{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"themes/butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/404.md","hash":"3bf1c1cecaf07cceea193fc8f00cb394145e9cc2","modified":1718462174094},{"_id":"source/_posts/2022å¹´ç»ˆæ€»ç»“.md","hash":"d487cdf0517746cbcf5d573e23568390753b53b0","modified":1718462174094},{"_id":"source/categories/index.md","hash":"12aa89fc2f5e0d39a459ade9efea837cde29e2bb","modified":1718462174094},{"_id":"source/tags/index.md","hash":"148a16399bdc84abbfdf5dfca0fb1446c5269ca2","modified":1718462174094},{"_id":"themes/butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":1718463162815},{"_id":"themes/butterfly/README.md","hash":"4e01b47448d9f3a02afc04eef644e2321253f6f4","modified":1718463162815},{"_id":"themes/butterfly/README_CN.md","hash":"148da187d16033624ceccce8b8561835296f5a5a","modified":1718463162815},{"_id":"themes/butterfly/package.json","hash":"314b0271ba3f668d0d6081b499b2d24e90dab25e","modified":1718463162819},{"_id":"themes/butterfly/.github/FUNDING.yml","hash":"da5e77f5e0cdb7e11b36546fb6796d10e3dfbe5d","modified":1718463162811},{"_id":"themes/butterfly/plugins.yml","hash":"d807fbb62163bb6fc5a83a24ebd69ac14cf45f67","modified":1718463162819},{"_id":"themes/butterfly/_config.yml","hash":"10e02050b5eeaf5d869cf4df4d3188c9cc4acebb","modified":1718521092168},{"_id":"themes/butterfly/languages/default.yml","hash":"90a6dc361de67532437d819a55ec64945ca5404b","modified":1718463162815},{"_id":"themes/butterfly/languages/en.yml","hash":"af5603b1a888f167dc80be6d53a19437b5cf6bef","modified":1718463162815},{"_id":"themes/butterfly/layout/archive.pug","hash":"bb32c9c476372de747dfa563b83f77d7a917a77d","modified":1718463162815},{"_id":"themes/butterfly/layout/category.pug","hash":"710708cfdb436bc875602abf096c919ccdf544db","modified":1718463162815},{"_id":"themes/butterfly/languages/zh-CN.yml","hash":"5004faee365139521f161babd66649a8107e4008","modified":1718463162815},{"_id":"themes/butterfly/languages/zh-TW.yml","hash":"03629d1d13a7be09d4933aa5dc0dcbe45e79140c","modified":1718463162815},{"_id":"themes/butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":1718463162819},{"_id":"themes/butterfly/layout/page.pug","hash":"baf469784aef227e4cc840550888554588e87a13","modified":1718463162819},{"_id":"themes/butterfly/layout/post.pug","hash":"fc9f45252d78fcd15e4a82bfd144401cba5b169a","modified":1718463162819},{"_id":"themes/butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":1718463162819},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"6e34b565ea013812d5e363b6de5fa1f9078d4e12","modified":1718463162811},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"7b4831ae8f8f8c55dd1b856781210c517c63e6dd","modified":1718463162811},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"996640605ed1e8e35182f0fd9a60a88783b24b03","modified":1718463162811},{"_id":"themes/butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":1718463162815},{"_id":"themes/butterfly/.github/workflows/stale.yml","hash":"ac62b989b5550c756e1986fcc68f243170705383","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/additional-js.pug","hash":"aca0ec7ef69b21d1f242c62fed389468a0f0e1a2","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/footer.pug","hash":"02390a5b6ae1f57497b22ba2e6be9f13cfb7acac","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/pagination.pug","hash":"4c85de4dea4dca4e5088097a79bd6d7009cbf8ef","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/head.pug","hash":"ecec62305aaa596bb1dfbb46c13d06fb5a9628cf","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/sidebar.pug","hash":"9f0e9e039f304439007460fa0a7c8ac18e0ffd37","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/layout.pug","hash":"7fa9ae4b70b87fc97e992dde5944681f92b59bea","modified":1718463162815},{"_id":"themes/butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/rightside.pug","hash":"db275f7fbe4438b54cd813b695f4834e10aa234f","modified":1718463162815},{"_id":"themes/butterfly/scripts/events/comment.js","hash":"5351e0bc09e6b5b3f6d30f333a2520626a28ca3a","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":1718463162819},{"_id":"themes/butterfly/scripts/events/cdn.js","hash":"21fb5aabe043486d095c4c8cce361ed85ba88a26","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_newest_comment.pug","hash":"7834bf7c711e739fd33cfcd0b53d151013b3d449","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_post_toc.pug","hash":"a658a274c5f7896ee5122725bee45548693bdd66","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_recent_post.pug","hash":"e5aac7b28ed4123d75797263c64e74ac547945bc","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_tags.pug","hash":"eceb4420a64c720f0d2741e89d6229bbb3d87353","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_webinfo.pug","hash":"35ce167c5a275211bfc1fa3d49adfde5b404d98f","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_author.pug","hash":"03c6afabbf1ac729c7fb21c7ec06da0190b0fdc7","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/index.pug","hash":"66f7a8b0cebc05c575ec3cb70b08d6854029d87a","modified":1718463162819},{"_id":"themes/butterfly/source/css/_global/function.styl","hash":"f19694a42dbe28eda4b39a1696e8fbcd277bc76c","modified":1718463162819},{"_id":"themes/butterfly/source/css/_highlight/highlight.styl","hash":"4dcd468e4d11a0ac75406162678feffcd89fee00","modified":1718463162819},{"_id":"themes/butterfly/source/css/_global/index.styl","hash":"c8ff6ddd5bfe1190b7b8056b68ce41114fd79dcb","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/widget/card_post_series.pug","hash":"bd5ad01277f8c6ddf8a3a29af1518e5fe6eed23f","modified":1718463162819},{"_id":"themes/butterfly/source/css/_layout/comments.styl","hash":"134811b2d696f9ed2c0cd578f3886f1c60770c0a","modified":1718463162819},{"_id":"themes/butterfly/source/css/_highlight/theme.styl","hash":"bcd384c8b2aa0390c9eb69ac1abbfd1240ce1da4","modified":1718463162819},{"_id":"themes/butterfly/source/css/_layout/chat.styl","hash":"f9a5d3f1fc5ed0ed2ee4c1eaa58ed650d11ddebd","modified":1718463162819},{"_id":"themes/butterfly/source/css/_layout/footer.styl","hash":"83a7a70eb0532ea9c4267939fe484af915fca01e","modified":1718463162819},{"_id":"themes/butterfly/source/css/_layout/aside.styl","hash":"fad650f88778b33a6358e38cf50dfafc0974d28f","modified":1718463162819},{"_id":"themes/butterfly/source/css/_layout/pagination.styl","hash":"fb9f78bfbb79579f1d752cb73fb6d25c8418e0fd","modified":1718463162819},{"_id":"themes/butterfly/source/css/_layout/loading.styl","hash":"ac2aeee9926f75b2a0098efe1c114126987430f2","modified":1718463162819},{"_id":"themes/butterfly/source/css/_layout/relatedposts.styl","hash":"d53de408cb27a2e704aba7f7402b7caebe0410d8","modified":1718463162819},{"_id":"themes/butterfly/source/css/_layout/post.styl","hash":"a2eb44fa5eaea1325319a2064439cf36d0f35a2f","modified":1718463162819},{"_id":"themes/butterfly/source/css/_layout/head.styl","hash":"18d08be0cd9b1f8c049d4b922e80f8163a55c947","modified":1718463162819},{"_id":"themes/butterfly/source/css/_layout/reward.styl","hash":"d6cf26ffb8a0343eda1cde65b6b73b0ddbe8fcfc","modified":1718463162819},{"_id":"themes/butterfly/source/css/_layout/rightside.styl","hash":"f845b9b4efdee750f70c023aab27432611f83059","modified":1718463162819},{"_id":"themes/butterfly/source/css/_layout/sidebar.styl","hash":"b7a6a585dbc38d177c9aba75df3a467415d0488a","modified":1718463162819},{"_id":"themes/butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":1718463162823},{"_id":"themes/butterfly/source/css/_layout/third-party.styl","hash":"5556c9bf4f53a90cb9b4945cd76a8849bd67f3f3","modified":1718463162819},{"_id":"themes/butterfly/source/css/_mode/readmode.styl","hash":"e549d24ad81a7d93326a509ff8dcfcc58c80729e","modified":1718463162819},{"_id":"themes/butterfly/source/css/_mode/darkmode.styl","hash":"0db591a1f4ed5adcb8668a549bbee5c9d62682cf","modified":1718463162819},{"_id":"themes/butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":1718463162823},{"_id":"themes/butterfly/source/css/_page/common.styl","hash":"4e320e16d49bc18085045937681f7331a1e243ca","modified":1718463162823},{"_id":"themes/butterfly/source/css/_page/archives.styl","hash":"c9e98027f2dd730ce389c2047f62ebb748955fcf","modified":1718463162823},{"_id":"themes/butterfly/scripts/events/stylus.js","hash":"e196a99733d7f90899bceed5d12488e8234817d5","modified":1718463162819},{"_id":"themes/butterfly/scripts/events/merge_config.js","hash":"2ac43fd4103ba3c6897da7c13015cb05f39fd695","modified":1718463162819},{"_id":"themes/butterfly/scripts/events/init.js","hash":"428b94c7b9e83f7ea36227dee66bfe3c23aee4a8","modified":1718463162819},{"_id":"themes/butterfly/scripts/events/welcome.js","hash":"8ad9911b755cba13dde2cc055c3f857a6b0dd20e","modified":1718463162819},{"_id":"themes/butterfly/scripts/filters/post_lazyload.js","hash":"860f967ecf3c6a6ea785b560a7aae4d0757cd18a","modified":1718463162819},{"_id":"themes/butterfly/scripts/filters/random_cover.js","hash":"a8eef3f37428436554f58a2b6bac7c255fbdf38d","modified":1718463162819},{"_id":"themes/butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":1718463162819},{"_id":"themes/butterfly/scripts/helpers/aside_categories.js","hash":"96f861151e3b889ef0ffe78821d489ad2625ee43","modified":1718463162819},{"_id":"themes/butterfly/scripts/helpers/findArchiveLength.js","hash":"7caf549810f971c34196fb9deac2d992545bdff9","modified":1718463162819},{"_id":"themes/butterfly/scripts/helpers/page.js","hash":"e2a8a09bfe47da26eab242a36f516e6c452c799a","modified":1718463162819},{"_id":"themes/butterfly/scripts/helpers/inject_head_js.js","hash":"d5c7e61257b08a9648404f6f48ce4d471cd5fa55","modified":1718463162819},{"_id":"themes/butterfly/scripts/helpers/related_post.js","hash":"4677be4175da6800c0b3b8c1614e593f73df8831","modified":1718463162819},{"_id":"themes/butterfly/scripts/helpers/series.js","hash":"821e973d41f7b3b64cde91e0e836ea49c43e3c06","modified":1718463162819},{"_id":"themes/butterfly/scripts/tag/button.js","hash":"93229d44b35b9da92e647b89d6d3087085974a29","modified":1718463162819},{"_id":"themes/butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":1718463162819},{"_id":"themes/butterfly/scripts/tag/gallery.js","hash":"418684993a3a3a2ac534257a2d9ecbcead6808c1","modified":1718463162819},{"_id":"themes/butterfly/scripts/tag/hide.js","hash":"365db87ddfc582bf8c15cb440c48bed95106e4b1","modified":1718463162819},{"_id":"themes/butterfly/scripts/tag/inlineImg.js","hash":"512c68a22ae4a58d6a6b24b368a0c00c2ccb4fcb","modified":1718463162819},{"_id":"themes/butterfly/scripts/tag/label.js","hash":"19773218877281ccffed921431e87148413a7c20","modified":1718463162819},{"_id":"themes/butterfly/scripts/tag/mermaid.js","hash":"5c2a07df5874b5377540884e4da14dd21489378f","modified":1718463162819},{"_id":"themes/butterfly/scripts/tag/note.js","hash":"1acefc59ead75ebd8cafee36efc7da4fa426d088","modified":1718463162819},{"_id":"themes/butterfly/scripts/tag/score.js","hash":"5cb273e95846874e3a58074074c501df23c5e912","modified":1718463162819},{"_id":"themes/butterfly/scripts/tag/series.js","hash":"830b1d592278b9f676df0cf9a91b1eeda2456aec","modified":1718463162819},{"_id":"themes/butterfly/scripts/tag/tabs.js","hash":"ffc62222f8d7b4d44c1c0726c8a08824a2201039","modified":1718463162819},{"_id":"themes/butterfly/scripts/tag/timeline.js","hash":"4526c75e5bf84609d67e92b6af3524bcb278e852","modified":1718463162819},{"_id":"themes/butterfly/source/css/index.styl","hash":"755490867fd8afe47d5cce24faea2ca172b0c4dd","modified":1718463162823},{"_id":"themes/butterfly/source/css/var.styl","hash":"152b6bd4b6285165541a71f5a1c913f8ee6a602b","modified":1718463162823},{"_id":"themes/butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1718463162823},{"_id":"themes/butterfly/source/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1718463162823},{"_id":"themes/butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1718463162823},{"_id":"themes/butterfly/source/js/main.js","hash":"0dac585446445e0c419b86eec5580bc9b0657dc6","modified":1718463162823},{"_id":"themes/butterfly/source/js/tw_cn.js","hash":"f8d2e3f31468991a7f5171cbfdb157dfb86d3372","modified":1718463162823},{"_id":"themes/butterfly/source/js/utils.js","hash":"8e6b48d294e7aeaba8ff6348c43b2271cf865547","modified":1718463162823},{"_id":"themes/butterfly/source/css/_search/algolia.styl","hash":"649a054e73278b6724bd4dd9b94724791ec5c928","modified":1718463162823},{"_id":"themes/butterfly/source/css/_page/homepage.styl","hash":"d4ebc41b5c855dd75f47de7345d62f85ce7cf073","modified":1718463162823},{"_id":"themes/butterfly/source/css/_search/index.styl","hash":"20a3134e1302b62bfc881f4ec43f398267111f22","modified":1718463162823},{"_id":"themes/butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":1718463162823},{"_id":"themes/butterfly/source/css/_search/local-search.styl","hash":"961589da3c0a532c4709a4a4ea96bd579257f766","modified":1718463162823},{"_id":"themes/butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":1718463162823},{"_id":"themes/butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":1718463162823},{"_id":"themes/butterfly/source/css/_tags/gallery.styl","hash":"5cddbb5f4eae695a26685e415d821b523e0f17bf","modified":1718463162823},{"_id":"themes/butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":1718463162823},{"_id":"themes/butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":1718463162823},{"_id":"themes/butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":1718463162823},{"_id":"themes/butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":1718463162823},{"_id":"themes/butterfly/source/css/_tags/note.styl","hash":"909bb5079b26b6ee68177919f522566503654058","modified":1718463162823},{"_id":"themes/butterfly/source/css/_tags/tabs.styl","hash":"2d02e52b360f6e6cae47c293ae57ed78e2554663","modified":1718463162823},{"_id":"themes/butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":1718463162823},{"_id":"themes/butterfly/source/js/search/algolia.js","hash":"108988d046da9a4716148df43b3975217c8ceaae","modified":1718463162823},{"_id":"themes/butterfly/source/js/search/local-search.js","hash":"e1f60ebac53a3f596fd0a4769b4f9275c48c6542","modified":1718463162823},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/abcjs.pug","hash":"f7299f9fef5bf94bb58c8cd3be8ee660ad2f9cd4","modified":1718463162815},{"_id":"themes/butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":1718463162823},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/index.pug","hash":"f58f1648d2d71311bafca4833f20b605bb5f18c8","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"b2d274db84ef22fbd6d5ea8f4404821898934209","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"c5f7081ca29db8cc80f808dfc29e36d5fa22fd7e","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"71af0b679e00290b0854384368b3c7e9b3e5f26a","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"0344477a2cf38698318ead2681c63ac12f01586e","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"001e8be47854b891efe04013c240c38fed4185eb","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"56c028ba0ea8fac19f0125114d765dfc56ce2b48","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"3a5ccfc69bd8ccb4b8f3ce3502023f7914f2a022","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"39427e107230a10790972349c9dd4c4f31d55eb7","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/chat/index.pug","hash":"618e1b7f9204049b07beb9e1363c844a78a9ace3","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/chat/crisp.pug","hash":"2fb098a7aa45010a8cd212dc0bd5308c6e7c63e3","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"9b57a8e13de8fc51a5f550854e47164fd8ac1be8","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/chat/chatra.pug","hash":"ddce8352b371a1fb426bdb6c33f587eb37a69647","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/chat/messenger.pug","hash":"e39a9c37adf4cb15a2ba3b2cc65542ffea88650d","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/chat/tidio.pug","hash":"dd61eca6e9a45f63e09bdefba89fe285a81ba096","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/artalk.pug","hash":"f77f0fdeac2bc8a72f71a58f9b75aa39f0a108c8","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqus.pug","hash":"62f16a602e57e5f7f7c5249dd37b42d436dc032a","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"0d378ee8a671982a46213a4bfb223b4f3409aea9","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"3bc4c1b91568561f0491bdac65b75aa0bfd01f27","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/giscus.pug","hash":"2d7b0b09678adba09481e3152e0b32962677f650","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"46aec6466959baec1c3d71a5dbc510fbeb00c91d","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/index.pug","hash":"a9709905593d960954e2dd572f09f48a6c2b1ef7","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/js.pug","hash":"00ed91c52939b9675b316137f854d13684c895a6","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/livere.pug","hash":"63cea2b5c8f7b59f5919379d61a2bb2ce8ed7623","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/remark42.pug","hash":"f15699abb8c7a255aabad0222ae53eee387c66a3","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"5c29b5887e2e6cd81e1f13b32da53d9c139b788b","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/valine.pug","hash":"46865e3f52096acb07d0212174b4e8751b123aea","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/utterances.pug","hash":"1995a654ba7ad62775a0a6e2922209cd1a85f2e3","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/comments/waline.pug","hash":"7aa443b4881448979b810864e206e58c9ed787e3","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/math/katex.pug","hash":"dfcbd9881be569ea420eff1a6b00e4f4dbe2138e","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/math/mermaid.pug","hash":"6b67982bb7a3713b5bffd6a23ba2810425c504d0","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/math/mathjax.pug","hash":"fc072ac839401174b5d3cf9acd3b694246c23a55","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"17080aba1754478197ab089f7948ed900f116d2b","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"2609bc2656aaaa9b59e8d575e711776512a62192","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"0f0b46d637a9a1b6ae35148923abecc80b866276","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"4ec0642f2d5444acfab570a6f8c7868e7ff43fde","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"1f9f51023e9e33081c2add2ca73643c0edc5e9d5","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"4104f96faa6040f111ebfb9a90eeb470857c3b86","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"de2c4d02b520dd49a0a59fc0f33295e5bbb2c624","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"24804ab6da9727ed793655c1262fa3f1a9746f70","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/search/algolia.pug","hash":"9c3c109a12d2b6916e8b4965cca12f521510ead9","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/search/index.pug","hash":"a99a41334387ee9a46c6f8e8212331a29a10d159","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/search/local-search.pug","hash":"3335024ba91f55ccf3858571b7898f46881c455c","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/search/docsearch.pug","hash":"b928be14d1b47a9fadb1bcc5f5072a7328752d4b","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/share/addtoany.pug","hash":"85c92f8a7e44d7cd1c86f089a05be438535e5362","modified":1718463162819},{"_id":"themes/butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/share/index.pug","hash":"3ba49cfe186e9ca05faf9f0d0113611ec47e9b38","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/share/share-js.pug","hash":"c7dd2b2ae9b23aa0a60fffd7df9e9f76ef52033e","modified":1718463162819},{"_id":"themes/butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":1718463162819},{"_id":"themes/butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":1718463162819},{"_id":"themes/butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"25914321762e30aacc610bc4dfb9de3e1cb556a3","modified":1718463162819},{"_id":"themes/butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/head/Open_Graph.pug","hash":"8aa8d799aedbfd811195b84a451bc4b6e2647c12","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/head/analytics.pug","hash":"67e1c3b48e4ca7ee0b2c76d3ca7476b9883cf105","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/head/config.pug","hash":"63fed4548367a3663cdbaffa1df48167b0a2397b","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/head/preconnect.pug","hash":"5208fe1e75d97a05fd9bdd6cc53c59d8b741b94b","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/header/index.pug","hash":"944d6e9dd50df3395f3a2c7ad9db667d50dea4ed","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/header/menu_item.pug","hash":"31346a210f4f9912c5b29f51d8f659913492f388","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/header/nav.pug","hash":"f61659aa457d1a2d1baa3a13157996cfac4d6609","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/header/social.pug","hash":"5de9a82032cdad1db3b868b797460921cd775fc2","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/header/post-info.pug","hash":"f50e6a17073677933c5bc78481bf587a4a9e6da0","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/loading/fullpage-loading.pug","hash":"9e8c5788602b29a527ef35fe8a20076a5fa969bd","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/loading/index.pug","hash":"131f344d68b4c241d6e03849b243ee792fcd3cea","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/loading/pace.pug","hash":"6ab4e301c92586505d6cddce1b3ad23b7c79010d","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/mixins/article-sort.pug","hash":"90554c2ca5ba946f4c02e1bc5fe2859cef1b1594","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/mixins/post-ui.pug","hash":"6f310ca7b392021632b987557607d5b6d18052bb","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/post/post-copyright.pug","hash":"5574804fdea5edf7fd52aad2caf030614d5e7f2f","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/post/reward.pug","hash":"a096ff8eb6b2a22395be881f827ff2a686ba5596","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/aplayer.pug","hash":"c7cfade2b160380432c47eef4cd62273b6508c58","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/effect.pug","hash":"1d39670ee6225f85f5c53bf5c84f3fd6e19290e8","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/third-party/pangu.pug","hash":"0f024e36b8116118233e10118714bde304e01e12","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/pjax.pug","hash":"12e57491e94fa00d953bbda9db0b6d6169e2358c","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/prismjs.pug","hash":"ffb9ea15a2b54423cd4cd441e2d061b8233e9b58","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/third-party/subtitle.pug","hash":"8044b9c18b34b019ffe26b7383e7e80356b5e4b5","modified":1718463162819},{"_id":"themes/butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/page/flink.pug","hash":"f9ce83978b217a71a2eb8761dc14b09866faa3f4","modified":1718463162815},{"_id":"themes/butterfly/layout/includes/page/tags.pug","hash":"9621991359e22b14049346f1cf87bdedc94edf5a","modified":1718463162815},{"_id":"public/atom.xml","hash":"0ed9df1c414babf36db89a13f5b9948d8473ab25","modified":1718522348024},{"_id":"public/search.xml","hash":"11d6f35e8e522227c1e63e7fb403abef08c4b504","modified":1718510864801},{"_id":"public/404.html","hash":"63af05ea75fb14957e19a5ca077a3243122315bb","modified":1718522348024},{"_id":"public/categories/index.html","hash":"c0bb9bc4e5bb52373a34c2fb715216f16cc0bc24","modified":1718522348024},{"_id":"public/tags/index.html","hash":"d7a908396c69b281ff1d8f29daabee5da9df3240","modified":1718522348024},{"_id":"public/2023/01/01/2022å¹´ç»ˆæ€»ç»“/index.html","hash":"9c73fe85099ba5e6fcf055af84298418f68a4360","modified":1718522348024},{"_id":"public/archives/index.html","hash":"e2169a3e51a425d3048bc2498c3cff649e1c2eb7","modified":1718522348024},{"_id":"public/archives/2023/index.html","hash":"965e014600930343a381c16eda7f2c091cde960e","modified":1718522348024},{"_id":"public/archives/2023/01/index.html","hash":"11a7563e2b7248af2893d154f804f1bb27faa20f","modified":1718522348024},{"_id":"public/categories/å¹´ç»ˆæ€»ç»“/index.html","hash":"b494d1f944440117961fd28333c5c9f99ac2225c","modified":1718522348024},{"_id":"public/tags/ç”Ÿæ´»/index.html","hash":"94b395ef1690bc44fac31be4352b84640d1012e5","modified":1718522348024},{"_id":"public/index.html","hash":"7d3d30b184ce08e139b42b440c36ce9883ed6948","modified":1718522348024},{"_id":"public/tags/å·¥ä½œ/index.html","hash":"98dda19babfea26e7934d3706e40b4370656aea5","modified":1718522348024},{"_id":"public/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1718471115997},{"_id":"public/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1718471115997},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1718471115997},{"_id":"public/css/index.css","hash":"af3f925766b9d943cfa511e4f59f84846459cf7e","modified":1718471115997},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1718471115997},{"_id":"public/js/utils.js","hash":"8e6b48d294e7aeaba8ff6348c43b2271cf865547","modified":1718471115997},{"_id":"public/js/tw_cn.js","hash":"f8d2e3f31468991a7f5171cbfdb157dfb86d3372","modified":1718471115997},{"_id":"public/js/main.js","hash":"0dac585446445e0c419b86eec5580bc9b0657dc6","modified":1718471115997},{"_id":"public/js/search/algolia.js","hash":"108988d046da9a4716148df43b3975217c8ceaae","modified":1718471115997},{"_id":"public/js/search/local-search.js","hash":"e1f60ebac53a3f596fd0a4769b4f9275c48c6542","modified":1718471115997},{"_id":"source/_posts/DM-æ•°æ®æ—…ç¨‹-00ï¼šåºè¨€.md","hash":"0b1c9abd77647339f68eeda308089a61338c3a46","modified":1718521427893},{"_id":"public/2023/01/03/DM-æ•°æ®æ—…ç¨‹-00ï¼šåºè¨€/index.html","hash":"107b9bed8cebac51de50c9c6ce08e6c1f35c82cc","modified":1718522348024},{"_id":"public/tags/DM-æºç é˜…è¯»/index.html","hash":"553a6c5e7c63b8a432087c8f21a18ef273e45571","modified":1718474483817},{"_id":"source/_posts/DM-æ•°æ®æ—…ç¨‹-01ï¼šç¬¬ä¸€æ¬¡-start-task.md","hash":"83903e92d9a0364c886238a07fd2b11980288c11","modified":1718521949395},{"_id":"public/2023/01/03/DM-æ•°æ®æ—…ç¨‹-01ï¼šç¬¬ä¸€æ¬¡-start-task/index.html","hash":"02a50eb8b50fcfa0561c8aa969ed73f278ae74ae","modified":1718522348024},{"_id":"public/categories/DM-æ•°æ®æ—…ç¨‹/index.html","hash":"f8b46791aea99158308ae32279b27a49328195bb","modified":1718522348024},{"_id":"public/tags/DM/index.html","hash":"ff2c70179c35e4364505dc5d0895fd2b71fa061e","modified":1718522348024},{"_id":"public/tags/æºç é˜…è¯»/index.html","hash":"146a3c8b546f6d1b3e0b7e6e72f65c079abb3152","modified":1718522348024},{"_id":"source/_posts/DM-æ•°æ®æ—…ç¨‹-01ï¼šç¬¬ä¸€æ¬¡-start-taskasdfsd.md","hash":"aecd4adf32c0a4fad664d60b8637678467b98b01","modified":1718509233930},{"_id":"public/2023/01/03/DM-æ•°æ®æ—…ç¨‹-01ï¼šç¬¬ä¸€æ¬¡-start-taskasdfsd/index.html","hash":"9e5114cb90147de9c36188695cddc5279c820fe1","modified":1718510068282},{"_id":"source/_posts/DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”02Lock-Resolve-Lock.md","hash":"6efe70ae74a10ac816c54df06f631f2aa7115687","modified":1718521164542},{"_id":"public/2023/01/03/DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”02Lock-Resolve-Lock/index.html","hash":"70b7dc374d5d9e8f9bbbcef43a10ec1ec4e27098","modified":1718522348024},{"_id":"source/_posts/DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”03reSync.md","hash":"fe8c2d96dffe9f5eeb09668a3e8124f7d3ef8af2","modified":1718521214111},{"_id":"public/2024/06/16/DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”03reSync/index.html","hash":"ddb3f8fd0fb8d82ad11c408794b4262f91e086fb","modified":1718510326277},{"_id":"public/archives/2024/index.html","hash":"ade5c83226994bf5a426c62fe910cd1ade8b4aa6","modified":1718510326277},{"_id":"public/archives/2024/06/index.html","hash":"9e0c6a1ac481d1e3265a0e992b9bd944e3ddc8d4","modified":1718510326277},{"_id":"public/2023/01/03/DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”03reSync/index.html","hash":"94ec463fa55fa8ae6e64d07c6c929ae312f08414","modified":1718522348024},{"_id":"source/_posts/DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”01å‡†å¤‡è¿‡ç¨‹.md","hash":"a56bc2ea0eb1314c0e75e639eccbb57940f9b6fb","modified":1718521804519},{"_id":"public/2023/01/03/DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”01å‡†å¤‡è¿‡ç¨‹/index.html","hash":"65754687493e48a685156d3240021114a57d15b7","modified":1718522348024}],"Category":[{"name":"å¹´ç»ˆæ€»ç»“","_id":"clxgdbzom0003xbdyhftahxry"},{"name":"DM æ•°æ®æ—…ç¨‹","_id":"clxgfdvel0004fhdyg0rb7wuq"}],"Data":[],"Page":[{"title":"404 Not Found","date":"2021-03-08T02:41:27.000Z","_content":"\n<center>\nå¯¹ä¸èµ·ï¼Œæ‚¨æ‰€è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨æˆ–è€…å·²åˆ é™¤ã€‚\næ‚¨å¯ä»¥<a href=\"https://okjiang.github.io>\">ç‚¹å‡»æ­¤å¤„</a>è¿”å›é¦–é¡µã€‚\n</center>\n\n<blockquote class=\"blockquote-center\">\n    okJiang\n</blockquote>","source":"404.md","raw":"---\ntitle: 404 Not Found\ndate: 2021-03-08 10:41:27\n---\n\n<center>\nå¯¹ä¸èµ·ï¼Œæ‚¨æ‰€è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨æˆ–è€…å·²åˆ é™¤ã€‚\næ‚¨å¯ä»¥<a href=\"https://okjiang.github.io>\">ç‚¹å‡»æ­¤å¤„</a>è¿”å›é¦–é¡µã€‚\n</center>\n\n<blockquote class=\"blockquote-center\">\n    okJiang\n</blockquote>","updated":"2024-06-15T14:36:14.094Z","path":"404.html","comments":1,"layout":"page","_id":"clxgdbzoe0000xbdydomgf618","content":"<center>\nå¯¹ä¸èµ·ï¼Œæ‚¨æ‰€è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨æˆ–è€…å·²åˆ é™¤ã€‚\næ‚¨å¯ä»¥<a href=\"https://okjiang.github.io>\">ç‚¹å‡»æ­¤å¤„</a>è¿”å›é¦–é¡µã€‚\n</center>\n\n<blockquote class=\"blockquote-center\">\n    okJiang\n</blockquote>","site":{"data":{}},"cover":false,"length":39,"excerpt":"","more":"<center>\nå¯¹ä¸èµ·ï¼Œæ‚¨æ‰€è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨æˆ–è€…å·²åˆ é™¤ã€‚\næ‚¨å¯ä»¥<a href=\"https://okjiang.github.io>\">ç‚¹å‡»æ­¤å¤„</a>è¿”å›é¦–é¡µã€‚\n</center>\n\n<blockquote class=\"blockquote-center\">\n    okJiang\n</blockquote>"},{"title":"categories","date":"2023-01-01T11:33:56.000Z","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2023-01-01 19:33:56\ntype: categories\ncomments: false\n---\n","updated":"2024-06-15T14:36:14.094Z","path":"categories/index.html","layout":"page","_id":"clxgdbzok0002xbdy4qg22tn9","content":"","site":{"data":{}},"cover":false,"length":0,"excerpt":"","more":""},{"title":"tags","date":"2023-01-01T11:33:42.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2023-01-01 19:33:42\ntype: tags\ncomments: false\n---\n","updated":"2024-06-15T14:36:14.094Z","path":"tags/index.html","layout":"page","_id":"clxgdbzon0005xbdy5lm4cqcq","content":"","site":{"data":{}},"cover":false,"length":0,"excerpt":"","more":""}],"Post":[{"title":"2022å¹´ç»ˆæ€»ç»“â€”â€”å¹¸è¿å¼€å¿ƒçš„ä¸€å¹´","date":"2023-01-01T12:00:52.000Z","_content":"\nç¬¬ä¸€æ¬¡å†™å¹´ç»ˆæ€»ç»“å‘€ï¼Œå°è¯•è®°å½•ä¸€ä¸‹ã€‚ä¸€å¹´ä¸‹æ¥è¿˜çœŸå‘ç”Ÿäº†ä¸å°‘äº‹ã€‚çœ‹çœ‹è‡ªå·±æœ‰å•¥æ”¶è·æœ‰å•¥æˆé•¿ã€‚\n\n## å·¥ä½œ\n\nå…ˆè¯´è¯´å·¥ä½œå§ã€‚ä»å—å¤§æ¯•ä¸šåï¼Œæˆ‘å»äº† PingCAPï¼ˆè´µå¸ï¼‰å·¥ä½œï¼Œç°åœ¨åœ¨è´µå¸çš„ DMï¼ˆData Migrationï¼‰å›¢é˜Ÿå·¥ä½œï¼Œå·®ä¸å¤šå°±åœ¨æ•°æ®å¯¼å…¥ã€æ•°æ®è¿ç§»ä»¥åŠå…¶å¯¹åº”çš„äº‘ä¸Šç‰ˆæœ¬è¿™äº›åœ°æ–¹æ¬ç –ã€‚å»å¹´å°±æœ‰åœ¨è´µå¸å®ä¹ ï¼Œä¸»è¦åœ¨ç»´æŠ¤ DMï¼Œä¹Ÿå°±æ˜¯æ€ä¹ˆæŠŠä¸€æ¡ binlog å†™åˆ°ä¸‹æ¸¸ TiDB é‡Œé¢ï¼Œå’Œ MySQL binlog æ‰“äº¤é“æ¯”è¾ƒå¤šã€‚ä»Šå¹´å…¥èŒåï¼Œé¡ºåº”å…¬å¸çš„æˆ˜ç•¥ï¼Œä¸»è¦åœ¨ tidbcloud.com ä¸Š CRUDï¼Œå¸®åŠ©ç”¨æˆ·åœ¨ cloud ä¸Šå¯¼å…¥æˆ–è¿ç§»æ•°æ®ï¼Œå’Œ k8sã€CRUD ä»¥åŠç”¨æˆ·ä½“éªŒæ‰“äº¤é“æ¯”è¾ƒå¤šã€‚\n\nç®€å•æ€»ç»“ä¸€ä¸‹å­¦åˆ°çš„ä¸œè¥¿å§ï¼Œä»å®ä¹ åˆ°ç°åœ¨ï¼š\n\n1. å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•\n2. å¤šçº¿ç¨‹ä»£ç \n3. review ä»£ç \n4. å†™è®¾è®¡æ–‡æ¡£\n5. ç†è§£ä¸€ä¸ªéœ€æ±‚æ˜¯ä»»ä½•å·¥ä½œçš„ç¬¬ä¸€æ­¥\n6. å¯¹ä¸€ä¸ªéœ€æ±‚è¿›è¡Œé¡¹ç›®ç®¡ç†ï¼Œä»¥å°½å¯èƒ½åœ°æŒ‰æ—¶äº¤ä»˜ï¼ˆå½“ç„¶ç°åœ¨è¿˜åšçš„ä¸å¤Ÿå¥½ã€‚ã€‚ã€‚ï¼‰\n7. å­¦ä¹ äº† K8s/CRD/Operator/AWS/Pulumi ç›¸å…³çš„çŸ¥è¯†ï¼Œèƒ½çœ‹æ‡‚ä»£ç ï¼Œå¹¶ç¼–å†™ç®€å•çš„ä»£ç \n8. æ›´å¤šåœ°è€ƒè™‘ç”¨æˆ·ä½“éªŒ\n9. ã€‚ã€‚\n\nå†è°ˆè°ˆå·¥ä½œçš„æ„Ÿå—ã€‚å¯¹äºæˆ‘è¿™ç¬¬ä¸€ä»½æ­£å¼çš„å·¥ä½œï¼Œæˆ‘æ˜¯éå¸¸æ»¡æ„æˆ‘å½“å‰çš„å›¢é˜Ÿå’Œå…¬å¸çš„ã€‚ä¸è®ºæ˜¯å…¬å¸è¿˜æ˜¯å›¢é˜Ÿå†…ï¼Œå¤§ä½¬éå¸¸å¤šï¼Œå¯ä»¥åœ¨ä»–ä»¬èº«ä¸Šå­¦åˆ°å¾ˆå¤šä¸œè¥¿ã€‚å›¢é˜Ÿå†…çš„äººå¤§å®¶å®äº‹æ±‚æ˜¯ã€äº’ç›¸å¸®åŠ©ï¼Œæˆ‘æ˜¯æ²¡æœ‰é‡åˆ°ä»€ä¹ˆå°”è™æˆ‘è¯ˆï¼Œä¸ºäº†åˆ©ç›Šèµ·å†²çªçš„æƒ…å†µï¼Œå¾ˆ niceï¼è™½ç„¶å¾ˆå¤šäººè¯Ÿç—…è´µå¸å·²ç»ä¸æ˜¯ä»¥å‰çš„è´µå¸äº†ï¼Œä¹‹å‰çš„å·¥ç¨‹å¸ˆæ–‡åŒ–æ²¡æœ‰é‚£ä¹ˆçº¯ç²¹äº†ï¼Œä½†æˆ‘è¿˜æ˜¯å¸®å…¬å¸è¯´å¥è¯ã€‚ä»Šå¹´ 2022 å¹´çš„ç¯å¢ƒå¤§å®¶è¿˜æ˜¯å¯ä»¥çœ‹å¾—åˆ°çš„ï¼ŒåŒæ ·ä»¥å·¥ç¨‹å¸ˆæ–‡åŒ–è‘—ç§°çš„å°é©¬ï¼Œå·²ç»æŠŠ 22 å±Šå¤§éƒ¨åˆ†çš„åº”å±Šç”Ÿè£æ‰äº†ï¼Œæˆ‘æœ‰åŒå­¦å°±åœ¨è¢«è£åå•é‡Œã€‚æ‰€ä»¥å¯¹äºä¸€ä¸ªåŒæ ·æ˜¯åº”å±Šç”Ÿçš„æˆ‘ï¼Œæˆ‘è¿˜æ˜¯å¾ˆä½©æœå…¬å¸çš„æˆ˜ç•¥å’Œå®šåŠ›ï¼Œä»¥å¸®åŠ©å…¬å¸ç»§ç»­ç”Ÿå­˜ä¸‹å»ï¼Œæ¯•ç«Ÿæ´»ä¸‹å»æ‰æœ‰æœªæ¥ã€‚æˆ‘çŸ¥é“è¿™ä¸¤è€…ä¹Ÿå¹¶ä¸æ˜¯å†²çªçš„ï¼Œä½†æˆ‘è¿˜æ˜¯åº†å¹¸å…¬å¸èƒ½è®©æˆ‘æœ‰ä¸€ä¸ªåœ°æ–¹å­¦ä¹ å’Œæˆé•¿ã€‚å½“ç„¶ï¼Œå¤§å®¶ä¹Ÿéƒ½ä¼šå¸Œæœ›è‡ªå·±çš„å…¬å¸èƒ½è¶Šæ¥è¶Šå¥½ï¼\n\nè®°å½•ä¸€ä¸‹ï¼šä»Šå¹´ 1 æœˆä»½å…¨ç»„äººå‘˜é½èšåŒ—äº¬å›¢ï¼ˆmianï¼‰å»ºï¼ˆjiï¼‰ï¼Œç¬¬ä¸€æ¬¡æ­£å¼è§åˆ°äº†æ¥è‡ªæˆéƒ½ã€åŒ—äº¬ã€æ­å·ã€ä¸Šæµ·çš„å„ä½å¤§ä½¬ï¼Œä¹Ÿè·Ÿç€ mentor æ²¡ç¾æ²¡è‡Šåœ°è¹­åƒè¹­å–ç©äº†ä¸¤å¤©å“ˆå“ˆã€‚ä¸å¾—ä¸è¯´ï¼Œå¤ªçˆ½äº†å“ˆå“ˆå“ˆğŸ¶ã€‚\n\n## å­¦ç”Ÿç”Ÿæ¶¯\n\nä»Šå¹´ç»ˆäºä»ç¡•å£«æ¯•ä¸šäº†ã€‚å¦è¯šåœ°å¯¹ç¡•å£«è¿™ä¸‰å¹´åšä¸ªç®€çŸ­çš„æ€»ç»“å§ã€‚è‡ªå·±åœ¨ä¸‰å¹´ä¸­å‡ ä¹æ²¡æœ‰ä»»ä½•çš„æˆæœï¼Œè¿ä¸€ç¯‡è®ºæ–‡éƒ½æ²¡å‘è¿‡ï¼Œåœ¨ç§‘ç ”è¿™æ¡è·¯ä¸Šï¼Œæˆ‘ä¹Ÿç®—çš„ä¸Šæ˜¯å½»åº•å¤±è´¥äº†ã€‚ä¸è¿‡è¿™ä¸‰å¹´æ¯”è¾ƒå¹¸è¿çš„æ˜¯ï¼Œæˆ‘åœ¨ç ”ä¸€ä¸‹å°±æ„è¯†åˆ°äº†è‡ªå·±ä¸é€‚åˆèµ°ç§‘ç ”è¿™æ¡è·¯ï¼Œæ‰€ä»¥èŠ±äº†å¾ˆå¤šæ—¶é—´åœ¨æ€è€ƒå’Œå®è·µè‡ªå·±ä»¥åè¦åšä»€ä¹ˆè¿™ä¸ªé—®é¢˜ä¸Šã€‚ä¹Ÿæ‰¾åˆ°äº†è‡ªè®¤ä¸ºçŸ­ä¸­æœŸå†…å‘å±•è¿˜ä¸é”™çš„æ•°æ®åº“è¿™æ¡é“è·¯ã€‚\n\n> åœ¨è¯»ä¹¦æœŸé—´ï¼Œç»å¸¸å’ŒåŒå­¦è°ƒä¾ƒï¼Œè¯»ç ”æœ€å¤§çš„ä½œç”¨ï¼Œå°±æ˜¯å‘ç°äº†è¯»ç ”æ²¡ç”¨ã€‚å“ˆå“ˆå“ˆï¼Œè¿™å¥è¯å¯èƒ½æœ‰ç‚¹è¿‡ï¼Œä½†ä¹Ÿæ˜¯åªæœ‰è¯»ç ”åï¼Œæ‰èƒ½ç†è§£å¾ˆå¤šå¤§ä½¬è¯´çš„ï¼Œã€Œå›½å†…çš„ç ”ç©¶æœ‰äº›æµ®èºã€ä¸­**æµ®èº**çš„å«ä¹‰å§ï¼ˆå¹æ¯ï¼‰\n\n## ç”Ÿæ´»\n\nåœ¨æ¯•ä¸šåï¼Œæ­£å¼å¼€å¯äº†æˆ‘è‡ªå·±çš„ç”Ÿæ´»ã€‚è¿™ä¸€æ¬¡å’Œæˆ‘ä¹‹å‰çš„å®ä¹ éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ‹’ç»äº†åˆç§Ÿï¼Œé€‰æ‹©äº†ä¸€ä¸ªäººæ•´ç§Ÿä¸€ä¸ªå°åŒºé‡Œçš„ä¸€å®¤ä¸€å…ã€‚åœ¨çœé’±å’Œç”Ÿæ´»è´¨é‡ä¸­é€‰æ‹©äº†åè€…ã€‚å½“æ—¶åœ¨æ¥å¹¿å·ä¹‹å‰å°±ç–¯ç‹‚åœ°çœ‹æˆ¿ï¼Œå¹»æƒ³ç€è‡ªå·±ä¸€ä¸ªäººè‡ªç”±çš„ç”Ÿæ´»å“ˆå“ˆå“ˆã€‚æ¥äº†å¹¿å·ä¹‹åå°±ç–¯ç‹‚åœ°æ‰¾æˆ¿å­ï¼Œä¸€å®¤ä¸€å…çš„å°åŒºæˆ¿å®åœ¨æ˜¯å¤ªå°‘äº†ğŸ¤®ã€‚æˆ‘é‡åˆ°ä¸€ä¸ª 2500/æœˆ 60 å¹³çš„æˆ¿å­ï¼Œä¸‹åˆ 2 ç‚¹çœ‹å®Œé¥­ï¼Œä¸‹åˆ 4 ç‚¹å°±è¢«ç§Ÿå‡ºå»äº†ï¼å°±æ˜¯è¢«æˆ‘åé¢ä¸€ä¸ªçœ‹æˆ¿çš„äººç§Ÿèµ°äº†ã€‚ã€‚ã€‚è¿™æ•ˆç‡ç®€ç›´äº†ã€‚æœ€åç§Ÿåˆ°äº†ä¸€é—´ 3000 å‡ºå¤´çš„ä¸€å®¤ä¸€å…ï¼Œæˆ¿ä¸œéå¸¸ niceï¼Œç»™é…äº†æ–°çš„é©¬æ¡¶ã€ç”µçƒ­æ°´å™¨ã€ç©ºè°ƒã€æŠ½æ²¹çƒŸæœºå’Œç¶å°ï¼Œç”šè‡³è¿˜é‡æ–°è£…ä¿®äº†å¨æˆ¿ï¼è™½ç„¶è¿˜æœ‰ä¸è¶³çš„åœ°æ–¹ï¼Œä½†æˆ‘å·²ç»éå¸¸æ»¡è¶³äº†ï¼\n\n### æ·»ç½®æ–°ç‰©ä»¶\n\n#### å¤§æ¡Œå­âœ…\n\nåœ¨è‡ªå·±ç§Ÿäº†æˆ¿å­ä¹‹åï¼Œå¿…ç„¶ä¹Ÿæ˜¯è¦æ•´ä¸€ä¸ªæ­£ç»çš„å°ä¹¦æ¡Œçš„å•¦ã€‚åœ¨é—²é±¼ä¸Šè¹²äº†å¥½å‡ å¤©ï¼Œä¸­é—´è¿˜å»æ—è¾¹çš„äºŒæ‰‹å¸‚åœºçœ‹äº†ï¼Œæœ€åèŠ± 220 è¹²åˆ°äº†è¿™å¼  160âœ–ï¸70 çš„æ¡Œå­ï¼ˆè´§æ‹‰æ‹‰éƒ½èŠ±äº† 100+ ğŸ˜‚ï¼‰\n\n[![tk3cN.th.jpeg](https://i.328888.xyz/2023/01/02/tk3cN.th.jpeg)](https://imgloc.com/i/tk3cN)\n\n#### æ´æ´æ¿âœ…\n\nçœ‹ B ç«™è§†é¢‘è¿˜çœ‹åˆ°äº†è¿™ç§ç«‹å¼çš„æ´æ´æ¿ï¼Œæƒ³åˆ°å‡ºç§Ÿå±‹é‡Œä¹Ÿå®Œå…¨æ²¡æœ‰ä¹¦æ¶ã€å°ç‰©ä»¶çš„æ”¶çº³ä»€ä¹ˆçš„ï¼Œå°±æ•´äº†ä¸€ä¸ªã€‚è¿˜è¡Œå“ˆï¼Œæ¯”å…‰ç§ƒç§ƒçš„å¥½å¤šäº†ã€‚\n\n[![tkHFX.th.jpeg](https://i.328888.xyz/2023/01/02/tkHFX.th.jpeg)](https://imgloc.com/i/tkHFX)\n\n#### äººä½“å·¥å­¦æ¤…âœ…\n\næ¯•ç«Ÿå·¥ä½œéœ€è¦ï¼Œç«‹é©¬ä¹Ÿæ•´äº†ä¸ªå¥½æ¤…å­ï¼Œå¯ä»¥ç”¨å¾ˆä¹…äº†\n\n[![t0jdv.th.jpeg](https://i.328888.xyz/2023/01/02/t0jdv.th.jpeg)](https://imgloc.com/i/t0jdv)\n\n#### ç‰™å¥—âœ…\n\nä»å¾ˆå¤šå¹´å‰è‡ªå·±å°±è§‰å¾—è‡ªå·±çš„ç‰™é½¿ä¸é½ï¼Œæƒ³è¦åšç‰™é½¿çŸ«æ­£ï¼Œä½†æ— å¥ˆå› ä¸ºé’±æˆ–è€…é•¿ä½åœ°ä¸ç¨³å®šç­‰åŸå› ï¼Œä¸€ç›´æ²¡å¼€å§‹ã€‚æ‰€ä»¥åœ¨å¹¿å·å®‰é¡¿ä¸‹æ¥ä¹‹åï¼Œç«‹é©¬å¼€å§‹äº†ç‰™é½¿çŸ«æ­£çš„è¿›ç¨‹ã€‚ä¸Šä¸‹å·¦å³æ‹”äº† 4 é¢—ç‰™ï¼å¦ˆè€¶ï¼Œç–¼æ­»æˆ‘äº†ã€‚\n\n#### æ‰“å‡»å«âœ…\n\næˆ‘è‡ªå·±å¯¹éŸ³ä¹ä¹Ÿä¸€ç›´æŒºæ„Ÿå…´è¶£çš„ï¼Œå“ˆå“ˆå°±æƒ³åšç‚¹éŸ³ä¹ç›¸å…³çš„çˆ±å¥½ã€‚ä¹‹å‰æœ‰å…³æ³¨ä¸€ä¸ªç»åœ°çš„ä¸»æ’­ï¼Œä»–ç©çš„æ‰“å‡»å«è¶…é…·ï¼ç°åœ¨æœ‰è‡ªå·±çš„ç©ºé—´å’Œç”Ÿæ´»äº†ï¼Œå°±æ•´äº†ä¸€ä¸ªäºŒæ‰‹çš„å…¥é—¨æ¬¾ã€‚\n\n[![twO4o.th.jpeg](https://i.328888.xyz/2023/01/02/twO4o.th.jpeg)](https://imgloc.com/i/twO4o)\n\nä½†æ˜¯éå¸¸å¯æƒœï¼Œåœ¨ç»ƒå®Œå…¥é—¨æ›² [Luz letter](https://www.bilibili.com/video/BV1bv4y1B7RL/?spm_id_from=333.999.0.0&vd_source=1d41e3899bfb8af8d65144aad99bbde1) åï¼Œåœ¨å¦å¤–æŒ‘äº†ä¸€é¦–[è¿›é˜¶çš„æ›²å­](https://www.bilibili.com/video/BV1q8411E7ts/?spm_id_from=333.999.0.0&vd_source=1d41e3899bfb8af8d65144aad99bbde1)ç»ƒä¹ è¿‡ç¨‹ä¸­å°±å‘ç°äº†é—®é¢˜â€”â€”ç¯å…‰è·Ÿä¸ä¸ŠèŠ‚å¥ã€‚ã€‚ã€‚è¿™ä¸ªå…¥é—¨æ¬¾çš„ç¯å…‰é¢‘ç‡å¤ªä½äº†ï¼Œå°è¯•äº†å¾ˆå¤šæ¬¡ä¹‹åè¿˜æ˜¯æ”¾å¼ƒäº†ç»§ç»­åœ¨è¿™æ¬¾ä¸Šé¢ç»§ç»­ç»ƒï¼Œç„¶åè’åºŸåˆ°ç°åœ¨ï¼ˆå“ï¼Œå¯æƒœã€‚\n\n#### PS5/å¤§ç”µè§†âœ…\n\nåœ¨åŒåä¸€çš„æ—¶å€™ï¼Œæ”¶äº†ä¸€ä¸ªäºŒæ‰‹çš„ PS5ï¼Œè¿˜é…äº†ä¸€ä¸ªå¤§ç”µè§†ï¼è¿™ä¸ªå°å‡ºç§Ÿå±‹ä¹Ÿç»ˆäºå¯ä»¥çœ‹ç”µè§†äº†ã€‚\n\n![t0Law.jpeg](https://i.328888.xyz/2023/01/02/t0Law.jpeg)\n\né¡ºå¸¦è¯„ä»·ä¸€ä¸‹è€å¤´ç¯å§ï¼Œåœ¨ PS5 ä¸Šç©çš„ç¬¬ä¸€ä¸ªæ¸¸æˆã€‚ä¹‹å‰ä¹Ÿæœ‰ç©è¿‡é»‘é­‚ 3ï¼Œ1ï¼‰æ‰€ä»¥å¹¶æ²¡æœ‰ç¬¬ä¸€æ¬¡ç©é­‚ç±»æ¸¸æˆé‚£ç§å†²å‡»äº†ï¼Œè€Œä¸”è€å¤´ç¯çš„éš¾åº¦ç³»æ•°ç›¸æ¯”é»‘é­‚ç¡®å®ä½äº†ä¸å°‘ï¼Œè½¬è§’æ€å°‘äº†ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥è€ç©å®¶åœ¨è½¬è§’å¤„å›å¤´çš„æ—¶å€™ç»å¸¸â€œå¤±æœ›â€å“ˆå“ˆå“ˆã€‚2ï¼‰è¿˜æœ‰ä¸€ä¸ªç‚¹æ˜¯å †æ–™å¤ªä¸¥é‡äº†å­ï¼Œé‡å¤çš„é—è¿¹ï¼Œé‡å¤çš„ bossï¼Œé‡å¤çš„å¢“åœ°ï¼Œå•ä¸€çš„å°æ€ªï¼Œæ•£è½åœ¨äº¤ç•Œåœ°çš„å„å¤„ï¼Œå®Œå…¨æ²¡æœ‰ä»€ä¹ˆåŠ¨åŠ›å»ä¸€ä¸€æ‰«å›¾ã€‚ã€‚ã€‚3ï¼‰å¯¹äºå‰§æƒ…ï¼Œæˆ‘è¿˜æ˜¯çŸ¥é“é­‚ç±»æ¸¸æˆçš„å¥—è·¯çš„â€”â€”å‰§æƒ…éƒ½æ•£è½åœ¨å„ä¸ªé“å…·ä¸Šï¼Œä½†æˆ‘çœŸçš„åšä¸åˆ°å…¨æœé›†å‘€ï¼ğŸ˜­ï¼Œè€Œä¸”ç”±äºåœ°å›¾å¤ªå¤§ï¼Œå‰§æƒ…å¤ªæ•£ï¼Œæˆ‘çœŸçš„è®°ä¸ä½å„ä¸ªæ”¯çº¿å‘€ï¼4ï¼‰å¯¹äºå¼€æ”¾ä¸–ç•Œï¼Œç”±äºä¹Ÿç©è¿‡å¡å°”è¾¾è¿™ç§ç¥ä½œï¼Œåªèƒ½è¯´å®«å´è‹±é«˜æŠŠé­‚å…ƒç´ å¡åˆ°äº†ä¸€ä¸ªå¼€æ”¾ä¸–ç•Œä¸­ï¼Œè‡³äºè¿™ä¸ªå¼€æ”¾ä¸–ç•Œå®ƒâ€œå¼€æ”¾â€å—ï¼Ÿè¿™ç®¡æˆ‘å•¥äº‹ã€‚\n\nå“ˆå“ˆå“ˆï¼Œåæ§½å®Œäº†ï¼Œä½†è¿˜æ˜¯è¦è¯´æˆ‘ç©äº†å‡ åä¸ªå°æ—¶ï¼Œæ¯æ¬¡ä¸€ç©å°±æ˜¯äº”å…­ä¸ªå°æ—¶èµ·æ­¥ï¼Œè¿˜æ˜¯å¾ˆä¸é”™çš„æ¸¸æˆçš„ï¼Œåªä¸è¿‡åœ¨åæœŸæ„Ÿå—åˆ°äº†ä¹å‘³ï¼Œæ²¡èƒ½æˆä¸ºè‰¾å°”ç™»ä¹‹ç‹ã€‚\n\n### åšé¥­\n\nè¦æœ‰ç”Ÿæ´»æ°”æ¯ï¼Œä¸€å®šç¦»ä¸å¼€è‡ªå·±åšé¥­ï¼ä»Šå¹´è‡ªå·±å’Œå¥³æœ‹å‹ä¸€èµ·åšäº†å¥½å¤šå¥½å¤šçš„èœï¼è€Œä¸”å°‘æœ‰å¤±è´¥ï¼Œå“ˆå“ˆå“ˆå¥³ç¥¨ç›´ç§°æˆ‘ä¸ºå¨æˆ¿å°å¤©æ‰å“ˆå“ˆï¼ˆä¹Ÿä¸æ’é™¤å¥¹æ˜¯ä¸ºäº†è®©æˆ‘å¤šåšé¥­ğŸ¶ï¼‰ã€‚è‡ªå·±åšé¥­çœŸçš„æ²¡é‚£ä¹ˆéš¾ï¼Œè€Œä¸”å‘³é“ä¹Ÿæ¯”å¤§éƒ¨åˆ†åŸä¸­æ‘çš„å¤–å–å¥½åƒï¼Œå°±æ˜¯æ”¶æ‹¾å¨æˆ¿ã€æ´—ç¢—ä»€ä¹ˆçš„å¤ªéº»çƒ¦äº†ï¼Œåšå®Œé¥­åƒå®Œé¥­æ”¶æ‹¾å®ŒåŸºæœ¬æ™šä¸Šå°±å•¥éƒ½ä¸æƒ³å¹²äº†åªæƒ³ç˜«ç€ã€‚ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™èƒ½ä¹°ä¸ªæ´—ç¢—æœºå‘€ã€‚\n\n<img src=https://cdn-us.imgs.moe/2023/01/02/63b2c89a14f9a.jpg width=30% />\n\n### çœ‹ä¹¦\n\nä»Šå¹´çœ‹ä¹¦çš„ç›®æ ‡ç®—æ˜¯è¾¾åˆ°äº†ï¼Œä¸€å…±çœ‹å®Œäº† 13 æœ¬ä¹¦ã€‚æ„Ÿè§‰è‡ªå·±çœ‹ä¹¦çš„è¾“å…¥æ•ˆç‡è¿˜ä¸å¤Ÿã€‚ã€‚ã€‚è¿˜éœ€è¦ç»§ç»­å­¦ä¹ ğŸ˜‚\n\n- æµªæ½®ä¹‹å·…\n- ç¨‹åºå‘˜çš„ä¿®ç‚¼ä¹‹é“\n- å°ç‹å­çš„é¢†æ‚Ÿ\n- MySQL æ˜¯æ€ä¹ˆè¿è¡Œçš„\n- é»‘å®¢ä¸ç”»å®¶\n- æ‚‰è¾¾å¤š\n- kubernetes in action\n- å¼‚ä¹¡äºº\n- æ²™å‘ä¸Šçš„å¿ƒç†å­¦\n- æ•°æ®ç”Ÿæ€ï¼šMySQL å¤åˆ¶æŠ€æœ¯ä¸ç”Ÿäº§å®è·µ\n- å®‡å®™çš„æœ€åä¸‰åˆ†é’Ÿ\n- shell è„šæœ¬åŸºç¡€æ•™ç¨‹\n- æªç‚®ã€ç—…èŒä¸é’¢é“\n\n### çˆ±æƒ…\n\nä»Šå¹´æ˜¯å’Œæˆ‘å¥³æœ‹å‹ï¼ˆä»¥åå°±å«å¥¹å°æ‡’è™«å§ï¼ï¼‰åœ¨ä¸€èµ·çš„ç¬¬ä¸€å¹´ï½ç®—æ˜¯æ”¶è·äº†æ¢¦æƒ³ä¸­ç”œèœœçš„çˆ±æƒ…äº†ï¼ˆç—´æ±‰ç¬‘ğŸ˜Šï¼‰ã€‚è¿™ä¸€å¹´æˆ‘ä»¬å…ˆæ˜¯åº¦è¿‡äº†æ‹çˆ±ä¸­æœ€éš¾ç†¬çš„å¼‚åœ°æ‹ï¼æœ€é•¿æœ‰ä¸‰ä¸ªæœˆçš„æ—¶é—´æ²¡æœ‰è§é¢ï¼Œå¯èƒ½ä»¥åéƒ½ä¸ä¼šå†æœ‰è¿™ä¹ˆé•¿æ—¶é—´ä¸è§é¢çš„æœºä¼šäº†å§ã€‚\n\nä»Šå¹´å’Œå°æ‡’è™«åº¦è¿‡äº†è¶…çº§å¤šçš„ç¬¬ä¸€æ¬¡ã€‚\n\n- ç¬¬ä¸€æ¬¡æ”¶åˆ°æ–°å¹´ç¤¼ç‰©\n\n[![tN1da.th.jpeg](https://i.328888.xyz/2023/01/03/tN1da.th.jpeg)](https://imgloc.com/i/tN1da)\n\n- ç¬¬ä¸€æ¬¡ä¸€èµ·å¼¹é’¢ç´\n\n- ç¬¬ä¸€æ¬¡ä¸€èµ·æ—…æ¸¸ã€çœ‹æµ·ã€å¸†èˆ¹ã€æ¡¨æ¿ã€æµ·è¾¹éœ²è¥ã€æ—¥å‡º\n\n[![tN9TV.th.jpeg](https://i.328888.xyz/2023/01/03/tN9TV.th.jpeg)](https://imgloc.com/i/tN9TV)\n\n- ç¬¬ä¸€æ¬¡ææ€–å¯†å®¤\n\n[![tNLpb.th.png](https://i.328888.xyz/2023/01/03/tNLpb.th.png)](https://imgloc.com/i/tNLpb)\n\n- ç¬¬ä¸€æ¬¡é€šå…³æ¸¸æˆ\n\n[![trjhJ.th.jpeg](https://i.328888.xyz/2023/01/03/trjhJ.th.jpeg)](https://imgloc.com/i/trjhJ)\n\n- ç¬¬ä¸€æ¬¡è„±å£ç§€\n\n[![try93.th.jpeg](https://i.328888.xyz/2023/01/03/try93.th.jpeg)](https://imgloc.com/i/try93)\n\n### ç–«æƒ…\n\nåœ¨ 2022 å¹´çš„å¹´æœ«ï¼Œç–«æƒ…ç»ˆäºç®—æ˜¯â€œç»“æŸâ€äº†ã€‚ã€‚ã€‚åœ¨æ¯•ä¸šå‰ç”±äºæ±Ÿè‹æ•™è‚²å±€çš„æ”¿ç­–ã€Œä¸Šæµ·ä¸€å¤©ä¸è§£å°ï¼Œå—äº¬é«˜æ ¡ä¹Ÿä¸è§£å°ã€ï¼Œç»“æœå¯¼è‡´æˆ‘ä»¬åœ¨å—å¤§è¢«å°äº†ä¸¤ä¸ªæœˆï¼è¿™è®©æˆ‘ä»¬è®ºæ–‡å†™å®Œäº†ï¼Œç­”è¾©å®Œäº†ä¹Ÿæ²¡æœ‰æœºä¼šå‡ºæ ¡ã€‚è¿™ç›´æ¥å¯¼è‡´æˆ‘åœ¨èƒ½æ¯•ä¸šç¦»æ ¡çš„ç¬¬ä¸€æ—¶é—´ç¦»å¼€äº†å­¦æ ¡ï¼Œå¹¶ä¸å¸¦ä¸€ç‚¹ç•™æ‹ã€‚æœ¬æ¥æ‰“ç®—åœ¨å—äº¬å¥½å¥½ç©ä¸€ä¸‹çš„ä¹Ÿæ²¡æœ‰æ—¶é—´äº†ã€‚å¼‚åœ°æ‹çš„å½±å“ä¹Ÿåœ¨è¿™ä¸¤ä¸ªæœˆé‡Œè¾¾åˆ°äº†é¡¶å³°ã€‚ã€‚ã€‚çœŸæ˜¯å¤ªç…ç†¬äº†ã€‚\n\nå¦å¤–ï¼Œä»ä»Šå¹´å¹´åº•å¹¿å·ç–«æƒ…å¼€å§‹ï¼Œè‡ªå·±å‡ ä¹å°±ä¸€ç›´ remote åˆ°äº†ç°åœ¨ï¼Œå®Œå…¨æ”¹å˜äº†å·¥ä½œä¹ æƒ¯ã€‚ã€‚ã€‚æ”¾å¼€åä¹Ÿé˜³äº†ä¸€æ¬¡ï¼Œä½†è¿˜ä¸ç®—ä¸¥é‡ï¼Œä¹Ÿå°±çƒ§äº†ä¸€å¤©å¤šï¼Œå‘çƒ§çš„æ—¶å€™åŸºæœ¬åœ¨ç¡è§‰ï¼Œé€€çƒ§ååŸºæœ¬å°±æ²¡ä»€ä¹ˆäº‹äº†ã€‚\n\næˆ‘è®¤ä¸ºåªè¦ä¸å†æä»€ä¹ˆç±»ä¼¼å°åŸçš„äº‹æƒ…ï¼Œç–«æƒ…å°±ç®—æ˜¯è¿‡å»äº†ã€‚å› ä¸ºè¿™æ˜¯ä¸å¯é¿å…çš„äº‹æƒ…å‘€ï¼Œåœ¨è¯»å®Œã€Šæªç‚®ã€ç—…èŒä¸é’¢é“ã€‹åçŸ¥é“ï¼Œäººç±»**ä»æ¥**æ²¡æœ‰æˆ˜èƒœè¿‡ç—…æ¯’ã€‚è¿™æ˜¯å®¢è§‚äº‹å®ã€‚ä¸€æ—¦æ”¾å¼€åï¼Œæˆ‘ä»¬å°±å†ä¹Ÿå›ä¸å»äº†ï¼Œäº¦æˆ–è€…è¯´æˆ‘ä»¬ç¬é—´å°±å›åˆ°äº†è¿‡å»ã€‚æœ‰ç—…æ²»ç—…ï¼ŒæŒºå¥½çš„ã€‚\n\n## 2023\n\n2023 å¹´è¦åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ\n\n- å·¥ä½œä¸Šï¼Œthink more and do more\n- è¯»ä¹¦å’Œåšé¥­çš„ä¹ æƒ¯èƒ½ç»§ç»­ä¿æŒ\n- è®¡åˆ’ä¸­çš„é”»ç‚¼åˆ«æ‹‰ä¸‹äº†ï¼Œå¤šè·‘æ­¥ï¼Œå‚åŠ ä¸€åœºåŠé©¬\n- æ¥¼ä¸‹å°±æœ‰ç½‘çƒåœºï¼Œå¤§å­¦å­¦çš„ç½‘çƒä¸€å®šè¦æ¡èµ·æ¥ç©ç©\n- å»æ›´å¤šåœ°æ–¹æ—…è¡Œï¼ˆå“ˆå°”æ»¨ã€æ½®æ±•\n- æ¢ä¸ªå¥½ç‚¹çš„ launchpad ç»§ç»­ç©ç©\n\næ€»ä¹‹ï¼Œ2022 è¿˜è¡Œï¼Œ2023 ç»§ç»­åŠ æ²¹ğŸ’ª\n","source":"_posts/2022å¹´ç»ˆæ€»ç»“.md","raw":"---\ntitle: 2022å¹´ç»ˆæ€»ç»“â€”â€”å¹¸è¿å¼€å¿ƒçš„ä¸€å¹´\ndate: 2023-01-01 20:00:52\ntags:\n- ç”Ÿæ´»\n- å·¥ä½œ\ncategories:\n- å¹´ç»ˆæ€»ç»“\n---\n\nç¬¬ä¸€æ¬¡å†™å¹´ç»ˆæ€»ç»“å‘€ï¼Œå°è¯•è®°å½•ä¸€ä¸‹ã€‚ä¸€å¹´ä¸‹æ¥è¿˜çœŸå‘ç”Ÿäº†ä¸å°‘äº‹ã€‚çœ‹çœ‹è‡ªå·±æœ‰å•¥æ”¶è·æœ‰å•¥æˆé•¿ã€‚\n\n## å·¥ä½œ\n\nå…ˆè¯´è¯´å·¥ä½œå§ã€‚ä»å—å¤§æ¯•ä¸šåï¼Œæˆ‘å»äº† PingCAPï¼ˆè´µå¸ï¼‰å·¥ä½œï¼Œç°åœ¨åœ¨è´µå¸çš„ DMï¼ˆData Migrationï¼‰å›¢é˜Ÿå·¥ä½œï¼Œå·®ä¸å¤šå°±åœ¨æ•°æ®å¯¼å…¥ã€æ•°æ®è¿ç§»ä»¥åŠå…¶å¯¹åº”çš„äº‘ä¸Šç‰ˆæœ¬è¿™äº›åœ°æ–¹æ¬ç –ã€‚å»å¹´å°±æœ‰åœ¨è´µå¸å®ä¹ ï¼Œä¸»è¦åœ¨ç»´æŠ¤ DMï¼Œä¹Ÿå°±æ˜¯æ€ä¹ˆæŠŠä¸€æ¡ binlog å†™åˆ°ä¸‹æ¸¸ TiDB é‡Œé¢ï¼Œå’Œ MySQL binlog æ‰“äº¤é“æ¯”è¾ƒå¤šã€‚ä»Šå¹´å…¥èŒåï¼Œé¡ºåº”å…¬å¸çš„æˆ˜ç•¥ï¼Œä¸»è¦åœ¨ tidbcloud.com ä¸Š CRUDï¼Œå¸®åŠ©ç”¨æˆ·åœ¨ cloud ä¸Šå¯¼å…¥æˆ–è¿ç§»æ•°æ®ï¼Œå’Œ k8sã€CRUD ä»¥åŠç”¨æˆ·ä½“éªŒæ‰“äº¤é“æ¯”è¾ƒå¤šã€‚\n\nç®€å•æ€»ç»“ä¸€ä¸‹å­¦åˆ°çš„ä¸œè¥¿å§ï¼Œä»å®ä¹ åˆ°ç°åœ¨ï¼š\n\n1. å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•\n2. å¤šçº¿ç¨‹ä»£ç \n3. review ä»£ç \n4. å†™è®¾è®¡æ–‡æ¡£\n5. ç†è§£ä¸€ä¸ªéœ€æ±‚æ˜¯ä»»ä½•å·¥ä½œçš„ç¬¬ä¸€æ­¥\n6. å¯¹ä¸€ä¸ªéœ€æ±‚è¿›è¡Œé¡¹ç›®ç®¡ç†ï¼Œä»¥å°½å¯èƒ½åœ°æŒ‰æ—¶äº¤ä»˜ï¼ˆå½“ç„¶ç°åœ¨è¿˜åšçš„ä¸å¤Ÿå¥½ã€‚ã€‚ã€‚ï¼‰\n7. å­¦ä¹ äº† K8s/CRD/Operator/AWS/Pulumi ç›¸å…³çš„çŸ¥è¯†ï¼Œèƒ½çœ‹æ‡‚ä»£ç ï¼Œå¹¶ç¼–å†™ç®€å•çš„ä»£ç \n8. æ›´å¤šåœ°è€ƒè™‘ç”¨æˆ·ä½“éªŒ\n9. ã€‚ã€‚\n\nå†è°ˆè°ˆå·¥ä½œçš„æ„Ÿå—ã€‚å¯¹äºæˆ‘è¿™ç¬¬ä¸€ä»½æ­£å¼çš„å·¥ä½œï¼Œæˆ‘æ˜¯éå¸¸æ»¡æ„æˆ‘å½“å‰çš„å›¢é˜Ÿå’Œå…¬å¸çš„ã€‚ä¸è®ºæ˜¯å…¬å¸è¿˜æ˜¯å›¢é˜Ÿå†…ï¼Œå¤§ä½¬éå¸¸å¤šï¼Œå¯ä»¥åœ¨ä»–ä»¬èº«ä¸Šå­¦åˆ°å¾ˆå¤šä¸œè¥¿ã€‚å›¢é˜Ÿå†…çš„äººå¤§å®¶å®äº‹æ±‚æ˜¯ã€äº’ç›¸å¸®åŠ©ï¼Œæˆ‘æ˜¯æ²¡æœ‰é‡åˆ°ä»€ä¹ˆå°”è™æˆ‘è¯ˆï¼Œä¸ºäº†åˆ©ç›Šèµ·å†²çªçš„æƒ…å†µï¼Œå¾ˆ niceï¼è™½ç„¶å¾ˆå¤šäººè¯Ÿç—…è´µå¸å·²ç»ä¸æ˜¯ä»¥å‰çš„è´µå¸äº†ï¼Œä¹‹å‰çš„å·¥ç¨‹å¸ˆæ–‡åŒ–æ²¡æœ‰é‚£ä¹ˆçº¯ç²¹äº†ï¼Œä½†æˆ‘è¿˜æ˜¯å¸®å…¬å¸è¯´å¥è¯ã€‚ä»Šå¹´ 2022 å¹´çš„ç¯å¢ƒå¤§å®¶è¿˜æ˜¯å¯ä»¥çœ‹å¾—åˆ°çš„ï¼ŒåŒæ ·ä»¥å·¥ç¨‹å¸ˆæ–‡åŒ–è‘—ç§°çš„å°é©¬ï¼Œå·²ç»æŠŠ 22 å±Šå¤§éƒ¨åˆ†çš„åº”å±Šç”Ÿè£æ‰äº†ï¼Œæˆ‘æœ‰åŒå­¦å°±åœ¨è¢«è£åå•é‡Œã€‚æ‰€ä»¥å¯¹äºä¸€ä¸ªåŒæ ·æ˜¯åº”å±Šç”Ÿçš„æˆ‘ï¼Œæˆ‘è¿˜æ˜¯å¾ˆä½©æœå…¬å¸çš„æˆ˜ç•¥å’Œå®šåŠ›ï¼Œä»¥å¸®åŠ©å…¬å¸ç»§ç»­ç”Ÿå­˜ä¸‹å»ï¼Œæ¯•ç«Ÿæ´»ä¸‹å»æ‰æœ‰æœªæ¥ã€‚æˆ‘çŸ¥é“è¿™ä¸¤è€…ä¹Ÿå¹¶ä¸æ˜¯å†²çªçš„ï¼Œä½†æˆ‘è¿˜æ˜¯åº†å¹¸å…¬å¸èƒ½è®©æˆ‘æœ‰ä¸€ä¸ªåœ°æ–¹å­¦ä¹ å’Œæˆé•¿ã€‚å½“ç„¶ï¼Œå¤§å®¶ä¹Ÿéƒ½ä¼šå¸Œæœ›è‡ªå·±çš„å…¬å¸èƒ½è¶Šæ¥è¶Šå¥½ï¼\n\nè®°å½•ä¸€ä¸‹ï¼šä»Šå¹´ 1 æœˆä»½å…¨ç»„äººå‘˜é½èšåŒ—äº¬å›¢ï¼ˆmianï¼‰å»ºï¼ˆjiï¼‰ï¼Œç¬¬ä¸€æ¬¡æ­£å¼è§åˆ°äº†æ¥è‡ªæˆéƒ½ã€åŒ—äº¬ã€æ­å·ã€ä¸Šæµ·çš„å„ä½å¤§ä½¬ï¼Œä¹Ÿè·Ÿç€ mentor æ²¡ç¾æ²¡è‡Šåœ°è¹­åƒè¹­å–ç©äº†ä¸¤å¤©å“ˆå“ˆã€‚ä¸å¾—ä¸è¯´ï¼Œå¤ªçˆ½äº†å“ˆå“ˆå“ˆğŸ¶ã€‚\n\n## å­¦ç”Ÿç”Ÿæ¶¯\n\nä»Šå¹´ç»ˆäºä»ç¡•å£«æ¯•ä¸šäº†ã€‚å¦è¯šåœ°å¯¹ç¡•å£«è¿™ä¸‰å¹´åšä¸ªç®€çŸ­çš„æ€»ç»“å§ã€‚è‡ªå·±åœ¨ä¸‰å¹´ä¸­å‡ ä¹æ²¡æœ‰ä»»ä½•çš„æˆæœï¼Œè¿ä¸€ç¯‡è®ºæ–‡éƒ½æ²¡å‘è¿‡ï¼Œåœ¨ç§‘ç ”è¿™æ¡è·¯ä¸Šï¼Œæˆ‘ä¹Ÿç®—çš„ä¸Šæ˜¯å½»åº•å¤±è´¥äº†ã€‚ä¸è¿‡è¿™ä¸‰å¹´æ¯”è¾ƒå¹¸è¿çš„æ˜¯ï¼Œæˆ‘åœ¨ç ”ä¸€ä¸‹å°±æ„è¯†åˆ°äº†è‡ªå·±ä¸é€‚åˆèµ°ç§‘ç ”è¿™æ¡è·¯ï¼Œæ‰€ä»¥èŠ±äº†å¾ˆå¤šæ—¶é—´åœ¨æ€è€ƒå’Œå®è·µè‡ªå·±ä»¥åè¦åšä»€ä¹ˆè¿™ä¸ªé—®é¢˜ä¸Šã€‚ä¹Ÿæ‰¾åˆ°äº†è‡ªè®¤ä¸ºçŸ­ä¸­æœŸå†…å‘å±•è¿˜ä¸é”™çš„æ•°æ®åº“è¿™æ¡é“è·¯ã€‚\n\n> åœ¨è¯»ä¹¦æœŸé—´ï¼Œç»å¸¸å’ŒåŒå­¦è°ƒä¾ƒï¼Œè¯»ç ”æœ€å¤§çš„ä½œç”¨ï¼Œå°±æ˜¯å‘ç°äº†è¯»ç ”æ²¡ç”¨ã€‚å“ˆå“ˆå“ˆï¼Œè¿™å¥è¯å¯èƒ½æœ‰ç‚¹è¿‡ï¼Œä½†ä¹Ÿæ˜¯åªæœ‰è¯»ç ”åï¼Œæ‰èƒ½ç†è§£å¾ˆå¤šå¤§ä½¬è¯´çš„ï¼Œã€Œå›½å†…çš„ç ”ç©¶æœ‰äº›æµ®èºã€ä¸­**æµ®èº**çš„å«ä¹‰å§ï¼ˆå¹æ¯ï¼‰\n\n## ç”Ÿæ´»\n\nåœ¨æ¯•ä¸šåï¼Œæ­£å¼å¼€å¯äº†æˆ‘è‡ªå·±çš„ç”Ÿæ´»ã€‚è¿™ä¸€æ¬¡å’Œæˆ‘ä¹‹å‰çš„å®ä¹ éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ‹’ç»äº†åˆç§Ÿï¼Œé€‰æ‹©äº†ä¸€ä¸ªäººæ•´ç§Ÿä¸€ä¸ªå°åŒºé‡Œçš„ä¸€å®¤ä¸€å…ã€‚åœ¨çœé’±å’Œç”Ÿæ´»è´¨é‡ä¸­é€‰æ‹©äº†åè€…ã€‚å½“æ—¶åœ¨æ¥å¹¿å·ä¹‹å‰å°±ç–¯ç‹‚åœ°çœ‹æˆ¿ï¼Œå¹»æƒ³ç€è‡ªå·±ä¸€ä¸ªäººè‡ªç”±çš„ç”Ÿæ´»å“ˆå“ˆå“ˆã€‚æ¥äº†å¹¿å·ä¹‹åå°±ç–¯ç‹‚åœ°æ‰¾æˆ¿å­ï¼Œä¸€å®¤ä¸€å…çš„å°åŒºæˆ¿å®åœ¨æ˜¯å¤ªå°‘äº†ğŸ¤®ã€‚æˆ‘é‡åˆ°ä¸€ä¸ª 2500/æœˆ 60 å¹³çš„æˆ¿å­ï¼Œä¸‹åˆ 2 ç‚¹çœ‹å®Œé¥­ï¼Œä¸‹åˆ 4 ç‚¹å°±è¢«ç§Ÿå‡ºå»äº†ï¼å°±æ˜¯è¢«æˆ‘åé¢ä¸€ä¸ªçœ‹æˆ¿çš„äººç§Ÿèµ°äº†ã€‚ã€‚ã€‚è¿™æ•ˆç‡ç®€ç›´äº†ã€‚æœ€åç§Ÿåˆ°äº†ä¸€é—´ 3000 å‡ºå¤´çš„ä¸€å®¤ä¸€å…ï¼Œæˆ¿ä¸œéå¸¸ niceï¼Œç»™é…äº†æ–°çš„é©¬æ¡¶ã€ç”µçƒ­æ°´å™¨ã€ç©ºè°ƒã€æŠ½æ²¹çƒŸæœºå’Œç¶å°ï¼Œç”šè‡³è¿˜é‡æ–°è£…ä¿®äº†å¨æˆ¿ï¼è™½ç„¶è¿˜æœ‰ä¸è¶³çš„åœ°æ–¹ï¼Œä½†æˆ‘å·²ç»éå¸¸æ»¡è¶³äº†ï¼\n\n### æ·»ç½®æ–°ç‰©ä»¶\n\n#### å¤§æ¡Œå­âœ…\n\nåœ¨è‡ªå·±ç§Ÿäº†æˆ¿å­ä¹‹åï¼Œå¿…ç„¶ä¹Ÿæ˜¯è¦æ•´ä¸€ä¸ªæ­£ç»çš„å°ä¹¦æ¡Œçš„å•¦ã€‚åœ¨é—²é±¼ä¸Šè¹²äº†å¥½å‡ å¤©ï¼Œä¸­é—´è¿˜å»æ—è¾¹çš„äºŒæ‰‹å¸‚åœºçœ‹äº†ï¼Œæœ€åèŠ± 220 è¹²åˆ°äº†è¿™å¼  160âœ–ï¸70 çš„æ¡Œå­ï¼ˆè´§æ‹‰æ‹‰éƒ½èŠ±äº† 100+ ğŸ˜‚ï¼‰\n\n[![tk3cN.th.jpeg](https://i.328888.xyz/2023/01/02/tk3cN.th.jpeg)](https://imgloc.com/i/tk3cN)\n\n#### æ´æ´æ¿âœ…\n\nçœ‹ B ç«™è§†é¢‘è¿˜çœ‹åˆ°äº†è¿™ç§ç«‹å¼çš„æ´æ´æ¿ï¼Œæƒ³åˆ°å‡ºç§Ÿå±‹é‡Œä¹Ÿå®Œå…¨æ²¡æœ‰ä¹¦æ¶ã€å°ç‰©ä»¶çš„æ”¶çº³ä»€ä¹ˆçš„ï¼Œå°±æ•´äº†ä¸€ä¸ªã€‚è¿˜è¡Œå“ˆï¼Œæ¯”å…‰ç§ƒç§ƒçš„å¥½å¤šäº†ã€‚\n\n[![tkHFX.th.jpeg](https://i.328888.xyz/2023/01/02/tkHFX.th.jpeg)](https://imgloc.com/i/tkHFX)\n\n#### äººä½“å·¥å­¦æ¤…âœ…\n\næ¯•ç«Ÿå·¥ä½œéœ€è¦ï¼Œç«‹é©¬ä¹Ÿæ•´äº†ä¸ªå¥½æ¤…å­ï¼Œå¯ä»¥ç”¨å¾ˆä¹…äº†\n\n[![t0jdv.th.jpeg](https://i.328888.xyz/2023/01/02/t0jdv.th.jpeg)](https://imgloc.com/i/t0jdv)\n\n#### ç‰™å¥—âœ…\n\nä»å¾ˆå¤šå¹´å‰è‡ªå·±å°±è§‰å¾—è‡ªå·±çš„ç‰™é½¿ä¸é½ï¼Œæƒ³è¦åšç‰™é½¿çŸ«æ­£ï¼Œä½†æ— å¥ˆå› ä¸ºé’±æˆ–è€…é•¿ä½åœ°ä¸ç¨³å®šç­‰åŸå› ï¼Œä¸€ç›´æ²¡å¼€å§‹ã€‚æ‰€ä»¥åœ¨å¹¿å·å®‰é¡¿ä¸‹æ¥ä¹‹åï¼Œç«‹é©¬å¼€å§‹äº†ç‰™é½¿çŸ«æ­£çš„è¿›ç¨‹ã€‚ä¸Šä¸‹å·¦å³æ‹”äº† 4 é¢—ç‰™ï¼å¦ˆè€¶ï¼Œç–¼æ­»æˆ‘äº†ã€‚\n\n#### æ‰“å‡»å«âœ…\n\næˆ‘è‡ªå·±å¯¹éŸ³ä¹ä¹Ÿä¸€ç›´æŒºæ„Ÿå…´è¶£çš„ï¼Œå“ˆå“ˆå°±æƒ³åšç‚¹éŸ³ä¹ç›¸å…³çš„çˆ±å¥½ã€‚ä¹‹å‰æœ‰å…³æ³¨ä¸€ä¸ªç»åœ°çš„ä¸»æ’­ï¼Œä»–ç©çš„æ‰“å‡»å«è¶…é…·ï¼ç°åœ¨æœ‰è‡ªå·±çš„ç©ºé—´å’Œç”Ÿæ´»äº†ï¼Œå°±æ•´äº†ä¸€ä¸ªäºŒæ‰‹çš„å…¥é—¨æ¬¾ã€‚\n\n[![twO4o.th.jpeg](https://i.328888.xyz/2023/01/02/twO4o.th.jpeg)](https://imgloc.com/i/twO4o)\n\nä½†æ˜¯éå¸¸å¯æƒœï¼Œåœ¨ç»ƒå®Œå…¥é—¨æ›² [Luz letter](https://www.bilibili.com/video/BV1bv4y1B7RL/?spm_id_from=333.999.0.0&vd_source=1d41e3899bfb8af8d65144aad99bbde1) åï¼Œåœ¨å¦å¤–æŒ‘äº†ä¸€é¦–[è¿›é˜¶çš„æ›²å­](https://www.bilibili.com/video/BV1q8411E7ts/?spm_id_from=333.999.0.0&vd_source=1d41e3899bfb8af8d65144aad99bbde1)ç»ƒä¹ è¿‡ç¨‹ä¸­å°±å‘ç°äº†é—®é¢˜â€”â€”ç¯å…‰è·Ÿä¸ä¸ŠèŠ‚å¥ã€‚ã€‚ã€‚è¿™ä¸ªå…¥é—¨æ¬¾çš„ç¯å…‰é¢‘ç‡å¤ªä½äº†ï¼Œå°è¯•äº†å¾ˆå¤šæ¬¡ä¹‹åè¿˜æ˜¯æ”¾å¼ƒäº†ç»§ç»­åœ¨è¿™æ¬¾ä¸Šé¢ç»§ç»­ç»ƒï¼Œç„¶åè’åºŸåˆ°ç°åœ¨ï¼ˆå“ï¼Œå¯æƒœã€‚\n\n#### PS5/å¤§ç”µè§†âœ…\n\nåœ¨åŒåä¸€çš„æ—¶å€™ï¼Œæ”¶äº†ä¸€ä¸ªäºŒæ‰‹çš„ PS5ï¼Œè¿˜é…äº†ä¸€ä¸ªå¤§ç”µè§†ï¼è¿™ä¸ªå°å‡ºç§Ÿå±‹ä¹Ÿç»ˆäºå¯ä»¥çœ‹ç”µè§†äº†ã€‚\n\n![t0Law.jpeg](https://i.328888.xyz/2023/01/02/t0Law.jpeg)\n\né¡ºå¸¦è¯„ä»·ä¸€ä¸‹è€å¤´ç¯å§ï¼Œåœ¨ PS5 ä¸Šç©çš„ç¬¬ä¸€ä¸ªæ¸¸æˆã€‚ä¹‹å‰ä¹Ÿæœ‰ç©è¿‡é»‘é­‚ 3ï¼Œ1ï¼‰æ‰€ä»¥å¹¶æ²¡æœ‰ç¬¬ä¸€æ¬¡ç©é­‚ç±»æ¸¸æˆé‚£ç§å†²å‡»äº†ï¼Œè€Œä¸”è€å¤´ç¯çš„éš¾åº¦ç³»æ•°ç›¸æ¯”é»‘é­‚ç¡®å®ä½äº†ä¸å°‘ï¼Œè½¬è§’æ€å°‘äº†ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥è€ç©å®¶åœ¨è½¬è§’å¤„å›å¤´çš„æ—¶å€™ç»å¸¸â€œå¤±æœ›â€å“ˆå“ˆå“ˆã€‚2ï¼‰è¿˜æœ‰ä¸€ä¸ªç‚¹æ˜¯å †æ–™å¤ªä¸¥é‡äº†å­ï¼Œé‡å¤çš„é—è¿¹ï¼Œé‡å¤çš„ bossï¼Œé‡å¤çš„å¢“åœ°ï¼Œå•ä¸€çš„å°æ€ªï¼Œæ•£è½åœ¨äº¤ç•Œåœ°çš„å„å¤„ï¼Œå®Œå…¨æ²¡æœ‰ä»€ä¹ˆåŠ¨åŠ›å»ä¸€ä¸€æ‰«å›¾ã€‚ã€‚ã€‚3ï¼‰å¯¹äºå‰§æƒ…ï¼Œæˆ‘è¿˜æ˜¯çŸ¥é“é­‚ç±»æ¸¸æˆçš„å¥—è·¯çš„â€”â€”å‰§æƒ…éƒ½æ•£è½åœ¨å„ä¸ªé“å…·ä¸Šï¼Œä½†æˆ‘çœŸçš„åšä¸åˆ°å…¨æœé›†å‘€ï¼ğŸ˜­ï¼Œè€Œä¸”ç”±äºåœ°å›¾å¤ªå¤§ï¼Œå‰§æƒ…å¤ªæ•£ï¼Œæˆ‘çœŸçš„è®°ä¸ä½å„ä¸ªæ”¯çº¿å‘€ï¼4ï¼‰å¯¹äºå¼€æ”¾ä¸–ç•Œï¼Œç”±äºä¹Ÿç©è¿‡å¡å°”è¾¾è¿™ç§ç¥ä½œï¼Œåªèƒ½è¯´å®«å´è‹±é«˜æŠŠé­‚å…ƒç´ å¡åˆ°äº†ä¸€ä¸ªå¼€æ”¾ä¸–ç•Œä¸­ï¼Œè‡³äºè¿™ä¸ªå¼€æ”¾ä¸–ç•Œå®ƒâ€œå¼€æ”¾â€å—ï¼Ÿè¿™ç®¡æˆ‘å•¥äº‹ã€‚\n\nå“ˆå“ˆå“ˆï¼Œåæ§½å®Œäº†ï¼Œä½†è¿˜æ˜¯è¦è¯´æˆ‘ç©äº†å‡ åä¸ªå°æ—¶ï¼Œæ¯æ¬¡ä¸€ç©å°±æ˜¯äº”å…­ä¸ªå°æ—¶èµ·æ­¥ï¼Œè¿˜æ˜¯å¾ˆä¸é”™çš„æ¸¸æˆçš„ï¼Œåªä¸è¿‡åœ¨åæœŸæ„Ÿå—åˆ°äº†ä¹å‘³ï¼Œæ²¡èƒ½æˆä¸ºè‰¾å°”ç™»ä¹‹ç‹ã€‚\n\n### åšé¥­\n\nè¦æœ‰ç”Ÿæ´»æ°”æ¯ï¼Œä¸€å®šç¦»ä¸å¼€è‡ªå·±åšé¥­ï¼ä»Šå¹´è‡ªå·±å’Œå¥³æœ‹å‹ä¸€èµ·åšäº†å¥½å¤šå¥½å¤šçš„èœï¼è€Œä¸”å°‘æœ‰å¤±è´¥ï¼Œå“ˆå“ˆå“ˆå¥³ç¥¨ç›´ç§°æˆ‘ä¸ºå¨æˆ¿å°å¤©æ‰å“ˆå“ˆï¼ˆä¹Ÿä¸æ’é™¤å¥¹æ˜¯ä¸ºäº†è®©æˆ‘å¤šåšé¥­ğŸ¶ï¼‰ã€‚è‡ªå·±åšé¥­çœŸçš„æ²¡é‚£ä¹ˆéš¾ï¼Œè€Œä¸”å‘³é“ä¹Ÿæ¯”å¤§éƒ¨åˆ†åŸä¸­æ‘çš„å¤–å–å¥½åƒï¼Œå°±æ˜¯æ”¶æ‹¾å¨æˆ¿ã€æ´—ç¢—ä»€ä¹ˆçš„å¤ªéº»çƒ¦äº†ï¼Œåšå®Œé¥­åƒå®Œé¥­æ”¶æ‹¾å®ŒåŸºæœ¬æ™šä¸Šå°±å•¥éƒ½ä¸æƒ³å¹²äº†åªæƒ³ç˜«ç€ã€‚ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™èƒ½ä¹°ä¸ªæ´—ç¢—æœºå‘€ã€‚\n\n<img src=https://cdn-us.imgs.moe/2023/01/02/63b2c89a14f9a.jpg width=30% />\n\n### çœ‹ä¹¦\n\nä»Šå¹´çœ‹ä¹¦çš„ç›®æ ‡ç®—æ˜¯è¾¾åˆ°äº†ï¼Œä¸€å…±çœ‹å®Œäº† 13 æœ¬ä¹¦ã€‚æ„Ÿè§‰è‡ªå·±çœ‹ä¹¦çš„è¾“å…¥æ•ˆç‡è¿˜ä¸å¤Ÿã€‚ã€‚ã€‚è¿˜éœ€è¦ç»§ç»­å­¦ä¹ ğŸ˜‚\n\n- æµªæ½®ä¹‹å·…\n- ç¨‹åºå‘˜çš„ä¿®ç‚¼ä¹‹é“\n- å°ç‹å­çš„é¢†æ‚Ÿ\n- MySQL æ˜¯æ€ä¹ˆè¿è¡Œçš„\n- é»‘å®¢ä¸ç”»å®¶\n- æ‚‰è¾¾å¤š\n- kubernetes in action\n- å¼‚ä¹¡äºº\n- æ²™å‘ä¸Šçš„å¿ƒç†å­¦\n- æ•°æ®ç”Ÿæ€ï¼šMySQL å¤åˆ¶æŠ€æœ¯ä¸ç”Ÿäº§å®è·µ\n- å®‡å®™çš„æœ€åä¸‰åˆ†é’Ÿ\n- shell è„šæœ¬åŸºç¡€æ•™ç¨‹\n- æªç‚®ã€ç—…èŒä¸é’¢é“\n\n### çˆ±æƒ…\n\nä»Šå¹´æ˜¯å’Œæˆ‘å¥³æœ‹å‹ï¼ˆä»¥åå°±å«å¥¹å°æ‡’è™«å§ï¼ï¼‰åœ¨ä¸€èµ·çš„ç¬¬ä¸€å¹´ï½ç®—æ˜¯æ”¶è·äº†æ¢¦æƒ³ä¸­ç”œèœœçš„çˆ±æƒ…äº†ï¼ˆç—´æ±‰ç¬‘ğŸ˜Šï¼‰ã€‚è¿™ä¸€å¹´æˆ‘ä»¬å…ˆæ˜¯åº¦è¿‡äº†æ‹çˆ±ä¸­æœ€éš¾ç†¬çš„å¼‚åœ°æ‹ï¼æœ€é•¿æœ‰ä¸‰ä¸ªæœˆçš„æ—¶é—´æ²¡æœ‰è§é¢ï¼Œå¯èƒ½ä»¥åéƒ½ä¸ä¼šå†æœ‰è¿™ä¹ˆé•¿æ—¶é—´ä¸è§é¢çš„æœºä¼šäº†å§ã€‚\n\nä»Šå¹´å’Œå°æ‡’è™«åº¦è¿‡äº†è¶…çº§å¤šçš„ç¬¬ä¸€æ¬¡ã€‚\n\n- ç¬¬ä¸€æ¬¡æ”¶åˆ°æ–°å¹´ç¤¼ç‰©\n\n[![tN1da.th.jpeg](https://i.328888.xyz/2023/01/03/tN1da.th.jpeg)](https://imgloc.com/i/tN1da)\n\n- ç¬¬ä¸€æ¬¡ä¸€èµ·å¼¹é’¢ç´\n\n- ç¬¬ä¸€æ¬¡ä¸€èµ·æ—…æ¸¸ã€çœ‹æµ·ã€å¸†èˆ¹ã€æ¡¨æ¿ã€æµ·è¾¹éœ²è¥ã€æ—¥å‡º\n\n[![tN9TV.th.jpeg](https://i.328888.xyz/2023/01/03/tN9TV.th.jpeg)](https://imgloc.com/i/tN9TV)\n\n- ç¬¬ä¸€æ¬¡ææ€–å¯†å®¤\n\n[![tNLpb.th.png](https://i.328888.xyz/2023/01/03/tNLpb.th.png)](https://imgloc.com/i/tNLpb)\n\n- ç¬¬ä¸€æ¬¡é€šå…³æ¸¸æˆ\n\n[![trjhJ.th.jpeg](https://i.328888.xyz/2023/01/03/trjhJ.th.jpeg)](https://imgloc.com/i/trjhJ)\n\n- ç¬¬ä¸€æ¬¡è„±å£ç§€\n\n[![try93.th.jpeg](https://i.328888.xyz/2023/01/03/try93.th.jpeg)](https://imgloc.com/i/try93)\n\n### ç–«æƒ…\n\nåœ¨ 2022 å¹´çš„å¹´æœ«ï¼Œç–«æƒ…ç»ˆäºç®—æ˜¯â€œç»“æŸâ€äº†ã€‚ã€‚ã€‚åœ¨æ¯•ä¸šå‰ç”±äºæ±Ÿè‹æ•™è‚²å±€çš„æ”¿ç­–ã€Œä¸Šæµ·ä¸€å¤©ä¸è§£å°ï¼Œå—äº¬é«˜æ ¡ä¹Ÿä¸è§£å°ã€ï¼Œç»“æœå¯¼è‡´æˆ‘ä»¬åœ¨å—å¤§è¢«å°äº†ä¸¤ä¸ªæœˆï¼è¿™è®©æˆ‘ä»¬è®ºæ–‡å†™å®Œäº†ï¼Œç­”è¾©å®Œäº†ä¹Ÿæ²¡æœ‰æœºä¼šå‡ºæ ¡ã€‚è¿™ç›´æ¥å¯¼è‡´æˆ‘åœ¨èƒ½æ¯•ä¸šç¦»æ ¡çš„ç¬¬ä¸€æ—¶é—´ç¦»å¼€äº†å­¦æ ¡ï¼Œå¹¶ä¸å¸¦ä¸€ç‚¹ç•™æ‹ã€‚æœ¬æ¥æ‰“ç®—åœ¨å—äº¬å¥½å¥½ç©ä¸€ä¸‹çš„ä¹Ÿæ²¡æœ‰æ—¶é—´äº†ã€‚å¼‚åœ°æ‹çš„å½±å“ä¹Ÿåœ¨è¿™ä¸¤ä¸ªæœˆé‡Œè¾¾åˆ°äº†é¡¶å³°ã€‚ã€‚ã€‚çœŸæ˜¯å¤ªç…ç†¬äº†ã€‚\n\nå¦å¤–ï¼Œä»ä»Šå¹´å¹´åº•å¹¿å·ç–«æƒ…å¼€å§‹ï¼Œè‡ªå·±å‡ ä¹å°±ä¸€ç›´ remote åˆ°äº†ç°åœ¨ï¼Œå®Œå…¨æ”¹å˜äº†å·¥ä½œä¹ æƒ¯ã€‚ã€‚ã€‚æ”¾å¼€åä¹Ÿé˜³äº†ä¸€æ¬¡ï¼Œä½†è¿˜ä¸ç®—ä¸¥é‡ï¼Œä¹Ÿå°±çƒ§äº†ä¸€å¤©å¤šï¼Œå‘çƒ§çš„æ—¶å€™åŸºæœ¬åœ¨ç¡è§‰ï¼Œé€€çƒ§ååŸºæœ¬å°±æ²¡ä»€ä¹ˆäº‹äº†ã€‚\n\næˆ‘è®¤ä¸ºåªè¦ä¸å†æä»€ä¹ˆç±»ä¼¼å°åŸçš„äº‹æƒ…ï¼Œç–«æƒ…å°±ç®—æ˜¯è¿‡å»äº†ã€‚å› ä¸ºè¿™æ˜¯ä¸å¯é¿å…çš„äº‹æƒ…å‘€ï¼Œåœ¨è¯»å®Œã€Šæªç‚®ã€ç—…èŒä¸é’¢é“ã€‹åçŸ¥é“ï¼Œäººç±»**ä»æ¥**æ²¡æœ‰æˆ˜èƒœè¿‡ç—…æ¯’ã€‚è¿™æ˜¯å®¢è§‚äº‹å®ã€‚ä¸€æ—¦æ”¾å¼€åï¼Œæˆ‘ä»¬å°±å†ä¹Ÿå›ä¸å»äº†ï¼Œäº¦æˆ–è€…è¯´æˆ‘ä»¬ç¬é—´å°±å›åˆ°äº†è¿‡å»ã€‚æœ‰ç—…æ²»ç—…ï¼ŒæŒºå¥½çš„ã€‚\n\n## 2023\n\n2023 å¹´è¦åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ\n\n- å·¥ä½œä¸Šï¼Œthink more and do more\n- è¯»ä¹¦å’Œåšé¥­çš„ä¹ æƒ¯èƒ½ç»§ç»­ä¿æŒ\n- è®¡åˆ’ä¸­çš„é”»ç‚¼åˆ«æ‹‰ä¸‹äº†ï¼Œå¤šè·‘æ­¥ï¼Œå‚åŠ ä¸€åœºåŠé©¬\n- æ¥¼ä¸‹å°±æœ‰ç½‘çƒåœºï¼Œå¤§å­¦å­¦çš„ç½‘çƒä¸€å®šè¦æ¡èµ·æ¥ç©ç©\n- å»æ›´å¤šåœ°æ–¹æ—…è¡Œï¼ˆå“ˆå°”æ»¨ã€æ½®æ±•\n- æ¢ä¸ªå¥½ç‚¹çš„ launchpad ç»§ç»­ç©ç©\n\næ€»ä¹‹ï¼Œ2022 è¿˜è¡Œï¼Œ2023 ç»§ç»­åŠ æ²¹ğŸ’ª\n","slug":"2022å¹´ç»ˆæ€»ç»“","published":1,"updated":"2024-06-15T14:36:14.094Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clxgdbzoh0001xbdygyu7c36p","content":"<p>ç¬¬ä¸€æ¬¡å†™å¹´ç»ˆæ€»ç»“å‘€ï¼Œå°è¯•è®°å½•ä¸€ä¸‹ã€‚ä¸€å¹´ä¸‹æ¥è¿˜çœŸå‘ç”Ÿäº†ä¸å°‘äº‹ã€‚çœ‹çœ‹è‡ªå·±æœ‰å•¥æ”¶è·æœ‰å•¥æˆé•¿ã€‚</p>\n<h2 id=\"å·¥ä½œ\"><a href=\"#å·¥ä½œ\" class=\"headerlink\" title=\"å·¥ä½œ\"></a>å·¥ä½œ</h2><p>å…ˆè¯´è¯´å·¥ä½œå§ã€‚ä»å—å¤§æ¯•ä¸šåï¼Œæˆ‘å»äº† PingCAPï¼ˆè´µå¸ï¼‰å·¥ä½œï¼Œç°åœ¨åœ¨è´µå¸çš„ DMï¼ˆData Migrationï¼‰å›¢é˜Ÿå·¥ä½œï¼Œå·®ä¸å¤šå°±åœ¨æ•°æ®å¯¼å…¥ã€æ•°æ®è¿ç§»ä»¥åŠå…¶å¯¹åº”çš„äº‘ä¸Šç‰ˆæœ¬è¿™äº›åœ°æ–¹æ¬ç –ã€‚å»å¹´å°±æœ‰åœ¨è´µå¸å®ä¹ ï¼Œä¸»è¦åœ¨ç»´æŠ¤ DMï¼Œä¹Ÿå°±æ˜¯æ€ä¹ˆæŠŠä¸€æ¡ binlog å†™åˆ°ä¸‹æ¸¸ TiDB é‡Œé¢ï¼Œå’Œ MySQL binlog æ‰“äº¤é“æ¯”è¾ƒå¤šã€‚ä»Šå¹´å…¥èŒåï¼Œé¡ºåº”å…¬å¸çš„æˆ˜ç•¥ï¼Œä¸»è¦åœ¨ tidbcloud.com ä¸Š CRUDï¼Œå¸®åŠ©ç”¨æˆ·åœ¨ cloud ä¸Šå¯¼å…¥æˆ–è¿ç§»æ•°æ®ï¼Œå’Œ k8sã€CRUD ä»¥åŠç”¨æˆ·ä½“éªŒæ‰“äº¤é“æ¯”è¾ƒå¤šã€‚</p>\n<p>ç®€å•æ€»ç»“ä¸€ä¸‹å­¦åˆ°çš„ä¸œè¥¿å§ï¼Œä»å®ä¹ åˆ°ç°åœ¨ï¼š</p>\n<ol>\n<li>å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•</li>\n<li>å¤šçº¿ç¨‹ä»£ç </li>\n<li>review ä»£ç </li>\n<li>å†™è®¾è®¡æ–‡æ¡£</li>\n<li>ç†è§£ä¸€ä¸ªéœ€æ±‚æ˜¯ä»»ä½•å·¥ä½œçš„ç¬¬ä¸€æ­¥</li>\n<li>å¯¹ä¸€ä¸ªéœ€æ±‚è¿›è¡Œé¡¹ç›®ç®¡ç†ï¼Œä»¥å°½å¯èƒ½åœ°æŒ‰æ—¶äº¤ä»˜ï¼ˆå½“ç„¶ç°åœ¨è¿˜åšçš„ä¸å¤Ÿå¥½ã€‚ã€‚ã€‚ï¼‰</li>\n<li>å­¦ä¹ äº† K8s/CRD/Operator/AWS/Pulumi ç›¸å…³çš„çŸ¥è¯†ï¼Œèƒ½çœ‹æ‡‚ä»£ç ï¼Œå¹¶ç¼–å†™ç®€å•çš„ä»£ç </li>\n<li>æ›´å¤šåœ°è€ƒè™‘ç”¨æˆ·ä½“éªŒ</li>\n<li>ã€‚ã€‚</li>\n</ol>\n<p>å†è°ˆè°ˆå·¥ä½œçš„æ„Ÿå—ã€‚å¯¹äºæˆ‘è¿™ç¬¬ä¸€ä»½æ­£å¼çš„å·¥ä½œï¼Œæˆ‘æ˜¯éå¸¸æ»¡æ„æˆ‘å½“å‰çš„å›¢é˜Ÿå’Œå…¬å¸çš„ã€‚ä¸è®ºæ˜¯å…¬å¸è¿˜æ˜¯å›¢é˜Ÿå†…ï¼Œå¤§ä½¬éå¸¸å¤šï¼Œå¯ä»¥åœ¨ä»–ä»¬èº«ä¸Šå­¦åˆ°å¾ˆå¤šä¸œè¥¿ã€‚å›¢é˜Ÿå†…çš„äººå¤§å®¶å®äº‹æ±‚æ˜¯ã€äº’ç›¸å¸®åŠ©ï¼Œæˆ‘æ˜¯æ²¡æœ‰é‡åˆ°ä»€ä¹ˆå°”è™æˆ‘è¯ˆï¼Œä¸ºäº†åˆ©ç›Šèµ·å†²çªçš„æƒ…å†µï¼Œå¾ˆ niceï¼è™½ç„¶å¾ˆå¤šäººè¯Ÿç—…è´µå¸å·²ç»ä¸æ˜¯ä»¥å‰çš„è´µå¸äº†ï¼Œä¹‹å‰çš„å·¥ç¨‹å¸ˆæ–‡åŒ–æ²¡æœ‰é‚£ä¹ˆçº¯ç²¹äº†ï¼Œä½†æˆ‘è¿˜æ˜¯å¸®å…¬å¸è¯´å¥è¯ã€‚ä»Šå¹´ 2022 å¹´çš„ç¯å¢ƒå¤§å®¶è¿˜æ˜¯å¯ä»¥çœ‹å¾—åˆ°çš„ï¼ŒåŒæ ·ä»¥å·¥ç¨‹å¸ˆæ–‡åŒ–è‘—ç§°çš„å°é©¬ï¼Œå·²ç»æŠŠ 22 å±Šå¤§éƒ¨åˆ†çš„åº”å±Šç”Ÿè£æ‰äº†ï¼Œæˆ‘æœ‰åŒå­¦å°±åœ¨è¢«è£åå•é‡Œã€‚æ‰€ä»¥å¯¹äºä¸€ä¸ªåŒæ ·æ˜¯åº”å±Šç”Ÿçš„æˆ‘ï¼Œæˆ‘è¿˜æ˜¯å¾ˆä½©æœå…¬å¸çš„æˆ˜ç•¥å’Œå®šåŠ›ï¼Œä»¥å¸®åŠ©å…¬å¸ç»§ç»­ç”Ÿå­˜ä¸‹å»ï¼Œæ¯•ç«Ÿæ´»ä¸‹å»æ‰æœ‰æœªæ¥ã€‚æˆ‘çŸ¥é“è¿™ä¸¤è€…ä¹Ÿå¹¶ä¸æ˜¯å†²çªçš„ï¼Œä½†æˆ‘è¿˜æ˜¯åº†å¹¸å…¬å¸èƒ½è®©æˆ‘æœ‰ä¸€ä¸ªåœ°æ–¹å­¦ä¹ å’Œæˆé•¿ã€‚å½“ç„¶ï¼Œå¤§å®¶ä¹Ÿéƒ½ä¼šå¸Œæœ›è‡ªå·±çš„å…¬å¸èƒ½è¶Šæ¥è¶Šå¥½ï¼</p>\n<p>è®°å½•ä¸€ä¸‹ï¼šä»Šå¹´ 1 æœˆä»½å…¨ç»„äººå‘˜é½èšåŒ—äº¬å›¢ï¼ˆmianï¼‰å»ºï¼ˆjiï¼‰ï¼Œç¬¬ä¸€æ¬¡æ­£å¼è§åˆ°äº†æ¥è‡ªæˆéƒ½ã€åŒ—äº¬ã€æ­å·ã€ä¸Šæµ·çš„å„ä½å¤§ä½¬ï¼Œä¹Ÿè·Ÿç€ mentor æ²¡ç¾æ²¡è‡Šåœ°è¹­åƒè¹­å–ç©äº†ä¸¤å¤©å“ˆå“ˆã€‚ä¸å¾—ä¸è¯´ï¼Œå¤ªçˆ½äº†å“ˆå“ˆå“ˆğŸ¶ã€‚</p>\n<h2 id=\"å­¦ç”Ÿç”Ÿæ¶¯\"><a href=\"#å­¦ç”Ÿç”Ÿæ¶¯\" class=\"headerlink\" title=\"å­¦ç”Ÿç”Ÿæ¶¯\"></a>å­¦ç”Ÿç”Ÿæ¶¯</h2><p>ä»Šå¹´ç»ˆäºä»ç¡•å£«æ¯•ä¸šäº†ã€‚å¦è¯šåœ°å¯¹ç¡•å£«è¿™ä¸‰å¹´åšä¸ªç®€çŸ­çš„æ€»ç»“å§ã€‚è‡ªå·±åœ¨ä¸‰å¹´ä¸­å‡ ä¹æ²¡æœ‰ä»»ä½•çš„æˆæœï¼Œè¿ä¸€ç¯‡è®ºæ–‡éƒ½æ²¡å‘è¿‡ï¼Œåœ¨ç§‘ç ”è¿™æ¡è·¯ä¸Šï¼Œæˆ‘ä¹Ÿç®—çš„ä¸Šæ˜¯å½»åº•å¤±è´¥äº†ã€‚ä¸è¿‡è¿™ä¸‰å¹´æ¯”è¾ƒå¹¸è¿çš„æ˜¯ï¼Œæˆ‘åœ¨ç ”ä¸€ä¸‹å°±æ„è¯†åˆ°äº†è‡ªå·±ä¸é€‚åˆèµ°ç§‘ç ”è¿™æ¡è·¯ï¼Œæ‰€ä»¥èŠ±äº†å¾ˆå¤šæ—¶é—´åœ¨æ€è€ƒå’Œå®è·µè‡ªå·±ä»¥åè¦åšä»€ä¹ˆè¿™ä¸ªé—®é¢˜ä¸Šã€‚ä¹Ÿæ‰¾åˆ°äº†è‡ªè®¤ä¸ºçŸ­ä¸­æœŸå†…å‘å±•è¿˜ä¸é”™çš„æ•°æ®åº“è¿™æ¡é“è·¯ã€‚</p>\n<blockquote>\n<p>åœ¨è¯»ä¹¦æœŸé—´ï¼Œç»å¸¸å’ŒåŒå­¦è°ƒä¾ƒï¼Œè¯»ç ”æœ€å¤§çš„ä½œç”¨ï¼Œå°±æ˜¯å‘ç°äº†è¯»ç ”æ²¡ç”¨ã€‚å“ˆå“ˆå“ˆï¼Œè¿™å¥è¯å¯èƒ½æœ‰ç‚¹è¿‡ï¼Œä½†ä¹Ÿæ˜¯åªæœ‰è¯»ç ”åï¼Œæ‰èƒ½ç†è§£å¾ˆå¤šå¤§ä½¬è¯´çš„ï¼Œã€Œå›½å†…çš„ç ”ç©¶æœ‰äº›æµ®èºã€ä¸­<strong>æµ®èº</strong>çš„å«ä¹‰å§ï¼ˆå¹æ¯ï¼‰</p>\n</blockquote>\n<h2 id=\"ç”Ÿæ´»\"><a href=\"#ç”Ÿæ´»\" class=\"headerlink\" title=\"ç”Ÿæ´»\"></a>ç”Ÿæ´»</h2><p>åœ¨æ¯•ä¸šåï¼Œæ­£å¼å¼€å¯äº†æˆ‘è‡ªå·±çš„ç”Ÿæ´»ã€‚è¿™ä¸€æ¬¡å’Œæˆ‘ä¹‹å‰çš„å®ä¹ éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ‹’ç»äº†åˆç§Ÿï¼Œé€‰æ‹©äº†ä¸€ä¸ªäººæ•´ç§Ÿä¸€ä¸ªå°åŒºé‡Œçš„ä¸€å®¤ä¸€å…ã€‚åœ¨çœé’±å’Œç”Ÿæ´»è´¨é‡ä¸­é€‰æ‹©äº†åè€…ã€‚å½“æ—¶åœ¨æ¥å¹¿å·ä¹‹å‰å°±ç–¯ç‹‚åœ°çœ‹æˆ¿ï¼Œå¹»æƒ³ç€è‡ªå·±ä¸€ä¸ªäººè‡ªç”±çš„ç”Ÿæ´»å“ˆå“ˆå“ˆã€‚æ¥äº†å¹¿å·ä¹‹åå°±ç–¯ç‹‚åœ°æ‰¾æˆ¿å­ï¼Œä¸€å®¤ä¸€å…çš„å°åŒºæˆ¿å®åœ¨æ˜¯å¤ªå°‘äº†ğŸ¤®ã€‚æˆ‘é‡åˆ°ä¸€ä¸ª 2500/æœˆ 60 å¹³çš„æˆ¿å­ï¼Œä¸‹åˆ 2 ç‚¹çœ‹å®Œé¥­ï¼Œä¸‹åˆ 4 ç‚¹å°±è¢«ç§Ÿå‡ºå»äº†ï¼å°±æ˜¯è¢«æˆ‘åé¢ä¸€ä¸ªçœ‹æˆ¿çš„äººç§Ÿèµ°äº†ã€‚ã€‚ã€‚è¿™æ•ˆç‡ç®€ç›´äº†ã€‚æœ€åç§Ÿåˆ°äº†ä¸€é—´ 3000 å‡ºå¤´çš„ä¸€å®¤ä¸€å…ï¼Œæˆ¿ä¸œéå¸¸ niceï¼Œç»™é…äº†æ–°çš„é©¬æ¡¶ã€ç”µçƒ­æ°´å™¨ã€ç©ºè°ƒã€æŠ½æ²¹çƒŸæœºå’Œç¶å°ï¼Œç”šè‡³è¿˜é‡æ–°è£…ä¿®äº†å¨æˆ¿ï¼è™½ç„¶è¿˜æœ‰ä¸è¶³çš„åœ°æ–¹ï¼Œä½†æˆ‘å·²ç»éå¸¸æ»¡è¶³äº†ï¼</p>\n<h3 id=\"æ·»ç½®æ–°ç‰©ä»¶\"><a href=\"#æ·»ç½®æ–°ç‰©ä»¶\" class=\"headerlink\" title=\"æ·»ç½®æ–°ç‰©ä»¶\"></a>æ·»ç½®æ–°ç‰©ä»¶</h3><h4 id=\"å¤§æ¡Œå­âœ…\"><a href=\"#å¤§æ¡Œå­âœ…\" class=\"headerlink\" title=\"å¤§æ¡Œå­âœ…\"></a>å¤§æ¡Œå­âœ…</h4><p>åœ¨è‡ªå·±ç§Ÿäº†æˆ¿å­ä¹‹åï¼Œå¿…ç„¶ä¹Ÿæ˜¯è¦æ•´ä¸€ä¸ªæ­£ç»çš„å°ä¹¦æ¡Œçš„å•¦ã€‚åœ¨é—²é±¼ä¸Šè¹²äº†å¥½å‡ å¤©ï¼Œä¸­é—´è¿˜å»æ—è¾¹çš„äºŒæ‰‹å¸‚åœºçœ‹äº†ï¼Œæœ€åèŠ± 220 è¹²åˆ°äº†è¿™å¼  160âœ–ï¸70 çš„æ¡Œå­ï¼ˆè´§æ‹‰æ‹‰éƒ½èŠ±äº† 100+ ğŸ˜‚ï¼‰</p>\n<p><a href=\"https://imgloc.com/i/tk3cN\"><img src=\"https://i.328888.xyz/2023/01/02/tk3cN.th.jpeg\" alt=\"tk3cN.th.jpeg\"></a></p>\n<h4 id=\"æ´æ´æ¿âœ…\"><a href=\"#æ´æ´æ¿âœ…\" class=\"headerlink\" title=\"æ´æ´æ¿âœ…\"></a>æ´æ´æ¿âœ…</h4><p>çœ‹ B ç«™è§†é¢‘è¿˜çœ‹åˆ°äº†è¿™ç§ç«‹å¼çš„æ´æ´æ¿ï¼Œæƒ³åˆ°å‡ºç§Ÿå±‹é‡Œä¹Ÿå®Œå…¨æ²¡æœ‰ä¹¦æ¶ã€å°ç‰©ä»¶çš„æ”¶çº³ä»€ä¹ˆçš„ï¼Œå°±æ•´äº†ä¸€ä¸ªã€‚è¿˜è¡Œå“ˆï¼Œæ¯”å…‰ç§ƒç§ƒçš„å¥½å¤šäº†ã€‚</p>\n<p><a href=\"https://imgloc.com/i/tkHFX\"><img src=\"https://i.328888.xyz/2023/01/02/tkHFX.th.jpeg\" alt=\"tkHFX.th.jpeg\"></a></p>\n<h4 id=\"äººä½“å·¥å­¦æ¤…âœ…\"><a href=\"#äººä½“å·¥å­¦æ¤…âœ…\" class=\"headerlink\" title=\"äººä½“å·¥å­¦æ¤…âœ…\"></a>äººä½“å·¥å­¦æ¤…âœ…</h4><p>æ¯•ç«Ÿå·¥ä½œéœ€è¦ï¼Œç«‹é©¬ä¹Ÿæ•´äº†ä¸ªå¥½æ¤…å­ï¼Œå¯ä»¥ç”¨å¾ˆä¹…äº†</p>\n<p><a href=\"https://imgloc.com/i/t0jdv\"><img src=\"https://i.328888.xyz/2023/01/02/t0jdv.th.jpeg\" alt=\"t0jdv.th.jpeg\"></a></p>\n<h4 id=\"ç‰™å¥—âœ…\"><a href=\"#ç‰™å¥—âœ…\" class=\"headerlink\" title=\"ç‰™å¥—âœ…\"></a>ç‰™å¥—âœ…</h4><p>ä»å¾ˆå¤šå¹´å‰è‡ªå·±å°±è§‰å¾—è‡ªå·±çš„ç‰™é½¿ä¸é½ï¼Œæƒ³è¦åšç‰™é½¿çŸ«æ­£ï¼Œä½†æ— å¥ˆå› ä¸ºé’±æˆ–è€…é•¿ä½åœ°ä¸ç¨³å®šç­‰åŸå› ï¼Œä¸€ç›´æ²¡å¼€å§‹ã€‚æ‰€ä»¥åœ¨å¹¿å·å®‰é¡¿ä¸‹æ¥ä¹‹åï¼Œç«‹é©¬å¼€å§‹äº†ç‰™é½¿çŸ«æ­£çš„è¿›ç¨‹ã€‚ä¸Šä¸‹å·¦å³æ‹”äº† 4 é¢—ç‰™ï¼å¦ˆè€¶ï¼Œç–¼æ­»æˆ‘äº†ã€‚</p>\n<h4 id=\"æ‰“å‡»å«âœ…\"><a href=\"#æ‰“å‡»å«âœ…\" class=\"headerlink\" title=\"æ‰“å‡»å«âœ…\"></a>æ‰“å‡»å«âœ…</h4><p>æˆ‘è‡ªå·±å¯¹éŸ³ä¹ä¹Ÿä¸€ç›´æŒºæ„Ÿå…´è¶£çš„ï¼Œå“ˆå“ˆå°±æƒ³åšç‚¹éŸ³ä¹ç›¸å…³çš„çˆ±å¥½ã€‚ä¹‹å‰æœ‰å…³æ³¨ä¸€ä¸ªç»åœ°çš„ä¸»æ’­ï¼Œä»–ç©çš„æ‰“å‡»å«è¶…é…·ï¼ç°åœ¨æœ‰è‡ªå·±çš„ç©ºé—´å’Œç”Ÿæ´»äº†ï¼Œå°±æ•´äº†ä¸€ä¸ªäºŒæ‰‹çš„å…¥é—¨æ¬¾ã€‚</p>\n<p><a href=\"https://imgloc.com/i/twO4o\"><img src=\"https://i.328888.xyz/2023/01/02/twO4o.th.jpeg\" alt=\"twO4o.th.jpeg\"></a></p>\n<p>ä½†æ˜¯éå¸¸å¯æƒœï¼Œåœ¨ç»ƒå®Œå…¥é—¨æ›² <a href=\"https://www.bilibili.com/video/BV1bv4y1B7RL/?spm_id_from=333.999.0.0&vd_source=1d41e3899bfb8af8d65144aad99bbde1\">Luz letter</a> åï¼Œåœ¨å¦å¤–æŒ‘äº†ä¸€é¦–<a href=\"https://www.bilibili.com/video/BV1q8411E7ts/?spm_id_from=333.999.0.0&vd_source=1d41e3899bfb8af8d65144aad99bbde1\">è¿›é˜¶çš„æ›²å­</a>ç»ƒä¹ è¿‡ç¨‹ä¸­å°±å‘ç°äº†é—®é¢˜â€”â€”ç¯å…‰è·Ÿä¸ä¸ŠèŠ‚å¥ã€‚ã€‚ã€‚è¿™ä¸ªå…¥é—¨æ¬¾çš„ç¯å…‰é¢‘ç‡å¤ªä½äº†ï¼Œå°è¯•äº†å¾ˆå¤šæ¬¡ä¹‹åè¿˜æ˜¯æ”¾å¼ƒäº†ç»§ç»­åœ¨è¿™æ¬¾ä¸Šé¢ç»§ç»­ç»ƒï¼Œç„¶åè’åºŸåˆ°ç°åœ¨ï¼ˆå“ï¼Œå¯æƒœã€‚</p>\n<h4 id=\"PS5-å¤§ç”µè§†âœ…\"><a href=\"#PS5-å¤§ç”µè§†âœ…\" class=\"headerlink\" title=\"PS5/å¤§ç”µè§†âœ…\"></a>PS5/å¤§ç”µè§†âœ…</h4><p>åœ¨åŒåä¸€çš„æ—¶å€™ï¼Œæ”¶äº†ä¸€ä¸ªäºŒæ‰‹çš„ PS5ï¼Œè¿˜é…äº†ä¸€ä¸ªå¤§ç”µè§†ï¼è¿™ä¸ªå°å‡ºç§Ÿå±‹ä¹Ÿç»ˆäºå¯ä»¥çœ‹ç”µè§†äº†ã€‚</p>\n<p><img src=\"https://i.328888.xyz/2023/01/02/t0Law.jpeg\" alt=\"t0Law.jpeg\"></p>\n<p>é¡ºå¸¦è¯„ä»·ä¸€ä¸‹è€å¤´ç¯å§ï¼Œåœ¨ PS5 ä¸Šç©çš„ç¬¬ä¸€ä¸ªæ¸¸æˆã€‚ä¹‹å‰ä¹Ÿæœ‰ç©è¿‡é»‘é­‚ 3ï¼Œ1ï¼‰æ‰€ä»¥å¹¶æ²¡æœ‰ç¬¬ä¸€æ¬¡ç©é­‚ç±»æ¸¸æˆé‚£ç§å†²å‡»äº†ï¼Œè€Œä¸”è€å¤´ç¯çš„éš¾åº¦ç³»æ•°ç›¸æ¯”é»‘é­‚ç¡®å®ä½äº†ä¸å°‘ï¼Œè½¬è§’æ€å°‘äº†ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥è€ç©å®¶åœ¨è½¬è§’å¤„å›å¤´çš„æ—¶å€™ç»å¸¸â€œå¤±æœ›â€å“ˆå“ˆå“ˆã€‚2ï¼‰è¿˜æœ‰ä¸€ä¸ªç‚¹æ˜¯å †æ–™å¤ªä¸¥é‡äº†å­ï¼Œé‡å¤çš„é—è¿¹ï¼Œé‡å¤çš„ bossï¼Œé‡å¤çš„å¢“åœ°ï¼Œå•ä¸€çš„å°æ€ªï¼Œæ•£è½åœ¨äº¤ç•Œåœ°çš„å„å¤„ï¼Œå®Œå…¨æ²¡æœ‰ä»€ä¹ˆåŠ¨åŠ›å»ä¸€ä¸€æ‰«å›¾ã€‚ã€‚ã€‚3ï¼‰å¯¹äºå‰§æƒ…ï¼Œæˆ‘è¿˜æ˜¯çŸ¥é“é­‚ç±»æ¸¸æˆçš„å¥—è·¯çš„â€”â€”å‰§æƒ…éƒ½æ•£è½åœ¨å„ä¸ªé“å…·ä¸Šï¼Œä½†æˆ‘çœŸçš„åšä¸åˆ°å…¨æœé›†å‘€ï¼ğŸ˜­ï¼Œè€Œä¸”ç”±äºåœ°å›¾å¤ªå¤§ï¼Œå‰§æƒ…å¤ªæ•£ï¼Œæˆ‘çœŸçš„è®°ä¸ä½å„ä¸ªæ”¯çº¿å‘€ï¼4ï¼‰å¯¹äºå¼€æ”¾ä¸–ç•Œï¼Œç”±äºä¹Ÿç©è¿‡å¡å°”è¾¾è¿™ç§ç¥ä½œï¼Œåªèƒ½è¯´å®«å´è‹±é«˜æŠŠé­‚å…ƒç´ å¡åˆ°äº†ä¸€ä¸ªå¼€æ”¾ä¸–ç•Œä¸­ï¼Œè‡³äºè¿™ä¸ªå¼€æ”¾ä¸–ç•Œå®ƒâ€œå¼€æ”¾â€å—ï¼Ÿè¿™ç®¡æˆ‘å•¥äº‹ã€‚</p>\n<p>å“ˆå“ˆå“ˆï¼Œåæ§½å®Œäº†ï¼Œä½†è¿˜æ˜¯è¦è¯´æˆ‘ç©äº†å‡ åä¸ªå°æ—¶ï¼Œæ¯æ¬¡ä¸€ç©å°±æ˜¯äº”å…­ä¸ªå°æ—¶èµ·æ­¥ï¼Œè¿˜æ˜¯å¾ˆä¸é”™çš„æ¸¸æˆçš„ï¼Œåªä¸è¿‡åœ¨åæœŸæ„Ÿå—åˆ°äº†ä¹å‘³ï¼Œæ²¡èƒ½æˆä¸ºè‰¾å°”ç™»ä¹‹ç‹ã€‚</p>\n<h3 id=\"åšé¥­\"><a href=\"#åšé¥­\" class=\"headerlink\" title=\"åšé¥­\"></a>åšé¥­</h3><p>è¦æœ‰ç”Ÿæ´»æ°”æ¯ï¼Œä¸€å®šç¦»ä¸å¼€è‡ªå·±åšé¥­ï¼ä»Šå¹´è‡ªå·±å’Œå¥³æœ‹å‹ä¸€èµ·åšäº†å¥½å¤šå¥½å¤šçš„èœï¼è€Œä¸”å°‘æœ‰å¤±è´¥ï¼Œå“ˆå“ˆå“ˆå¥³ç¥¨ç›´ç§°æˆ‘ä¸ºå¨æˆ¿å°å¤©æ‰å“ˆå“ˆï¼ˆä¹Ÿä¸æ’é™¤å¥¹æ˜¯ä¸ºäº†è®©æˆ‘å¤šåšé¥­ğŸ¶ï¼‰ã€‚è‡ªå·±åšé¥­çœŸçš„æ²¡é‚£ä¹ˆéš¾ï¼Œè€Œä¸”å‘³é“ä¹Ÿæ¯”å¤§éƒ¨åˆ†åŸä¸­æ‘çš„å¤–å–å¥½åƒï¼Œå°±æ˜¯æ”¶æ‹¾å¨æˆ¿ã€æ´—ç¢—ä»€ä¹ˆçš„å¤ªéº»çƒ¦äº†ï¼Œåšå®Œé¥­åƒå®Œé¥­æ”¶æ‹¾å®ŒåŸºæœ¬æ™šä¸Šå°±å•¥éƒ½ä¸æƒ³å¹²äº†åªæƒ³ç˜«ç€ã€‚ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™èƒ½ä¹°ä¸ªæ´—ç¢—æœºå‘€ã€‚</p>\n<img src=https://cdn-us.imgs.moe/2023/01/02/63b2c89a14f9a.jpg width=30% />\n\n<h3 id=\"çœ‹ä¹¦\"><a href=\"#çœ‹ä¹¦\" class=\"headerlink\" title=\"çœ‹ä¹¦\"></a>çœ‹ä¹¦</h3><p>ä»Šå¹´çœ‹ä¹¦çš„ç›®æ ‡ç®—æ˜¯è¾¾åˆ°äº†ï¼Œä¸€å…±çœ‹å®Œäº† 13 æœ¬ä¹¦ã€‚æ„Ÿè§‰è‡ªå·±çœ‹ä¹¦çš„è¾“å…¥æ•ˆç‡è¿˜ä¸å¤Ÿã€‚ã€‚ã€‚è¿˜éœ€è¦ç»§ç»­å­¦ä¹ ğŸ˜‚</p>\n<ul>\n<li>æµªæ½®ä¹‹å·…</li>\n<li>ç¨‹åºå‘˜çš„ä¿®ç‚¼ä¹‹é“</li>\n<li>å°ç‹å­çš„é¢†æ‚Ÿ</li>\n<li>MySQL æ˜¯æ€ä¹ˆè¿è¡Œçš„</li>\n<li>é»‘å®¢ä¸ç”»å®¶</li>\n<li>æ‚‰è¾¾å¤š</li>\n<li>kubernetes in action</li>\n<li>å¼‚ä¹¡äºº</li>\n<li>æ²™å‘ä¸Šçš„å¿ƒç†å­¦</li>\n<li>æ•°æ®ç”Ÿæ€ï¼šMySQL å¤åˆ¶æŠ€æœ¯ä¸ç”Ÿäº§å®è·µ</li>\n<li>å®‡å®™çš„æœ€åä¸‰åˆ†é’Ÿ</li>\n<li>shell è„šæœ¬åŸºç¡€æ•™ç¨‹</li>\n<li>æªç‚®ã€ç—…èŒä¸é’¢é“</li>\n</ul>\n<h3 id=\"çˆ±æƒ…\"><a href=\"#çˆ±æƒ…\" class=\"headerlink\" title=\"çˆ±æƒ…\"></a>çˆ±æƒ…</h3><p>ä»Šå¹´æ˜¯å’Œæˆ‘å¥³æœ‹å‹ï¼ˆä»¥åå°±å«å¥¹å°æ‡’è™«å§ï¼ï¼‰åœ¨ä¸€èµ·çš„ç¬¬ä¸€å¹´ï½ç®—æ˜¯æ”¶è·äº†æ¢¦æƒ³ä¸­ç”œèœœçš„çˆ±æƒ…äº†ï¼ˆç—´æ±‰ç¬‘ğŸ˜Šï¼‰ã€‚è¿™ä¸€å¹´æˆ‘ä»¬å…ˆæ˜¯åº¦è¿‡äº†æ‹çˆ±ä¸­æœ€éš¾ç†¬çš„å¼‚åœ°æ‹ï¼æœ€é•¿æœ‰ä¸‰ä¸ªæœˆçš„æ—¶é—´æ²¡æœ‰è§é¢ï¼Œå¯èƒ½ä»¥åéƒ½ä¸ä¼šå†æœ‰è¿™ä¹ˆé•¿æ—¶é—´ä¸è§é¢çš„æœºä¼šäº†å§ã€‚</p>\n<p>ä»Šå¹´å’Œå°æ‡’è™«åº¦è¿‡äº†è¶…çº§å¤šçš„ç¬¬ä¸€æ¬¡ã€‚</p>\n<ul>\n<li>ç¬¬ä¸€æ¬¡æ”¶åˆ°æ–°å¹´ç¤¼ç‰©</li>\n</ul>\n<p><a href=\"https://imgloc.com/i/tN1da\"><img src=\"https://i.328888.xyz/2023/01/03/tN1da.th.jpeg\" alt=\"tN1da.th.jpeg\"></a></p>\n<ul>\n<li><p>ç¬¬ä¸€æ¬¡ä¸€èµ·å¼¹é’¢ç´</p>\n</li>\n<li><p>ç¬¬ä¸€æ¬¡ä¸€èµ·æ—…æ¸¸ã€çœ‹æµ·ã€å¸†èˆ¹ã€æ¡¨æ¿ã€æµ·è¾¹éœ²è¥ã€æ—¥å‡º</p>\n</li>\n</ul>\n<p><a href=\"https://imgloc.com/i/tN9TV\"><img src=\"https://i.328888.xyz/2023/01/03/tN9TV.th.jpeg\" alt=\"tN9TV.th.jpeg\"></a></p>\n<ul>\n<li>ç¬¬ä¸€æ¬¡ææ€–å¯†å®¤</li>\n</ul>\n<p><a href=\"https://imgloc.com/i/tNLpb\"><img src=\"https://i.328888.xyz/2023/01/03/tNLpb.th.png\" alt=\"tNLpb.th.png\"></a></p>\n<ul>\n<li>ç¬¬ä¸€æ¬¡é€šå…³æ¸¸æˆ</li>\n</ul>\n<p><a href=\"https://imgloc.com/i/trjhJ\"><img src=\"https://i.328888.xyz/2023/01/03/trjhJ.th.jpeg\" alt=\"trjhJ.th.jpeg\"></a></p>\n<ul>\n<li>ç¬¬ä¸€æ¬¡è„±å£ç§€</li>\n</ul>\n<p><a href=\"https://imgloc.com/i/try93\"><img src=\"https://i.328888.xyz/2023/01/03/try93.th.jpeg\" alt=\"try93.th.jpeg\"></a></p>\n<h3 id=\"ç–«æƒ…\"><a href=\"#ç–«æƒ…\" class=\"headerlink\" title=\"ç–«æƒ…\"></a>ç–«æƒ…</h3><p>åœ¨ 2022 å¹´çš„å¹´æœ«ï¼Œç–«æƒ…ç»ˆäºç®—æ˜¯â€œç»“æŸâ€äº†ã€‚ã€‚ã€‚åœ¨æ¯•ä¸šå‰ç”±äºæ±Ÿè‹æ•™è‚²å±€çš„æ”¿ç­–ã€Œä¸Šæµ·ä¸€å¤©ä¸è§£å°ï¼Œå—äº¬é«˜æ ¡ä¹Ÿä¸è§£å°ã€ï¼Œç»“æœå¯¼è‡´æˆ‘ä»¬åœ¨å—å¤§è¢«å°äº†ä¸¤ä¸ªæœˆï¼è¿™è®©æˆ‘ä»¬è®ºæ–‡å†™å®Œäº†ï¼Œç­”è¾©å®Œäº†ä¹Ÿæ²¡æœ‰æœºä¼šå‡ºæ ¡ã€‚è¿™ç›´æ¥å¯¼è‡´æˆ‘åœ¨èƒ½æ¯•ä¸šç¦»æ ¡çš„ç¬¬ä¸€æ—¶é—´ç¦»å¼€äº†å­¦æ ¡ï¼Œå¹¶ä¸å¸¦ä¸€ç‚¹ç•™æ‹ã€‚æœ¬æ¥æ‰“ç®—åœ¨å—äº¬å¥½å¥½ç©ä¸€ä¸‹çš„ä¹Ÿæ²¡æœ‰æ—¶é—´äº†ã€‚å¼‚åœ°æ‹çš„å½±å“ä¹Ÿåœ¨è¿™ä¸¤ä¸ªæœˆé‡Œè¾¾åˆ°äº†é¡¶å³°ã€‚ã€‚ã€‚çœŸæ˜¯å¤ªç…ç†¬äº†ã€‚</p>\n<p>å¦å¤–ï¼Œä»ä»Šå¹´å¹´åº•å¹¿å·ç–«æƒ…å¼€å§‹ï¼Œè‡ªå·±å‡ ä¹å°±ä¸€ç›´ remote åˆ°äº†ç°åœ¨ï¼Œå®Œå…¨æ”¹å˜äº†å·¥ä½œä¹ æƒ¯ã€‚ã€‚ã€‚æ”¾å¼€åä¹Ÿé˜³äº†ä¸€æ¬¡ï¼Œä½†è¿˜ä¸ç®—ä¸¥é‡ï¼Œä¹Ÿå°±çƒ§äº†ä¸€å¤©å¤šï¼Œå‘çƒ§çš„æ—¶å€™åŸºæœ¬åœ¨ç¡è§‰ï¼Œé€€çƒ§ååŸºæœ¬å°±æ²¡ä»€ä¹ˆäº‹äº†ã€‚</p>\n<p>æˆ‘è®¤ä¸ºåªè¦ä¸å†æä»€ä¹ˆç±»ä¼¼å°åŸçš„äº‹æƒ…ï¼Œç–«æƒ…å°±ç®—æ˜¯è¿‡å»äº†ã€‚å› ä¸ºè¿™æ˜¯ä¸å¯é¿å…çš„äº‹æƒ…å‘€ï¼Œåœ¨è¯»å®Œã€Šæªç‚®ã€ç—…èŒä¸é’¢é“ã€‹åçŸ¥é“ï¼Œäººç±»<strong>ä»æ¥</strong>æ²¡æœ‰æˆ˜èƒœè¿‡ç—…æ¯’ã€‚è¿™æ˜¯å®¢è§‚äº‹å®ã€‚ä¸€æ—¦æ”¾å¼€åï¼Œæˆ‘ä»¬å°±å†ä¹Ÿå›ä¸å»äº†ï¼Œäº¦æˆ–è€…è¯´æˆ‘ä»¬ç¬é—´å°±å›åˆ°äº†è¿‡å»ã€‚æœ‰ç—…æ²»ç—…ï¼ŒæŒºå¥½çš„ã€‚</p>\n<h2 id=\"2023\"><a href=\"#2023\" class=\"headerlink\" title=\"2023\"></a>2023</h2><p>2023 å¹´è¦åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<ul>\n<li>å·¥ä½œä¸Šï¼Œthink more and do more</li>\n<li>è¯»ä¹¦å’Œåšé¥­çš„ä¹ æƒ¯èƒ½ç»§ç»­ä¿æŒ</li>\n<li>è®¡åˆ’ä¸­çš„é”»ç‚¼åˆ«æ‹‰ä¸‹äº†ï¼Œå¤šè·‘æ­¥ï¼Œå‚åŠ ä¸€åœºåŠé©¬</li>\n<li>æ¥¼ä¸‹å°±æœ‰ç½‘çƒåœºï¼Œå¤§å­¦å­¦çš„ç½‘çƒä¸€å®šè¦æ¡èµ·æ¥ç©ç©</li>\n<li>å»æ›´å¤šåœ°æ–¹æ—…è¡Œï¼ˆå“ˆå°”æ»¨ã€æ½®æ±•</li>\n<li>æ¢ä¸ªå¥½ç‚¹çš„ launchpad ç»§ç»­ç©ç©</li>\n</ul>\n<p>æ€»ä¹‹ï¼Œ2022 è¿˜è¡Œï¼Œ2023 ç»§ç»­åŠ æ²¹ğŸ’ª</p>\n","site":{"data":{}},"cover":false,"length":3365,"excerpt":"","more":"<p>ç¬¬ä¸€æ¬¡å†™å¹´ç»ˆæ€»ç»“å‘€ï¼Œå°è¯•è®°å½•ä¸€ä¸‹ã€‚ä¸€å¹´ä¸‹æ¥è¿˜çœŸå‘ç”Ÿäº†ä¸å°‘äº‹ã€‚çœ‹çœ‹è‡ªå·±æœ‰å•¥æ”¶è·æœ‰å•¥æˆé•¿ã€‚</p>\n<h2 id=\"å·¥ä½œ\"><a href=\"#å·¥ä½œ\" class=\"headerlink\" title=\"å·¥ä½œ\"></a>å·¥ä½œ</h2><p>å…ˆè¯´è¯´å·¥ä½œå§ã€‚ä»å—å¤§æ¯•ä¸šåï¼Œæˆ‘å»äº† PingCAPï¼ˆè´µå¸ï¼‰å·¥ä½œï¼Œç°åœ¨åœ¨è´µå¸çš„ DMï¼ˆData Migrationï¼‰å›¢é˜Ÿå·¥ä½œï¼Œå·®ä¸å¤šå°±åœ¨æ•°æ®å¯¼å…¥ã€æ•°æ®è¿ç§»ä»¥åŠå…¶å¯¹åº”çš„äº‘ä¸Šç‰ˆæœ¬è¿™äº›åœ°æ–¹æ¬ç –ã€‚å»å¹´å°±æœ‰åœ¨è´µå¸å®ä¹ ï¼Œä¸»è¦åœ¨ç»´æŠ¤ DMï¼Œä¹Ÿå°±æ˜¯æ€ä¹ˆæŠŠä¸€æ¡ binlog å†™åˆ°ä¸‹æ¸¸ TiDB é‡Œé¢ï¼Œå’Œ MySQL binlog æ‰“äº¤é“æ¯”è¾ƒå¤šã€‚ä»Šå¹´å…¥èŒåï¼Œé¡ºåº”å…¬å¸çš„æˆ˜ç•¥ï¼Œä¸»è¦åœ¨ tidbcloud.com ä¸Š CRUDï¼Œå¸®åŠ©ç”¨æˆ·åœ¨ cloud ä¸Šå¯¼å…¥æˆ–è¿ç§»æ•°æ®ï¼Œå’Œ k8sã€CRUD ä»¥åŠç”¨æˆ·ä½“éªŒæ‰“äº¤é“æ¯”è¾ƒå¤šã€‚</p>\n<p>ç®€å•æ€»ç»“ä¸€ä¸‹å­¦åˆ°çš„ä¸œè¥¿å§ï¼Œä»å®ä¹ åˆ°ç°åœ¨ï¼š</p>\n<ol>\n<li>å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•</li>\n<li>å¤šçº¿ç¨‹ä»£ç </li>\n<li>review ä»£ç </li>\n<li>å†™è®¾è®¡æ–‡æ¡£</li>\n<li>ç†è§£ä¸€ä¸ªéœ€æ±‚æ˜¯ä»»ä½•å·¥ä½œçš„ç¬¬ä¸€æ­¥</li>\n<li>å¯¹ä¸€ä¸ªéœ€æ±‚è¿›è¡Œé¡¹ç›®ç®¡ç†ï¼Œä»¥å°½å¯èƒ½åœ°æŒ‰æ—¶äº¤ä»˜ï¼ˆå½“ç„¶ç°åœ¨è¿˜åšçš„ä¸å¤Ÿå¥½ã€‚ã€‚ã€‚ï¼‰</li>\n<li>å­¦ä¹ äº† K8s/CRD/Operator/AWS/Pulumi ç›¸å…³çš„çŸ¥è¯†ï¼Œèƒ½çœ‹æ‡‚ä»£ç ï¼Œå¹¶ç¼–å†™ç®€å•çš„ä»£ç </li>\n<li>æ›´å¤šåœ°è€ƒè™‘ç”¨æˆ·ä½“éªŒ</li>\n<li>ã€‚ã€‚</li>\n</ol>\n<p>å†è°ˆè°ˆå·¥ä½œçš„æ„Ÿå—ã€‚å¯¹äºæˆ‘è¿™ç¬¬ä¸€ä»½æ­£å¼çš„å·¥ä½œï¼Œæˆ‘æ˜¯éå¸¸æ»¡æ„æˆ‘å½“å‰çš„å›¢é˜Ÿå’Œå…¬å¸çš„ã€‚ä¸è®ºæ˜¯å…¬å¸è¿˜æ˜¯å›¢é˜Ÿå†…ï¼Œå¤§ä½¬éå¸¸å¤šï¼Œå¯ä»¥åœ¨ä»–ä»¬èº«ä¸Šå­¦åˆ°å¾ˆå¤šä¸œè¥¿ã€‚å›¢é˜Ÿå†…çš„äººå¤§å®¶å®äº‹æ±‚æ˜¯ã€äº’ç›¸å¸®åŠ©ï¼Œæˆ‘æ˜¯æ²¡æœ‰é‡åˆ°ä»€ä¹ˆå°”è™æˆ‘è¯ˆï¼Œä¸ºäº†åˆ©ç›Šèµ·å†²çªçš„æƒ…å†µï¼Œå¾ˆ niceï¼è™½ç„¶å¾ˆå¤šäººè¯Ÿç—…è´µå¸å·²ç»ä¸æ˜¯ä»¥å‰çš„è´µå¸äº†ï¼Œä¹‹å‰çš„å·¥ç¨‹å¸ˆæ–‡åŒ–æ²¡æœ‰é‚£ä¹ˆçº¯ç²¹äº†ï¼Œä½†æˆ‘è¿˜æ˜¯å¸®å…¬å¸è¯´å¥è¯ã€‚ä»Šå¹´ 2022 å¹´çš„ç¯å¢ƒå¤§å®¶è¿˜æ˜¯å¯ä»¥çœ‹å¾—åˆ°çš„ï¼ŒåŒæ ·ä»¥å·¥ç¨‹å¸ˆæ–‡åŒ–è‘—ç§°çš„å°é©¬ï¼Œå·²ç»æŠŠ 22 å±Šå¤§éƒ¨åˆ†çš„åº”å±Šç”Ÿè£æ‰äº†ï¼Œæˆ‘æœ‰åŒå­¦å°±åœ¨è¢«è£åå•é‡Œã€‚æ‰€ä»¥å¯¹äºä¸€ä¸ªåŒæ ·æ˜¯åº”å±Šç”Ÿçš„æˆ‘ï¼Œæˆ‘è¿˜æ˜¯å¾ˆä½©æœå…¬å¸çš„æˆ˜ç•¥å’Œå®šåŠ›ï¼Œä»¥å¸®åŠ©å…¬å¸ç»§ç»­ç”Ÿå­˜ä¸‹å»ï¼Œæ¯•ç«Ÿæ´»ä¸‹å»æ‰æœ‰æœªæ¥ã€‚æˆ‘çŸ¥é“è¿™ä¸¤è€…ä¹Ÿå¹¶ä¸æ˜¯å†²çªçš„ï¼Œä½†æˆ‘è¿˜æ˜¯åº†å¹¸å…¬å¸èƒ½è®©æˆ‘æœ‰ä¸€ä¸ªåœ°æ–¹å­¦ä¹ å’Œæˆé•¿ã€‚å½“ç„¶ï¼Œå¤§å®¶ä¹Ÿéƒ½ä¼šå¸Œæœ›è‡ªå·±çš„å…¬å¸èƒ½è¶Šæ¥è¶Šå¥½ï¼</p>\n<p>è®°å½•ä¸€ä¸‹ï¼šä»Šå¹´ 1 æœˆä»½å…¨ç»„äººå‘˜é½èšåŒ—äº¬å›¢ï¼ˆmianï¼‰å»ºï¼ˆjiï¼‰ï¼Œç¬¬ä¸€æ¬¡æ­£å¼è§åˆ°äº†æ¥è‡ªæˆéƒ½ã€åŒ—äº¬ã€æ­å·ã€ä¸Šæµ·çš„å„ä½å¤§ä½¬ï¼Œä¹Ÿè·Ÿç€ mentor æ²¡ç¾æ²¡è‡Šåœ°è¹­åƒè¹­å–ç©äº†ä¸¤å¤©å“ˆå“ˆã€‚ä¸å¾—ä¸è¯´ï¼Œå¤ªçˆ½äº†å“ˆå“ˆå“ˆğŸ¶ã€‚</p>\n<h2 id=\"å­¦ç”Ÿç”Ÿæ¶¯\"><a href=\"#å­¦ç”Ÿç”Ÿæ¶¯\" class=\"headerlink\" title=\"å­¦ç”Ÿç”Ÿæ¶¯\"></a>å­¦ç”Ÿç”Ÿæ¶¯</h2><p>ä»Šå¹´ç»ˆäºä»ç¡•å£«æ¯•ä¸šäº†ã€‚å¦è¯šåœ°å¯¹ç¡•å£«è¿™ä¸‰å¹´åšä¸ªç®€çŸ­çš„æ€»ç»“å§ã€‚è‡ªå·±åœ¨ä¸‰å¹´ä¸­å‡ ä¹æ²¡æœ‰ä»»ä½•çš„æˆæœï¼Œè¿ä¸€ç¯‡è®ºæ–‡éƒ½æ²¡å‘è¿‡ï¼Œåœ¨ç§‘ç ”è¿™æ¡è·¯ä¸Šï¼Œæˆ‘ä¹Ÿç®—çš„ä¸Šæ˜¯å½»åº•å¤±è´¥äº†ã€‚ä¸è¿‡è¿™ä¸‰å¹´æ¯”è¾ƒå¹¸è¿çš„æ˜¯ï¼Œæˆ‘åœ¨ç ”ä¸€ä¸‹å°±æ„è¯†åˆ°äº†è‡ªå·±ä¸é€‚åˆèµ°ç§‘ç ”è¿™æ¡è·¯ï¼Œæ‰€ä»¥èŠ±äº†å¾ˆå¤šæ—¶é—´åœ¨æ€è€ƒå’Œå®è·µè‡ªå·±ä»¥åè¦åšä»€ä¹ˆè¿™ä¸ªé—®é¢˜ä¸Šã€‚ä¹Ÿæ‰¾åˆ°äº†è‡ªè®¤ä¸ºçŸ­ä¸­æœŸå†…å‘å±•è¿˜ä¸é”™çš„æ•°æ®åº“è¿™æ¡é“è·¯ã€‚</p>\n<blockquote>\n<p>åœ¨è¯»ä¹¦æœŸé—´ï¼Œç»å¸¸å’ŒåŒå­¦è°ƒä¾ƒï¼Œè¯»ç ”æœ€å¤§çš„ä½œç”¨ï¼Œå°±æ˜¯å‘ç°äº†è¯»ç ”æ²¡ç”¨ã€‚å“ˆå“ˆå“ˆï¼Œè¿™å¥è¯å¯èƒ½æœ‰ç‚¹è¿‡ï¼Œä½†ä¹Ÿæ˜¯åªæœ‰è¯»ç ”åï¼Œæ‰èƒ½ç†è§£å¾ˆå¤šå¤§ä½¬è¯´çš„ï¼Œã€Œå›½å†…çš„ç ”ç©¶æœ‰äº›æµ®èºã€ä¸­<strong>æµ®èº</strong>çš„å«ä¹‰å§ï¼ˆå¹æ¯ï¼‰</p>\n</blockquote>\n<h2 id=\"ç”Ÿæ´»\"><a href=\"#ç”Ÿæ´»\" class=\"headerlink\" title=\"ç”Ÿæ´»\"></a>ç”Ÿæ´»</h2><p>åœ¨æ¯•ä¸šåï¼Œæ­£å¼å¼€å¯äº†æˆ‘è‡ªå·±çš„ç”Ÿæ´»ã€‚è¿™ä¸€æ¬¡å’Œæˆ‘ä¹‹å‰çš„å®ä¹ éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ‹’ç»äº†åˆç§Ÿï¼Œé€‰æ‹©äº†ä¸€ä¸ªäººæ•´ç§Ÿä¸€ä¸ªå°åŒºé‡Œçš„ä¸€å®¤ä¸€å…ã€‚åœ¨çœé’±å’Œç”Ÿæ´»è´¨é‡ä¸­é€‰æ‹©äº†åè€…ã€‚å½“æ—¶åœ¨æ¥å¹¿å·ä¹‹å‰å°±ç–¯ç‹‚åœ°çœ‹æˆ¿ï¼Œå¹»æƒ³ç€è‡ªå·±ä¸€ä¸ªäººè‡ªç”±çš„ç”Ÿæ´»å“ˆå“ˆå“ˆã€‚æ¥äº†å¹¿å·ä¹‹åå°±ç–¯ç‹‚åœ°æ‰¾æˆ¿å­ï¼Œä¸€å®¤ä¸€å…çš„å°åŒºæˆ¿å®åœ¨æ˜¯å¤ªå°‘äº†ğŸ¤®ã€‚æˆ‘é‡åˆ°ä¸€ä¸ª 2500/æœˆ 60 å¹³çš„æˆ¿å­ï¼Œä¸‹åˆ 2 ç‚¹çœ‹å®Œé¥­ï¼Œä¸‹åˆ 4 ç‚¹å°±è¢«ç§Ÿå‡ºå»äº†ï¼å°±æ˜¯è¢«æˆ‘åé¢ä¸€ä¸ªçœ‹æˆ¿çš„äººç§Ÿèµ°äº†ã€‚ã€‚ã€‚è¿™æ•ˆç‡ç®€ç›´äº†ã€‚æœ€åç§Ÿåˆ°äº†ä¸€é—´ 3000 å‡ºå¤´çš„ä¸€å®¤ä¸€å…ï¼Œæˆ¿ä¸œéå¸¸ niceï¼Œç»™é…äº†æ–°çš„é©¬æ¡¶ã€ç”µçƒ­æ°´å™¨ã€ç©ºè°ƒã€æŠ½æ²¹çƒŸæœºå’Œç¶å°ï¼Œç”šè‡³è¿˜é‡æ–°è£…ä¿®äº†å¨æˆ¿ï¼è™½ç„¶è¿˜æœ‰ä¸è¶³çš„åœ°æ–¹ï¼Œä½†æˆ‘å·²ç»éå¸¸æ»¡è¶³äº†ï¼</p>\n<h3 id=\"æ·»ç½®æ–°ç‰©ä»¶\"><a href=\"#æ·»ç½®æ–°ç‰©ä»¶\" class=\"headerlink\" title=\"æ·»ç½®æ–°ç‰©ä»¶\"></a>æ·»ç½®æ–°ç‰©ä»¶</h3><h4 id=\"å¤§æ¡Œå­âœ…\"><a href=\"#å¤§æ¡Œå­âœ…\" class=\"headerlink\" title=\"å¤§æ¡Œå­âœ…\"></a>å¤§æ¡Œå­âœ…</h4><p>åœ¨è‡ªå·±ç§Ÿäº†æˆ¿å­ä¹‹åï¼Œå¿…ç„¶ä¹Ÿæ˜¯è¦æ•´ä¸€ä¸ªæ­£ç»çš„å°ä¹¦æ¡Œçš„å•¦ã€‚åœ¨é—²é±¼ä¸Šè¹²äº†å¥½å‡ å¤©ï¼Œä¸­é—´è¿˜å»æ—è¾¹çš„äºŒæ‰‹å¸‚åœºçœ‹äº†ï¼Œæœ€åèŠ± 220 è¹²åˆ°äº†è¿™å¼  160âœ–ï¸70 çš„æ¡Œå­ï¼ˆè´§æ‹‰æ‹‰éƒ½èŠ±äº† 100+ ğŸ˜‚ï¼‰</p>\n<p><a href=\"https://imgloc.com/i/tk3cN\"><img src=\"https://i.328888.xyz/2023/01/02/tk3cN.th.jpeg\" alt=\"tk3cN.th.jpeg\"></a></p>\n<h4 id=\"æ´æ´æ¿âœ…\"><a href=\"#æ´æ´æ¿âœ…\" class=\"headerlink\" title=\"æ´æ´æ¿âœ…\"></a>æ´æ´æ¿âœ…</h4><p>çœ‹ B ç«™è§†é¢‘è¿˜çœ‹åˆ°äº†è¿™ç§ç«‹å¼çš„æ´æ´æ¿ï¼Œæƒ³åˆ°å‡ºç§Ÿå±‹é‡Œä¹Ÿå®Œå…¨æ²¡æœ‰ä¹¦æ¶ã€å°ç‰©ä»¶çš„æ”¶çº³ä»€ä¹ˆçš„ï¼Œå°±æ•´äº†ä¸€ä¸ªã€‚è¿˜è¡Œå“ˆï¼Œæ¯”å…‰ç§ƒç§ƒçš„å¥½å¤šäº†ã€‚</p>\n<p><a href=\"https://imgloc.com/i/tkHFX\"><img src=\"https://i.328888.xyz/2023/01/02/tkHFX.th.jpeg\" alt=\"tkHFX.th.jpeg\"></a></p>\n<h4 id=\"äººä½“å·¥å­¦æ¤…âœ…\"><a href=\"#äººä½“å·¥å­¦æ¤…âœ…\" class=\"headerlink\" title=\"äººä½“å·¥å­¦æ¤…âœ…\"></a>äººä½“å·¥å­¦æ¤…âœ…</h4><p>æ¯•ç«Ÿå·¥ä½œéœ€è¦ï¼Œç«‹é©¬ä¹Ÿæ•´äº†ä¸ªå¥½æ¤…å­ï¼Œå¯ä»¥ç”¨å¾ˆä¹…äº†</p>\n<p><a href=\"https://imgloc.com/i/t0jdv\"><img src=\"https://i.328888.xyz/2023/01/02/t0jdv.th.jpeg\" alt=\"t0jdv.th.jpeg\"></a></p>\n<h4 id=\"ç‰™å¥—âœ…\"><a href=\"#ç‰™å¥—âœ…\" class=\"headerlink\" title=\"ç‰™å¥—âœ…\"></a>ç‰™å¥—âœ…</h4><p>ä»å¾ˆå¤šå¹´å‰è‡ªå·±å°±è§‰å¾—è‡ªå·±çš„ç‰™é½¿ä¸é½ï¼Œæƒ³è¦åšç‰™é½¿çŸ«æ­£ï¼Œä½†æ— å¥ˆå› ä¸ºé’±æˆ–è€…é•¿ä½åœ°ä¸ç¨³å®šç­‰åŸå› ï¼Œä¸€ç›´æ²¡å¼€å§‹ã€‚æ‰€ä»¥åœ¨å¹¿å·å®‰é¡¿ä¸‹æ¥ä¹‹åï¼Œç«‹é©¬å¼€å§‹äº†ç‰™é½¿çŸ«æ­£çš„è¿›ç¨‹ã€‚ä¸Šä¸‹å·¦å³æ‹”äº† 4 é¢—ç‰™ï¼å¦ˆè€¶ï¼Œç–¼æ­»æˆ‘äº†ã€‚</p>\n<h4 id=\"æ‰“å‡»å«âœ…\"><a href=\"#æ‰“å‡»å«âœ…\" class=\"headerlink\" title=\"æ‰“å‡»å«âœ…\"></a>æ‰“å‡»å«âœ…</h4><p>æˆ‘è‡ªå·±å¯¹éŸ³ä¹ä¹Ÿä¸€ç›´æŒºæ„Ÿå…´è¶£çš„ï¼Œå“ˆå“ˆå°±æƒ³åšç‚¹éŸ³ä¹ç›¸å…³çš„çˆ±å¥½ã€‚ä¹‹å‰æœ‰å…³æ³¨ä¸€ä¸ªç»åœ°çš„ä¸»æ’­ï¼Œä»–ç©çš„æ‰“å‡»å«è¶…é…·ï¼ç°åœ¨æœ‰è‡ªå·±çš„ç©ºé—´å’Œç”Ÿæ´»äº†ï¼Œå°±æ•´äº†ä¸€ä¸ªäºŒæ‰‹çš„å…¥é—¨æ¬¾ã€‚</p>\n<p><a href=\"https://imgloc.com/i/twO4o\"><img src=\"https://i.328888.xyz/2023/01/02/twO4o.th.jpeg\" alt=\"twO4o.th.jpeg\"></a></p>\n<p>ä½†æ˜¯éå¸¸å¯æƒœï¼Œåœ¨ç»ƒå®Œå…¥é—¨æ›² <a href=\"https://www.bilibili.com/video/BV1bv4y1B7RL/?spm_id_from=333.999.0.0&vd_source=1d41e3899bfb8af8d65144aad99bbde1\">Luz letter</a> åï¼Œåœ¨å¦å¤–æŒ‘äº†ä¸€é¦–<a href=\"https://www.bilibili.com/video/BV1q8411E7ts/?spm_id_from=333.999.0.0&vd_source=1d41e3899bfb8af8d65144aad99bbde1\">è¿›é˜¶çš„æ›²å­</a>ç»ƒä¹ è¿‡ç¨‹ä¸­å°±å‘ç°äº†é—®é¢˜â€”â€”ç¯å…‰è·Ÿä¸ä¸ŠèŠ‚å¥ã€‚ã€‚ã€‚è¿™ä¸ªå…¥é—¨æ¬¾çš„ç¯å…‰é¢‘ç‡å¤ªä½äº†ï¼Œå°è¯•äº†å¾ˆå¤šæ¬¡ä¹‹åè¿˜æ˜¯æ”¾å¼ƒäº†ç»§ç»­åœ¨è¿™æ¬¾ä¸Šé¢ç»§ç»­ç»ƒï¼Œç„¶åè’åºŸåˆ°ç°åœ¨ï¼ˆå“ï¼Œå¯æƒœã€‚</p>\n<h4 id=\"PS5-å¤§ç”µè§†âœ…\"><a href=\"#PS5-å¤§ç”µè§†âœ…\" class=\"headerlink\" title=\"PS5/å¤§ç”µè§†âœ…\"></a>PS5/å¤§ç”µè§†âœ…</h4><p>åœ¨åŒåä¸€çš„æ—¶å€™ï¼Œæ”¶äº†ä¸€ä¸ªäºŒæ‰‹çš„ PS5ï¼Œè¿˜é…äº†ä¸€ä¸ªå¤§ç”µè§†ï¼è¿™ä¸ªå°å‡ºç§Ÿå±‹ä¹Ÿç»ˆäºå¯ä»¥çœ‹ç”µè§†äº†ã€‚</p>\n<p><img src=\"https://i.328888.xyz/2023/01/02/t0Law.jpeg\" alt=\"t0Law.jpeg\"></p>\n<p>é¡ºå¸¦è¯„ä»·ä¸€ä¸‹è€å¤´ç¯å§ï¼Œåœ¨ PS5 ä¸Šç©çš„ç¬¬ä¸€ä¸ªæ¸¸æˆã€‚ä¹‹å‰ä¹Ÿæœ‰ç©è¿‡é»‘é­‚ 3ï¼Œ1ï¼‰æ‰€ä»¥å¹¶æ²¡æœ‰ç¬¬ä¸€æ¬¡ç©é­‚ç±»æ¸¸æˆé‚£ç§å†²å‡»äº†ï¼Œè€Œä¸”è€å¤´ç¯çš„éš¾åº¦ç³»æ•°ç›¸æ¯”é»‘é­‚ç¡®å®ä½äº†ä¸å°‘ï¼Œè½¬è§’æ€å°‘äº†ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥è€ç©å®¶åœ¨è½¬è§’å¤„å›å¤´çš„æ—¶å€™ç»å¸¸â€œå¤±æœ›â€å“ˆå“ˆå“ˆã€‚2ï¼‰è¿˜æœ‰ä¸€ä¸ªç‚¹æ˜¯å †æ–™å¤ªä¸¥é‡äº†å­ï¼Œé‡å¤çš„é—è¿¹ï¼Œé‡å¤çš„ bossï¼Œé‡å¤çš„å¢“åœ°ï¼Œå•ä¸€çš„å°æ€ªï¼Œæ•£è½åœ¨äº¤ç•Œåœ°çš„å„å¤„ï¼Œå®Œå…¨æ²¡æœ‰ä»€ä¹ˆåŠ¨åŠ›å»ä¸€ä¸€æ‰«å›¾ã€‚ã€‚ã€‚3ï¼‰å¯¹äºå‰§æƒ…ï¼Œæˆ‘è¿˜æ˜¯çŸ¥é“é­‚ç±»æ¸¸æˆçš„å¥—è·¯çš„â€”â€”å‰§æƒ…éƒ½æ•£è½åœ¨å„ä¸ªé“å…·ä¸Šï¼Œä½†æˆ‘çœŸçš„åšä¸åˆ°å…¨æœé›†å‘€ï¼ğŸ˜­ï¼Œè€Œä¸”ç”±äºåœ°å›¾å¤ªå¤§ï¼Œå‰§æƒ…å¤ªæ•£ï¼Œæˆ‘çœŸçš„è®°ä¸ä½å„ä¸ªæ”¯çº¿å‘€ï¼4ï¼‰å¯¹äºå¼€æ”¾ä¸–ç•Œï¼Œç”±äºä¹Ÿç©è¿‡å¡å°”è¾¾è¿™ç§ç¥ä½œï¼Œåªèƒ½è¯´å®«å´è‹±é«˜æŠŠé­‚å…ƒç´ å¡åˆ°äº†ä¸€ä¸ªå¼€æ”¾ä¸–ç•Œä¸­ï¼Œè‡³äºè¿™ä¸ªå¼€æ”¾ä¸–ç•Œå®ƒâ€œå¼€æ”¾â€å—ï¼Ÿè¿™ç®¡æˆ‘å•¥äº‹ã€‚</p>\n<p>å“ˆå“ˆå“ˆï¼Œåæ§½å®Œäº†ï¼Œä½†è¿˜æ˜¯è¦è¯´æˆ‘ç©äº†å‡ åä¸ªå°æ—¶ï¼Œæ¯æ¬¡ä¸€ç©å°±æ˜¯äº”å…­ä¸ªå°æ—¶èµ·æ­¥ï¼Œè¿˜æ˜¯å¾ˆä¸é”™çš„æ¸¸æˆçš„ï¼Œåªä¸è¿‡åœ¨åæœŸæ„Ÿå—åˆ°äº†ä¹å‘³ï¼Œæ²¡èƒ½æˆä¸ºè‰¾å°”ç™»ä¹‹ç‹ã€‚</p>\n<h3 id=\"åšé¥­\"><a href=\"#åšé¥­\" class=\"headerlink\" title=\"åšé¥­\"></a>åšé¥­</h3><p>è¦æœ‰ç”Ÿæ´»æ°”æ¯ï¼Œä¸€å®šç¦»ä¸å¼€è‡ªå·±åšé¥­ï¼ä»Šå¹´è‡ªå·±å’Œå¥³æœ‹å‹ä¸€èµ·åšäº†å¥½å¤šå¥½å¤šçš„èœï¼è€Œä¸”å°‘æœ‰å¤±è´¥ï¼Œå“ˆå“ˆå“ˆå¥³ç¥¨ç›´ç§°æˆ‘ä¸ºå¨æˆ¿å°å¤©æ‰å“ˆå“ˆï¼ˆä¹Ÿä¸æ’é™¤å¥¹æ˜¯ä¸ºäº†è®©æˆ‘å¤šåšé¥­ğŸ¶ï¼‰ã€‚è‡ªå·±åšé¥­çœŸçš„æ²¡é‚£ä¹ˆéš¾ï¼Œè€Œä¸”å‘³é“ä¹Ÿæ¯”å¤§éƒ¨åˆ†åŸä¸­æ‘çš„å¤–å–å¥½åƒï¼Œå°±æ˜¯æ”¶æ‹¾å¨æˆ¿ã€æ´—ç¢—ä»€ä¹ˆçš„å¤ªéº»çƒ¦äº†ï¼Œåšå®Œé¥­åƒå®Œé¥­æ”¶æ‹¾å®ŒåŸºæœ¬æ™šä¸Šå°±å•¥éƒ½ä¸æƒ³å¹²äº†åªæƒ³ç˜«ç€ã€‚ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™èƒ½ä¹°ä¸ªæ´—ç¢—æœºå‘€ã€‚</p>\n<img src=https://cdn-us.imgs.moe/2023/01/02/63b2c89a14f9a.jpg width=30% />\n\n<h3 id=\"çœ‹ä¹¦\"><a href=\"#çœ‹ä¹¦\" class=\"headerlink\" title=\"çœ‹ä¹¦\"></a>çœ‹ä¹¦</h3><p>ä»Šå¹´çœ‹ä¹¦çš„ç›®æ ‡ç®—æ˜¯è¾¾åˆ°äº†ï¼Œä¸€å…±çœ‹å®Œäº† 13 æœ¬ä¹¦ã€‚æ„Ÿè§‰è‡ªå·±çœ‹ä¹¦çš„è¾“å…¥æ•ˆç‡è¿˜ä¸å¤Ÿã€‚ã€‚ã€‚è¿˜éœ€è¦ç»§ç»­å­¦ä¹ ğŸ˜‚</p>\n<ul>\n<li>æµªæ½®ä¹‹å·…</li>\n<li>ç¨‹åºå‘˜çš„ä¿®ç‚¼ä¹‹é“</li>\n<li>å°ç‹å­çš„é¢†æ‚Ÿ</li>\n<li>MySQL æ˜¯æ€ä¹ˆè¿è¡Œçš„</li>\n<li>é»‘å®¢ä¸ç”»å®¶</li>\n<li>æ‚‰è¾¾å¤š</li>\n<li>kubernetes in action</li>\n<li>å¼‚ä¹¡äºº</li>\n<li>æ²™å‘ä¸Šçš„å¿ƒç†å­¦</li>\n<li>æ•°æ®ç”Ÿæ€ï¼šMySQL å¤åˆ¶æŠ€æœ¯ä¸ç”Ÿäº§å®è·µ</li>\n<li>å®‡å®™çš„æœ€åä¸‰åˆ†é’Ÿ</li>\n<li>shell è„šæœ¬åŸºç¡€æ•™ç¨‹</li>\n<li>æªç‚®ã€ç—…èŒä¸é’¢é“</li>\n</ul>\n<h3 id=\"çˆ±æƒ…\"><a href=\"#çˆ±æƒ…\" class=\"headerlink\" title=\"çˆ±æƒ…\"></a>çˆ±æƒ…</h3><p>ä»Šå¹´æ˜¯å’Œæˆ‘å¥³æœ‹å‹ï¼ˆä»¥åå°±å«å¥¹å°æ‡’è™«å§ï¼ï¼‰åœ¨ä¸€èµ·çš„ç¬¬ä¸€å¹´ï½ç®—æ˜¯æ”¶è·äº†æ¢¦æƒ³ä¸­ç”œèœœçš„çˆ±æƒ…äº†ï¼ˆç—´æ±‰ç¬‘ğŸ˜Šï¼‰ã€‚è¿™ä¸€å¹´æˆ‘ä»¬å…ˆæ˜¯åº¦è¿‡äº†æ‹çˆ±ä¸­æœ€éš¾ç†¬çš„å¼‚åœ°æ‹ï¼æœ€é•¿æœ‰ä¸‰ä¸ªæœˆçš„æ—¶é—´æ²¡æœ‰è§é¢ï¼Œå¯èƒ½ä»¥åéƒ½ä¸ä¼šå†æœ‰è¿™ä¹ˆé•¿æ—¶é—´ä¸è§é¢çš„æœºä¼šäº†å§ã€‚</p>\n<p>ä»Šå¹´å’Œå°æ‡’è™«åº¦è¿‡äº†è¶…çº§å¤šçš„ç¬¬ä¸€æ¬¡ã€‚</p>\n<ul>\n<li>ç¬¬ä¸€æ¬¡æ”¶åˆ°æ–°å¹´ç¤¼ç‰©</li>\n</ul>\n<p><a href=\"https://imgloc.com/i/tN1da\"><img src=\"https://i.328888.xyz/2023/01/03/tN1da.th.jpeg\" alt=\"tN1da.th.jpeg\"></a></p>\n<ul>\n<li><p>ç¬¬ä¸€æ¬¡ä¸€èµ·å¼¹é’¢ç´</p>\n</li>\n<li><p>ç¬¬ä¸€æ¬¡ä¸€èµ·æ—…æ¸¸ã€çœ‹æµ·ã€å¸†èˆ¹ã€æ¡¨æ¿ã€æµ·è¾¹éœ²è¥ã€æ—¥å‡º</p>\n</li>\n</ul>\n<p><a href=\"https://imgloc.com/i/tN9TV\"><img src=\"https://i.328888.xyz/2023/01/03/tN9TV.th.jpeg\" alt=\"tN9TV.th.jpeg\"></a></p>\n<ul>\n<li>ç¬¬ä¸€æ¬¡ææ€–å¯†å®¤</li>\n</ul>\n<p><a href=\"https://imgloc.com/i/tNLpb\"><img src=\"https://i.328888.xyz/2023/01/03/tNLpb.th.png\" alt=\"tNLpb.th.png\"></a></p>\n<ul>\n<li>ç¬¬ä¸€æ¬¡é€šå…³æ¸¸æˆ</li>\n</ul>\n<p><a href=\"https://imgloc.com/i/trjhJ\"><img src=\"https://i.328888.xyz/2023/01/03/trjhJ.th.jpeg\" alt=\"trjhJ.th.jpeg\"></a></p>\n<ul>\n<li>ç¬¬ä¸€æ¬¡è„±å£ç§€</li>\n</ul>\n<p><a href=\"https://imgloc.com/i/try93\"><img src=\"https://i.328888.xyz/2023/01/03/try93.th.jpeg\" alt=\"try93.th.jpeg\"></a></p>\n<h3 id=\"ç–«æƒ…\"><a href=\"#ç–«æƒ…\" class=\"headerlink\" title=\"ç–«æƒ…\"></a>ç–«æƒ…</h3><p>åœ¨ 2022 å¹´çš„å¹´æœ«ï¼Œç–«æƒ…ç»ˆäºç®—æ˜¯â€œç»“æŸâ€äº†ã€‚ã€‚ã€‚åœ¨æ¯•ä¸šå‰ç”±äºæ±Ÿè‹æ•™è‚²å±€çš„æ”¿ç­–ã€Œä¸Šæµ·ä¸€å¤©ä¸è§£å°ï¼Œå—äº¬é«˜æ ¡ä¹Ÿä¸è§£å°ã€ï¼Œç»“æœå¯¼è‡´æˆ‘ä»¬åœ¨å—å¤§è¢«å°äº†ä¸¤ä¸ªæœˆï¼è¿™è®©æˆ‘ä»¬è®ºæ–‡å†™å®Œäº†ï¼Œç­”è¾©å®Œäº†ä¹Ÿæ²¡æœ‰æœºä¼šå‡ºæ ¡ã€‚è¿™ç›´æ¥å¯¼è‡´æˆ‘åœ¨èƒ½æ¯•ä¸šç¦»æ ¡çš„ç¬¬ä¸€æ—¶é—´ç¦»å¼€äº†å­¦æ ¡ï¼Œå¹¶ä¸å¸¦ä¸€ç‚¹ç•™æ‹ã€‚æœ¬æ¥æ‰“ç®—åœ¨å—äº¬å¥½å¥½ç©ä¸€ä¸‹çš„ä¹Ÿæ²¡æœ‰æ—¶é—´äº†ã€‚å¼‚åœ°æ‹çš„å½±å“ä¹Ÿåœ¨è¿™ä¸¤ä¸ªæœˆé‡Œè¾¾åˆ°äº†é¡¶å³°ã€‚ã€‚ã€‚çœŸæ˜¯å¤ªç…ç†¬äº†ã€‚</p>\n<p>å¦å¤–ï¼Œä»ä»Šå¹´å¹´åº•å¹¿å·ç–«æƒ…å¼€å§‹ï¼Œè‡ªå·±å‡ ä¹å°±ä¸€ç›´ remote åˆ°äº†ç°åœ¨ï¼Œå®Œå…¨æ”¹å˜äº†å·¥ä½œä¹ æƒ¯ã€‚ã€‚ã€‚æ”¾å¼€åä¹Ÿé˜³äº†ä¸€æ¬¡ï¼Œä½†è¿˜ä¸ç®—ä¸¥é‡ï¼Œä¹Ÿå°±çƒ§äº†ä¸€å¤©å¤šï¼Œå‘çƒ§çš„æ—¶å€™åŸºæœ¬åœ¨ç¡è§‰ï¼Œé€€çƒ§ååŸºæœ¬å°±æ²¡ä»€ä¹ˆäº‹äº†ã€‚</p>\n<p>æˆ‘è®¤ä¸ºåªè¦ä¸å†æä»€ä¹ˆç±»ä¼¼å°åŸçš„äº‹æƒ…ï¼Œç–«æƒ…å°±ç®—æ˜¯è¿‡å»äº†ã€‚å› ä¸ºè¿™æ˜¯ä¸å¯é¿å…çš„äº‹æƒ…å‘€ï¼Œåœ¨è¯»å®Œã€Šæªç‚®ã€ç—…èŒä¸é’¢é“ã€‹åçŸ¥é“ï¼Œäººç±»<strong>ä»æ¥</strong>æ²¡æœ‰æˆ˜èƒœè¿‡ç—…æ¯’ã€‚è¿™æ˜¯å®¢è§‚äº‹å®ã€‚ä¸€æ—¦æ”¾å¼€åï¼Œæˆ‘ä»¬å°±å†ä¹Ÿå›ä¸å»äº†ï¼Œäº¦æˆ–è€…è¯´æˆ‘ä»¬ç¬é—´å°±å›åˆ°äº†è¿‡å»ã€‚æœ‰ç—…æ²»ç—…ï¼ŒæŒºå¥½çš„ã€‚</p>\n<h2 id=\"2023\"><a href=\"#2023\" class=\"headerlink\" title=\"2023\"></a>2023</h2><p>2023 å¹´è¦åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<ul>\n<li>å·¥ä½œä¸Šï¼Œthink more and do more</li>\n<li>è¯»ä¹¦å’Œåšé¥­çš„ä¹ æƒ¯èƒ½ç»§ç»­ä¿æŒ</li>\n<li>è®¡åˆ’ä¸­çš„é”»ç‚¼åˆ«æ‹‰ä¸‹äº†ï¼Œå¤šè·‘æ­¥ï¼Œå‚åŠ ä¸€åœºåŠé©¬</li>\n<li>æ¥¼ä¸‹å°±æœ‰ç½‘çƒåœºï¼Œå¤§å­¦å­¦çš„ç½‘çƒä¸€å®šè¦æ¡èµ·æ¥ç©ç©</li>\n<li>å»æ›´å¤šåœ°æ–¹æ—…è¡Œï¼ˆå“ˆå°”æ»¨ã€æ½®æ±•</li>\n<li>æ¢ä¸ªå¥½ç‚¹çš„ launchpad ç»§ç»­ç©ç©</li>\n</ul>\n<p>æ€»ä¹‹ï¼Œ2022 è¿˜è¡Œï¼Œ2023 ç»§ç»­åŠ æ²¹ğŸ’ª</p>\n"},{"title":"DM æ•°æ®æ—…ç¨‹ 00ï¼šåºè¨€","date":"2023-01-02T17:58:33.000Z","top_img":"img/category/dm_repo.png","cover":"img/category/dm_repo.png","_content":"\n# èƒŒæ™¯\nåœ¨æ­¤ä¹‹å‰å·²ç»æœ‰å®˜æ–¹å¾ˆå¤šå…³äº DM çš„ä¼˜ç§€æ–‡ç« äº†ï¼Œæ¯”å¦‚\n\n- [TiDB Ecosystem Tools åŸç†è§£è¯»ç³»åˆ—ï¼ˆä¸‰ï¼‰TiDB Data Migration æ¶æ„è®¾è®¡ä¸å®ç°åŸç†](https://pingcap.com/zh/blog/tidb-ecosystem-tools-3)\n- [DM æºç è§£è¯»](https://pingcap.com/zh/blog?tag=DM%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB)\n\nè¿™äº›æ–‡ç« ä»åŸç†æ–¹é¢éå¸¸è¯¦å°½åœ°ä»‹ç»äº† DM çš„ç›¸å…³åŠŸèƒ½ï¼Œæ˜¯éå¸¸å¥½çš„å­¦ä¹ èµ„æ–™ã€‚ä½†æ˜¯\n\n- å®ƒè®²è¿°çš„å†…å®¹è·¨åº¦è¾ƒå¤§ï¼Œå¯¹è¯»è€…æœ‰ä¸€å®šçš„é—¨æ§›ï¼Œ[DM æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰åºï¼šèƒŒæ™¯çŸ¥è¯†](https://pingcap.com/zh/blog/dm-source-code-reading-1#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86)\n- ç¼–è¾‘æ—¶é—´å¤ªè¿‡ä¹…è¿œï¼Œå·²ç»è¿‡å»ä¸¤å¹´å¤šäº†ã€‚DM æ–°å¢äº†ä¸€äº›æ–°ç‰¹æ€§ï¼Œå¯¹å¾ˆå¤šæ—§åŠŸèƒ½ä¹Ÿè¿›è¡Œäº†æ›´æ–°ä¼˜åŒ–ã€‚æ‰€ä»¥åŸæ–‡ä¸­æœ‰å¾ˆå¤šå†…å®¹å·²ç»è¿‡æ—¶ï¼ˆä½†å¤§éƒ¨åˆ†ä»æœ‰å‚è€ƒä»·å€¼ï¼‰ã€‚ä¾‹å¦‚ï¼š[DM ä½¿ç”¨ Dumpling æ›¿æ¢äº† MyDumper](https://github.com/pingcap/dm/pull/540)ï¼Œ[æ–°å¢ä¹è§‚æ¨¡å¼](https://github.com/pingcap/dm/pull/568)ç­‰ç­‰ã€‚\n\nè€Œå¤–éƒ¨çš„æ–‡ç« åˆ™å¤§éƒ¨åˆ†é›†ä¸­åœ¨ DM çš„ä½¿ç”¨ä¸Šè€Œä¸æ˜¯å®ç°ä¸Šã€‚\n\nåŸºäºæ­¤ï¼Œæˆ‘æƒ³å¼€ä¸€ä¸ªå‘ã€ŠDM æ•°æ®æ—…ç¨‹ç³»åˆ—ã€‹ï¼Œæ¯ä¸€ç¯‡æ–‡ç« å°†ä»¥ä¸€ä¸ªä¸ªå°åŠŸèƒ½ä¸ºçº¿ç´¢ï¼Œå¸¦å¤§å®¶ç†è§£ DM ä¸­çš„å„ç§å®ç°ã€‚å¦‚æœè¦è®²çš„åŠŸèƒ½å¤ªå¤§ï¼Œä¹Ÿä¼šæ‹†åˆ†æˆå°æ¨¡å—æ”¾å‡ºã€‚æ¯ä¸€æ­¥éƒ½ä¼šå°½é‡æ”¾å‡º GitHub åœ°å€ï¼Œæ–¹ä¾¿å¤§å®¶è·Ÿè¸ªå­¦ä¹ ï½\n\n> æ•°æ®æ—…ç¨‹å‡ºè‡ªäºé¾™å°‘ PPT ä¸­æåˆ°çš„ç”¨æˆ·æ—…ç¨‹å’Œæ•°æ®æ—…ç¨‹ï¼ŒæŒ‡æˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®ï¼ˆå­—èŠ‚ï¼‰ä¼ è¾“çš„é€”å¾„ã€‚åœ¨çœ‹ä¸€æ®µä»£ç æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒè¿™ä¸ªå­—èŠ‚æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œåˆ°å“ªé‡Œå»ï¼Œä½œç”¨æ˜¯ä»€ä¹ˆï¼Œé€šè¿‡ç†è§£æ•°æ®æ—…ç¨‹æ¥ç†è§£æ•´ä¸ªäº§å“å®ƒçš„æ·±å±‚åŸç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æ”¹å˜æ•°æ®è§„æ¨¡ï¼ˆæå‡/é™ä½æ•°æ®æ•°é‡çº§ï¼‰å’Œåœºæ™¯ï¼ˆä¸åŒçš„æ—¶é—´ä¸åŒçš„ä½ç½®ï¼‰æ¥ç†è§£äº§å“çš„ç¼ºç‚¹ï¼ˆbugï¼‰ã€‚\n\n> ä»¥ä¸Šéƒ½æ˜¯ä¸ªäººæ‹™è§ï¼ˆåºŸè¯ï¼‰ï¼Œæ¬¢è¿ææ„è§ï½\n\nå½“ç„¶ï¼Œç°åœ¨çš„ DM æ­£åœ¨é£é€Ÿçš„å‘å±•è¿­ä»£ä¸­ï¼Œæœ¬ç³»åˆ—çš„å†…å®¹ä¹Ÿå¯èƒ½é©¬ä¸Šå°±ä¼šè¿‡æ—¶ï¼Œç°åœ¨æ˜¯ 2021 å¹´ 10 æœˆ 31 æ—¥ï¼Œæœ¬ç³»åˆ—æ–‡ç« é¢„è®¡å°†ä¼šè¦†ç›– DM v5.3.0-vx.x.x çš„ä»£ç é€»è¾‘ã€‚\n\nå¦‚æœè®¤ä¸ºæ–‡ç« ä¸­æœ‰ä»»ä½•å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Œ æ¬¢è¿å¤§å®¶æå‡ºè‡ªå·±çš„æƒ³æ³•ã€‚åŒæ ·åœ°ï¼Œå› ä¸º DM è¿˜åœ¨å¿«é€Ÿè¿­ä»£ï¼Œè¿˜æœ‰å¾ˆå¤šåœ°æ–¹éƒ½æœ‰æ”¹è¿›çš„åœ°æ–¹ï¼Œå¦‚æœå¤§å®¶å¯¹ä»£ç å®ç°æœ‰ä»»ä½•ç–‘é—®ï¼Œä¹Ÿéƒ½å¯ä»¥å» repo ä¸­ç›´æ¥æ issueã€‚\n\n# è¯»è€…è¦æ±‚\n- èƒ½çœ‹æ‡‚ Golang è¯­æ³•\n- äº†è§£ grpcã€etcd\n- è®¡åˆ’ç« èŠ‚\n- Start task\n- Stop task\n- Pause task\n- Resume task\n- Full modeï¼ˆdumplingï¼‰\n- Incremental modeï¼ˆsyncerï¼‰\n- Block-allow list\n- Binlog-filter\n- Enable relay log\n- Permistic sharding ddl\n- Optimistic sharding ddl\n- ã€‚ã€‚ã€‚","source":"_posts/DM-æ•°æ®æ—…ç¨‹-00ï¼šåºè¨€.md","raw":"---\ntitle: DM æ•°æ®æ—…ç¨‹ 00ï¼šåºè¨€\ndate: 2023-01-03 01:58:33\ntags:\n- DM\n- æºç é˜…è¯»\ncategories:\n- DM æ•°æ®æ—…ç¨‹\ntop_img: img/category/dm_repo.png\ncover: img/category/dm_repo.png\n---\n\n# èƒŒæ™¯\nåœ¨æ­¤ä¹‹å‰å·²ç»æœ‰å®˜æ–¹å¾ˆå¤šå…³äº DM çš„ä¼˜ç§€æ–‡ç« äº†ï¼Œæ¯”å¦‚\n\n- [TiDB Ecosystem Tools åŸç†è§£è¯»ç³»åˆ—ï¼ˆä¸‰ï¼‰TiDB Data Migration æ¶æ„è®¾è®¡ä¸å®ç°åŸç†](https://pingcap.com/zh/blog/tidb-ecosystem-tools-3)\n- [DM æºç è§£è¯»](https://pingcap.com/zh/blog?tag=DM%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB)\n\nè¿™äº›æ–‡ç« ä»åŸç†æ–¹é¢éå¸¸è¯¦å°½åœ°ä»‹ç»äº† DM çš„ç›¸å…³åŠŸèƒ½ï¼Œæ˜¯éå¸¸å¥½çš„å­¦ä¹ èµ„æ–™ã€‚ä½†æ˜¯\n\n- å®ƒè®²è¿°çš„å†…å®¹è·¨åº¦è¾ƒå¤§ï¼Œå¯¹è¯»è€…æœ‰ä¸€å®šçš„é—¨æ§›ï¼Œ[DM æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰åºï¼šèƒŒæ™¯çŸ¥è¯†](https://pingcap.com/zh/blog/dm-source-code-reading-1#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86)\n- ç¼–è¾‘æ—¶é—´å¤ªè¿‡ä¹…è¿œï¼Œå·²ç»è¿‡å»ä¸¤å¹´å¤šäº†ã€‚DM æ–°å¢äº†ä¸€äº›æ–°ç‰¹æ€§ï¼Œå¯¹å¾ˆå¤šæ—§åŠŸèƒ½ä¹Ÿè¿›è¡Œäº†æ›´æ–°ä¼˜åŒ–ã€‚æ‰€ä»¥åŸæ–‡ä¸­æœ‰å¾ˆå¤šå†…å®¹å·²ç»è¿‡æ—¶ï¼ˆä½†å¤§éƒ¨åˆ†ä»æœ‰å‚è€ƒä»·å€¼ï¼‰ã€‚ä¾‹å¦‚ï¼š[DM ä½¿ç”¨ Dumpling æ›¿æ¢äº† MyDumper](https://github.com/pingcap/dm/pull/540)ï¼Œ[æ–°å¢ä¹è§‚æ¨¡å¼](https://github.com/pingcap/dm/pull/568)ç­‰ç­‰ã€‚\n\nè€Œå¤–éƒ¨çš„æ–‡ç« åˆ™å¤§éƒ¨åˆ†é›†ä¸­åœ¨ DM çš„ä½¿ç”¨ä¸Šè€Œä¸æ˜¯å®ç°ä¸Šã€‚\n\nåŸºäºæ­¤ï¼Œæˆ‘æƒ³å¼€ä¸€ä¸ªå‘ã€ŠDM æ•°æ®æ—…ç¨‹ç³»åˆ—ã€‹ï¼Œæ¯ä¸€ç¯‡æ–‡ç« å°†ä»¥ä¸€ä¸ªä¸ªå°åŠŸèƒ½ä¸ºçº¿ç´¢ï¼Œå¸¦å¤§å®¶ç†è§£ DM ä¸­çš„å„ç§å®ç°ã€‚å¦‚æœè¦è®²çš„åŠŸèƒ½å¤ªå¤§ï¼Œä¹Ÿä¼šæ‹†åˆ†æˆå°æ¨¡å—æ”¾å‡ºã€‚æ¯ä¸€æ­¥éƒ½ä¼šå°½é‡æ”¾å‡º GitHub åœ°å€ï¼Œæ–¹ä¾¿å¤§å®¶è·Ÿè¸ªå­¦ä¹ ï½\n\n> æ•°æ®æ—…ç¨‹å‡ºè‡ªäºé¾™å°‘ PPT ä¸­æåˆ°çš„ç”¨æˆ·æ—…ç¨‹å’Œæ•°æ®æ—…ç¨‹ï¼ŒæŒ‡æˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®ï¼ˆå­—èŠ‚ï¼‰ä¼ è¾“çš„é€”å¾„ã€‚åœ¨çœ‹ä¸€æ®µä»£ç æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒè¿™ä¸ªå­—èŠ‚æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œåˆ°å“ªé‡Œå»ï¼Œä½œç”¨æ˜¯ä»€ä¹ˆï¼Œé€šè¿‡ç†è§£æ•°æ®æ—…ç¨‹æ¥ç†è§£æ•´ä¸ªäº§å“å®ƒçš„æ·±å±‚åŸç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æ”¹å˜æ•°æ®è§„æ¨¡ï¼ˆæå‡/é™ä½æ•°æ®æ•°é‡çº§ï¼‰å’Œåœºæ™¯ï¼ˆä¸åŒçš„æ—¶é—´ä¸åŒçš„ä½ç½®ï¼‰æ¥ç†è§£äº§å“çš„ç¼ºç‚¹ï¼ˆbugï¼‰ã€‚\n\n> ä»¥ä¸Šéƒ½æ˜¯ä¸ªäººæ‹™è§ï¼ˆåºŸè¯ï¼‰ï¼Œæ¬¢è¿ææ„è§ï½\n\nå½“ç„¶ï¼Œç°åœ¨çš„ DM æ­£åœ¨é£é€Ÿçš„å‘å±•è¿­ä»£ä¸­ï¼Œæœ¬ç³»åˆ—çš„å†…å®¹ä¹Ÿå¯èƒ½é©¬ä¸Šå°±ä¼šè¿‡æ—¶ï¼Œç°åœ¨æ˜¯ 2021 å¹´ 10 æœˆ 31 æ—¥ï¼Œæœ¬ç³»åˆ—æ–‡ç« é¢„è®¡å°†ä¼šè¦†ç›– DM v5.3.0-vx.x.x çš„ä»£ç é€»è¾‘ã€‚\n\nå¦‚æœè®¤ä¸ºæ–‡ç« ä¸­æœ‰ä»»ä½•å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Œ æ¬¢è¿å¤§å®¶æå‡ºè‡ªå·±çš„æƒ³æ³•ã€‚åŒæ ·åœ°ï¼Œå› ä¸º DM è¿˜åœ¨å¿«é€Ÿè¿­ä»£ï¼Œè¿˜æœ‰å¾ˆå¤šåœ°æ–¹éƒ½æœ‰æ”¹è¿›çš„åœ°æ–¹ï¼Œå¦‚æœå¤§å®¶å¯¹ä»£ç å®ç°æœ‰ä»»ä½•ç–‘é—®ï¼Œä¹Ÿéƒ½å¯ä»¥å» repo ä¸­ç›´æ¥æ issueã€‚\n\n# è¯»è€…è¦æ±‚\n- èƒ½çœ‹æ‡‚ Golang è¯­æ³•\n- äº†è§£ grpcã€etcd\n- è®¡åˆ’ç« èŠ‚\n- Start task\n- Stop task\n- Pause task\n- Resume task\n- Full modeï¼ˆdumplingï¼‰\n- Incremental modeï¼ˆsyncerï¼‰\n- Block-allow list\n- Binlog-filter\n- Enable relay log\n- Permistic sharding ddl\n- Optimistic sharding ddl\n- ã€‚ã€‚ã€‚","slug":"DM-æ•°æ®æ—…ç¨‹-00ï¼šåºè¨€","published":1,"updated":"2024-06-16T07:03:47.893Z","_id":"clxgfc6d300007odyg8gg1y4w","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"èƒŒæ™¯\"><a href=\"#èƒŒæ™¯\" class=\"headerlink\" title=\"èƒŒæ™¯\"></a>èƒŒæ™¯</h1><p>åœ¨æ­¤ä¹‹å‰å·²ç»æœ‰å®˜æ–¹å¾ˆå¤šå…³äº DM çš„ä¼˜ç§€æ–‡ç« äº†ï¼Œæ¯”å¦‚</p>\n<ul>\n<li><a href=\"https://pingcap.com/zh/blog/tidb-ecosystem-tools-3\">TiDB Ecosystem Tools åŸç†è§£è¯»ç³»åˆ—ï¼ˆä¸‰ï¼‰TiDB Data Migration æ¶æ„è®¾è®¡ä¸å®ç°åŸç†</a></li>\n<li><a href=\"https://pingcap.com/zh/blog?tag=DM%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB\">DM æºç è§£è¯»</a></li>\n</ul>\n<p>è¿™äº›æ–‡ç« ä»åŸç†æ–¹é¢éå¸¸è¯¦å°½åœ°ä»‹ç»äº† DM çš„ç›¸å…³åŠŸèƒ½ï¼Œæ˜¯éå¸¸å¥½çš„å­¦ä¹ èµ„æ–™ã€‚ä½†æ˜¯</p>\n<ul>\n<li>å®ƒè®²è¿°çš„å†…å®¹è·¨åº¦è¾ƒå¤§ï¼Œå¯¹è¯»è€…æœ‰ä¸€å®šçš„é—¨æ§›ï¼Œ<a href=\"https://pingcap.com/zh/blog/dm-source-code-reading-1#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86\">DM æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰åºï¼šèƒŒæ™¯çŸ¥è¯†</a></li>\n<li>ç¼–è¾‘æ—¶é—´å¤ªè¿‡ä¹…è¿œï¼Œå·²ç»è¿‡å»ä¸¤å¹´å¤šäº†ã€‚DM æ–°å¢äº†ä¸€äº›æ–°ç‰¹æ€§ï¼Œå¯¹å¾ˆå¤šæ—§åŠŸèƒ½ä¹Ÿè¿›è¡Œäº†æ›´æ–°ä¼˜åŒ–ã€‚æ‰€ä»¥åŸæ–‡ä¸­æœ‰å¾ˆå¤šå†…å®¹å·²ç»è¿‡æ—¶ï¼ˆä½†å¤§éƒ¨åˆ†ä»æœ‰å‚è€ƒä»·å€¼ï¼‰ã€‚ä¾‹å¦‚ï¼š<a href=\"https://github.com/pingcap/dm/pull/540\">DM ä½¿ç”¨ Dumpling æ›¿æ¢äº† MyDumper</a>ï¼Œ<a href=\"https://github.com/pingcap/dm/pull/568\">æ–°å¢ä¹è§‚æ¨¡å¼</a>ç­‰ç­‰ã€‚</li>\n</ul>\n<p>è€Œå¤–éƒ¨çš„æ–‡ç« åˆ™å¤§éƒ¨åˆ†é›†ä¸­åœ¨ DM çš„ä½¿ç”¨ä¸Šè€Œä¸æ˜¯å®ç°ä¸Šã€‚</p>\n<p>åŸºäºæ­¤ï¼Œæˆ‘æƒ³å¼€ä¸€ä¸ªå‘ã€ŠDM æ•°æ®æ—…ç¨‹ç³»åˆ—ã€‹ï¼Œæ¯ä¸€ç¯‡æ–‡ç« å°†ä»¥ä¸€ä¸ªä¸ªå°åŠŸèƒ½ä¸ºçº¿ç´¢ï¼Œå¸¦å¤§å®¶ç†è§£ DM ä¸­çš„å„ç§å®ç°ã€‚å¦‚æœè¦è®²çš„åŠŸèƒ½å¤ªå¤§ï¼Œä¹Ÿä¼šæ‹†åˆ†æˆå°æ¨¡å—æ”¾å‡ºã€‚æ¯ä¸€æ­¥éƒ½ä¼šå°½é‡æ”¾å‡º GitHub åœ°å€ï¼Œæ–¹ä¾¿å¤§å®¶è·Ÿè¸ªå­¦ä¹ ï½</p>\n<blockquote>\n<p>æ•°æ®æ—…ç¨‹å‡ºè‡ªäºé¾™å°‘ PPT ä¸­æåˆ°çš„ç”¨æˆ·æ—…ç¨‹å’Œæ•°æ®æ—…ç¨‹ï¼ŒæŒ‡æˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®ï¼ˆå­—èŠ‚ï¼‰ä¼ è¾“çš„é€”å¾„ã€‚åœ¨çœ‹ä¸€æ®µä»£ç æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒè¿™ä¸ªå­—èŠ‚æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œåˆ°å“ªé‡Œå»ï¼Œä½œç”¨æ˜¯ä»€ä¹ˆï¼Œé€šè¿‡ç†è§£æ•°æ®æ—…ç¨‹æ¥ç†è§£æ•´ä¸ªäº§å“å®ƒçš„æ·±å±‚åŸç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æ”¹å˜æ•°æ®è§„æ¨¡ï¼ˆæå‡/é™ä½æ•°æ®æ•°é‡çº§ï¼‰å’Œåœºæ™¯ï¼ˆä¸åŒçš„æ—¶é—´ä¸åŒçš„ä½ç½®ï¼‰æ¥ç†è§£äº§å“çš„ç¼ºç‚¹ï¼ˆbugï¼‰ã€‚</p>\n</blockquote>\n<blockquote>\n<p>ä»¥ä¸Šéƒ½æ˜¯ä¸ªäººæ‹™è§ï¼ˆåºŸè¯ï¼‰ï¼Œæ¬¢è¿ææ„è§ï½</p>\n</blockquote>\n<p>å½“ç„¶ï¼Œç°åœ¨çš„ DM æ­£åœ¨é£é€Ÿçš„å‘å±•è¿­ä»£ä¸­ï¼Œæœ¬ç³»åˆ—çš„å†…å®¹ä¹Ÿå¯èƒ½é©¬ä¸Šå°±ä¼šè¿‡æ—¶ï¼Œç°åœ¨æ˜¯ 2021 å¹´ 10 æœˆ 31 æ—¥ï¼Œæœ¬ç³»åˆ—æ–‡ç« é¢„è®¡å°†ä¼šè¦†ç›– DM v5.3.0-vx.x.x çš„ä»£ç é€»è¾‘ã€‚</p>\n<p>å¦‚æœè®¤ä¸ºæ–‡ç« ä¸­æœ‰ä»»ä½•å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Œ æ¬¢è¿å¤§å®¶æå‡ºè‡ªå·±çš„æƒ³æ³•ã€‚åŒæ ·åœ°ï¼Œå› ä¸º DM è¿˜åœ¨å¿«é€Ÿè¿­ä»£ï¼Œè¿˜æœ‰å¾ˆå¤šåœ°æ–¹éƒ½æœ‰æ”¹è¿›çš„åœ°æ–¹ï¼Œå¦‚æœå¤§å®¶å¯¹ä»£ç å®ç°æœ‰ä»»ä½•ç–‘é—®ï¼Œä¹Ÿéƒ½å¯ä»¥å» repo ä¸­ç›´æ¥æ issueã€‚</p>\n<h1 id=\"è¯»è€…è¦æ±‚\"><a href=\"#è¯»è€…è¦æ±‚\" class=\"headerlink\" title=\"è¯»è€…è¦æ±‚\"></a>è¯»è€…è¦æ±‚</h1><ul>\n<li>èƒ½çœ‹æ‡‚ Golang è¯­æ³•</li>\n<li>äº†è§£ grpcã€etcd</li>\n<li>è®¡åˆ’ç« èŠ‚</li>\n<li>Start task</li>\n<li>Stop task</li>\n<li>Pause task</li>\n<li>Resume task</li>\n<li>Full modeï¼ˆdumplingï¼‰</li>\n<li>Incremental modeï¼ˆsyncerï¼‰</li>\n<li>Block-allow list</li>\n<li>Binlog-filter</li>\n<li>Enable relay log</li>\n<li>Permistic sharding ddl</li>\n<li>Optimistic sharding ddl</li>\n<li>ã€‚ã€‚ã€‚</li>\n</ul>\n","site":{"data":{}},"cover_type":"img","length":938,"excerpt":"","more":"<h1 id=\"èƒŒæ™¯\"><a href=\"#èƒŒæ™¯\" class=\"headerlink\" title=\"èƒŒæ™¯\"></a>èƒŒæ™¯</h1><p>åœ¨æ­¤ä¹‹å‰å·²ç»æœ‰å®˜æ–¹å¾ˆå¤šå…³äº DM çš„ä¼˜ç§€æ–‡ç« äº†ï¼Œæ¯”å¦‚</p>\n<ul>\n<li><a href=\"https://pingcap.com/zh/blog/tidb-ecosystem-tools-3\">TiDB Ecosystem Tools åŸç†è§£è¯»ç³»åˆ—ï¼ˆä¸‰ï¼‰TiDB Data Migration æ¶æ„è®¾è®¡ä¸å®ç°åŸç†</a></li>\n<li><a href=\"https://pingcap.com/zh/blog?tag=DM%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB\">DM æºç è§£è¯»</a></li>\n</ul>\n<p>è¿™äº›æ–‡ç« ä»åŸç†æ–¹é¢éå¸¸è¯¦å°½åœ°ä»‹ç»äº† DM çš„ç›¸å…³åŠŸèƒ½ï¼Œæ˜¯éå¸¸å¥½çš„å­¦ä¹ èµ„æ–™ã€‚ä½†æ˜¯</p>\n<ul>\n<li>å®ƒè®²è¿°çš„å†…å®¹è·¨åº¦è¾ƒå¤§ï¼Œå¯¹è¯»è€…æœ‰ä¸€å®šçš„é—¨æ§›ï¼Œ<a href=\"https://pingcap.com/zh/blog/dm-source-code-reading-1#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86\">DM æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰åºï¼šèƒŒæ™¯çŸ¥è¯†</a></li>\n<li>ç¼–è¾‘æ—¶é—´å¤ªè¿‡ä¹…è¿œï¼Œå·²ç»è¿‡å»ä¸¤å¹´å¤šäº†ã€‚DM æ–°å¢äº†ä¸€äº›æ–°ç‰¹æ€§ï¼Œå¯¹å¾ˆå¤šæ—§åŠŸèƒ½ä¹Ÿè¿›è¡Œäº†æ›´æ–°ä¼˜åŒ–ã€‚æ‰€ä»¥åŸæ–‡ä¸­æœ‰å¾ˆå¤šå†…å®¹å·²ç»è¿‡æ—¶ï¼ˆä½†å¤§éƒ¨åˆ†ä»æœ‰å‚è€ƒä»·å€¼ï¼‰ã€‚ä¾‹å¦‚ï¼š<a href=\"https://github.com/pingcap/dm/pull/540\">DM ä½¿ç”¨ Dumpling æ›¿æ¢äº† MyDumper</a>ï¼Œ<a href=\"https://github.com/pingcap/dm/pull/568\">æ–°å¢ä¹è§‚æ¨¡å¼</a>ç­‰ç­‰ã€‚</li>\n</ul>\n<p>è€Œå¤–éƒ¨çš„æ–‡ç« åˆ™å¤§éƒ¨åˆ†é›†ä¸­åœ¨ DM çš„ä½¿ç”¨ä¸Šè€Œä¸æ˜¯å®ç°ä¸Šã€‚</p>\n<p>åŸºäºæ­¤ï¼Œæˆ‘æƒ³å¼€ä¸€ä¸ªå‘ã€ŠDM æ•°æ®æ—…ç¨‹ç³»åˆ—ã€‹ï¼Œæ¯ä¸€ç¯‡æ–‡ç« å°†ä»¥ä¸€ä¸ªä¸ªå°åŠŸèƒ½ä¸ºçº¿ç´¢ï¼Œå¸¦å¤§å®¶ç†è§£ DM ä¸­çš„å„ç§å®ç°ã€‚å¦‚æœè¦è®²çš„åŠŸèƒ½å¤ªå¤§ï¼Œä¹Ÿä¼šæ‹†åˆ†æˆå°æ¨¡å—æ”¾å‡ºã€‚æ¯ä¸€æ­¥éƒ½ä¼šå°½é‡æ”¾å‡º GitHub åœ°å€ï¼Œæ–¹ä¾¿å¤§å®¶è·Ÿè¸ªå­¦ä¹ ï½</p>\n<blockquote>\n<p>æ•°æ®æ—…ç¨‹å‡ºè‡ªäºé¾™å°‘ PPT ä¸­æåˆ°çš„ç”¨æˆ·æ—…ç¨‹å’Œæ•°æ®æ—…ç¨‹ï¼ŒæŒ‡æˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®ï¼ˆå­—èŠ‚ï¼‰ä¼ è¾“çš„é€”å¾„ã€‚åœ¨çœ‹ä¸€æ®µä»£ç æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒè¿™ä¸ªå­—èŠ‚æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œåˆ°å“ªé‡Œå»ï¼Œä½œç”¨æ˜¯ä»€ä¹ˆï¼Œé€šè¿‡ç†è§£æ•°æ®æ—…ç¨‹æ¥ç†è§£æ•´ä¸ªäº§å“å®ƒçš„æ·±å±‚åŸç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æ”¹å˜æ•°æ®è§„æ¨¡ï¼ˆæå‡/é™ä½æ•°æ®æ•°é‡çº§ï¼‰å’Œåœºæ™¯ï¼ˆä¸åŒçš„æ—¶é—´ä¸åŒçš„ä½ç½®ï¼‰æ¥ç†è§£äº§å“çš„ç¼ºç‚¹ï¼ˆbugï¼‰ã€‚</p>\n</blockquote>\n<blockquote>\n<p>ä»¥ä¸Šéƒ½æ˜¯ä¸ªäººæ‹™è§ï¼ˆåºŸè¯ï¼‰ï¼Œæ¬¢è¿ææ„è§ï½</p>\n</blockquote>\n<p>å½“ç„¶ï¼Œç°åœ¨çš„ DM æ­£åœ¨é£é€Ÿçš„å‘å±•è¿­ä»£ä¸­ï¼Œæœ¬ç³»åˆ—çš„å†…å®¹ä¹Ÿå¯èƒ½é©¬ä¸Šå°±ä¼šè¿‡æ—¶ï¼Œç°åœ¨æ˜¯ 2021 å¹´ 10 æœˆ 31 æ—¥ï¼Œæœ¬ç³»åˆ—æ–‡ç« é¢„è®¡å°†ä¼šè¦†ç›– DM v5.3.0-vx.x.x çš„ä»£ç é€»è¾‘ã€‚</p>\n<p>å¦‚æœè®¤ä¸ºæ–‡ç« ä¸­æœ‰ä»»ä½•å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Œ æ¬¢è¿å¤§å®¶æå‡ºè‡ªå·±çš„æƒ³æ³•ã€‚åŒæ ·åœ°ï¼Œå› ä¸º DM è¿˜åœ¨å¿«é€Ÿè¿­ä»£ï¼Œè¿˜æœ‰å¾ˆå¤šåœ°æ–¹éƒ½æœ‰æ”¹è¿›çš„åœ°æ–¹ï¼Œå¦‚æœå¤§å®¶å¯¹ä»£ç å®ç°æœ‰ä»»ä½•ç–‘é—®ï¼Œä¹Ÿéƒ½å¯ä»¥å» repo ä¸­ç›´æ¥æ issueã€‚</p>\n<h1 id=\"è¯»è€…è¦æ±‚\"><a href=\"#è¯»è€…è¦æ±‚\" class=\"headerlink\" title=\"è¯»è€…è¦æ±‚\"></a>è¯»è€…è¦æ±‚</h1><ul>\n<li>èƒ½çœ‹æ‡‚ Golang è¯­æ³•</li>\n<li>äº†è§£ grpcã€etcd</li>\n<li>è®¡åˆ’ç« èŠ‚</li>\n<li>Start task</li>\n<li>Stop task</li>\n<li>Pause task</li>\n<li>Resume task</li>\n<li>Full modeï¼ˆdumplingï¼‰</li>\n<li>Incremental modeï¼ˆsyncerï¼‰</li>\n<li>Block-allow list</li>\n<li>Binlog-filter</li>\n<li>Enable relay log</li>\n<li>Permistic sharding ddl</li>\n<li>Optimistic sharding ddl</li>\n<li>ã€‚ã€‚ã€‚</li>\n</ul>\n"},{"title":"DM æ•°æ®æ—…ç¨‹ 01ï¼šç¬¬ä¸€æ¬¡ start task","date":"2023-01-02T18:58:33.000Z","top_img":"/img/category/first_dm_job.png","cover":"/img/category/first_dm_job.png","_content":"\n# ä¸€ã€æ¦‚è¿°\n\næœ¬æ–‡ä»¥ start task ä¸ºç›®çš„ï¼Œå¸¦ç€è¯»è€…ä» 0 åˆ° 1 å¯åŠ¨ä¸€ä¸ªæ•°æ®è¿ç§»ä»»åŠ¡ï¼Œæ—¨åœ¨è®©è¯»è€…äº†è§£åˆ°æœ€åŸºç¡€çš„ DM é€»è¾‘ã€‚æœ¬æ–‡å°†ç›´æ¥å‚ç…§é›†æˆæµ‹è¯• [start\\_task](https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L27-L36) çš„è¿‡ç¨‹ï¼Œä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å±•å¼€ï¼š\n\n1. Start dm-master\n2. Start dm-worker\n3. ç»‘å®š source å’Œ dm-worker\n4. Start task\n\n> æ³¨ï¼šä¸ºäº†ä¸“æ³¨äºæˆ‘ä»¬çš„ç›®çš„ï¼ˆstart taskï¼‰ï¼Œæœ¬æ–‡ä¸ä¼šå¯¹æ— å…³ä»£ç è¿›è¡Œè§£è¯»\n\n> å¤§å®¶å¯ä½¿ç”¨ [start/stop æµç¨‹](https://pingcap.feishu.cn/mindnotes/bmncnqlO5BCrkgxFqabTLaz6EQh#mindmap) è¾…åŠ©é˜…è¯»\n>\n> ç”±äºå†™è¿™ç¯‡çš„æ–‡ç« çš„æ—¶é—´æ˜¯ 2021 å¹´ 12 æœˆä»½ï¼Œæ‰€ä»¥æ‰€æœ‰çš„é“¾æ¥éƒ½æ˜¯åŸ DM repo çš„ğŸ˜‚\n\n# äºŒã€start dm-master\n\n1. [./dm-master](https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L27)ï¼ˆin [run\\_dm\\_master](https://github.com/pingcap/dm/blob/master/tests/_utils/run_dm_master)ï¼‰ å¯åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå³è°ƒç”¨ [main å‡½æ•°](https://github.com/pingcap/dm/blob/master/cmd/dm-master/main.go#L35)ï¼Œå…¶ä¸­ [master-server start](https://github.com/pingcap/dm/blob/master/cmd/dm-master/main.go#L69)\n2. [go electionNotify](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L232)ï¼šè¿™ä¸ªæ˜¯ä¸ºäº†[ç­‰å¾… ](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L55)`etcd election`[ æˆåŠŸ](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L55)ï¼Œå¹¶åœ¨å…¶æˆåŠŸååšâ¬‡ï¸\n\n> DM master ä¸­å†…åµŒäº†ä¸€ä¸ª [etcd](https://etcd.io/)ï¼Œç”¨äºå­˜å‚¨å„ç§å…ƒæ•°æ®ï¼Œå¹¶ä¸”å€Ÿæ­¤ä¿è¯ DM master çš„é«˜å¯ç”¨ã€‚åé¢éå¸¸å¤šçš„æ•°æ®å­˜å‚¨éƒ½ä¼šç”¨åˆ° etcdã€‚\n\n3. [startLeaderComponent](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L71)ï¼Œå…¶ä¸­æˆ‘ä»¬è¿™æ¬¡åªéœ€è¦å…³æ³¨ [s.scheduler.Start](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L173) ä¸­çš„[go observeWorkerEvent](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L243)ï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†\n\n   1. [go WatchWorkerEvent](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1617)ï¼šè¯¥å‡½æ•°é€šè¿‡ etcd client ç›‘å¬[æ˜¯å¦æœ‰ workerEvent å‡ºç°](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L198)\n\n   2. [handleWorkerEv](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1619)ï¼šæœ‰ workerEvent å‡ºç°æ—¶ï¼Œhandle it\n\n      1. [handleWorkerOffline](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1580)\n      2. [handleWorkerOnline](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1582)\n\n4. è¿™ä¸ªæ—¶å€™ï¼Œdm-master ç­‰å¾… workerEvent åˆ°æ¥\n\n# ä¸‰ã€start dm-worker\n\n1. [./dm-worker](https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L29)ï¼ˆin [run\\_dm\\_worker](https://github.com/pingcap/dm/blob/master/tests/_utils/run_dm_worker)ï¼‰å¯åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå³è°ƒç”¨ [main å‡½æ•°](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go)ï¼Œå…¶ä¸­[ worker-server start](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go#L89)\n\n2. [JoinMaster](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go#L78)ï¼šå…ˆå‘Šè¯‰ masterï¼Œæˆ‘æ¥äº†ï¼\n\n   1. worker å…ˆåœ¨è¿™ [RegisterWorker](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/join.go#L72)ï¼Œç„¶åä¼šè§¦å‘ master è°ƒç”¨ [RegisterWorker](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L298)\n   2. Master ä¼šè°ƒç”¨ [AddWorker](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L308)ï¼Œç„¶å [PutWorkerInfo](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L907)ï¼ŒæŠŠç›¸åº”çš„ key-value [å†™åˆ° etcd](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/worker.go#L69) ä¸­\n   3. å¯ä»¥çœ‹åˆ°å†™åˆ° etcd ç”¨çš„æ˜¯ `clientv3.OpPut(key, value)`ï¼Œä¹Ÿå°±æ˜¯è¯´ kv è¦æ‰§è¡Œ put æ“ä½œ\n   4. ä¹‹å‰çš„ [go WatchWorkerEvent](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1617) ä¸­å°±ç›‘å¬åˆ°æœ‰äº‹ä»¶æ¥äº†ï¼Œå¹¶ä¸”åˆ¤æ–­å…¶ä¸º `mvccpb.PUT`[ ç±»å‹](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L224)ï¼Œevent å¤„ç†ä¹‹åä¼šé€šè¿‡ [outCh](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L242) ä¼ åˆ° handleWorkerEv ä¸­è¿›è¡Œå…·ä½“çš„[ä¸Šçº¿å¤„ç†](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1582)\n   5. åˆšä¸Šçº¿çš„æ—¶å€™ï¼Œå°±ä¼šå»å„ç§æ‰¾ source å» boundï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¿˜æ²¡æœ‰ create sourceï¼Œæ‰€ä»¥ä¹Ÿæ‰¾ä¸åˆ° sourceï¼Œæš‚æ—¶å¯ä»¥ä¸å…³æ³¨è¿™é‡Œ\n\n3. Start task è¿˜éœ€è¦ bound sourceï¼Œé‚£ worker é¦–å…ˆè¦åšçš„å°±æ˜¯ [observeSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L169)ï¼Œè¿™é‡ŒåŒ [observeWorkerEvent](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L243) æ˜¯ç±»ä¼¼çš„ï¼š\n\n   1. [go WatchSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L404)ï¼šé€šè¿‡ etcd client ç›‘å¬[æ˜¯å¦æœ‰ sourceBound å‡ºç°](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/bound.go#L265)\n   2. [handleSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L406)ï¼šä¸Šé¢ç›‘å¬åˆ°äº†ä¹‹åï¼Œåˆ™ [operateSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L582)\n\n4. æ¥ä¸‹æ¥ï¼Œdm-worker ç­‰å¾… source bound\n\n# å››ã€operate-source create\n\n> DM ç”¨çš„å‘½ä»¤è¡Œå·¥å…·æ˜¯ [cobra](https://github.com/spf13/cobra)ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯æ·±å…¥äº†è§£ä¸€ä¸‹\n\n1. å‘½ä»¤è¡Œæ‰§è¡Œ [operate-source create](https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L34)ï¼ˆin [test\\_prepare](https://github.com/pingcap/dm/blob/master/tests/_utils/test_prepare#L128-L136)ï¼‰ï¼Œ`operate-source` è¿™ä¸ªå‘½ä»¤åœ¨ [NewOperateSourceCmd](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/ctl.go#L68) æ³¨å†Œï¼Œå…·ä½“å®ç°åœ¨ [operateSourceFunc](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L39)\n\n2. è¯»å–åˆ°è¯¥å‘½ä»¤åï¼Œå¼€å§‹[è§£æ](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L89)ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå³ `create`ï¼‰å¹¶[è½¬æ¢](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L47-L48)ï¼Œæœ€åè¢«[æ‰“åŒ…é€](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L143-L152)åˆ° masterï¼Œå¼€å§‹æ‰§è¡Œ master çš„ [OperateSource](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1186) å‡½æ•°\n\n3. è¯¥å‡½æ•°ä¸­ï¼Œmaster ä¼šä»å‘½ä»¤è¡Œä¸­ç»™å‡ºçš„é…ç½®æ–‡ä»¶è·¯å¾„\n\n   1. [è§£æå¹¶è°ƒæ•´](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1205) source config\n   2. [æŠŠ source cfg ä¹Ÿå­˜åˆ° etcd é‡Œ](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1227)ï¼Œå› ä¸º worker å¾…ä¼šè¦ç”¨\n   3. [Try to bound it to a free worker](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L318-L319)ï¼šå› ä¸ºæˆ‘ä»¬æ˜¯ç¬¬ä¸€æ¬¡ start taskï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å¼€å¯ relay åŠŸèƒ½ï¼ˆ[test](https://github.com/pingcap/dm/blob/master/tests/start_task/conf/source1.yaml#L4) ä¸­æ˜¯å¼€å¯äº†ï¼Œä½†æœ¬ç¯‡æ–‡ç« å‡è®¾ä¸å¼€å¯ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åªèƒ½ [bound a free worker](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1904-L1915) äº†ã€‚\n   4. æœ€ç»ˆï¼Œé€šè¿‡ [PutSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1936)ï¼ŒæŠŠ SourceBound [é€šè¿‡ etcd client å‘é€](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/bound.go#L100)\n\n4. å‘é€ä¹‹åï¼Œworker å°±é€šè¿‡ [go WatchSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L404) ç›‘å¬åˆ°æœ‰ SourceBound å‡ºç°ï¼Œç„¶åè¿›è¡Œ [operateSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L582)\n\n   1. é¦–å…ˆéœ€è¦[æ‹¿åˆ° source cfg](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L649)ï¼Œå› ä¸ºä¸Šé¢çš„æ“ä½œéƒ½æ˜¯åœ¨ master æ‰§è¡Œçš„ï¼Œworker è¿™é‡Œå¹¶æ²¡æœ‰ source cfg\n   2. Source cfg ä¹Ÿæ˜¯é€šè¿‡ [etcd](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/source.go#L83) æ‹¿åˆ°çš„ï¼Œæ­£å¥½ä¸Šé¢å­˜äº†\n\n5. ä¹‹åå°±å¯ä»¥[å¼€å§‹ subtask äº†å§](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L658)ï¼\n\n   1. ä½†æ˜¯å¹¶æ²¡æœ‰ã€‚ã€‚ã€‚æˆ‘ä»¬è¿˜æ²¡å¼€å§‹ start task å‘¢ï¼\n   2. æ‰€ä»¥ [fetchSubTasksAndAdjust](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L396) å¹¶ä¸èƒ½æ‹¿åˆ° subtaskã€‚æ‹¿åˆ°æ˜¯ç©ºçš„\n\n6. é‚£æ²¡åŠæ³•äº†ï¼Œç»§ç»­[ç­‰](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L422)å‘—ï¼ˆåˆæ˜¯åŒæ ·çš„ watch/handle æœºåˆ¶ï¼‰\n\n   1. [go WatchSubTaskStage](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L638)\n   2. [handleSubTaskStage](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L640)\n\n# äº”ã€start-task\n\n1. å‘½ä»¤è¡Œæ‰§è¡Œ [start-task](https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L36)ï¼ˆin [test\\_prepare](https://github.com/pingcap/dm/blob/master/tests/_utils/test_prepare#L53-L64)ï¼‰ï¼Œ`start-task` å‘½ä»¤çš„æ³¨å†Œå’Œå®ç°å‚è€ƒ `operate-source`ï¼Œæœ€åæ‰§è¡Œ master çš„ [StartTask](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L404) å‡½æ•°\n\n2. ç›´æ¥å¼€å§‹å°± [generateSubTask](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L426)ï¼ˆ`req.Task` ç›´æ¥ä¼ é€’çš„å°±æ˜¯è§£æå¥½çš„ `task.yaml` å­—ç¬¦ä¸²ï¼ŒåŸæ¥åœ¨å‘½ä»¤çš„å®ç°ä¸­å°±å¸®æˆ‘ä»¬è§£æå¥½å•¦ï¼‰ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯ç»è¿‡ä¸€äº› adjust å’Œ checkï¼Œ å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆäº† [SubTask](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/config/subtask.go#L184) struct\n\n3. é‡ç‚¹æ¥äº†ï¼Œ[AddSubTasks](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L489) -> [NewSubTaskStage](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L727)ï¼ŒsubTask ç»ˆäºåˆ›å»ºå¥½äº†ï¼Œstage=runningï¼›å† [put](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L739) è¿› etcdï¼Œå®Œç¾ã€‚å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆ†åˆ«æŠŠ [SubTaskCfg](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/ops.go#L91) å’Œ [SubTaskStage](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/ops.go#L95) éƒ½ put è¿› etcd äº†ã€‚\n\n4. é‚£ä¸Šé¢å°± watch åˆ° stage æ¥äº†ï¼Œå¯¹ SubTaskCfg è¿›è¡Œ[å¤„ç†](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L682)ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯è¦è¿›è¡Œ run çš„æ“ä½œï¼Œæˆ‘ä»¬è¿˜å¾—[å…ˆæŠŠ cfg æ‹¿å‡ºæ¥](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L735-L743)ï¼Œæœ€å [startSubTask](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L716)\n\n5. startSubTask ä¸­ï¼Œä¼š [NewSubTask](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L481)ï¼Œå† [runSubTask](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L504)ã€‚subTask å†…éƒ¨å…·ä½“çš„æ‰§è¡Œç»„å»ºæ˜¯ç”± [unit](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/unit/unit.go#L32-L67) è´Ÿè´£çš„ï¼Œæ‰€ä»¥å®ƒä¼š\n\n   1. [initUnits](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L200)\n   2. [st.run](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L207) å…¶å®ä¹Ÿæ˜¯ç”± [currentUnit](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L228) æ¥ [Process](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L233)\n\n# å…­ã€ç»“è¯­\n\nåœ¨ unit Process åï¼Œstart-task å°±ç»“æŸå•¦ï¼æ˜¯ä¸æ˜¯è¿˜æ„çŠ¹æœªå°½å‘¢ï¼Ÿåˆ°åº•æœ‰å“ªäº› unit å‘¢ï¼Ÿè¿™äº› unit å†…éƒ¨åˆ°åº•æ˜¯æ€ä¹ˆ Process çš„å‘¢ï¼Ÿåœ¨åç»­çš„æ–‡ç« ä¸­ä¼šé™†ç»­å’Œå¤§å®¶è§é¢å“¦ã€‚\n\nå…¶å®å†å¤è¯»ä¸€ä¸‹å…¨æ–‡ï¼Œæˆ‘ä»¬å‘ç°æœ¬ç¯‡æ–‡ç« å¹¶æ²¡æœ‰å¤ªå¤šå¾ˆéš¾çš„ä¸œè¥¿ï¼Œå¤§éƒ¨åˆ†ç¯‡å¹…éƒ½åœ¨æè¿°ä¸€äº›ã€Œå‡†å¤‡æ´»åŠ¨ã€ï¼Œå…¨ç¨‹ç”¨ etcd watchâ€”â€”master ç­‰å¾… worker åˆ°æ¥ã€worker ç­‰å¾… source åˆ°æ¥ã€source-worker ç­‰å¾… subtask åˆ°æ¥ã€‚ç­‰å°±å®Œäº‹äº†ã€‚\n\nä»»ä½•å»ºè®®å’Œåé¦ˆéƒ½æ¬¢è¿å‘Šè¯‰æˆ‘ã€‚ä¸‹æœŸå†è§ï¼\n","source":"_posts/DM-æ•°æ®æ—…ç¨‹-01ï¼šç¬¬ä¸€æ¬¡-start-task.md","raw":"---\ntitle: DM æ•°æ®æ—…ç¨‹ 01ï¼šç¬¬ä¸€æ¬¡ start task\ndate: 2023-01-03 02:58:33\ntags:\n- DM\n- æºç é˜…è¯»\ncategories:\n- DM æ•°æ®æ—…ç¨‹\ntop_img: /img/category/first_dm_job.png\ncover: /img/category/first_dm_job.png\n---\n\n# ä¸€ã€æ¦‚è¿°\n\næœ¬æ–‡ä»¥ start task ä¸ºç›®çš„ï¼Œå¸¦ç€è¯»è€…ä» 0 åˆ° 1 å¯åŠ¨ä¸€ä¸ªæ•°æ®è¿ç§»ä»»åŠ¡ï¼Œæ—¨åœ¨è®©è¯»è€…äº†è§£åˆ°æœ€åŸºç¡€çš„ DM é€»è¾‘ã€‚æœ¬æ–‡å°†ç›´æ¥å‚ç…§é›†æˆæµ‹è¯• [start\\_task](https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L27-L36) çš„è¿‡ç¨‹ï¼Œä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å±•å¼€ï¼š\n\n1. Start dm-master\n2. Start dm-worker\n3. ç»‘å®š source å’Œ dm-worker\n4. Start task\n\n> æ³¨ï¼šä¸ºäº†ä¸“æ³¨äºæˆ‘ä»¬çš„ç›®çš„ï¼ˆstart taskï¼‰ï¼Œæœ¬æ–‡ä¸ä¼šå¯¹æ— å…³ä»£ç è¿›è¡Œè§£è¯»\n\n> å¤§å®¶å¯ä½¿ç”¨ [start/stop æµç¨‹](https://pingcap.feishu.cn/mindnotes/bmncnqlO5BCrkgxFqabTLaz6EQh#mindmap) è¾…åŠ©é˜…è¯»\n>\n> ç”±äºå†™è¿™ç¯‡çš„æ–‡ç« çš„æ—¶é—´æ˜¯ 2021 å¹´ 12 æœˆä»½ï¼Œæ‰€ä»¥æ‰€æœ‰çš„é“¾æ¥éƒ½æ˜¯åŸ DM repo çš„ğŸ˜‚\n\n# äºŒã€start dm-master\n\n1. [./dm-master](https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L27)ï¼ˆin [run\\_dm\\_master](https://github.com/pingcap/dm/blob/master/tests/_utils/run_dm_master)ï¼‰ å¯åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå³è°ƒç”¨ [main å‡½æ•°](https://github.com/pingcap/dm/blob/master/cmd/dm-master/main.go#L35)ï¼Œå…¶ä¸­ [master-server start](https://github.com/pingcap/dm/blob/master/cmd/dm-master/main.go#L69)\n2. [go electionNotify](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L232)ï¼šè¿™ä¸ªæ˜¯ä¸ºäº†[ç­‰å¾… ](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L55)`etcd election`[ æˆåŠŸ](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L55)ï¼Œå¹¶åœ¨å…¶æˆåŠŸååšâ¬‡ï¸\n\n> DM master ä¸­å†…åµŒäº†ä¸€ä¸ª [etcd](https://etcd.io/)ï¼Œç”¨äºå­˜å‚¨å„ç§å…ƒæ•°æ®ï¼Œå¹¶ä¸”å€Ÿæ­¤ä¿è¯ DM master çš„é«˜å¯ç”¨ã€‚åé¢éå¸¸å¤šçš„æ•°æ®å­˜å‚¨éƒ½ä¼šç”¨åˆ° etcdã€‚\n\n3. [startLeaderComponent](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L71)ï¼Œå…¶ä¸­æˆ‘ä»¬è¿™æ¬¡åªéœ€è¦å…³æ³¨ [s.scheduler.Start](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L173) ä¸­çš„[go observeWorkerEvent](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L243)ï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†\n\n   1. [go WatchWorkerEvent](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1617)ï¼šè¯¥å‡½æ•°é€šè¿‡ etcd client ç›‘å¬[æ˜¯å¦æœ‰ workerEvent å‡ºç°](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L198)\n\n   2. [handleWorkerEv](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1619)ï¼šæœ‰ workerEvent å‡ºç°æ—¶ï¼Œhandle it\n\n      1. [handleWorkerOffline](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1580)\n      2. [handleWorkerOnline](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1582)\n\n4. è¿™ä¸ªæ—¶å€™ï¼Œdm-master ç­‰å¾… workerEvent åˆ°æ¥\n\n# ä¸‰ã€start dm-worker\n\n1. [./dm-worker](https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L29)ï¼ˆin [run\\_dm\\_worker](https://github.com/pingcap/dm/blob/master/tests/_utils/run_dm_worker)ï¼‰å¯åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå³è°ƒç”¨ [main å‡½æ•°](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go)ï¼Œå…¶ä¸­[ worker-server start](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go#L89)\n\n2. [JoinMaster](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go#L78)ï¼šå…ˆå‘Šè¯‰ masterï¼Œæˆ‘æ¥äº†ï¼\n\n   1. worker å…ˆåœ¨è¿™ [RegisterWorker](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/join.go#L72)ï¼Œç„¶åä¼šè§¦å‘ master è°ƒç”¨ [RegisterWorker](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L298)\n   2. Master ä¼šè°ƒç”¨ [AddWorker](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L308)ï¼Œç„¶å [PutWorkerInfo](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L907)ï¼ŒæŠŠç›¸åº”çš„ key-value [å†™åˆ° etcd](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/worker.go#L69) ä¸­\n   3. å¯ä»¥çœ‹åˆ°å†™åˆ° etcd ç”¨çš„æ˜¯ `clientv3.OpPut(key, value)`ï¼Œä¹Ÿå°±æ˜¯è¯´ kv è¦æ‰§è¡Œ put æ“ä½œ\n   4. ä¹‹å‰çš„ [go WatchWorkerEvent](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1617) ä¸­å°±ç›‘å¬åˆ°æœ‰äº‹ä»¶æ¥äº†ï¼Œå¹¶ä¸”åˆ¤æ–­å…¶ä¸º `mvccpb.PUT`[ ç±»å‹](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L224)ï¼Œevent å¤„ç†ä¹‹åä¼šé€šè¿‡ [outCh](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L242) ä¼ åˆ° handleWorkerEv ä¸­è¿›è¡Œå…·ä½“çš„[ä¸Šçº¿å¤„ç†](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1582)\n   5. åˆšä¸Šçº¿çš„æ—¶å€™ï¼Œå°±ä¼šå»å„ç§æ‰¾ source å» boundï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¿˜æ²¡æœ‰ create sourceï¼Œæ‰€ä»¥ä¹Ÿæ‰¾ä¸åˆ° sourceï¼Œæš‚æ—¶å¯ä»¥ä¸å…³æ³¨è¿™é‡Œ\n\n3. Start task è¿˜éœ€è¦ bound sourceï¼Œé‚£ worker é¦–å…ˆè¦åšçš„å°±æ˜¯ [observeSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L169)ï¼Œè¿™é‡ŒåŒ [observeWorkerEvent](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L243) æ˜¯ç±»ä¼¼çš„ï¼š\n\n   1. [go WatchSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L404)ï¼šé€šè¿‡ etcd client ç›‘å¬[æ˜¯å¦æœ‰ sourceBound å‡ºç°](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/bound.go#L265)\n   2. [handleSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L406)ï¼šä¸Šé¢ç›‘å¬åˆ°äº†ä¹‹åï¼Œåˆ™ [operateSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L582)\n\n4. æ¥ä¸‹æ¥ï¼Œdm-worker ç­‰å¾… source bound\n\n# å››ã€operate-source create\n\n> DM ç”¨çš„å‘½ä»¤è¡Œå·¥å…·æ˜¯ [cobra](https://github.com/spf13/cobra)ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯æ·±å…¥äº†è§£ä¸€ä¸‹\n\n1. å‘½ä»¤è¡Œæ‰§è¡Œ [operate-source create](https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L34)ï¼ˆin [test\\_prepare](https://github.com/pingcap/dm/blob/master/tests/_utils/test_prepare#L128-L136)ï¼‰ï¼Œ`operate-source` è¿™ä¸ªå‘½ä»¤åœ¨ [NewOperateSourceCmd](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/ctl.go#L68) æ³¨å†Œï¼Œå…·ä½“å®ç°åœ¨ [operateSourceFunc](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L39)\n\n2. è¯»å–åˆ°è¯¥å‘½ä»¤åï¼Œå¼€å§‹[è§£æ](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L89)ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå³ `create`ï¼‰å¹¶[è½¬æ¢](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L47-L48)ï¼Œæœ€åè¢«[æ‰“åŒ…é€](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L143-L152)åˆ° masterï¼Œå¼€å§‹æ‰§è¡Œ master çš„ [OperateSource](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1186) å‡½æ•°\n\n3. è¯¥å‡½æ•°ä¸­ï¼Œmaster ä¼šä»å‘½ä»¤è¡Œä¸­ç»™å‡ºçš„é…ç½®æ–‡ä»¶è·¯å¾„\n\n   1. [è§£æå¹¶è°ƒæ•´](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1205) source config\n   2. [æŠŠ source cfg ä¹Ÿå­˜åˆ° etcd é‡Œ](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1227)ï¼Œå› ä¸º worker å¾…ä¼šè¦ç”¨\n   3. [Try to bound it to a free worker](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L318-L319)ï¼šå› ä¸ºæˆ‘ä»¬æ˜¯ç¬¬ä¸€æ¬¡ start taskï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å¼€å¯ relay åŠŸèƒ½ï¼ˆ[test](https://github.com/pingcap/dm/blob/master/tests/start_task/conf/source1.yaml#L4) ä¸­æ˜¯å¼€å¯äº†ï¼Œä½†æœ¬ç¯‡æ–‡ç« å‡è®¾ä¸å¼€å¯ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åªèƒ½ [bound a free worker](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1904-L1915) äº†ã€‚\n   4. æœ€ç»ˆï¼Œé€šè¿‡ [PutSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1936)ï¼ŒæŠŠ SourceBound [é€šè¿‡ etcd client å‘é€](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/bound.go#L100)\n\n4. å‘é€ä¹‹åï¼Œworker å°±é€šè¿‡ [go WatchSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L404) ç›‘å¬åˆ°æœ‰ SourceBound å‡ºç°ï¼Œç„¶åè¿›è¡Œ [operateSourceBound](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L582)\n\n   1. é¦–å…ˆéœ€è¦[æ‹¿åˆ° source cfg](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L649)ï¼Œå› ä¸ºä¸Šé¢çš„æ“ä½œéƒ½æ˜¯åœ¨ master æ‰§è¡Œçš„ï¼Œworker è¿™é‡Œå¹¶æ²¡æœ‰ source cfg\n   2. Source cfg ä¹Ÿæ˜¯é€šè¿‡ [etcd](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/source.go#L83) æ‹¿åˆ°çš„ï¼Œæ­£å¥½ä¸Šé¢å­˜äº†\n\n5. ä¹‹åå°±å¯ä»¥[å¼€å§‹ subtask äº†å§](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L658)ï¼\n\n   1. ä½†æ˜¯å¹¶æ²¡æœ‰ã€‚ã€‚ã€‚æˆ‘ä»¬è¿˜æ²¡å¼€å§‹ start task å‘¢ï¼\n   2. æ‰€ä»¥ [fetchSubTasksAndAdjust](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L396) å¹¶ä¸èƒ½æ‹¿åˆ° subtaskã€‚æ‹¿åˆ°æ˜¯ç©ºçš„\n\n6. é‚£æ²¡åŠæ³•äº†ï¼Œç»§ç»­[ç­‰](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L422)å‘—ï¼ˆåˆæ˜¯åŒæ ·çš„ watch/handle æœºåˆ¶ï¼‰\n\n   1. [go WatchSubTaskStage](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L638)\n   2. [handleSubTaskStage](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L640)\n\n# äº”ã€start-task\n\n1. å‘½ä»¤è¡Œæ‰§è¡Œ [start-task](https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L36)ï¼ˆin [test\\_prepare](https://github.com/pingcap/dm/blob/master/tests/_utils/test_prepare#L53-L64)ï¼‰ï¼Œ`start-task` å‘½ä»¤çš„æ³¨å†Œå’Œå®ç°å‚è€ƒ `operate-source`ï¼Œæœ€åæ‰§è¡Œ master çš„ [StartTask](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L404) å‡½æ•°\n\n2. ç›´æ¥å¼€å§‹å°± [generateSubTask](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L426)ï¼ˆ`req.Task` ç›´æ¥ä¼ é€’çš„å°±æ˜¯è§£æå¥½çš„ `task.yaml` å­—ç¬¦ä¸²ï¼ŒåŸæ¥åœ¨å‘½ä»¤çš„å®ç°ä¸­å°±å¸®æˆ‘ä»¬è§£æå¥½å•¦ï¼‰ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯ç»è¿‡ä¸€äº› adjust å’Œ checkï¼Œ å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆäº† [SubTask](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/config/subtask.go#L184) struct\n\n3. é‡ç‚¹æ¥äº†ï¼Œ[AddSubTasks](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L489) -> [NewSubTaskStage](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L727)ï¼ŒsubTask ç»ˆäºåˆ›å»ºå¥½äº†ï¼Œstage=runningï¼›å† [put](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L739) è¿› etcdï¼Œå®Œç¾ã€‚å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆ†åˆ«æŠŠ [SubTaskCfg](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/ops.go#L91) å’Œ [SubTaskStage](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/ops.go#L95) éƒ½ put è¿› etcd äº†ã€‚\n\n4. é‚£ä¸Šé¢å°± watch åˆ° stage æ¥äº†ï¼Œå¯¹ SubTaskCfg è¿›è¡Œ[å¤„ç†](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L682)ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯è¦è¿›è¡Œ run çš„æ“ä½œï¼Œæˆ‘ä»¬è¿˜å¾—[å…ˆæŠŠ cfg æ‹¿å‡ºæ¥](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L735-L743)ï¼Œæœ€å [startSubTask](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L716)\n\n5. startSubTask ä¸­ï¼Œä¼š [NewSubTask](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L481)ï¼Œå† [runSubTask](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L504)ã€‚subTask å†…éƒ¨å…·ä½“çš„æ‰§è¡Œç»„å»ºæ˜¯ç”± [unit](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/unit/unit.go#L32-L67) è´Ÿè´£çš„ï¼Œæ‰€ä»¥å®ƒä¼š\n\n   1. [initUnits](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L200)\n   2. [st.run](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L207) å…¶å®ä¹Ÿæ˜¯ç”± [currentUnit](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L228) æ¥ [Process](https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L233)\n\n# å…­ã€ç»“è¯­\n\nåœ¨ unit Process åï¼Œstart-task å°±ç»“æŸå•¦ï¼æ˜¯ä¸æ˜¯è¿˜æ„çŠ¹æœªå°½å‘¢ï¼Ÿåˆ°åº•æœ‰å“ªäº› unit å‘¢ï¼Ÿè¿™äº› unit å†…éƒ¨åˆ°åº•æ˜¯æ€ä¹ˆ Process çš„å‘¢ï¼Ÿåœ¨åç»­çš„æ–‡ç« ä¸­ä¼šé™†ç»­å’Œå¤§å®¶è§é¢å“¦ã€‚\n\nå…¶å®å†å¤è¯»ä¸€ä¸‹å…¨æ–‡ï¼Œæˆ‘ä»¬å‘ç°æœ¬ç¯‡æ–‡ç« å¹¶æ²¡æœ‰å¤ªå¤šå¾ˆéš¾çš„ä¸œè¥¿ï¼Œå¤§éƒ¨åˆ†ç¯‡å¹…éƒ½åœ¨æè¿°ä¸€äº›ã€Œå‡†å¤‡æ´»åŠ¨ã€ï¼Œå…¨ç¨‹ç”¨ etcd watchâ€”â€”master ç­‰å¾… worker åˆ°æ¥ã€worker ç­‰å¾… source åˆ°æ¥ã€source-worker ç­‰å¾… subtask åˆ°æ¥ã€‚ç­‰å°±å®Œäº‹äº†ã€‚\n\nä»»ä½•å»ºè®®å’Œåé¦ˆéƒ½æ¬¢è¿å‘Šè¯‰æˆ‘ã€‚ä¸‹æœŸå†è§ï¼\n","slug":"DM-æ•°æ®æ—…ç¨‹-01ï¼šç¬¬ä¸€æ¬¡-start-task","published":1,"updated":"2024-06-16T07:12:29.395Z","_id":"clxh0ivhl0000rvdyen14f5dy","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"ä¸€ã€æ¦‚è¿°\"><a href=\"#ä¸€ã€æ¦‚è¿°\" class=\"headerlink\" title=\"ä¸€ã€æ¦‚è¿°\"></a>ä¸€ã€æ¦‚è¿°</h1><p>æœ¬æ–‡ä»¥ start task ä¸ºç›®çš„ï¼Œå¸¦ç€è¯»è€…ä» 0 åˆ° 1 å¯åŠ¨ä¸€ä¸ªæ•°æ®è¿ç§»ä»»åŠ¡ï¼Œæ—¨åœ¨è®©è¯»è€…äº†è§£åˆ°æœ€åŸºç¡€çš„ DM é€»è¾‘ã€‚æœ¬æ–‡å°†ç›´æ¥å‚ç…§é›†æˆæµ‹è¯• <a href=\"https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L27-L36\">start_task</a> çš„è¿‡ç¨‹ï¼Œä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å±•å¼€ï¼š</p>\n<ol>\n<li>Start dm-master</li>\n<li>Start dm-worker</li>\n<li>ç»‘å®š source å’Œ dm-worker</li>\n<li>Start task</li>\n</ol>\n<blockquote>\n<p>æ³¨ï¼šä¸ºäº†ä¸“æ³¨äºæˆ‘ä»¬çš„ç›®çš„ï¼ˆstart taskï¼‰ï¼Œæœ¬æ–‡ä¸ä¼šå¯¹æ— å…³ä»£ç è¿›è¡Œè§£è¯»</p>\n</blockquote>\n<blockquote>\n<p>å¤§å®¶å¯ä½¿ç”¨ <a href=\"https://pingcap.feishu.cn/mindnotes/bmncnqlO5BCrkgxFqabTLaz6EQh#mindmap\">start/stop æµç¨‹</a> è¾…åŠ©é˜…è¯»</p>\n<p>ç”±äºå†™è¿™ç¯‡çš„æ–‡ç« çš„æ—¶é—´æ˜¯ 2021 å¹´ 12 æœˆä»½ï¼Œæ‰€ä»¥æ‰€æœ‰çš„é“¾æ¥éƒ½æ˜¯åŸ DM repo çš„ğŸ˜‚</p>\n</blockquote>\n<h1 id=\"äºŒã€start-dm-master\"><a href=\"#äºŒã€start-dm-master\" class=\"headerlink\" title=\"äºŒã€start dm-master\"></a>äºŒã€start dm-master</h1><ol>\n<li><a href=\"https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L27\">./dm-master</a>ï¼ˆin <a href=\"https://github.com/pingcap/dm/blob/master/tests/_utils/run_dm_master\">run_dm_master</a>ï¼‰ å¯åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå³è°ƒç”¨ <a href=\"https://github.com/pingcap/dm/blob/master/cmd/dm-master/main.go#L35\">main å‡½æ•°</a>ï¼Œå…¶ä¸­ <a href=\"https://github.com/pingcap/dm/blob/master/cmd/dm-master/main.go#L69\">master-server start</a></li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L232\">go electionNotify</a>ï¼šè¿™ä¸ªæ˜¯ä¸ºäº†<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L55\">ç­‰å¾… </a><code>etcd election</code><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L55\"> æˆåŠŸ</a>ï¼Œå¹¶åœ¨å…¶æˆåŠŸååšâ¬‡ï¸</li>\n</ol>\n<blockquote>\n<p>DM master ä¸­å†…åµŒäº†ä¸€ä¸ª <a href=\"https://etcd.io/\">etcd</a>ï¼Œç”¨äºå­˜å‚¨å„ç§å…ƒæ•°æ®ï¼Œå¹¶ä¸”å€Ÿæ­¤ä¿è¯ DM master çš„é«˜å¯ç”¨ã€‚åé¢éå¸¸å¤šçš„æ•°æ®å­˜å‚¨éƒ½ä¼šç”¨åˆ° etcdã€‚</p>\n</blockquote>\n<ol start=\"3\">\n<li><p><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L71\">startLeaderComponent</a>ï¼Œå…¶ä¸­æˆ‘ä»¬è¿™æ¬¡åªéœ€è¦å…³æ³¨ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L173\">s.scheduler.Start</a> ä¸­çš„<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L243\">go observeWorkerEvent</a>ï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†</p>\n<ol>\n<li><p><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1617\">go WatchWorkerEvent</a>ï¼šè¯¥å‡½æ•°é€šè¿‡ etcd client ç›‘å¬<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L198\">æ˜¯å¦æœ‰ workerEvent å‡ºç°</a></p>\n</li>\n<li><p><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1619\">handleWorkerEv</a>ï¼šæœ‰ workerEvent å‡ºç°æ—¶ï¼Œhandle it</p>\n<ol>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1580\">handleWorkerOffline</a></li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1582\">handleWorkerOnline</a></li>\n</ol>\n</li>\n</ol>\n</li>\n<li><p>è¿™ä¸ªæ—¶å€™ï¼Œdm-master ç­‰å¾… workerEvent åˆ°æ¥</p>\n</li>\n</ol>\n<h1 id=\"ä¸‰ã€start-dm-worker\"><a href=\"#ä¸‰ã€start-dm-worker\" class=\"headerlink\" title=\"ä¸‰ã€start dm-worker\"></a>ä¸‰ã€start dm-worker</h1><ol>\n<li><p><a href=\"https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L29\">./dm-worker</a>ï¼ˆin <a href=\"https://github.com/pingcap/dm/blob/master/tests/_utils/run_dm_worker\">run_dm_worker</a>ï¼‰å¯åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå³è°ƒç”¨ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go\">main å‡½æ•°</a>ï¼Œå…¶ä¸­<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go#L89\"> worker-server start</a></p>\n</li>\n<li><p><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go#L78\">JoinMaster</a>ï¼šå…ˆå‘Šè¯‰ masterï¼Œæˆ‘æ¥äº†ï¼</p>\n<ol>\n<li>worker å…ˆåœ¨è¿™ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/join.go#L72\">RegisterWorker</a>ï¼Œç„¶åä¼šè§¦å‘ master è°ƒç”¨ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L298\">RegisterWorker</a></li>\n<li>Master ä¼šè°ƒç”¨ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L308\">AddWorker</a>ï¼Œç„¶å <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L907\">PutWorkerInfo</a>ï¼ŒæŠŠç›¸åº”çš„ key-value <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/worker.go#L69\">å†™åˆ° etcd</a> ä¸­</li>\n<li>å¯ä»¥çœ‹åˆ°å†™åˆ° etcd ç”¨çš„æ˜¯ <code>clientv3.OpPut(key, value)</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ kv è¦æ‰§è¡Œ put æ“ä½œ</li>\n<li>ä¹‹å‰çš„ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1617\">go WatchWorkerEvent</a> ä¸­å°±ç›‘å¬åˆ°æœ‰äº‹ä»¶æ¥äº†ï¼Œå¹¶ä¸”åˆ¤æ–­å…¶ä¸º <code>mvccpb.PUT</code><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L224\"> ç±»å‹</a>ï¼Œevent å¤„ç†ä¹‹åä¼šé€šè¿‡ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L242\">outCh</a> ä¼ åˆ° handleWorkerEv ä¸­è¿›è¡Œå…·ä½“çš„<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1582\">ä¸Šçº¿å¤„ç†</a></li>\n<li>åˆšä¸Šçº¿çš„æ—¶å€™ï¼Œå°±ä¼šå»å„ç§æ‰¾ source å» boundï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¿˜æ²¡æœ‰ create sourceï¼Œæ‰€ä»¥ä¹Ÿæ‰¾ä¸åˆ° sourceï¼Œæš‚æ—¶å¯ä»¥ä¸å…³æ³¨è¿™é‡Œ</li>\n</ol>\n</li>\n<li><p>Start task è¿˜éœ€è¦ bound sourceï¼Œé‚£ worker é¦–å…ˆè¦åšçš„å°±æ˜¯ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L169\">observeSourceBound</a>ï¼Œè¿™é‡ŒåŒ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L243\">observeWorkerEvent</a> æ˜¯ç±»ä¼¼çš„ï¼š</p>\n<ol>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L404\">go WatchSourceBound</a>ï¼šé€šè¿‡ etcd client ç›‘å¬<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/bound.go#L265\">æ˜¯å¦æœ‰ sourceBound å‡ºç°</a></li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L406\">handleSourceBound</a>ï¼šä¸Šé¢ç›‘å¬åˆ°äº†ä¹‹åï¼Œåˆ™ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L582\">operateSourceBound</a></li>\n</ol>\n</li>\n<li><p>æ¥ä¸‹æ¥ï¼Œdm-worker ç­‰å¾… source bound</p>\n</li>\n</ol>\n<h1 id=\"å››ã€operate-source-create\"><a href=\"#å››ã€operate-source-create\" class=\"headerlink\" title=\"å››ã€operate-source create\"></a>å››ã€operate-source create</h1><blockquote>\n<p>DM ç”¨çš„å‘½ä»¤è¡Œå·¥å…·æ˜¯ <a href=\"https://github.com/spf13/cobra\">cobra</a>ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯æ·±å…¥äº†è§£ä¸€ä¸‹</p>\n</blockquote>\n<ol>\n<li><p>å‘½ä»¤è¡Œæ‰§è¡Œ <a href=\"https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L34\">operate-source create</a>ï¼ˆin <a href=\"https://github.com/pingcap/dm/blob/master/tests/_utils/test_prepare#L128-L136\">test_prepare</a>ï¼‰ï¼Œ<code>operate-source</code> è¿™ä¸ªå‘½ä»¤åœ¨ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/ctl.go#L68\">NewOperateSourceCmd</a> æ³¨å†Œï¼Œå…·ä½“å®ç°åœ¨ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L39\">operateSourceFunc</a></p>\n</li>\n<li><p>è¯»å–åˆ°è¯¥å‘½ä»¤åï¼Œå¼€å§‹<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L89\">è§£æ</a>ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå³ <code>create</code>ï¼‰å¹¶<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L47-L48\">è½¬æ¢</a>ï¼Œæœ€åè¢«<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L143-L152\">æ‰“åŒ…é€</a>åˆ° masterï¼Œå¼€å§‹æ‰§è¡Œ master çš„ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1186\">OperateSource</a> å‡½æ•°</p>\n</li>\n<li><p>è¯¥å‡½æ•°ä¸­ï¼Œmaster ä¼šä»å‘½ä»¤è¡Œä¸­ç»™å‡ºçš„é…ç½®æ–‡ä»¶è·¯å¾„</p>\n<ol>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1205\">è§£æå¹¶è°ƒæ•´</a> source config</li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1227\">æŠŠ source cfg ä¹Ÿå­˜åˆ° etcd é‡Œ</a>ï¼Œå› ä¸º worker å¾…ä¼šè¦ç”¨</li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L318-L319\">Try to bound it to a free worker</a>ï¼šå› ä¸ºæˆ‘ä»¬æ˜¯ç¬¬ä¸€æ¬¡ start taskï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å¼€å¯ relay åŠŸèƒ½ï¼ˆ<a href=\"https://github.com/pingcap/dm/blob/master/tests/start_task/conf/source1.yaml#L4\">test</a> ä¸­æ˜¯å¼€å¯äº†ï¼Œä½†æœ¬ç¯‡æ–‡ç« å‡è®¾ä¸å¼€å¯ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åªèƒ½ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1904-L1915\">bound a free worker</a> äº†ã€‚</li>\n<li>æœ€ç»ˆï¼Œé€šè¿‡ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1936\">PutSourceBound</a>ï¼ŒæŠŠ SourceBound <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/bound.go#L100\">é€šè¿‡ etcd client å‘é€</a></li>\n</ol>\n</li>\n<li><p>å‘é€ä¹‹åï¼Œworker å°±é€šè¿‡ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L404\">go WatchSourceBound</a> ç›‘å¬åˆ°æœ‰ SourceBound å‡ºç°ï¼Œç„¶åè¿›è¡Œ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L582\">operateSourceBound</a></p>\n<ol>\n<li>é¦–å…ˆéœ€è¦<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L649\">æ‹¿åˆ° source cfg</a>ï¼Œå› ä¸ºä¸Šé¢çš„æ“ä½œéƒ½æ˜¯åœ¨ master æ‰§è¡Œçš„ï¼Œworker è¿™é‡Œå¹¶æ²¡æœ‰ source cfg</li>\n<li>Source cfg ä¹Ÿæ˜¯é€šè¿‡ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/source.go#L83\">etcd</a> æ‹¿åˆ°çš„ï¼Œæ­£å¥½ä¸Šé¢å­˜äº†</li>\n</ol>\n</li>\n<li><p>ä¹‹åå°±å¯ä»¥<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L658\">å¼€å§‹ subtask äº†å§</a>ï¼</p>\n<ol>\n<li>ä½†æ˜¯å¹¶æ²¡æœ‰ã€‚ã€‚ã€‚æˆ‘ä»¬è¿˜æ²¡å¼€å§‹ start task å‘¢ï¼</li>\n<li>æ‰€ä»¥ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L396\">fetchSubTasksAndAdjust</a> å¹¶ä¸èƒ½æ‹¿åˆ° subtaskã€‚æ‹¿åˆ°æ˜¯ç©ºçš„</li>\n</ol>\n</li>\n<li><p>é‚£æ²¡åŠæ³•äº†ï¼Œç»§ç»­<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L422\">ç­‰</a>å‘—ï¼ˆåˆæ˜¯åŒæ ·çš„ watch/handle æœºåˆ¶ï¼‰</p>\n<ol>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L638\">go WatchSubTaskStage</a></li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L640\">handleSubTaskStage</a></li>\n</ol>\n</li>\n</ol>\n<h1 id=\"äº”ã€start-task\"><a href=\"#äº”ã€start-task\" class=\"headerlink\" title=\"äº”ã€start-task\"></a>äº”ã€start-task</h1><ol>\n<li><p>å‘½ä»¤è¡Œæ‰§è¡Œ <a href=\"https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L36\">start-task</a>ï¼ˆin <a href=\"https://github.com/pingcap/dm/blob/master/tests/_utils/test_prepare#L53-L64\">test_prepare</a>ï¼‰ï¼Œ<code>start-task</code> å‘½ä»¤çš„æ³¨å†Œå’Œå®ç°å‚è€ƒ <code>operate-source</code>ï¼Œæœ€åæ‰§è¡Œ master çš„ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L404\">StartTask</a> å‡½æ•°</p>\n</li>\n<li><p>ç›´æ¥å¼€å§‹å°± <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L426\">generateSubTask</a>ï¼ˆ<code>req.Task</code> ç›´æ¥ä¼ é€’çš„å°±æ˜¯è§£æå¥½çš„ <code>task.yaml</code> å­—ç¬¦ä¸²ï¼ŒåŸæ¥åœ¨å‘½ä»¤çš„å®ç°ä¸­å°±å¸®æˆ‘ä»¬è§£æå¥½å•¦ï¼‰ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯ç»è¿‡ä¸€äº› adjust å’Œ checkï¼Œ å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆäº† <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/config/subtask.go#L184\">SubTask</a> struct</p>\n</li>\n<li><p>é‡ç‚¹æ¥äº†ï¼Œ<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L489\">AddSubTasks</a> -&gt; <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L727\">NewSubTaskStage</a>ï¼ŒsubTask ç»ˆäºåˆ›å»ºå¥½äº†ï¼Œstage=runningï¼›å† <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L739\">put</a> è¿› etcdï¼Œå®Œç¾ã€‚å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆ†åˆ«æŠŠ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/ops.go#L91\">SubTaskCfg</a> å’Œ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/ops.go#L95\">SubTaskStage</a> éƒ½ put è¿› etcd äº†ã€‚</p>\n</li>\n<li><p>é‚£ä¸Šé¢å°± watch åˆ° stage æ¥äº†ï¼Œå¯¹ SubTaskCfg è¿›è¡Œ<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L682\">å¤„ç†</a>ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯è¦è¿›è¡Œ run çš„æ“ä½œï¼Œæˆ‘ä»¬è¿˜å¾—<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L735-L743\">å…ˆæŠŠ cfg æ‹¿å‡ºæ¥</a>ï¼Œæœ€å <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L716\">startSubTask</a></p>\n</li>\n<li><p>startSubTask ä¸­ï¼Œä¼š <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L481\">NewSubTask</a>ï¼Œå† <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L504\">runSubTask</a>ã€‚subTask å†…éƒ¨å…·ä½“çš„æ‰§è¡Œç»„å»ºæ˜¯ç”± <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/unit/unit.go#L32-L67\">unit</a> è´Ÿè´£çš„ï¼Œæ‰€ä»¥å®ƒä¼š</p>\n<ol>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L200\">initUnits</a></li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L207\">st.run</a> å…¶å®ä¹Ÿæ˜¯ç”± <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L228\">currentUnit</a> æ¥ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L233\">Process</a></li>\n</ol>\n</li>\n</ol>\n<h1 id=\"å…­ã€ç»“è¯­\"><a href=\"#å…­ã€ç»“è¯­\" class=\"headerlink\" title=\"å…­ã€ç»“è¯­\"></a>å…­ã€ç»“è¯­</h1><p>åœ¨ unit Process åï¼Œstart-task å°±ç»“æŸå•¦ï¼æ˜¯ä¸æ˜¯è¿˜æ„çŠ¹æœªå°½å‘¢ï¼Ÿåˆ°åº•æœ‰å“ªäº› unit å‘¢ï¼Ÿè¿™äº› unit å†…éƒ¨åˆ°åº•æ˜¯æ€ä¹ˆ Process çš„å‘¢ï¼Ÿåœ¨åç»­çš„æ–‡ç« ä¸­ä¼šé™†ç»­å’Œå¤§å®¶è§é¢å“¦ã€‚</p>\n<p>å…¶å®å†å¤è¯»ä¸€ä¸‹å…¨æ–‡ï¼Œæˆ‘ä»¬å‘ç°æœ¬ç¯‡æ–‡ç« å¹¶æ²¡æœ‰å¤ªå¤šå¾ˆéš¾çš„ä¸œè¥¿ï¼Œå¤§éƒ¨åˆ†ç¯‡å¹…éƒ½åœ¨æè¿°ä¸€äº›ã€Œå‡†å¤‡æ´»åŠ¨ã€ï¼Œå…¨ç¨‹ç”¨ etcd watchâ€”â€”master ç­‰å¾… worker åˆ°æ¥ã€worker ç­‰å¾… source åˆ°æ¥ã€source-worker ç­‰å¾… subtask åˆ°æ¥ã€‚ç­‰å°±å®Œäº‹äº†ã€‚</p>\n<p>ä»»ä½•å»ºè®®å’Œåé¦ˆéƒ½æ¬¢è¿å‘Šè¯‰æˆ‘ã€‚ä¸‹æœŸå†è§ï¼</p>\n","site":{"data":{}},"cover_type":"img","length":2831,"excerpt":"","more":"<h1 id=\"ä¸€ã€æ¦‚è¿°\"><a href=\"#ä¸€ã€æ¦‚è¿°\" class=\"headerlink\" title=\"ä¸€ã€æ¦‚è¿°\"></a>ä¸€ã€æ¦‚è¿°</h1><p>æœ¬æ–‡ä»¥ start task ä¸ºç›®çš„ï¼Œå¸¦ç€è¯»è€…ä» 0 åˆ° 1 å¯åŠ¨ä¸€ä¸ªæ•°æ®è¿ç§»ä»»åŠ¡ï¼Œæ—¨åœ¨è®©è¯»è€…äº†è§£åˆ°æœ€åŸºç¡€çš„ DM é€»è¾‘ã€‚æœ¬æ–‡å°†ç›´æ¥å‚ç…§é›†æˆæµ‹è¯• <a href=\"https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L27-L36\">start_task</a> çš„è¿‡ç¨‹ï¼Œä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å±•å¼€ï¼š</p>\n<ol>\n<li>Start dm-master</li>\n<li>Start dm-worker</li>\n<li>ç»‘å®š source å’Œ dm-worker</li>\n<li>Start task</li>\n</ol>\n<blockquote>\n<p>æ³¨ï¼šä¸ºäº†ä¸“æ³¨äºæˆ‘ä»¬çš„ç›®çš„ï¼ˆstart taskï¼‰ï¼Œæœ¬æ–‡ä¸ä¼šå¯¹æ— å…³ä»£ç è¿›è¡Œè§£è¯»</p>\n</blockquote>\n<blockquote>\n<p>å¤§å®¶å¯ä½¿ç”¨ <a href=\"https://pingcap.feishu.cn/mindnotes/bmncnqlO5BCrkgxFqabTLaz6EQh#mindmap\">start/stop æµç¨‹</a> è¾…åŠ©é˜…è¯»</p>\n<p>ç”±äºå†™è¿™ç¯‡çš„æ–‡ç« çš„æ—¶é—´æ˜¯ 2021 å¹´ 12 æœˆä»½ï¼Œæ‰€ä»¥æ‰€æœ‰çš„é“¾æ¥éƒ½æ˜¯åŸ DM repo çš„ğŸ˜‚</p>\n</blockquote>\n<h1 id=\"äºŒã€start-dm-master\"><a href=\"#äºŒã€start-dm-master\" class=\"headerlink\" title=\"äºŒã€start dm-master\"></a>äºŒã€start dm-master</h1><ol>\n<li><a href=\"https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L27\">./dm-master</a>ï¼ˆin <a href=\"https://github.com/pingcap/dm/blob/master/tests/_utils/run_dm_master\">run_dm_master</a>ï¼‰ å¯åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå³è°ƒç”¨ <a href=\"https://github.com/pingcap/dm/blob/master/cmd/dm-master/main.go#L35\">main å‡½æ•°</a>ï¼Œå…¶ä¸­ <a href=\"https://github.com/pingcap/dm/blob/master/cmd/dm-master/main.go#L69\">master-server start</a></li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L232\">go electionNotify</a>ï¼šè¿™ä¸ªæ˜¯ä¸ºäº†<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L55\">ç­‰å¾… </a><code>etcd election</code><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L55\"> æˆåŠŸ</a>ï¼Œå¹¶åœ¨å…¶æˆåŠŸååšâ¬‡ï¸</li>\n</ol>\n<blockquote>\n<p>DM master ä¸­å†…åµŒäº†ä¸€ä¸ª <a href=\"https://etcd.io/\">etcd</a>ï¼Œç”¨äºå­˜å‚¨å„ç§å…ƒæ•°æ®ï¼Œå¹¶ä¸”å€Ÿæ­¤ä¿è¯ DM master çš„é«˜å¯ç”¨ã€‚åé¢éå¸¸å¤šçš„æ•°æ®å­˜å‚¨éƒ½ä¼šç”¨åˆ° etcdã€‚</p>\n</blockquote>\n<ol start=\"3\">\n<li><p><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L71\">startLeaderComponent</a>ï¼Œå…¶ä¸­æˆ‘ä»¬è¿™æ¬¡åªéœ€è¦å…³æ³¨ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L173\">s.scheduler.Start</a> ä¸­çš„<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L243\">go observeWorkerEvent</a>ï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†</p>\n<ol>\n<li><p><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1617\">go WatchWorkerEvent</a>ï¼šè¯¥å‡½æ•°é€šè¿‡ etcd client ç›‘å¬<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L198\">æ˜¯å¦æœ‰ workerEvent å‡ºç°</a></p>\n</li>\n<li><p><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1619\">handleWorkerEv</a>ï¼šæœ‰ workerEvent å‡ºç°æ—¶ï¼Œhandle it</p>\n<ol>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1580\">handleWorkerOffline</a></li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1582\">handleWorkerOnline</a></li>\n</ol>\n</li>\n</ol>\n</li>\n<li><p>è¿™ä¸ªæ—¶å€™ï¼Œdm-master ç­‰å¾… workerEvent åˆ°æ¥</p>\n</li>\n</ol>\n<h1 id=\"ä¸‰ã€start-dm-worker\"><a href=\"#ä¸‰ã€start-dm-worker\" class=\"headerlink\" title=\"ä¸‰ã€start dm-worker\"></a>ä¸‰ã€start dm-worker</h1><ol>\n<li><p><a href=\"https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L29\">./dm-worker</a>ï¼ˆin <a href=\"https://github.com/pingcap/dm/blob/master/tests/_utils/run_dm_worker\">run_dm_worker</a>ï¼‰å¯åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå³è°ƒç”¨ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go\">main å‡½æ•°</a>ï¼Œå…¶ä¸­<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go#L89\"> worker-server start</a></p>\n</li>\n<li><p><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go#L78\">JoinMaster</a>ï¼šå…ˆå‘Šè¯‰ masterï¼Œæˆ‘æ¥äº†ï¼</p>\n<ol>\n<li>worker å…ˆåœ¨è¿™ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/join.go#L72\">RegisterWorker</a>ï¼Œç„¶åä¼šè§¦å‘ master è°ƒç”¨ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L298\">RegisterWorker</a></li>\n<li>Master ä¼šè°ƒç”¨ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L308\">AddWorker</a>ï¼Œç„¶å <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L907\">PutWorkerInfo</a>ï¼ŒæŠŠç›¸åº”çš„ key-value <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/worker.go#L69\">å†™åˆ° etcd</a> ä¸­</li>\n<li>å¯ä»¥çœ‹åˆ°å†™åˆ° etcd ç”¨çš„æ˜¯ <code>clientv3.OpPut(key, value)</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ kv è¦æ‰§è¡Œ put æ“ä½œ</li>\n<li>ä¹‹å‰çš„ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1617\">go WatchWorkerEvent</a> ä¸­å°±ç›‘å¬åˆ°æœ‰äº‹ä»¶æ¥äº†ï¼Œå¹¶ä¸”åˆ¤æ–­å…¶ä¸º <code>mvccpb.PUT</code><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L224\"> ç±»å‹</a>ï¼Œevent å¤„ç†ä¹‹åä¼šé€šè¿‡ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L242\">outCh</a> ä¼ åˆ° handleWorkerEv ä¸­è¿›è¡Œå…·ä½“çš„<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1582\">ä¸Šçº¿å¤„ç†</a></li>\n<li>åˆšä¸Šçº¿çš„æ—¶å€™ï¼Œå°±ä¼šå»å„ç§æ‰¾ source å» boundï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¿˜æ²¡æœ‰ create sourceï¼Œæ‰€ä»¥ä¹Ÿæ‰¾ä¸åˆ° sourceï¼Œæš‚æ—¶å¯ä»¥ä¸å…³æ³¨è¿™é‡Œ</li>\n</ol>\n</li>\n<li><p>Start task è¿˜éœ€è¦ bound sourceï¼Œé‚£ worker é¦–å…ˆè¦åšçš„å°±æ˜¯ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L169\">observeSourceBound</a>ï¼Œè¿™é‡ŒåŒ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L243\">observeWorkerEvent</a> æ˜¯ç±»ä¼¼çš„ï¼š</p>\n<ol>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L404\">go WatchSourceBound</a>ï¼šé€šè¿‡ etcd client ç›‘å¬<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/bound.go#L265\">æ˜¯å¦æœ‰ sourceBound å‡ºç°</a></li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L406\">handleSourceBound</a>ï¼šä¸Šé¢ç›‘å¬åˆ°äº†ä¹‹åï¼Œåˆ™ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L582\">operateSourceBound</a></li>\n</ol>\n</li>\n<li><p>æ¥ä¸‹æ¥ï¼Œdm-worker ç­‰å¾… source bound</p>\n</li>\n</ol>\n<h1 id=\"å››ã€operate-source-create\"><a href=\"#å››ã€operate-source-create\" class=\"headerlink\" title=\"å››ã€operate-source create\"></a>å››ã€operate-source create</h1><blockquote>\n<p>DM ç”¨çš„å‘½ä»¤è¡Œå·¥å…·æ˜¯ <a href=\"https://github.com/spf13/cobra\">cobra</a>ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯æ·±å…¥äº†è§£ä¸€ä¸‹</p>\n</blockquote>\n<ol>\n<li><p>å‘½ä»¤è¡Œæ‰§è¡Œ <a href=\"https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L34\">operate-source create</a>ï¼ˆin <a href=\"https://github.com/pingcap/dm/blob/master/tests/_utils/test_prepare#L128-L136\">test_prepare</a>ï¼‰ï¼Œ<code>operate-source</code> è¿™ä¸ªå‘½ä»¤åœ¨ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/ctl.go#L68\">NewOperateSourceCmd</a> æ³¨å†Œï¼Œå…·ä½“å®ç°åœ¨ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L39\">operateSourceFunc</a></p>\n</li>\n<li><p>è¯»å–åˆ°è¯¥å‘½ä»¤åï¼Œå¼€å§‹<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L89\">è§£æ</a>ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå³ <code>create</code>ï¼‰å¹¶<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L47-L48\">è½¬æ¢</a>ï¼Œæœ€åè¢«<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L143-L152\">æ‰“åŒ…é€</a>åˆ° masterï¼Œå¼€å§‹æ‰§è¡Œ master çš„ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1186\">OperateSource</a> å‡½æ•°</p>\n</li>\n<li><p>è¯¥å‡½æ•°ä¸­ï¼Œmaster ä¼šä»å‘½ä»¤è¡Œä¸­ç»™å‡ºçš„é…ç½®æ–‡ä»¶è·¯å¾„</p>\n<ol>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1205\">è§£æå¹¶è°ƒæ•´</a> source config</li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1227\">æŠŠ source cfg ä¹Ÿå­˜åˆ° etcd é‡Œ</a>ï¼Œå› ä¸º worker å¾…ä¼šè¦ç”¨</li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L318-L319\">Try to bound it to a free worker</a>ï¼šå› ä¸ºæˆ‘ä»¬æ˜¯ç¬¬ä¸€æ¬¡ start taskï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å¼€å¯ relay åŠŸèƒ½ï¼ˆ<a href=\"https://github.com/pingcap/dm/blob/master/tests/start_task/conf/source1.yaml#L4\">test</a> ä¸­æ˜¯å¼€å¯äº†ï¼Œä½†æœ¬ç¯‡æ–‡ç« å‡è®¾ä¸å¼€å¯ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åªèƒ½ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1904-L1915\">bound a free worker</a> äº†ã€‚</li>\n<li>æœ€ç»ˆï¼Œé€šè¿‡ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1936\">PutSourceBound</a>ï¼ŒæŠŠ SourceBound <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/bound.go#L100\">é€šè¿‡ etcd client å‘é€</a></li>\n</ol>\n</li>\n<li><p>å‘é€ä¹‹åï¼Œworker å°±é€šè¿‡ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L404\">go WatchSourceBound</a> ç›‘å¬åˆ°æœ‰ SourceBound å‡ºç°ï¼Œç„¶åè¿›è¡Œ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L582\">operateSourceBound</a></p>\n<ol>\n<li>é¦–å…ˆéœ€è¦<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L649\">æ‹¿åˆ° source cfg</a>ï¼Œå› ä¸ºä¸Šé¢çš„æ“ä½œéƒ½æ˜¯åœ¨ master æ‰§è¡Œçš„ï¼Œworker è¿™é‡Œå¹¶æ²¡æœ‰ source cfg</li>\n<li>Source cfg ä¹Ÿæ˜¯é€šè¿‡ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/source.go#L83\">etcd</a> æ‹¿åˆ°çš„ï¼Œæ­£å¥½ä¸Šé¢å­˜äº†</li>\n</ol>\n</li>\n<li><p>ä¹‹åå°±å¯ä»¥<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L658\">å¼€å§‹ subtask äº†å§</a>ï¼</p>\n<ol>\n<li>ä½†æ˜¯å¹¶æ²¡æœ‰ã€‚ã€‚ã€‚æˆ‘ä»¬è¿˜æ²¡å¼€å§‹ start task å‘¢ï¼</li>\n<li>æ‰€ä»¥ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L396\">fetchSubTasksAndAdjust</a> å¹¶ä¸èƒ½æ‹¿åˆ° subtaskã€‚æ‹¿åˆ°æ˜¯ç©ºçš„</li>\n</ol>\n</li>\n<li><p>é‚£æ²¡åŠæ³•äº†ï¼Œç»§ç»­<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L422\">ç­‰</a>å‘—ï¼ˆåˆæ˜¯åŒæ ·çš„ watch/handle æœºåˆ¶ï¼‰</p>\n<ol>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L638\">go WatchSubTaskStage</a></li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L640\">handleSubTaskStage</a></li>\n</ol>\n</li>\n</ol>\n<h1 id=\"äº”ã€start-task\"><a href=\"#äº”ã€start-task\" class=\"headerlink\" title=\"äº”ã€start-task\"></a>äº”ã€start-task</h1><ol>\n<li><p>å‘½ä»¤è¡Œæ‰§è¡Œ <a href=\"https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L36\">start-task</a>ï¼ˆin <a href=\"https://github.com/pingcap/dm/blob/master/tests/_utils/test_prepare#L53-L64\">test_prepare</a>ï¼‰ï¼Œ<code>start-task</code> å‘½ä»¤çš„æ³¨å†Œå’Œå®ç°å‚è€ƒ <code>operate-source</code>ï¼Œæœ€åæ‰§è¡Œ master çš„ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L404\">StartTask</a> å‡½æ•°</p>\n</li>\n<li><p>ç›´æ¥å¼€å§‹å°± <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L426\">generateSubTask</a>ï¼ˆ<code>req.Task</code> ç›´æ¥ä¼ é€’çš„å°±æ˜¯è§£æå¥½çš„ <code>task.yaml</code> å­—ç¬¦ä¸²ï¼ŒåŸæ¥åœ¨å‘½ä»¤çš„å®ç°ä¸­å°±å¸®æˆ‘ä»¬è§£æå¥½å•¦ï¼‰ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯ç»è¿‡ä¸€äº› adjust å’Œ checkï¼Œ å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆäº† <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/config/subtask.go#L184\">SubTask</a> struct</p>\n</li>\n<li><p>é‡ç‚¹æ¥äº†ï¼Œ<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L489\">AddSubTasks</a> -&gt; <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L727\">NewSubTaskStage</a>ï¼ŒsubTask ç»ˆäºåˆ›å»ºå¥½äº†ï¼Œstage=runningï¼›å† <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L739\">put</a> è¿› etcdï¼Œå®Œç¾ã€‚å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆ†åˆ«æŠŠ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/ops.go#L91\">SubTaskCfg</a> å’Œ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/ops.go#L95\">SubTaskStage</a> éƒ½ put è¿› etcd äº†ã€‚</p>\n</li>\n<li><p>é‚£ä¸Šé¢å°± watch åˆ° stage æ¥äº†ï¼Œå¯¹ SubTaskCfg è¿›è¡Œ<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L682\">å¤„ç†</a>ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯è¦è¿›è¡Œ run çš„æ“ä½œï¼Œæˆ‘ä»¬è¿˜å¾—<a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L735-L743\">å…ˆæŠŠ cfg æ‹¿å‡ºæ¥</a>ï¼Œæœ€å <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L716\">startSubTask</a></p>\n</li>\n<li><p>startSubTask ä¸­ï¼Œä¼š <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L481\">NewSubTask</a>ï¼Œå† <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L504\">runSubTask</a>ã€‚subTask å†…éƒ¨å…·ä½“çš„æ‰§è¡Œç»„å»ºæ˜¯ç”± <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/unit/unit.go#L32-L67\">unit</a> è´Ÿè´£çš„ï¼Œæ‰€ä»¥å®ƒä¼š</p>\n<ol>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L200\">initUnits</a></li>\n<li><a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L207\">st.run</a> å…¶å®ä¹Ÿæ˜¯ç”± <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L228\">currentUnit</a> æ¥ <a href=\"https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L233\">Process</a></li>\n</ol>\n</li>\n</ol>\n<h1 id=\"å…­ã€ç»“è¯­\"><a href=\"#å…­ã€ç»“è¯­\" class=\"headerlink\" title=\"å…­ã€ç»“è¯­\"></a>å…­ã€ç»“è¯­</h1><p>åœ¨ unit Process åï¼Œstart-task å°±ç»“æŸå•¦ï¼æ˜¯ä¸æ˜¯è¿˜æ„çŠ¹æœªå°½å‘¢ï¼Ÿåˆ°åº•æœ‰å“ªäº› unit å‘¢ï¼Ÿè¿™äº› unit å†…éƒ¨åˆ°åº•æ˜¯æ€ä¹ˆ Process çš„å‘¢ï¼Ÿåœ¨åç»­çš„æ–‡ç« ä¸­ä¼šé™†ç»­å’Œå¤§å®¶è§é¢å“¦ã€‚</p>\n<p>å…¶å®å†å¤è¯»ä¸€ä¸‹å…¨æ–‡ï¼Œæˆ‘ä»¬å‘ç°æœ¬ç¯‡æ–‡ç« å¹¶æ²¡æœ‰å¤ªå¤šå¾ˆéš¾çš„ä¸œè¥¿ï¼Œå¤§éƒ¨åˆ†ç¯‡å¹…éƒ½åœ¨æè¿°ä¸€äº›ã€Œå‡†å¤‡æ´»åŠ¨ã€ï¼Œå…¨ç¨‹ç”¨ etcd watchâ€”â€”master ç­‰å¾… worker åˆ°æ¥ã€worker ç­‰å¾… source åˆ°æ¥ã€source-worker ç­‰å¾… subtask åˆ°æ¥ã€‚ç­‰å°±å®Œäº‹äº†ã€‚</p>\n<p>ä»»ä½•å»ºè®®å’Œåé¦ˆéƒ½æ¬¢è¿å‘Šè¯‰æˆ‘ã€‚ä¸‹æœŸå†è§ï¼</p>\n"},{"title":"DM æ•°æ®æ—…ç¨‹ 02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”02Lock -> Resolve Lock","date":"2023-01-02T19:58:33.000Z","top_img":"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283666.png","cover":"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283666.png","_content":"\n# ä¸€ã€æ¦‚è¿°\n\nä»‹ç»äº†ä¸æ‚²è§‚åè°ƒæœ‰å…³çš„å„ä¸ªæ•°æ®ç»“æ„ä¹‹åï¼Œæ¥ä¸‹æ¥å°†ä»‹ç»ä¸€ä¸ª DM ç³»ç»Ÿä»æ¥å—åˆ°ç¬¬ä¸€æ¡åˆ†è¡¨ DDL å¼€å§‹ï¼Œåˆ°æ‰€æœ‰è¯¥ DDL å¯¹åº”çš„ Lock resolved çš„å…¨è¿‡ç¨‹ã€‚\n\n> æœ¬èŠ‚å†…å®¹çš†å‚è€ƒ [DM v6.0](https://github.com/pingcap/tiflow/tree/release-6.0)ï¼Œå¯¹ç°åœ¨è€Œè¨€ï¼Œæœ‰å¯èƒ½å·²è¿‡æ—¶ï¼Œæ¬¢è¿å¤§å®¶æå‡ºæ„è§ï½\n\n# äºŒã€Overview\n\nå‡è®¾ç°åœ¨èµ·äº† master å’Œä¸¤ä¸ª Workerï¼Œä¸¤ä¸ª Worker åˆ†åˆ«ç»‘å®šä¸¤ä¸ª Sourceï¼ˆs1ï¼Œs2ï¼‰ï¼Œæ¯ä¸ª Source æœ‰ä¸¤ä¸ªåˆ†è¡¨ï¼ˆt1ï¼Œt2ï¼‰ï¼Œè¿™å››ä¸ªè¡¨ä¼š route åˆ°ä¸€ä¸ª target tableï¼ˆtarTblï¼‰ä¸­ã€‚åœ¨ DDL åˆ°æ¥ä¹‹å‰ï¼Œä¸¤ä¸ª worker ä¼šåˆ›å»ºå¥½ ShardingGroupKeeperï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ª target tableï¼Œä¸¤ä¸ª source tableã€‚\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283187.png)\n\nä¸¤ä¸ª Worker å…ˆåæ”¶åˆ°ä¸¤ä¸ª Source å››ä¸ªåˆ†è¡¨çš„åŒä¸€æ¡ DDLï¼Œè¡¨ç¤ºä¸ºï¼š\n\n- DDL1ï¼šè¡¨ç¤ºå¯¹ s1.t1 çš„ DDLã€‚\n- DDL2ï¼šè¡¨ç¤ºå¯¹ s2.t1 çš„ DDLã€‚\n- DDL3ï¼šè¡¨ç¤ºå¯¹ s1.t2 çš„ DDLã€‚\n- DDL4ï¼šè¡¨ç¤ºå¯¹ s2.t2 çš„ DDLã€‚\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283666.png)\n\n# ä¸‰ã€å…·ä½“è¿‡ç¨‹\n\n> æœ¬å°èŠ‚ worker å¯¹ DDL çš„å¤„ç†ä» [handleQueryEventPessimistic](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2853) å¼€å§‹ï¼Œå¦‚æœä¸çŸ¥é“åœ¨æ­¤ä¹‹å‰çš„ DDL åšè¿‡å“ªäº›å¤„ç†ï¼Œè¯·æœŸå¾…åç»­æ–‡ç« ğŸ˜\n\næ¥ä¸‹æ¥å°†å¯¹ä¸Šå›¾ä¸­çš„æ­¥éª¤ä¸€ä¸€ä»‹ç»\n\n## Step 1\n\n1. worker1 æ”¶åˆ°æ¥è‡ª source1 çš„ DDL1ï¼Œä¼šç›´æ¥ [TrySync](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883)ï¼Œè¿™é‡Œè¿”å›äº†ä¸€å¤§å †çš„å‚æ•°ï¼Œå…¶å®æœ‰ç”¨çš„å°±åªæ˜¯ `synced`ï¼Œç®€å•æ¥è¯´ï¼Œé‡Œé¢åªåšäº†ä¸€ä»¶äº‹ï¼š[AddItem](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding_group.go#L215)ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹ TrySync\n\n> æœ¬èŠ‚ï¼Œå‡è®¾è¯¥ DDL ä¸æ˜¯ CreateTableStmtï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæ¯æ¬¡éƒ½æ˜¯ remain <=0ï¼Œsynced = trueï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€æ¬¡å‘é€è¯¥ create table çš„ worker ä¼š syncDDLã€‚\n\n### TrySync\n\næƒ³è¦çŸ¥é“ worker åœ¨æ‚²è§‚åè°ƒçš„æ—¶å€™åšäº†ä»€ä¹ˆï¼Œå¿…é¡»è¦ææ‡‚ TrySync æ˜¯æ€ä¹ˆè¿ä½œçš„ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥é‡æ–°ç†è§£ä¸€ä¸‹ ShardingGroupKeeperï¼š\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283187.png)\n\nå•ç‹¬æ‹¿å‡ºä¸€ä¸ª ShardingGroup ä¸¾ä¾‹ï¼ˆé¢œè‰²ä»£è¡¨ DDL çš„ç§ç±»ï¼‰ï¼š\n\n#### Example\n\nworker æ”¶åˆ°äº†ä»¥ä¸‹ DDL\n\n- ä¾æ¬¡æ”¶åˆ°äº† table1 æ©™è‰²ã€é»„è‰²ã€ç»¿è‰²ä¸‰æ¡ DDL\n- æ”¶åˆ°äº† table2 æ©™è‰²\n- è¿™ä¸ªæ—¶å€™ `activeIdx = 0`ï¼Œ`remain = 1`ï¼Œå› ä¸ºåªæœ‰ table3 æ²¡æœ‰æ”¶åˆ° active DDL äº†\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283679.png)\n\n- å¦‚æœåœ¨è¿™ä¸ªæ—¶å€™æ”¶åˆ°äº† table3 æ©™è‰² DDLï¼Œ`remain = 0`ï¼Œå¤„ç†äº†è¿™æ¡ DDL ä¹‹åï¼Œ`active ++`\n\n![image.png](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/image-1672713793518.png)\n\n- å¦‚æœè¿™ä¸ªæ—¶å€™æ”¶åˆ° table2 ç»¿è‰² DDLï¼Œåˆ™ä¼š[æŠ¥é”™](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L197-L199)ï¼Œæ‚²è§‚åè°ƒè¦æ±‚åŒä¸€ä¸ª source table ä¸­ DDL å¿…é¡»æœ‰åº\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283186.png)\n\n- å¦‚æœ group ä¸­æ‰€æœ‰çš„ DDL éƒ½ resolved äº†ã€‚åˆ™ä¼š[é‡ç½®](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L243-L246)ä¸€ä¸‹ meta\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283692.png)\n\næ€»ç»“ï¼š[AddItem](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding_group.go#L215) å°±æ˜¯ä¸Šé¢å›¾ä¸­æŠŠ DDLItem æ”¾è¿› ShardingSequence çš„è¿‡ç¨‹\n\n## Step 2 ä¸ Step 1 ç›¸åŒ\n\n## Step 3\n\nç”±äº tarTbl åªæœ‰ä¸¤ä¸ª source tableï¼šs1.t1 å’Œ s1.t2ï¼Œè¿™æ—¶ [TrySync](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883) åï¼Œ[synced = true](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2948)ï¼Œè¯´æ˜è¯¥ worker ready\n\n## Step 4\n\n### worker1\n\n- [PutInfo](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2985)ï¼šå‘é€ ready info ç»™ masterï¼ˆåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸ªå‡½æ•°ï¼‰\n- ä¹‹åä¼šè¢«é˜»å¡ï¼Œ[ç­‰å¾… master å‘é€ operation](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2992)ã€‚\n\n### Master\n\n- [watchInfoPut](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L177)ï¼šæˆåŠŸç›‘å¬åˆ°äº†\n- handleInfoPutï¼šmaster ä¹Ÿå¼€å§‹ [TrySync](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L474)ï¼Œmaster çš„ TrySync ç›¸æ¯” worker ä¸­çš„è¦ç®€å•å¾ˆå¤šï¼Œæ¯ä¸€ä¸ª Info ç›´æ¥ç›¸å½“äºè¯¥ source/worker å·² readyï¼Œæ‰€ä»¥ç›´æ¥ç»Ÿè®¡æ˜¯å¦æ‰€æœ‰ ready å³å¯\n- ç”±äºè¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ª worker å‘ info ç»™ masterï¼Œæ‰€ä»¥éœ€è¦[æ–°å»º Lock](https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/keeper.go#L49)ï¼Œæ–°å»º Lock è¿‡ç¨‹ä¸­ä¼šè·å–è¯¥ task æ‰€æœ‰çš„ sourceï¼Œå¹¶å­˜åˆ° lock ä¸­ï¼Œè¿™æ ·å°±çŸ¥é“è¿˜æœ‰å¤šå°‘ source æ²¡ readyã€‚æ˜¾ç„¶è¿˜æœ‰ source2 æ²¡ readyã€‚\n- [ç»§ç»­ç­‰å¾…](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L481-L485)\n\n## Step 5 ä¸ Step 3 ç›¸åŒ\n\n## Step 6\n\n- å‰é¢ä¸ Step 4 ç›¸åŒï¼Œä½†æ˜¯è¿™æ—¶æ‰€æœ‰ source éƒ½ ready äº†ï¼Œ[synced = true](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L486)\n\n## Step 7\n\n### master\n\n- [putOpForOwner](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L599)ï¼šå‘é€ [exec](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L604) operation to owner(worker1)\n\n### Worker1\n\n- [å¾—åˆ° master çš„ exec operation](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/shardddl/pessimist.go#L120-L124)\n\n- [NewDDLJob](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L3042-L3043) å¹¶ handle\n\n- [addJob](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1057)ï¼šå‘é€ job ç»™ DDLJobCh\n\n- syncDDLï¼šä¹‹å‰ worker èµ·çš„åç¨‹æ¥å—åˆ°è¯¥ job\n\n  - [æ‹¿åˆ°åˆšåˆšå¾—åˆ°çš„ operation](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1324)ï¼Œå¹¶ä¸”ä¸ä¼šè¢«è·³è¿‡ï¼Œå› ä¸º ignore = false\n\n## Step 8\n\n- [åŒæ­¥åˆ°ä¸‹æ¸¸](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1344)\n\n## Step 9\n\n### Worker1\n\n- [DoneOperationDeleteInfo](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1384)ï¼šå‘é€ done operation ç»™ master å¹¶åˆ é™¤ info\n\n## Step 10\n\n### Master\n\n- [æ¥å— done operation](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L509)\n- [markDone](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L529)\n- [putOpsForNonOwner](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L553)ï¼šç»™å…¶ä»–æ‰€æœ‰ non-owner å‘é€ skip infoï¼ˆskip done æ˜¯ä¸ºäº†é˜²æ­¢æŠŠ done è¦†ç›–æ‰ï¼‰\n\n### Worker2\n\n- æ¥å—åˆ°äº† no exec(skip) çš„ operationï¼Œå’Œ Step 7 ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨ syncDDL çš„æ—¶å€™ä¼š[è¢« skip](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1325-L1328)\n\n## Step 11 å’Œ Step 9 ç›¸åŒ\n\n# å››ã€æ€»ç»“\n\næœ¬èŠ‚ä»‹ç»äº†åœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ç¬¬ä¸€æ¡ DDL è¯­å¥ï¼Œç”Ÿæˆ Lockï¼Œåˆ°æ”¶åˆ°æ‰€æœ‰ DDL è¯­å¥ï¼ŒLock è§£é™¤çš„è¿‡ç¨‹ã€‚\n\nç»è¿‡æœ¬èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»å®Œå…¨å­¦ä¼šäº† DM æ‚²è§‚åè°ƒçš„è¿‡ç¨‹ã€‚æ˜¯ä¸æ˜¯ä¹Ÿæ²¡é‚£ä¹ˆå¤æ‚ğŸ˜ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªçŸ¥é“ DDL çš„å¤„ç†æ–¹å¼ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­çš„ DML ä¼šæ€ä¹ˆåŠå‘¢ï¼Ÿä¸‹ä¸€ç« æ­æ™“ã€‚\n\n# äº”ã€ç–‘ä¼¼ bug\n\n1. [initShardingGroups](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L552-L559) ä¸­å¯¹ ShardingGroup.sources è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œè¿™é‡ŒåŒ…å«äº†è¯¥ targetTable å¯¹åº”çš„æ‰€æœ‰ sourceTables\n2. åœ¨ [TrySync](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883) çš„æ—¶å€™ï¼Œå´ä½¿ç”¨ç¬¬ä¸€ä¸ª `sourceTable[0]`ï¼Œæ¥æ ‡è®°æ‰€æœ‰çš„ `DDL[]`ï¼Œå¦‚æœ `len(DDL[]) != 1`ï¼Œåˆ™ remain æ°¸è¿œä¸å¯èƒ½ä¸º 0ã€‚å› ä¸º sourceTables æ¥æºäº ddlInfoã€‚è€Œ DDLInfo åªå­˜äº†[ç¬¬ä¸€æ¡ ddl çš„ ddlInfo](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2738-L2743)ï¼Œå®é™…ä¸Šå¯¹äºæ¯ä¸€ä¸ª Split ä¹‹åçš„ DDLï¼Œéƒ½ä¼š [genDDLInfo](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2694)ã€‚\n3. ä½†æ˜¯å¥‡æ€ªçš„æ˜¯ï¼Œä»£ç ä¸­æ ‡æ³¨äº†[ä¸æ”¯æŒ multi-table DDL](http://ErrSyncerUnitDDLOnMultipleTable)ï¼Œè¿™ä¸ª error åœ¨ pessimist/optimist mode ä¸­éƒ½ç”¨åˆ°äº†ã€‚ä½†æ˜¯åœ¨ç°åœ¨çœ‹ pessimist ä»£ç ä¸­ï¼Œåˆçœ‹åˆ°å…¶ä¸º multi-table DDL å®ç°äº†éƒ¨åˆ†ç›¸å…³é€»è¾‘ã€‚ã€‚ã€‚**æœ‰æ¯’**\n4. æ¯”å¦‚ï¼š\n\n- https\\://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2957-L2960\n- https\\://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L35\n- ã€‚ã€‚ã€‚\n\n","source":"_posts/DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”02Lock-Resolve-Lock.md","raw":"---\ntitle: DM æ•°æ®æ—…ç¨‹ 02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”02Lock -> Resolve Lock\ndate: 2023-01-03 03:58:33\ntags:\n- DM\n- æºç é˜…è¯»\ncategories:\n- DM æ•°æ®æ—…ç¨‹\ntop_img: https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283666.png\ncover: https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283666.png\n---\n\n# ä¸€ã€æ¦‚è¿°\n\nä»‹ç»äº†ä¸æ‚²è§‚åè°ƒæœ‰å…³çš„å„ä¸ªæ•°æ®ç»“æ„ä¹‹åï¼Œæ¥ä¸‹æ¥å°†ä»‹ç»ä¸€ä¸ª DM ç³»ç»Ÿä»æ¥å—åˆ°ç¬¬ä¸€æ¡åˆ†è¡¨ DDL å¼€å§‹ï¼Œåˆ°æ‰€æœ‰è¯¥ DDL å¯¹åº”çš„ Lock resolved çš„å…¨è¿‡ç¨‹ã€‚\n\n> æœ¬èŠ‚å†…å®¹çš†å‚è€ƒ [DM v6.0](https://github.com/pingcap/tiflow/tree/release-6.0)ï¼Œå¯¹ç°åœ¨è€Œè¨€ï¼Œæœ‰å¯èƒ½å·²è¿‡æ—¶ï¼Œæ¬¢è¿å¤§å®¶æå‡ºæ„è§ï½\n\n# äºŒã€Overview\n\nå‡è®¾ç°åœ¨èµ·äº† master å’Œä¸¤ä¸ª Workerï¼Œä¸¤ä¸ª Worker åˆ†åˆ«ç»‘å®šä¸¤ä¸ª Sourceï¼ˆs1ï¼Œs2ï¼‰ï¼Œæ¯ä¸ª Source æœ‰ä¸¤ä¸ªåˆ†è¡¨ï¼ˆt1ï¼Œt2ï¼‰ï¼Œè¿™å››ä¸ªè¡¨ä¼š route åˆ°ä¸€ä¸ª target tableï¼ˆtarTblï¼‰ä¸­ã€‚åœ¨ DDL åˆ°æ¥ä¹‹å‰ï¼Œä¸¤ä¸ª worker ä¼šåˆ›å»ºå¥½ ShardingGroupKeeperï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ª target tableï¼Œä¸¤ä¸ª source tableã€‚\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283187.png)\n\nä¸¤ä¸ª Worker å…ˆåæ”¶åˆ°ä¸¤ä¸ª Source å››ä¸ªåˆ†è¡¨çš„åŒä¸€æ¡ DDLï¼Œè¡¨ç¤ºä¸ºï¼š\n\n- DDL1ï¼šè¡¨ç¤ºå¯¹ s1.t1 çš„ DDLã€‚\n- DDL2ï¼šè¡¨ç¤ºå¯¹ s2.t1 çš„ DDLã€‚\n- DDL3ï¼šè¡¨ç¤ºå¯¹ s1.t2 çš„ DDLã€‚\n- DDL4ï¼šè¡¨ç¤ºå¯¹ s2.t2 çš„ DDLã€‚\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283666.png)\n\n# ä¸‰ã€å…·ä½“è¿‡ç¨‹\n\n> æœ¬å°èŠ‚ worker å¯¹ DDL çš„å¤„ç†ä» [handleQueryEventPessimistic](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2853) å¼€å§‹ï¼Œå¦‚æœä¸çŸ¥é“åœ¨æ­¤ä¹‹å‰çš„ DDL åšè¿‡å“ªäº›å¤„ç†ï¼Œè¯·æœŸå¾…åç»­æ–‡ç« ğŸ˜\n\næ¥ä¸‹æ¥å°†å¯¹ä¸Šå›¾ä¸­çš„æ­¥éª¤ä¸€ä¸€ä»‹ç»\n\n## Step 1\n\n1. worker1 æ”¶åˆ°æ¥è‡ª source1 çš„ DDL1ï¼Œä¼šç›´æ¥ [TrySync](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883)ï¼Œè¿™é‡Œè¿”å›äº†ä¸€å¤§å †çš„å‚æ•°ï¼Œå…¶å®æœ‰ç”¨çš„å°±åªæ˜¯ `synced`ï¼Œç®€å•æ¥è¯´ï¼Œé‡Œé¢åªåšäº†ä¸€ä»¶äº‹ï¼š[AddItem](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding_group.go#L215)ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹ TrySync\n\n> æœ¬èŠ‚ï¼Œå‡è®¾è¯¥ DDL ä¸æ˜¯ CreateTableStmtï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæ¯æ¬¡éƒ½æ˜¯ remain <=0ï¼Œsynced = trueï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€æ¬¡å‘é€è¯¥ create table çš„ worker ä¼š syncDDLã€‚\n\n### TrySync\n\næƒ³è¦çŸ¥é“ worker åœ¨æ‚²è§‚åè°ƒçš„æ—¶å€™åšäº†ä»€ä¹ˆï¼Œå¿…é¡»è¦ææ‡‚ TrySync æ˜¯æ€ä¹ˆè¿ä½œçš„ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥é‡æ–°ç†è§£ä¸€ä¸‹ ShardingGroupKeeperï¼š\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283187.png)\n\nå•ç‹¬æ‹¿å‡ºä¸€ä¸ª ShardingGroup ä¸¾ä¾‹ï¼ˆé¢œè‰²ä»£è¡¨ DDL çš„ç§ç±»ï¼‰ï¼š\n\n#### Example\n\nworker æ”¶åˆ°äº†ä»¥ä¸‹ DDL\n\n- ä¾æ¬¡æ”¶åˆ°äº† table1 æ©™è‰²ã€é»„è‰²ã€ç»¿è‰²ä¸‰æ¡ DDL\n- æ”¶åˆ°äº† table2 æ©™è‰²\n- è¿™ä¸ªæ—¶å€™ `activeIdx = 0`ï¼Œ`remain = 1`ï¼Œå› ä¸ºåªæœ‰ table3 æ²¡æœ‰æ”¶åˆ° active DDL äº†\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283679.png)\n\n- å¦‚æœåœ¨è¿™ä¸ªæ—¶å€™æ”¶åˆ°äº† table3 æ©™è‰² DDLï¼Œ`remain = 0`ï¼Œå¤„ç†äº†è¿™æ¡ DDL ä¹‹åï¼Œ`active ++`\n\n![image.png](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/image-1672713793518.png)\n\n- å¦‚æœè¿™ä¸ªæ—¶å€™æ”¶åˆ° table2 ç»¿è‰² DDLï¼Œåˆ™ä¼š[æŠ¥é”™](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L197-L199)ï¼Œæ‚²è§‚åè°ƒè¦æ±‚åŒä¸€ä¸ª source table ä¸­ DDL å¿…é¡»æœ‰åº\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283186.png)\n\n- å¦‚æœ group ä¸­æ‰€æœ‰çš„ DDL éƒ½ resolved äº†ã€‚åˆ™ä¼š[é‡ç½®](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L243-L246)ä¸€ä¸‹ meta\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283692.png)\n\næ€»ç»“ï¼š[AddItem](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding_group.go#L215) å°±æ˜¯ä¸Šé¢å›¾ä¸­æŠŠ DDLItem æ”¾è¿› ShardingSequence çš„è¿‡ç¨‹\n\n## Step 2 ä¸ Step 1 ç›¸åŒ\n\n## Step 3\n\nç”±äº tarTbl åªæœ‰ä¸¤ä¸ª source tableï¼šs1.t1 å’Œ s1.t2ï¼Œè¿™æ—¶ [TrySync](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883) åï¼Œ[synced = true](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2948)ï¼Œè¯´æ˜è¯¥ worker ready\n\n## Step 4\n\n### worker1\n\n- [PutInfo](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2985)ï¼šå‘é€ ready info ç»™ masterï¼ˆåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸ªå‡½æ•°ï¼‰\n- ä¹‹åä¼šè¢«é˜»å¡ï¼Œ[ç­‰å¾… master å‘é€ operation](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2992)ã€‚\n\n### Master\n\n- [watchInfoPut](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L177)ï¼šæˆåŠŸç›‘å¬åˆ°äº†\n- handleInfoPutï¼šmaster ä¹Ÿå¼€å§‹ [TrySync](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L474)ï¼Œmaster çš„ TrySync ç›¸æ¯” worker ä¸­çš„è¦ç®€å•å¾ˆå¤šï¼Œæ¯ä¸€ä¸ª Info ç›´æ¥ç›¸å½“äºè¯¥ source/worker å·² readyï¼Œæ‰€ä»¥ç›´æ¥ç»Ÿè®¡æ˜¯å¦æ‰€æœ‰ ready å³å¯\n- ç”±äºè¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ª worker å‘ info ç»™ masterï¼Œæ‰€ä»¥éœ€è¦[æ–°å»º Lock](https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/keeper.go#L49)ï¼Œæ–°å»º Lock è¿‡ç¨‹ä¸­ä¼šè·å–è¯¥ task æ‰€æœ‰çš„ sourceï¼Œå¹¶å­˜åˆ° lock ä¸­ï¼Œè¿™æ ·å°±çŸ¥é“è¿˜æœ‰å¤šå°‘ source æ²¡ readyã€‚æ˜¾ç„¶è¿˜æœ‰ source2 æ²¡ readyã€‚\n- [ç»§ç»­ç­‰å¾…](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L481-L485)\n\n## Step 5 ä¸ Step 3 ç›¸åŒ\n\n## Step 6\n\n- å‰é¢ä¸ Step 4 ç›¸åŒï¼Œä½†æ˜¯è¿™æ—¶æ‰€æœ‰ source éƒ½ ready äº†ï¼Œ[synced = true](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L486)\n\n## Step 7\n\n### master\n\n- [putOpForOwner](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L599)ï¼šå‘é€ [exec](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L604) operation to owner(worker1)\n\n### Worker1\n\n- [å¾—åˆ° master çš„ exec operation](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/shardddl/pessimist.go#L120-L124)\n\n- [NewDDLJob](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L3042-L3043) å¹¶ handle\n\n- [addJob](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1057)ï¼šå‘é€ job ç»™ DDLJobCh\n\n- syncDDLï¼šä¹‹å‰ worker èµ·çš„åç¨‹æ¥å—åˆ°è¯¥ job\n\n  - [æ‹¿åˆ°åˆšåˆšå¾—åˆ°çš„ operation](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1324)ï¼Œå¹¶ä¸”ä¸ä¼šè¢«è·³è¿‡ï¼Œå› ä¸º ignore = false\n\n## Step 8\n\n- [åŒæ­¥åˆ°ä¸‹æ¸¸](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1344)\n\n## Step 9\n\n### Worker1\n\n- [DoneOperationDeleteInfo](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1384)ï¼šå‘é€ done operation ç»™ master å¹¶åˆ é™¤ info\n\n## Step 10\n\n### Master\n\n- [æ¥å— done operation](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L509)\n- [markDone](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L529)\n- [putOpsForNonOwner](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L553)ï¼šç»™å…¶ä»–æ‰€æœ‰ non-owner å‘é€ skip infoï¼ˆskip done æ˜¯ä¸ºäº†é˜²æ­¢æŠŠ done è¦†ç›–æ‰ï¼‰\n\n### Worker2\n\n- æ¥å—åˆ°äº† no exec(skip) çš„ operationï¼Œå’Œ Step 7 ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨ syncDDL çš„æ—¶å€™ä¼š[è¢« skip](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1325-L1328)\n\n## Step 11 å’Œ Step 9 ç›¸åŒ\n\n# å››ã€æ€»ç»“\n\næœ¬èŠ‚ä»‹ç»äº†åœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ç¬¬ä¸€æ¡ DDL è¯­å¥ï¼Œç”Ÿæˆ Lockï¼Œåˆ°æ”¶åˆ°æ‰€æœ‰ DDL è¯­å¥ï¼ŒLock è§£é™¤çš„è¿‡ç¨‹ã€‚\n\nç»è¿‡æœ¬èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»å®Œå…¨å­¦ä¼šäº† DM æ‚²è§‚åè°ƒçš„è¿‡ç¨‹ã€‚æ˜¯ä¸æ˜¯ä¹Ÿæ²¡é‚£ä¹ˆå¤æ‚ğŸ˜ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªçŸ¥é“ DDL çš„å¤„ç†æ–¹å¼ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­çš„ DML ä¼šæ€ä¹ˆåŠå‘¢ï¼Ÿä¸‹ä¸€ç« æ­æ™“ã€‚\n\n# äº”ã€ç–‘ä¼¼ bug\n\n1. [initShardingGroups](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L552-L559) ä¸­å¯¹ ShardingGroup.sources è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œè¿™é‡ŒåŒ…å«äº†è¯¥ targetTable å¯¹åº”çš„æ‰€æœ‰ sourceTables\n2. åœ¨ [TrySync](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883) çš„æ—¶å€™ï¼Œå´ä½¿ç”¨ç¬¬ä¸€ä¸ª `sourceTable[0]`ï¼Œæ¥æ ‡è®°æ‰€æœ‰çš„ `DDL[]`ï¼Œå¦‚æœ `len(DDL[]) != 1`ï¼Œåˆ™ remain æ°¸è¿œä¸å¯èƒ½ä¸º 0ã€‚å› ä¸º sourceTables æ¥æºäº ddlInfoã€‚è€Œ DDLInfo åªå­˜äº†[ç¬¬ä¸€æ¡ ddl çš„ ddlInfo](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2738-L2743)ï¼Œå®é™…ä¸Šå¯¹äºæ¯ä¸€ä¸ª Split ä¹‹åçš„ DDLï¼Œéƒ½ä¼š [genDDLInfo](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2694)ã€‚\n3. ä½†æ˜¯å¥‡æ€ªçš„æ˜¯ï¼Œä»£ç ä¸­æ ‡æ³¨äº†[ä¸æ”¯æŒ multi-table DDL](http://ErrSyncerUnitDDLOnMultipleTable)ï¼Œè¿™ä¸ª error åœ¨ pessimist/optimist mode ä¸­éƒ½ç”¨åˆ°äº†ã€‚ä½†æ˜¯åœ¨ç°åœ¨çœ‹ pessimist ä»£ç ä¸­ï¼Œåˆçœ‹åˆ°å…¶ä¸º multi-table DDL å®ç°äº†éƒ¨åˆ†ç›¸å…³é€»è¾‘ã€‚ã€‚ã€‚**æœ‰æ¯’**\n4. æ¯”å¦‚ï¼š\n\n- https\\://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2957-L2960\n- https\\://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L35\n- ã€‚ã€‚ã€‚\n\n","slug":"DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”02Lock-Resolve-Lock","published":1,"updated":"2024-06-16T06:59:24.542Z","_id":"clxh0mtjx0000avdy7tdtf3iz","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"ä¸€ã€æ¦‚è¿°\"><a href=\"#ä¸€ã€æ¦‚è¿°\" class=\"headerlink\" title=\"ä¸€ã€æ¦‚è¿°\"></a>ä¸€ã€æ¦‚è¿°</h1><p>ä»‹ç»äº†ä¸æ‚²è§‚åè°ƒæœ‰å…³çš„å„ä¸ªæ•°æ®ç»“æ„ä¹‹åï¼Œæ¥ä¸‹æ¥å°†ä»‹ç»ä¸€ä¸ª DM ç³»ç»Ÿä»æ¥å—åˆ°ç¬¬ä¸€æ¡åˆ†è¡¨ DDL å¼€å§‹ï¼Œåˆ°æ‰€æœ‰è¯¥ DDL å¯¹åº”çš„ Lock resolved çš„å…¨è¿‡ç¨‹ã€‚</p>\n<blockquote>\n<p>æœ¬èŠ‚å†…å®¹çš†å‚è€ƒ <a href=\"https://github.com/pingcap/tiflow/tree/release-6.0\">DM v6.0</a>ï¼Œå¯¹ç°åœ¨è€Œè¨€ï¼Œæœ‰å¯èƒ½å·²è¿‡æ—¶ï¼Œæ¬¢è¿å¤§å®¶æå‡ºæ„è§ï½</p>\n</blockquote>\n<h1 id=\"äºŒã€Overview\"><a href=\"#äºŒã€Overview\" class=\"headerlink\" title=\"äºŒã€Overview\"></a>äºŒã€Overview</h1><p>å‡è®¾ç°åœ¨èµ·äº† master å’Œä¸¤ä¸ª Workerï¼Œä¸¤ä¸ª Worker åˆ†åˆ«ç»‘å®šä¸¤ä¸ª Sourceï¼ˆs1ï¼Œs2ï¼‰ï¼Œæ¯ä¸ª Source æœ‰ä¸¤ä¸ªåˆ†è¡¨ï¼ˆt1ï¼Œt2ï¼‰ï¼Œè¿™å››ä¸ªè¡¨ä¼š route åˆ°ä¸€ä¸ª target tableï¼ˆtarTblï¼‰ä¸­ã€‚åœ¨ DDL åˆ°æ¥ä¹‹å‰ï¼Œä¸¤ä¸ª worker ä¼šåˆ›å»ºå¥½ ShardingGroupKeeperï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ª target tableï¼Œä¸¤ä¸ª source tableã€‚</p>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283187.png\"></p>\n<p>ä¸¤ä¸ª Worker å…ˆåæ”¶åˆ°ä¸¤ä¸ª Source å››ä¸ªåˆ†è¡¨çš„åŒä¸€æ¡ DDLï¼Œè¡¨ç¤ºä¸ºï¼š</p>\n<ul>\n<li>DDL1ï¼šè¡¨ç¤ºå¯¹ s1.t1 çš„ DDLã€‚</li>\n<li>DDL2ï¼šè¡¨ç¤ºå¯¹ s2.t1 çš„ DDLã€‚</li>\n<li>DDL3ï¼šè¡¨ç¤ºå¯¹ s1.t2 çš„ DDLã€‚</li>\n<li>DDL4ï¼šè¡¨ç¤ºå¯¹ s2.t2 çš„ DDLã€‚</li>\n</ul>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283666.png\"></p>\n<h1 id=\"ä¸‰ã€å…·ä½“è¿‡ç¨‹\"><a href=\"#ä¸‰ã€å…·ä½“è¿‡ç¨‹\" class=\"headerlink\" title=\"ä¸‰ã€å…·ä½“è¿‡ç¨‹\"></a>ä¸‰ã€å…·ä½“è¿‡ç¨‹</h1><blockquote>\n<p>æœ¬å°èŠ‚ worker å¯¹ DDL çš„å¤„ç†ä» <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2853\">handleQueryEventPessimistic</a> å¼€å§‹ï¼Œå¦‚æœä¸çŸ¥é“åœ¨æ­¤ä¹‹å‰çš„ DDL åšè¿‡å“ªäº›å¤„ç†ï¼Œè¯·æœŸå¾…åç»­æ–‡ç« ğŸ˜</p>\n</blockquote>\n<p>æ¥ä¸‹æ¥å°†å¯¹ä¸Šå›¾ä¸­çš„æ­¥éª¤ä¸€ä¸€ä»‹ç»</p>\n<h2 id=\"Step-1\"><a href=\"#Step-1\" class=\"headerlink\" title=\"Step 1\"></a>Step 1</h2><ol>\n<li>worker1 æ”¶åˆ°æ¥è‡ª source1 çš„ DDL1ï¼Œä¼šç›´æ¥ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883\">TrySync</a>ï¼Œè¿™é‡Œè¿”å›äº†ä¸€å¤§å †çš„å‚æ•°ï¼Œå…¶å®æœ‰ç”¨çš„å°±åªæ˜¯ <code>synced</code>ï¼Œç®€å•æ¥è¯´ï¼Œé‡Œé¢åªåšäº†ä¸€ä»¶äº‹ï¼š<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding_group.go#L215\">AddItem</a>ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹ TrySync</li>\n</ol>\n<blockquote>\n<p>æœ¬èŠ‚ï¼Œå‡è®¾è¯¥ DDL ä¸æ˜¯ CreateTableStmtï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæ¯æ¬¡éƒ½æ˜¯ remain &lt;=0ï¼Œsynced = trueï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€æ¬¡å‘é€è¯¥ create table çš„ worker ä¼š syncDDLã€‚</p>\n</blockquote>\n<h3 id=\"TrySync\"><a href=\"#TrySync\" class=\"headerlink\" title=\"TrySync\"></a>TrySync</h3><p>æƒ³è¦çŸ¥é“ worker åœ¨æ‚²è§‚åè°ƒçš„æ—¶å€™åšäº†ä»€ä¹ˆï¼Œå¿…é¡»è¦ææ‡‚ TrySync æ˜¯æ€ä¹ˆè¿ä½œçš„ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥é‡æ–°ç†è§£ä¸€ä¸‹ ShardingGroupKeeperï¼š</p>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283187.png\"></p>\n<p>å•ç‹¬æ‹¿å‡ºä¸€ä¸ª ShardingGroup ä¸¾ä¾‹ï¼ˆé¢œè‰²ä»£è¡¨ DDL çš„ç§ç±»ï¼‰ï¼š</p>\n<h4 id=\"Example\"><a href=\"#Example\" class=\"headerlink\" title=\"Example\"></a>Example</h4><p>worker æ”¶åˆ°äº†ä»¥ä¸‹ DDL</p>\n<ul>\n<li>ä¾æ¬¡æ”¶åˆ°äº† table1 æ©™è‰²ã€é»„è‰²ã€ç»¿è‰²ä¸‰æ¡ DDL</li>\n<li>æ”¶åˆ°äº† table2 æ©™è‰²</li>\n<li>è¿™ä¸ªæ—¶å€™ <code>activeIdx = 0</code>ï¼Œ<code>remain = 1</code>ï¼Œå› ä¸ºåªæœ‰ table3 æ²¡æœ‰æ”¶åˆ° active DDL äº†</li>\n</ul>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283679.png\"></p>\n<ul>\n<li>å¦‚æœåœ¨è¿™ä¸ªæ—¶å€™æ”¶åˆ°äº† table3 æ©™è‰² DDLï¼Œ<code>remain = 0</code>ï¼Œå¤„ç†äº†è¿™æ¡ DDL ä¹‹åï¼Œ<code>active ++</code></li>\n</ul>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/image-1672713793518.png\" alt=\"image.png\"></p>\n<ul>\n<li>å¦‚æœè¿™ä¸ªæ—¶å€™æ”¶åˆ° table2 ç»¿è‰² DDLï¼Œåˆ™ä¼š<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L197-L199\">æŠ¥é”™</a>ï¼Œæ‚²è§‚åè°ƒè¦æ±‚åŒä¸€ä¸ª source table ä¸­ DDL å¿…é¡»æœ‰åº</li>\n</ul>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283186.png\"></p>\n<ul>\n<li>å¦‚æœ group ä¸­æ‰€æœ‰çš„ DDL éƒ½ resolved äº†ã€‚åˆ™ä¼š<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L243-L246\">é‡ç½®</a>ä¸€ä¸‹ meta</li>\n</ul>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283692.png\"></p>\n<p>æ€»ç»“ï¼š<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding_group.go#L215\">AddItem</a> å°±æ˜¯ä¸Šé¢å›¾ä¸­æŠŠ DDLItem æ”¾è¿› ShardingSequence çš„è¿‡ç¨‹</p>\n<h2 id=\"Step-2-ä¸-Step-1-ç›¸åŒ\"><a href=\"#Step-2-ä¸-Step-1-ç›¸åŒ\" class=\"headerlink\" title=\"Step 2 ä¸ Step 1 ç›¸åŒ\"></a>Step 2 ä¸ Step 1 ç›¸åŒ</h2><h2 id=\"Step-3\"><a href=\"#Step-3\" class=\"headerlink\" title=\"Step 3\"></a>Step 3</h2><p>ç”±äº tarTbl åªæœ‰ä¸¤ä¸ª source tableï¼šs1.t1 å’Œ s1.t2ï¼Œè¿™æ—¶ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883\">TrySync</a> åï¼Œ<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2948\">synced = true</a>ï¼Œè¯´æ˜è¯¥ worker ready</p>\n<h2 id=\"Step-4\"><a href=\"#Step-4\" class=\"headerlink\" title=\"Step 4\"></a>Step 4</h2><h3 id=\"worker1\"><a href=\"#worker1\" class=\"headerlink\" title=\"worker1\"></a>worker1</h3><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2985\">PutInfo</a>ï¼šå‘é€ ready info ç»™ masterï¼ˆåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸ªå‡½æ•°ï¼‰</li>\n<li>ä¹‹åä¼šè¢«é˜»å¡ï¼Œ<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2992\">ç­‰å¾… master å‘é€ operation</a>ã€‚</li>\n</ul>\n<h3 id=\"Master\"><a href=\"#Master\" class=\"headerlink\" title=\"Master\"></a>Master</h3><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L177\">watchInfoPut</a>ï¼šæˆåŠŸç›‘å¬åˆ°äº†</li>\n<li>handleInfoPutï¼šmaster ä¹Ÿå¼€å§‹ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L474\">TrySync</a>ï¼Œmaster çš„ TrySync ç›¸æ¯” worker ä¸­çš„è¦ç®€å•å¾ˆå¤šï¼Œæ¯ä¸€ä¸ª Info ç›´æ¥ç›¸å½“äºè¯¥ source/worker å·² readyï¼Œæ‰€ä»¥ç›´æ¥ç»Ÿè®¡æ˜¯å¦æ‰€æœ‰ ready å³å¯</li>\n<li>ç”±äºè¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ª worker å‘ info ç»™ masterï¼Œæ‰€ä»¥éœ€è¦<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/keeper.go#L49\">æ–°å»º Lock</a>ï¼Œæ–°å»º Lock è¿‡ç¨‹ä¸­ä¼šè·å–è¯¥ task æ‰€æœ‰çš„ sourceï¼Œå¹¶å­˜åˆ° lock ä¸­ï¼Œè¿™æ ·å°±çŸ¥é“è¿˜æœ‰å¤šå°‘ source æ²¡ readyã€‚æ˜¾ç„¶è¿˜æœ‰ source2 æ²¡ readyã€‚</li>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L481-L485\">ç»§ç»­ç­‰å¾…</a></li>\n</ul>\n<h2 id=\"Step-5-ä¸-Step-3-ç›¸åŒ\"><a href=\"#Step-5-ä¸-Step-3-ç›¸åŒ\" class=\"headerlink\" title=\"Step 5 ä¸ Step 3 ç›¸åŒ\"></a>Step 5 ä¸ Step 3 ç›¸åŒ</h2><h2 id=\"Step-6\"><a href=\"#Step-6\" class=\"headerlink\" title=\"Step 6\"></a>Step 6</h2><ul>\n<li>å‰é¢ä¸ Step 4 ç›¸åŒï¼Œä½†æ˜¯è¿™æ—¶æ‰€æœ‰ source éƒ½ ready äº†ï¼Œ<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L486\">synced = true</a></li>\n</ul>\n<h2 id=\"Step-7\"><a href=\"#Step-7\" class=\"headerlink\" title=\"Step 7\"></a>Step 7</h2><h3 id=\"master\"><a href=\"#master\" class=\"headerlink\" title=\"master\"></a>master</h3><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L599\">putOpForOwner</a>ï¼šå‘é€ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L604\">exec</a> operation to owner(worker1)</li>\n</ul>\n<h3 id=\"Worker1\"><a href=\"#Worker1\" class=\"headerlink\" title=\"Worker1\"></a>Worker1</h3><ul>\n<li><p><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/shardddl/pessimist.go#L120-L124\">å¾—åˆ° master çš„ exec operation</a></p>\n</li>\n<li><p><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L3042-L3043\">NewDDLJob</a> å¹¶ handle</p>\n</li>\n<li><p><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1057\">addJob</a>ï¼šå‘é€ job ç»™ DDLJobCh</p>\n</li>\n<li><p>syncDDLï¼šä¹‹å‰ worker èµ·çš„åç¨‹æ¥å—åˆ°è¯¥ job</p>\n<ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1324\">æ‹¿åˆ°åˆšåˆšå¾—åˆ°çš„ operation</a>ï¼Œå¹¶ä¸”ä¸ä¼šè¢«è·³è¿‡ï¼Œå› ä¸º ignore = false</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Step-8\"><a href=\"#Step-8\" class=\"headerlink\" title=\"Step 8\"></a>Step 8</h2><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1344\">åŒæ­¥åˆ°ä¸‹æ¸¸</a></li>\n</ul>\n<h2 id=\"Step-9\"><a href=\"#Step-9\" class=\"headerlink\" title=\"Step 9\"></a>Step 9</h2><h3 id=\"Worker1-1\"><a href=\"#Worker1-1\" class=\"headerlink\" title=\"Worker1\"></a>Worker1</h3><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1384\">DoneOperationDeleteInfo</a>ï¼šå‘é€ done operation ç»™ master å¹¶åˆ é™¤ info</li>\n</ul>\n<h2 id=\"Step-10\"><a href=\"#Step-10\" class=\"headerlink\" title=\"Step 10\"></a>Step 10</h2><h3 id=\"Master-1\"><a href=\"#Master-1\" class=\"headerlink\" title=\"Master\"></a>Master</h3><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L509\">æ¥å— done operation</a></li>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L529\">markDone</a></li>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L553\">putOpsForNonOwner</a>ï¼šç»™å…¶ä»–æ‰€æœ‰ non-owner å‘é€ skip infoï¼ˆskip done æ˜¯ä¸ºäº†é˜²æ­¢æŠŠ done è¦†ç›–æ‰ï¼‰</li>\n</ul>\n<h3 id=\"Worker2\"><a href=\"#Worker2\" class=\"headerlink\" title=\"Worker2\"></a>Worker2</h3><ul>\n<li>æ¥å—åˆ°äº† no exec(skip) çš„ operationï¼Œå’Œ Step 7 ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨ syncDDL çš„æ—¶å€™ä¼š<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1325-L1328\">è¢« skip</a></li>\n</ul>\n<h2 id=\"Step-11-å’Œ-Step-9-ç›¸åŒ\"><a href=\"#Step-11-å’Œ-Step-9-ç›¸åŒ\" class=\"headerlink\" title=\"Step 11 å’Œ Step 9 ç›¸åŒ\"></a>Step 11 å’Œ Step 9 ç›¸åŒ</h2><h1 id=\"å››ã€æ€»ç»“\"><a href=\"#å››ã€æ€»ç»“\" class=\"headerlink\" title=\"å››ã€æ€»ç»“\"></a>å››ã€æ€»ç»“</h1><p>æœ¬èŠ‚ä»‹ç»äº†åœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ç¬¬ä¸€æ¡ DDL è¯­å¥ï¼Œç”Ÿæˆ Lockï¼Œåˆ°æ”¶åˆ°æ‰€æœ‰ DDL è¯­å¥ï¼ŒLock è§£é™¤çš„è¿‡ç¨‹ã€‚</p>\n<p>ç»è¿‡æœ¬èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»å®Œå…¨å­¦ä¼šäº† DM æ‚²è§‚åè°ƒçš„è¿‡ç¨‹ã€‚æ˜¯ä¸æ˜¯ä¹Ÿæ²¡é‚£ä¹ˆå¤æ‚ğŸ˜ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªçŸ¥é“ DDL çš„å¤„ç†æ–¹å¼ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­çš„ DML ä¼šæ€ä¹ˆåŠå‘¢ï¼Ÿä¸‹ä¸€ç« æ­æ™“ã€‚</p>\n<h1 id=\"äº”ã€ç–‘ä¼¼-bug\"><a href=\"#äº”ã€ç–‘ä¼¼-bug\" class=\"headerlink\" title=\"äº”ã€ç–‘ä¼¼ bug\"></a>äº”ã€ç–‘ä¼¼ bug</h1><ol>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L552-L559\">initShardingGroups</a> ä¸­å¯¹ ShardingGroup.sources è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œè¿™é‡ŒåŒ…å«äº†è¯¥ targetTable å¯¹åº”çš„æ‰€æœ‰ sourceTables</li>\n<li>åœ¨ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883\">TrySync</a> çš„æ—¶å€™ï¼Œå´ä½¿ç”¨ç¬¬ä¸€ä¸ª <code>sourceTable[0]</code>ï¼Œæ¥æ ‡è®°æ‰€æœ‰çš„ <code>DDL[]</code>ï¼Œå¦‚æœ <code>len(DDL[]) != 1</code>ï¼Œåˆ™ remain æ°¸è¿œä¸å¯èƒ½ä¸º 0ã€‚å› ä¸º sourceTables æ¥æºäº ddlInfoã€‚è€Œ DDLInfo åªå­˜äº†<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2738-L2743\">ç¬¬ä¸€æ¡ ddl çš„ ddlInfo</a>ï¼Œå®é™…ä¸Šå¯¹äºæ¯ä¸€ä¸ª Split ä¹‹åçš„ DDLï¼Œéƒ½ä¼š <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2694\">genDDLInfo</a>ã€‚</li>\n<li>ä½†æ˜¯å¥‡æ€ªçš„æ˜¯ï¼Œä»£ç ä¸­æ ‡æ³¨äº†<a href=\"http://errsyncerunitddlonmultipletable/\">ä¸æ”¯æŒ multi-table DDL</a>ï¼Œè¿™ä¸ª error åœ¨ pessimist/optimist mode ä¸­éƒ½ç”¨åˆ°äº†ã€‚ä½†æ˜¯åœ¨ç°åœ¨çœ‹ pessimist ä»£ç ä¸­ï¼Œåˆçœ‹åˆ°å…¶ä¸º multi-table DDL å®ç°äº†éƒ¨åˆ†ç›¸å…³é€»è¾‘ã€‚ã€‚ã€‚<strong>æœ‰æ¯’</strong></li>\n<li>æ¯”å¦‚ï¼š</li>\n</ol>\n<ul>\n<li>https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2957-L2960</li>\n<li>https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L35</li>\n<li>ã€‚ã€‚ã€‚</li>\n</ul>\n","site":{"data":{}},"cover_type":"img","length":2729,"excerpt":"","more":"<h1 id=\"ä¸€ã€æ¦‚è¿°\"><a href=\"#ä¸€ã€æ¦‚è¿°\" class=\"headerlink\" title=\"ä¸€ã€æ¦‚è¿°\"></a>ä¸€ã€æ¦‚è¿°</h1><p>ä»‹ç»äº†ä¸æ‚²è§‚åè°ƒæœ‰å…³çš„å„ä¸ªæ•°æ®ç»“æ„ä¹‹åï¼Œæ¥ä¸‹æ¥å°†ä»‹ç»ä¸€ä¸ª DM ç³»ç»Ÿä»æ¥å—åˆ°ç¬¬ä¸€æ¡åˆ†è¡¨ DDL å¼€å§‹ï¼Œåˆ°æ‰€æœ‰è¯¥ DDL å¯¹åº”çš„ Lock resolved çš„å…¨è¿‡ç¨‹ã€‚</p>\n<blockquote>\n<p>æœ¬èŠ‚å†…å®¹çš†å‚è€ƒ <a href=\"https://github.com/pingcap/tiflow/tree/release-6.0\">DM v6.0</a>ï¼Œå¯¹ç°åœ¨è€Œè¨€ï¼Œæœ‰å¯èƒ½å·²è¿‡æ—¶ï¼Œæ¬¢è¿å¤§å®¶æå‡ºæ„è§ï½</p>\n</blockquote>\n<h1 id=\"äºŒã€Overview\"><a href=\"#äºŒã€Overview\" class=\"headerlink\" title=\"äºŒã€Overview\"></a>äºŒã€Overview</h1><p>å‡è®¾ç°åœ¨èµ·äº† master å’Œä¸¤ä¸ª Workerï¼Œä¸¤ä¸ª Worker åˆ†åˆ«ç»‘å®šä¸¤ä¸ª Sourceï¼ˆs1ï¼Œs2ï¼‰ï¼Œæ¯ä¸ª Source æœ‰ä¸¤ä¸ªåˆ†è¡¨ï¼ˆt1ï¼Œt2ï¼‰ï¼Œè¿™å››ä¸ªè¡¨ä¼š route åˆ°ä¸€ä¸ª target tableï¼ˆtarTblï¼‰ä¸­ã€‚åœ¨ DDL åˆ°æ¥ä¹‹å‰ï¼Œä¸¤ä¸ª worker ä¼šåˆ›å»ºå¥½ ShardingGroupKeeperï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ª target tableï¼Œä¸¤ä¸ª source tableã€‚</p>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283187.png\"></p>\n<p>ä¸¤ä¸ª Worker å…ˆåæ”¶åˆ°ä¸¤ä¸ª Source å››ä¸ªåˆ†è¡¨çš„åŒä¸€æ¡ DDLï¼Œè¡¨ç¤ºä¸ºï¼š</p>\n<ul>\n<li>DDL1ï¼šè¡¨ç¤ºå¯¹ s1.t1 çš„ DDLã€‚</li>\n<li>DDL2ï¼šè¡¨ç¤ºå¯¹ s2.t1 çš„ DDLã€‚</li>\n<li>DDL3ï¼šè¡¨ç¤ºå¯¹ s1.t2 çš„ DDLã€‚</li>\n<li>DDL4ï¼šè¡¨ç¤ºå¯¹ s2.t2 çš„ DDLã€‚</li>\n</ul>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283666.png\"></p>\n<h1 id=\"ä¸‰ã€å…·ä½“è¿‡ç¨‹\"><a href=\"#ä¸‰ã€å…·ä½“è¿‡ç¨‹\" class=\"headerlink\" title=\"ä¸‰ã€å…·ä½“è¿‡ç¨‹\"></a>ä¸‰ã€å…·ä½“è¿‡ç¨‹</h1><blockquote>\n<p>æœ¬å°èŠ‚ worker å¯¹ DDL çš„å¤„ç†ä» <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2853\">handleQueryEventPessimistic</a> å¼€å§‹ï¼Œå¦‚æœä¸çŸ¥é“åœ¨æ­¤ä¹‹å‰çš„ DDL åšè¿‡å“ªäº›å¤„ç†ï¼Œè¯·æœŸå¾…åç»­æ–‡ç« ğŸ˜</p>\n</blockquote>\n<p>æ¥ä¸‹æ¥å°†å¯¹ä¸Šå›¾ä¸­çš„æ­¥éª¤ä¸€ä¸€ä»‹ç»</p>\n<h2 id=\"Step-1\"><a href=\"#Step-1\" class=\"headerlink\" title=\"Step 1\"></a>Step 1</h2><ol>\n<li>worker1 æ”¶åˆ°æ¥è‡ª source1 çš„ DDL1ï¼Œä¼šç›´æ¥ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883\">TrySync</a>ï¼Œè¿™é‡Œè¿”å›äº†ä¸€å¤§å †çš„å‚æ•°ï¼Œå…¶å®æœ‰ç”¨çš„å°±åªæ˜¯ <code>synced</code>ï¼Œç®€å•æ¥è¯´ï¼Œé‡Œé¢åªåšäº†ä¸€ä»¶äº‹ï¼š<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding_group.go#L215\">AddItem</a>ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹ TrySync</li>\n</ol>\n<blockquote>\n<p>æœ¬èŠ‚ï¼Œå‡è®¾è¯¥ DDL ä¸æ˜¯ CreateTableStmtï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæ¯æ¬¡éƒ½æ˜¯ remain &lt;=0ï¼Œsynced = trueï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€æ¬¡å‘é€è¯¥ create table çš„ worker ä¼š syncDDLã€‚</p>\n</blockquote>\n<h3 id=\"TrySync\"><a href=\"#TrySync\" class=\"headerlink\" title=\"TrySync\"></a>TrySync</h3><p>æƒ³è¦çŸ¥é“ worker åœ¨æ‚²è§‚åè°ƒçš„æ—¶å€™åšäº†ä»€ä¹ˆï¼Œå¿…é¡»è¦ææ‡‚ TrySync æ˜¯æ€ä¹ˆè¿ä½œçš„ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥é‡æ–°ç†è§£ä¸€ä¸‹ ShardingGroupKeeperï¼š</p>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283187.png\"></p>\n<p>å•ç‹¬æ‹¿å‡ºä¸€ä¸ª ShardingGroup ä¸¾ä¾‹ï¼ˆé¢œè‰²ä»£è¡¨ DDL çš„ç§ç±»ï¼‰ï¼š</p>\n<h4 id=\"Example\"><a href=\"#Example\" class=\"headerlink\" title=\"Example\"></a>Example</h4><p>worker æ”¶åˆ°äº†ä»¥ä¸‹ DDL</p>\n<ul>\n<li>ä¾æ¬¡æ”¶åˆ°äº† table1 æ©™è‰²ã€é»„è‰²ã€ç»¿è‰²ä¸‰æ¡ DDL</li>\n<li>æ”¶åˆ°äº† table2 æ©™è‰²</li>\n<li>è¿™ä¸ªæ—¶å€™ <code>activeIdx = 0</code>ï¼Œ<code>remain = 1</code>ï¼Œå› ä¸ºåªæœ‰ table3 æ²¡æœ‰æ”¶åˆ° active DDL äº†</li>\n</ul>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283679.png\"></p>\n<ul>\n<li>å¦‚æœåœ¨è¿™ä¸ªæ—¶å€™æ”¶åˆ°äº† table3 æ©™è‰² DDLï¼Œ<code>remain = 0</code>ï¼Œå¤„ç†äº†è¿™æ¡ DDL ä¹‹åï¼Œ<code>active ++</code></li>\n</ul>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/image-1672713793518.png\" alt=\"image.png\"></p>\n<ul>\n<li>å¦‚æœè¿™ä¸ªæ—¶å€™æ”¶åˆ° table2 ç»¿è‰² DDLï¼Œåˆ™ä¼š<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L197-L199\">æŠ¥é”™</a>ï¼Œæ‚²è§‚åè°ƒè¦æ±‚åŒä¸€ä¸ª source table ä¸­ DDL å¿…é¡»æœ‰åº</li>\n</ul>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283186.png\"></p>\n<ul>\n<li>å¦‚æœ group ä¸­æ‰€æœ‰çš„ DDL éƒ½ resolved äº†ã€‚åˆ™ä¼š<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L243-L246\">é‡ç½®</a>ä¸€ä¸‹ meta</li>\n</ul>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283692.png\"></p>\n<p>æ€»ç»“ï¼š<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding_group.go#L215\">AddItem</a> å°±æ˜¯ä¸Šé¢å›¾ä¸­æŠŠ DDLItem æ”¾è¿› ShardingSequence çš„è¿‡ç¨‹</p>\n<h2 id=\"Step-2-ä¸-Step-1-ç›¸åŒ\"><a href=\"#Step-2-ä¸-Step-1-ç›¸åŒ\" class=\"headerlink\" title=\"Step 2 ä¸ Step 1 ç›¸åŒ\"></a>Step 2 ä¸ Step 1 ç›¸åŒ</h2><h2 id=\"Step-3\"><a href=\"#Step-3\" class=\"headerlink\" title=\"Step 3\"></a>Step 3</h2><p>ç”±äº tarTbl åªæœ‰ä¸¤ä¸ª source tableï¼šs1.t1 å’Œ s1.t2ï¼Œè¿™æ—¶ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883\">TrySync</a> åï¼Œ<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2948\">synced = true</a>ï¼Œè¯´æ˜è¯¥ worker ready</p>\n<h2 id=\"Step-4\"><a href=\"#Step-4\" class=\"headerlink\" title=\"Step 4\"></a>Step 4</h2><h3 id=\"worker1\"><a href=\"#worker1\" class=\"headerlink\" title=\"worker1\"></a>worker1</h3><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2985\">PutInfo</a>ï¼šå‘é€ ready info ç»™ masterï¼ˆåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸ªå‡½æ•°ï¼‰</li>\n<li>ä¹‹åä¼šè¢«é˜»å¡ï¼Œ<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2992\">ç­‰å¾… master å‘é€ operation</a>ã€‚</li>\n</ul>\n<h3 id=\"Master\"><a href=\"#Master\" class=\"headerlink\" title=\"Master\"></a>Master</h3><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L177\">watchInfoPut</a>ï¼šæˆåŠŸç›‘å¬åˆ°äº†</li>\n<li>handleInfoPutï¼šmaster ä¹Ÿå¼€å§‹ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L474\">TrySync</a>ï¼Œmaster çš„ TrySync ç›¸æ¯” worker ä¸­çš„è¦ç®€å•å¾ˆå¤šï¼Œæ¯ä¸€ä¸ª Info ç›´æ¥ç›¸å½“äºè¯¥ source/worker å·² readyï¼Œæ‰€ä»¥ç›´æ¥ç»Ÿè®¡æ˜¯å¦æ‰€æœ‰ ready å³å¯</li>\n<li>ç”±äºè¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ª worker å‘ info ç»™ masterï¼Œæ‰€ä»¥éœ€è¦<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/keeper.go#L49\">æ–°å»º Lock</a>ï¼Œæ–°å»º Lock è¿‡ç¨‹ä¸­ä¼šè·å–è¯¥ task æ‰€æœ‰çš„ sourceï¼Œå¹¶å­˜åˆ° lock ä¸­ï¼Œè¿™æ ·å°±çŸ¥é“è¿˜æœ‰å¤šå°‘ source æ²¡ readyã€‚æ˜¾ç„¶è¿˜æœ‰ source2 æ²¡ readyã€‚</li>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L481-L485\">ç»§ç»­ç­‰å¾…</a></li>\n</ul>\n<h2 id=\"Step-5-ä¸-Step-3-ç›¸åŒ\"><a href=\"#Step-5-ä¸-Step-3-ç›¸åŒ\" class=\"headerlink\" title=\"Step 5 ä¸ Step 3 ç›¸åŒ\"></a>Step 5 ä¸ Step 3 ç›¸åŒ</h2><h2 id=\"Step-6\"><a href=\"#Step-6\" class=\"headerlink\" title=\"Step 6\"></a>Step 6</h2><ul>\n<li>å‰é¢ä¸ Step 4 ç›¸åŒï¼Œä½†æ˜¯è¿™æ—¶æ‰€æœ‰ source éƒ½ ready äº†ï¼Œ<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L486\">synced = true</a></li>\n</ul>\n<h2 id=\"Step-7\"><a href=\"#Step-7\" class=\"headerlink\" title=\"Step 7\"></a>Step 7</h2><h3 id=\"master\"><a href=\"#master\" class=\"headerlink\" title=\"master\"></a>master</h3><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L599\">putOpForOwner</a>ï¼šå‘é€ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L604\">exec</a> operation to owner(worker1)</li>\n</ul>\n<h3 id=\"Worker1\"><a href=\"#Worker1\" class=\"headerlink\" title=\"Worker1\"></a>Worker1</h3><ul>\n<li><p><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/shardddl/pessimist.go#L120-L124\">å¾—åˆ° master çš„ exec operation</a></p>\n</li>\n<li><p><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L3042-L3043\">NewDDLJob</a> å¹¶ handle</p>\n</li>\n<li><p><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1057\">addJob</a>ï¼šå‘é€ job ç»™ DDLJobCh</p>\n</li>\n<li><p>syncDDLï¼šä¹‹å‰ worker èµ·çš„åç¨‹æ¥å—åˆ°è¯¥ job</p>\n<ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1324\">æ‹¿åˆ°åˆšåˆšå¾—åˆ°çš„ operation</a>ï¼Œå¹¶ä¸”ä¸ä¼šè¢«è·³è¿‡ï¼Œå› ä¸º ignore = false</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Step-8\"><a href=\"#Step-8\" class=\"headerlink\" title=\"Step 8\"></a>Step 8</h2><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1344\">åŒæ­¥åˆ°ä¸‹æ¸¸</a></li>\n</ul>\n<h2 id=\"Step-9\"><a href=\"#Step-9\" class=\"headerlink\" title=\"Step 9\"></a>Step 9</h2><h3 id=\"Worker1-1\"><a href=\"#Worker1-1\" class=\"headerlink\" title=\"Worker1\"></a>Worker1</h3><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1384\">DoneOperationDeleteInfo</a>ï¼šå‘é€ done operation ç»™ master å¹¶åˆ é™¤ info</li>\n</ul>\n<h2 id=\"Step-10\"><a href=\"#Step-10\" class=\"headerlink\" title=\"Step 10\"></a>Step 10</h2><h3 id=\"Master-1\"><a href=\"#Master-1\" class=\"headerlink\" title=\"Master\"></a>Master</h3><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L509\">æ¥å— done operation</a></li>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L529\">markDone</a></li>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L553\">putOpsForNonOwner</a>ï¼šç»™å…¶ä»–æ‰€æœ‰ non-owner å‘é€ skip infoï¼ˆskip done æ˜¯ä¸ºäº†é˜²æ­¢æŠŠ done è¦†ç›–æ‰ï¼‰</li>\n</ul>\n<h3 id=\"Worker2\"><a href=\"#Worker2\" class=\"headerlink\" title=\"Worker2\"></a>Worker2</h3><ul>\n<li>æ¥å—åˆ°äº† no exec(skip) çš„ operationï¼Œå’Œ Step 7 ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨ syncDDL çš„æ—¶å€™ä¼š<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1325-L1328\">è¢« skip</a></li>\n</ul>\n<h2 id=\"Step-11-å’Œ-Step-9-ç›¸åŒ\"><a href=\"#Step-11-å’Œ-Step-9-ç›¸åŒ\" class=\"headerlink\" title=\"Step 11 å’Œ Step 9 ç›¸åŒ\"></a>Step 11 å’Œ Step 9 ç›¸åŒ</h2><h1 id=\"å››ã€æ€»ç»“\"><a href=\"#å››ã€æ€»ç»“\" class=\"headerlink\" title=\"å››ã€æ€»ç»“\"></a>å››ã€æ€»ç»“</h1><p>æœ¬èŠ‚ä»‹ç»äº†åœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ç¬¬ä¸€æ¡ DDL è¯­å¥ï¼Œç”Ÿæˆ Lockï¼Œåˆ°æ”¶åˆ°æ‰€æœ‰ DDL è¯­å¥ï¼ŒLock è§£é™¤çš„è¿‡ç¨‹ã€‚</p>\n<p>ç»è¿‡æœ¬èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»å®Œå…¨å­¦ä¼šäº† DM æ‚²è§‚åè°ƒçš„è¿‡ç¨‹ã€‚æ˜¯ä¸æ˜¯ä¹Ÿæ²¡é‚£ä¹ˆå¤æ‚ğŸ˜ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªçŸ¥é“ DDL çš„å¤„ç†æ–¹å¼ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­çš„ DML ä¼šæ€ä¹ˆåŠå‘¢ï¼Ÿä¸‹ä¸€ç« æ­æ™“ã€‚</p>\n<h1 id=\"äº”ã€ç–‘ä¼¼-bug\"><a href=\"#äº”ã€ç–‘ä¼¼-bug\" class=\"headerlink\" title=\"äº”ã€ç–‘ä¼¼ bug\"></a>äº”ã€ç–‘ä¼¼ bug</h1><ol>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L552-L559\">initShardingGroups</a> ä¸­å¯¹ ShardingGroup.sources è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œè¿™é‡ŒåŒ…å«äº†è¯¥ targetTable å¯¹åº”çš„æ‰€æœ‰ sourceTables</li>\n<li>åœ¨ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883\">TrySync</a> çš„æ—¶å€™ï¼Œå´ä½¿ç”¨ç¬¬ä¸€ä¸ª <code>sourceTable[0]</code>ï¼Œæ¥æ ‡è®°æ‰€æœ‰çš„ <code>DDL[]</code>ï¼Œå¦‚æœ <code>len(DDL[]) != 1</code>ï¼Œåˆ™ remain æ°¸è¿œä¸å¯èƒ½ä¸º 0ã€‚å› ä¸º sourceTables æ¥æºäº ddlInfoã€‚è€Œ DDLInfo åªå­˜äº†<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2738-L2743\">ç¬¬ä¸€æ¡ ddl çš„ ddlInfo</a>ï¼Œå®é™…ä¸Šå¯¹äºæ¯ä¸€ä¸ª Split ä¹‹åçš„ DDLï¼Œéƒ½ä¼š <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2694\">genDDLInfo</a>ã€‚</li>\n<li>ä½†æ˜¯å¥‡æ€ªçš„æ˜¯ï¼Œä»£ç ä¸­æ ‡æ³¨äº†<a href=\"http://errsyncerunitddlonmultipletable/\">ä¸æ”¯æŒ multi-table DDL</a>ï¼Œè¿™ä¸ª error åœ¨ pessimist/optimist mode ä¸­éƒ½ç”¨åˆ°äº†ã€‚ä½†æ˜¯åœ¨ç°åœ¨çœ‹ pessimist ä»£ç ä¸­ï¼Œåˆçœ‹åˆ°å…¶ä¸º multi-table DDL å®ç°äº†éƒ¨åˆ†ç›¸å…³é€»è¾‘ã€‚ã€‚ã€‚<strong>æœ‰æ¯’</strong></li>\n<li>æ¯”å¦‚ï¼š</li>\n</ol>\n<ul>\n<li>https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2957-L2960</li>\n<li>https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L35</li>\n<li>ã€‚ã€‚ã€‚</li>\n</ul>\n"},{"title":"DM æ•°æ®æ—…ç¨‹ 02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”03reSync","date":"2023-01-02T20:58:33.000Z","top_img":"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404522042.png","cover":"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404522042.png","_content":"\n# ä¸€ã€æ¦‚è¿°\n\nåœ¨åˆ†åº“åˆ†è¡¨åŒæ­¥çš„è¿‡ç¨‹ä¸­ï¼Œä¸åŒçš„ DDL ä¹‹é—´ï¼Œè¿˜ä¼šç©¿æ’ç€å„ç§å„æ ·çš„ DML è¯­å¥ï¼Œè¿™äº› DML è¯­å¥è¦å¦‚ä½•å¤„ç†å‘¢ï¼Ÿä»Šå¤©å°±æ¥çœ‹çœ‹å®ƒä»¬çš„å¤„ç†è¿‡ç¨‹â€”â€”reSyncã€‚\n\næœ¬èŠ‚å…ˆä»‹ç» reSync çš„æ€»æµç¨‹ï¼Œç„¶ååˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ä»‹ç» reSyncï¼š\n\n- ä¸€é˜¶æ®µï¼šreSync ä¹‹å‰\n- å¼€å¯ reSync\n- äºŒé˜¶æ®µï¼šreSync ä¹‹å\n- å…³é—­ reSync\n\n> æœ¬èŠ‚å†…å®¹çš†å‚è€ƒ [DM v6.0](https://github.com/pingcap/tiflow/tree/release-6.0)ï¼Œå¯¹ç°åœ¨è€Œè¨€ï¼Œæœ‰å¯èƒ½å·²è¿‡æ—¶ï¼Œæ¬¢è¿å¤§å®¶æå‡ºæ„è§ï½\n\n# äºŒã€Overview\n\n1. è¿›å…¥ lock é˜¶æ®µåï¼Œåœ¨ç¬¬ä¸€æ¬¡ sync çš„æ—¶å€™ï¼Œä¼šè·³è¿‡è¢« active å½±å“åˆ°çš„ targetTable å¯¹åº”çš„ DML\n2. åœ¨ Lock resolved ä¹‹åï¼Œä¼šå›åˆ°ç¬¬ä¸€æ¬¡è¿›å…¥ lock çš„ binlog Location ç‚¹ï¼Œè¿›è¡Œ reSyncï¼ŒæŠŠä¹‹å‰ skip çš„ DML é‡æ–° syncï¼Œè¿™ä¸ªé˜¶æ®µä¼šè·³è¿‡ä¸Šæ¬¡æ‰§è¡Œè¿‡çš„ DMLã€‚\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404522042.png)\n\n## åŸç†\n\nä¸¤ç§ DML äº’ç›¸éš”ç¦»ï¼Œä¸ä¼šäº’ç›¸å½±å“ã€‚\n\n# ä¸‰ã€è¿‡ç¨‹\n\n## 1ã€ä¸€é˜¶æ®µ\n\n### Skip\n\nåœ¨ handleRowsEvent çš„æ—¶å€™ï¼Œ[åˆ¤æ–­è¯¥ event æ˜¯å¦éœ€è¦ skip](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2368)ï¼š\n\n1. é€šè¿‡ targetTable å¾—åˆ°å¯¹åº”çš„ group\n\n2. é€šè¿‡ sourceTable å¾—åˆ°å¯¹åº”çš„ activeDDLItemï¼Œ\n\n   1. ä¸‹å›¾ä¸­ ID3 å³ä¸éœ€è¦ skip\n\n   2. å¦‚æœå·²ç»æ”¶åˆ° activeDDLItem\n\n      1. å¦‚æœè¯¥ DML åœ¨ active å‰é¢ï¼Œä¸éœ€è¦ skip\n      2. å¦‚æœè¯¥ DML åœ¨ active åé¢ï¼Œåˆ™ skip\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404521513.png)\n\n## 2ã€å¼€å§‹ reSync\n\n[reSync ä¿¡å·](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2970-L2975)ï¼šæŠŠ targetTable å’Œ binlog location ä¿¡æ¯ä¼ é€’ç»™ä¸»é€»è¾‘ä¸­ï¼Œ[é‡å®šå‘ streamer](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1843-L1864)ã€‚\n\n### ShardingReSync\n\n```go\n// ShardingReSync represents re-sync info for a sharding DDL group.\n\ntype ShardingReSync struct {\n\n    currLocation   binlog.Location // current DDL's binlog location, initialize to first DDL's location\n\n    latestLocation binlog.Location // latest DDL's binlog location\n\n    targetTable    *filter.Table\n\n    allResolved    bool\n\n}\n```\n\nç”¨åˆ°çš„ `ShardingReSync` ç»“æ„ä½“ï¼š\n\n- currLocationï¼šç”¨äºé‡å®šå‘\n- latestLocationï¼šç”¨äºåˆ¤æ–­ reSync æ˜¯å¦ç»“æŸ\n- targetTableï¼šç”¨äºåˆ¤æ–­è¯¥ DML æ˜¯å¦éœ€è¦ reSync\n- allResolvedï¼šä¸å…³é—­ reSync æœ‰å…³\n\n## 3ã€äºŒé˜¶æ®µ\n\n1. [åˆ¤æ–­æ˜¯å¦ skip](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2333-L2337)\n2. æ›´æ–° `shardingReSync.currLocation` å¹¶åˆ¤æ–­æ˜¯å¦è¦ç»“æŸ reSync\n\n- [XIDEvent](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2125-L2143)\n- [RotateEvent](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2285-L2300)\n- [RowsEvent](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2328-L2332)\n- [QueryEvent](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2629-L2645)\n\n## 4ã€å…³é—­ reSync\n\nå¦‚æœå½“å‰ binlog location å·²ç»è¶Šè¿‡äº† shardingReSync.lastestLocationï¼Œåˆ™é‡å®šå‘å›å»ã€‚æ ¹æ®æ˜¯å¦ allResolved æœ‰ä¸¤ç§é‡å®šå‘æ–¹å¼ï¼Œä½†è²Œä¼¼æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n# å››ã€æ€»ç»“\n\nç»è¿‡ reSync ä¹‹åï¼Œæ‚²è§‚åè°ƒå°±ç»“æŸäº†ã€‚reSync çš„è¿‡ç¨‹ä¸æ˜¯å¾ˆå¤æ‚ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ç§æ“ä½œï¼š\n\n- é‡å®šå‘\n- Skip\n\næ¥ä¸‹æ¥å°†ä¼šå¼€å§‹ä¹è§‚åè°ƒçš„å­¦ä¹ ï¼ˆå¸Œæœ›ğŸ˜­\n","source":"_posts/DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”03reSync.md","raw":"---\ntitle: DM æ•°æ®æ—…ç¨‹ 02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”03reSync\ndate: 2023-01-03 04:58:33\ntags:\n- DM\n- æºç é˜…è¯»\ncategories:\n- DM æ•°æ®æ—…ç¨‹\ntop_img: https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404522042.png\ncover: https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404522042.png\n---\n\n# ä¸€ã€æ¦‚è¿°\n\nåœ¨åˆ†åº“åˆ†è¡¨åŒæ­¥çš„è¿‡ç¨‹ä¸­ï¼Œä¸åŒçš„ DDL ä¹‹é—´ï¼Œè¿˜ä¼šç©¿æ’ç€å„ç§å„æ ·çš„ DML è¯­å¥ï¼Œè¿™äº› DML è¯­å¥è¦å¦‚ä½•å¤„ç†å‘¢ï¼Ÿä»Šå¤©å°±æ¥çœ‹çœ‹å®ƒä»¬çš„å¤„ç†è¿‡ç¨‹â€”â€”reSyncã€‚\n\næœ¬èŠ‚å…ˆä»‹ç» reSync çš„æ€»æµç¨‹ï¼Œç„¶ååˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ä»‹ç» reSyncï¼š\n\n- ä¸€é˜¶æ®µï¼šreSync ä¹‹å‰\n- å¼€å¯ reSync\n- äºŒé˜¶æ®µï¼šreSync ä¹‹å\n- å…³é—­ reSync\n\n> æœ¬èŠ‚å†…å®¹çš†å‚è€ƒ [DM v6.0](https://github.com/pingcap/tiflow/tree/release-6.0)ï¼Œå¯¹ç°åœ¨è€Œè¨€ï¼Œæœ‰å¯èƒ½å·²è¿‡æ—¶ï¼Œæ¬¢è¿å¤§å®¶æå‡ºæ„è§ï½\n\n# äºŒã€Overview\n\n1. è¿›å…¥ lock é˜¶æ®µåï¼Œåœ¨ç¬¬ä¸€æ¬¡ sync çš„æ—¶å€™ï¼Œä¼šè·³è¿‡è¢« active å½±å“åˆ°çš„ targetTable å¯¹åº”çš„ DML\n2. åœ¨ Lock resolved ä¹‹åï¼Œä¼šå›åˆ°ç¬¬ä¸€æ¬¡è¿›å…¥ lock çš„ binlog Location ç‚¹ï¼Œè¿›è¡Œ reSyncï¼ŒæŠŠä¹‹å‰ skip çš„ DML é‡æ–° syncï¼Œè¿™ä¸ªé˜¶æ®µä¼šè·³è¿‡ä¸Šæ¬¡æ‰§è¡Œè¿‡çš„ DMLã€‚\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404522042.png)\n\n## åŸç†\n\nä¸¤ç§ DML äº’ç›¸éš”ç¦»ï¼Œä¸ä¼šäº’ç›¸å½±å“ã€‚\n\n# ä¸‰ã€è¿‡ç¨‹\n\n## 1ã€ä¸€é˜¶æ®µ\n\n### Skip\n\nåœ¨ handleRowsEvent çš„æ—¶å€™ï¼Œ[åˆ¤æ–­è¯¥ event æ˜¯å¦éœ€è¦ skip](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2368)ï¼š\n\n1. é€šè¿‡ targetTable å¾—åˆ°å¯¹åº”çš„ group\n\n2. é€šè¿‡ sourceTable å¾—åˆ°å¯¹åº”çš„ activeDDLItemï¼Œ\n\n   1. ä¸‹å›¾ä¸­ ID3 å³ä¸éœ€è¦ skip\n\n   2. å¦‚æœå·²ç»æ”¶åˆ° activeDDLItem\n\n      1. å¦‚æœè¯¥ DML åœ¨ active å‰é¢ï¼Œä¸éœ€è¦ skip\n      2. å¦‚æœè¯¥ DML åœ¨ active åé¢ï¼Œåˆ™ skip\n\n![](https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404521513.png)\n\n## 2ã€å¼€å§‹ reSync\n\n[reSync ä¿¡å·](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2970-L2975)ï¼šæŠŠ targetTable å’Œ binlog location ä¿¡æ¯ä¼ é€’ç»™ä¸»é€»è¾‘ä¸­ï¼Œ[é‡å®šå‘ streamer](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1843-L1864)ã€‚\n\n### ShardingReSync\n\n```go\n// ShardingReSync represents re-sync info for a sharding DDL group.\n\ntype ShardingReSync struct {\n\n    currLocation   binlog.Location // current DDL's binlog location, initialize to first DDL's location\n\n    latestLocation binlog.Location // latest DDL's binlog location\n\n    targetTable    *filter.Table\n\n    allResolved    bool\n\n}\n```\n\nç”¨åˆ°çš„ `ShardingReSync` ç»“æ„ä½“ï¼š\n\n- currLocationï¼šç”¨äºé‡å®šå‘\n- latestLocationï¼šç”¨äºåˆ¤æ–­ reSync æ˜¯å¦ç»“æŸ\n- targetTableï¼šç”¨äºåˆ¤æ–­è¯¥ DML æ˜¯å¦éœ€è¦ reSync\n- allResolvedï¼šä¸å…³é—­ reSync æœ‰å…³\n\n## 3ã€äºŒé˜¶æ®µ\n\n1. [åˆ¤æ–­æ˜¯å¦ skip](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2333-L2337)\n2. æ›´æ–° `shardingReSync.currLocation` å¹¶åˆ¤æ–­æ˜¯å¦è¦ç»“æŸ reSync\n\n- [XIDEvent](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2125-L2143)\n- [RotateEvent](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2285-L2300)\n- [RowsEvent](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2328-L2332)\n- [QueryEvent](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2629-L2645)\n\n## 4ã€å…³é—­ reSync\n\nå¦‚æœå½“å‰ binlog location å·²ç»è¶Šè¿‡äº† shardingReSync.lastestLocationï¼Œåˆ™é‡å®šå‘å›å»ã€‚æ ¹æ®æ˜¯å¦ allResolved æœ‰ä¸¤ç§é‡å®šå‘æ–¹å¼ï¼Œä½†è²Œä¼¼æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n# å››ã€æ€»ç»“\n\nç»è¿‡ reSync ä¹‹åï¼Œæ‚²è§‚åè°ƒå°±ç»“æŸäº†ã€‚reSync çš„è¿‡ç¨‹ä¸æ˜¯å¾ˆå¤æ‚ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ç§æ“ä½œï¼š\n\n- é‡å®šå‘\n- Skip\n\næ¥ä¸‹æ¥å°†ä¼šå¼€å§‹ä¹è§‚åè°ƒçš„å­¦ä¹ ï¼ˆå¸Œæœ›ğŸ˜­\n","slug":"DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”03reSync","published":1,"updated":"2024-06-16T07:00:14.111Z","_id":"clxh0oeka0000kbdy6mt69rq6","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"ä¸€ã€æ¦‚è¿°\"><a href=\"#ä¸€ã€æ¦‚è¿°\" class=\"headerlink\" title=\"ä¸€ã€æ¦‚è¿°\"></a>ä¸€ã€æ¦‚è¿°</h1><p>åœ¨åˆ†åº“åˆ†è¡¨åŒæ­¥çš„è¿‡ç¨‹ä¸­ï¼Œä¸åŒçš„ DDL ä¹‹é—´ï¼Œè¿˜ä¼šç©¿æ’ç€å„ç§å„æ ·çš„ DML è¯­å¥ï¼Œè¿™äº› DML è¯­å¥è¦å¦‚ä½•å¤„ç†å‘¢ï¼Ÿä»Šå¤©å°±æ¥çœ‹çœ‹å®ƒä»¬çš„å¤„ç†è¿‡ç¨‹â€”â€”reSyncã€‚</p>\n<p>æœ¬èŠ‚å…ˆä»‹ç» reSync çš„æ€»æµç¨‹ï¼Œç„¶ååˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ä»‹ç» reSyncï¼š</p>\n<ul>\n<li>ä¸€é˜¶æ®µï¼šreSync ä¹‹å‰</li>\n<li>å¼€å¯ reSync</li>\n<li>äºŒé˜¶æ®µï¼šreSync ä¹‹å</li>\n<li>å…³é—­ reSync</li>\n</ul>\n<blockquote>\n<p>æœ¬èŠ‚å†…å®¹çš†å‚è€ƒ <a href=\"https://github.com/pingcap/tiflow/tree/release-6.0\">DM v6.0</a>ï¼Œå¯¹ç°åœ¨è€Œè¨€ï¼Œæœ‰å¯èƒ½å·²è¿‡æ—¶ï¼Œæ¬¢è¿å¤§å®¶æå‡ºæ„è§ï½</p>\n</blockquote>\n<h1 id=\"äºŒã€Overview\"><a href=\"#äºŒã€Overview\" class=\"headerlink\" title=\"äºŒã€Overview\"></a>äºŒã€Overview</h1><ol>\n<li>è¿›å…¥ lock é˜¶æ®µåï¼Œåœ¨ç¬¬ä¸€æ¬¡ sync çš„æ—¶å€™ï¼Œä¼šè·³è¿‡è¢« active å½±å“åˆ°çš„ targetTable å¯¹åº”çš„ DML</li>\n<li>åœ¨ Lock resolved ä¹‹åï¼Œä¼šå›åˆ°ç¬¬ä¸€æ¬¡è¿›å…¥ lock çš„ binlog Location ç‚¹ï¼Œè¿›è¡Œ reSyncï¼ŒæŠŠä¹‹å‰ skip çš„ DML é‡æ–° syncï¼Œè¿™ä¸ªé˜¶æ®µä¼šè·³è¿‡ä¸Šæ¬¡æ‰§è¡Œè¿‡çš„ DMLã€‚</li>\n</ol>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404522042.png\"></p>\n<h2 id=\"åŸç†\"><a href=\"#åŸç†\" class=\"headerlink\" title=\"åŸç†\"></a>åŸç†</h2><p>ä¸¤ç§ DML äº’ç›¸éš”ç¦»ï¼Œä¸ä¼šäº’ç›¸å½±å“ã€‚</p>\n<h1 id=\"ä¸‰ã€è¿‡ç¨‹\"><a href=\"#ä¸‰ã€è¿‡ç¨‹\" class=\"headerlink\" title=\"ä¸‰ã€è¿‡ç¨‹\"></a>ä¸‰ã€è¿‡ç¨‹</h1><h2 id=\"1ã€ä¸€é˜¶æ®µ\"><a href=\"#1ã€ä¸€é˜¶æ®µ\" class=\"headerlink\" title=\"1ã€ä¸€é˜¶æ®µ\"></a>1ã€ä¸€é˜¶æ®µ</h2><h3 id=\"Skip\"><a href=\"#Skip\" class=\"headerlink\" title=\"Skip\"></a>Skip</h3><p>åœ¨ handleRowsEvent çš„æ—¶å€™ï¼Œ<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2368\">åˆ¤æ–­è¯¥ event æ˜¯å¦éœ€è¦ skip</a>ï¼š</p>\n<ol>\n<li><p>é€šè¿‡ targetTable å¾—åˆ°å¯¹åº”çš„ group</p>\n</li>\n<li><p>é€šè¿‡ sourceTable å¾—åˆ°å¯¹åº”çš„ activeDDLItemï¼Œ</p>\n<ol>\n<li><p>ä¸‹å›¾ä¸­ ID3 å³ä¸éœ€è¦ skip</p>\n</li>\n<li><p>å¦‚æœå·²ç»æ”¶åˆ° activeDDLItem</p>\n<ol>\n<li>å¦‚æœè¯¥ DML åœ¨ active å‰é¢ï¼Œä¸éœ€è¦ skip</li>\n<li>å¦‚æœè¯¥ DML åœ¨ active åé¢ï¼Œåˆ™ skip</li>\n</ol>\n</li>\n</ol>\n</li>\n</ol>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404521513.png\"></p>\n<h2 id=\"2ã€å¼€å§‹-reSync\"><a href=\"#2ã€å¼€å§‹-reSync\" class=\"headerlink\" title=\"2ã€å¼€å§‹ reSync\"></a>2ã€å¼€å§‹ reSync</h2><p><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2970-L2975\">reSync ä¿¡å·</a>ï¼šæŠŠ targetTable å’Œ binlog location ä¿¡æ¯ä¼ é€’ç»™ä¸»é€»è¾‘ä¸­ï¼Œ<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1843-L1864\">é‡å®šå‘ streamer</a>ã€‚</p>\n<h3 id=\"ShardingReSync\"><a href=\"#ShardingReSync\" class=\"headerlink\" title=\"ShardingReSync\"></a>ShardingReSync</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ShardingReSync represents re-sync info for a sharding DDL group.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ShardingReSync <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    currLocation   binlog.Location <span class=\"comment\">// current DDL&#x27;s binlog location, initialize to first DDL&#x27;s location</span></span><br><span class=\"line\"></span><br><span class=\"line\">    latestLocation binlog.Location <span class=\"comment\">// latest DDL&#x27;s binlog location</span></span><br><span class=\"line\"></span><br><span class=\"line\">    targetTable    *filter.Table</span><br><span class=\"line\"></span><br><span class=\"line\">    allResolved    <span class=\"type\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç”¨åˆ°çš„ <code>ShardingReSync</code> ç»“æ„ä½“ï¼š</p>\n<ul>\n<li>currLocationï¼šç”¨äºé‡å®šå‘</li>\n<li>latestLocationï¼šç”¨äºåˆ¤æ–­ reSync æ˜¯å¦ç»“æŸ</li>\n<li>targetTableï¼šç”¨äºåˆ¤æ–­è¯¥ DML æ˜¯å¦éœ€è¦ reSync</li>\n<li>allResolvedï¼šä¸å…³é—­ reSync æœ‰å…³</li>\n</ul>\n<h2 id=\"3ã€äºŒé˜¶æ®µ\"><a href=\"#3ã€äºŒé˜¶æ®µ\" class=\"headerlink\" title=\"3ã€äºŒé˜¶æ®µ\"></a>3ã€äºŒé˜¶æ®µ</h2><ol>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2333-L2337\">åˆ¤æ–­æ˜¯å¦ skip</a></li>\n<li>æ›´æ–° <code>shardingReSync.currLocation</code> å¹¶åˆ¤æ–­æ˜¯å¦è¦ç»“æŸ reSync</li>\n</ol>\n<ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2125-L2143\">XIDEvent</a></li>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2285-L2300\">RotateEvent</a></li>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2328-L2332\">RowsEvent</a></li>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2629-L2645\">QueryEvent</a></li>\n</ul>\n<h2 id=\"4ã€å…³é—­-reSync\"><a href=\"#4ã€å…³é—­-reSync\" class=\"headerlink\" title=\"4ã€å…³é—­ reSync\"></a>4ã€å…³é—­ reSync</h2><p>å¦‚æœå½“å‰ binlog location å·²ç»è¶Šè¿‡äº† shardingReSync.lastestLocationï¼Œåˆ™é‡å®šå‘å›å»ã€‚æ ¹æ®æ˜¯å¦ allResolved æœ‰ä¸¤ç§é‡å®šå‘æ–¹å¼ï¼Œä½†è²Œä¼¼æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>\n<h1 id=\"å››ã€æ€»ç»“\"><a href=\"#å››ã€æ€»ç»“\" class=\"headerlink\" title=\"å››ã€æ€»ç»“\"></a>å››ã€æ€»ç»“</h1><p>ç»è¿‡ reSync ä¹‹åï¼Œæ‚²è§‚åè°ƒå°±ç»“æŸäº†ã€‚reSync çš„è¿‡ç¨‹ä¸æ˜¯å¾ˆå¤æ‚ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ç§æ“ä½œï¼š</p>\n<ul>\n<li>é‡å®šå‘</li>\n<li>Skip</li>\n</ul>\n<p>æ¥ä¸‹æ¥å°†ä¼šå¼€å§‹ä¹è§‚åè°ƒçš„å­¦ä¹ ï¼ˆå¸Œæœ›ğŸ˜­</p>\n","site":{"data":{}},"cover_type":"img","length":1322,"excerpt":"","more":"<h1 id=\"ä¸€ã€æ¦‚è¿°\"><a href=\"#ä¸€ã€æ¦‚è¿°\" class=\"headerlink\" title=\"ä¸€ã€æ¦‚è¿°\"></a>ä¸€ã€æ¦‚è¿°</h1><p>åœ¨åˆ†åº“åˆ†è¡¨åŒæ­¥çš„è¿‡ç¨‹ä¸­ï¼Œä¸åŒçš„ DDL ä¹‹é—´ï¼Œè¿˜ä¼šç©¿æ’ç€å„ç§å„æ ·çš„ DML è¯­å¥ï¼Œè¿™äº› DML è¯­å¥è¦å¦‚ä½•å¤„ç†å‘¢ï¼Ÿä»Šå¤©å°±æ¥çœ‹çœ‹å®ƒä»¬çš„å¤„ç†è¿‡ç¨‹â€”â€”reSyncã€‚</p>\n<p>æœ¬èŠ‚å…ˆä»‹ç» reSync çš„æ€»æµç¨‹ï¼Œç„¶ååˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ä»‹ç» reSyncï¼š</p>\n<ul>\n<li>ä¸€é˜¶æ®µï¼šreSync ä¹‹å‰</li>\n<li>å¼€å¯ reSync</li>\n<li>äºŒé˜¶æ®µï¼šreSync ä¹‹å</li>\n<li>å…³é—­ reSync</li>\n</ul>\n<blockquote>\n<p>æœ¬èŠ‚å†…å®¹çš†å‚è€ƒ <a href=\"https://github.com/pingcap/tiflow/tree/release-6.0\">DM v6.0</a>ï¼Œå¯¹ç°åœ¨è€Œè¨€ï¼Œæœ‰å¯èƒ½å·²è¿‡æ—¶ï¼Œæ¬¢è¿å¤§å®¶æå‡ºæ„è§ï½</p>\n</blockquote>\n<h1 id=\"äºŒã€Overview\"><a href=\"#äºŒã€Overview\" class=\"headerlink\" title=\"äºŒã€Overview\"></a>äºŒã€Overview</h1><ol>\n<li>è¿›å…¥ lock é˜¶æ®µåï¼Œåœ¨ç¬¬ä¸€æ¬¡ sync çš„æ—¶å€™ï¼Œä¼šè·³è¿‡è¢« active å½±å“åˆ°çš„ targetTable å¯¹åº”çš„ DML</li>\n<li>åœ¨ Lock resolved ä¹‹åï¼Œä¼šå›åˆ°ç¬¬ä¸€æ¬¡è¿›å…¥ lock çš„ binlog Location ç‚¹ï¼Œè¿›è¡Œ reSyncï¼ŒæŠŠä¹‹å‰ skip çš„ DML é‡æ–° syncï¼Œè¿™ä¸ªé˜¶æ®µä¼šè·³è¿‡ä¸Šæ¬¡æ‰§è¡Œè¿‡çš„ DMLã€‚</li>\n</ol>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404522042.png\"></p>\n<h2 id=\"åŸç†\"><a href=\"#åŸç†\" class=\"headerlink\" title=\"åŸç†\"></a>åŸç†</h2><p>ä¸¤ç§ DML äº’ç›¸éš”ç¦»ï¼Œä¸ä¼šäº’ç›¸å½±å“ã€‚</p>\n<h1 id=\"ä¸‰ã€è¿‡ç¨‹\"><a href=\"#ä¸‰ã€è¿‡ç¨‹\" class=\"headerlink\" title=\"ä¸‰ã€è¿‡ç¨‹\"></a>ä¸‰ã€è¿‡ç¨‹</h1><h2 id=\"1ã€ä¸€é˜¶æ®µ\"><a href=\"#1ã€ä¸€é˜¶æ®µ\" class=\"headerlink\" title=\"1ã€ä¸€é˜¶æ®µ\"></a>1ã€ä¸€é˜¶æ®µ</h2><h3 id=\"Skip\"><a href=\"#Skip\" class=\"headerlink\" title=\"Skip\"></a>Skip</h3><p>åœ¨ handleRowsEvent çš„æ—¶å€™ï¼Œ<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2368\">åˆ¤æ–­è¯¥ event æ˜¯å¦éœ€è¦ skip</a>ï¼š</p>\n<ol>\n<li><p>é€šè¿‡ targetTable å¾—åˆ°å¯¹åº”çš„ group</p>\n</li>\n<li><p>é€šè¿‡ sourceTable å¾—åˆ°å¯¹åº”çš„ activeDDLItemï¼Œ</p>\n<ol>\n<li><p>ä¸‹å›¾ä¸­ ID3 å³ä¸éœ€è¦ skip</p>\n</li>\n<li><p>å¦‚æœå·²ç»æ”¶åˆ° activeDDLItem</p>\n<ol>\n<li>å¦‚æœè¯¥ DML åœ¨ active å‰é¢ï¼Œä¸éœ€è¦ skip</li>\n<li>å¦‚æœè¯¥ DML åœ¨ active åé¢ï¼Œåˆ™ skip</li>\n</ol>\n</li>\n</ol>\n</li>\n</ol>\n<p><img src=\"https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404521513.png\"></p>\n<h2 id=\"2ã€å¼€å§‹-reSync\"><a href=\"#2ã€å¼€å§‹-reSync\" class=\"headerlink\" title=\"2ã€å¼€å§‹ reSync\"></a>2ã€å¼€å§‹ reSync</h2><p><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2970-L2975\">reSync ä¿¡å·</a>ï¼šæŠŠ targetTable å’Œ binlog location ä¿¡æ¯ä¼ é€’ç»™ä¸»é€»è¾‘ä¸­ï¼Œ<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1843-L1864\">é‡å®šå‘ streamer</a>ã€‚</p>\n<h3 id=\"ShardingReSync\"><a href=\"#ShardingReSync\" class=\"headerlink\" title=\"ShardingReSync\"></a>ShardingReSync</h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ShardingReSync represents re-sync info for a sharding DDL group.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ShardingReSync <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    currLocation   binlog.Location <span class=\"comment\">// current DDL&#x27;s binlog location, initialize to first DDL&#x27;s location</span></span><br><span class=\"line\"></span><br><span class=\"line\">    latestLocation binlog.Location <span class=\"comment\">// latest DDL&#x27;s binlog location</span></span><br><span class=\"line\"></span><br><span class=\"line\">    targetTable    *filter.Table</span><br><span class=\"line\"></span><br><span class=\"line\">    allResolved    <span class=\"type\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç”¨åˆ°çš„ <code>ShardingReSync</code> ç»“æ„ä½“ï¼š</p>\n<ul>\n<li>currLocationï¼šç”¨äºé‡å®šå‘</li>\n<li>latestLocationï¼šç”¨äºåˆ¤æ–­ reSync æ˜¯å¦ç»“æŸ</li>\n<li>targetTableï¼šç”¨äºåˆ¤æ–­è¯¥ DML æ˜¯å¦éœ€è¦ reSync</li>\n<li>allResolvedï¼šä¸å…³é—­ reSync æœ‰å…³</li>\n</ul>\n<h2 id=\"3ã€äºŒé˜¶æ®µ\"><a href=\"#3ã€äºŒé˜¶æ®µ\" class=\"headerlink\" title=\"3ã€äºŒé˜¶æ®µ\"></a>3ã€äºŒé˜¶æ®µ</h2><ol>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2333-L2337\">åˆ¤æ–­æ˜¯å¦ skip</a></li>\n<li>æ›´æ–° <code>shardingReSync.currLocation</code> å¹¶åˆ¤æ–­æ˜¯å¦è¦ç»“æŸ reSync</li>\n</ol>\n<ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2125-L2143\">XIDEvent</a></li>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2285-L2300\">RotateEvent</a></li>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2328-L2332\">RowsEvent</a></li>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2629-L2645\">QueryEvent</a></li>\n</ul>\n<h2 id=\"4ã€å…³é—­-reSync\"><a href=\"#4ã€å…³é—­-reSync\" class=\"headerlink\" title=\"4ã€å…³é—­ reSync\"></a>4ã€å…³é—­ reSync</h2><p>å¦‚æœå½“å‰ binlog location å·²ç»è¶Šè¿‡äº† shardingReSync.lastestLocationï¼Œåˆ™é‡å®šå‘å›å»ã€‚æ ¹æ®æ˜¯å¦ allResolved æœ‰ä¸¤ç§é‡å®šå‘æ–¹å¼ï¼Œä½†è²Œä¼¼æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>\n<h1 id=\"å››ã€æ€»ç»“\"><a href=\"#å››ã€æ€»ç»“\" class=\"headerlink\" title=\"å››ã€æ€»ç»“\"></a>å››ã€æ€»ç»“</h1><p>ç»è¿‡ reSync ä¹‹åï¼Œæ‚²è§‚åè°ƒå°±ç»“æŸäº†ã€‚reSync çš„è¿‡ç¨‹ä¸æ˜¯å¾ˆå¤æ‚ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ç§æ“ä½œï¼š</p>\n<ul>\n<li>é‡å®šå‘</li>\n<li>Skip</li>\n</ul>\n<p>æ¥ä¸‹æ¥å°†ä¼šå¼€å§‹ä¹è§‚åè°ƒçš„å­¦ä¹ ï¼ˆå¸Œæœ›ğŸ˜­</p>\n"},{"title":"DM æ•°æ®æ—…ç¨‹ 02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”01å‡†å¤‡è¿‡ç¨‹","date":"2023-01-02T19:50:33.000Z","cover":"/img/category/dm_shard.png","_content":"\n# ä¸€ã€æ¦‚è¿°\n\nåˆ†åº“åˆ†è¡¨çš„æ‚²è§‚åè°ƒæ–¹æ³•æ˜¯ 2018 å¹´å¼€å‘çš„ç‰¹æ€§ï¼Œæ˜¯ DM é¦–æ¬¡æ”¯æŒ MySQL åˆ†åº“åˆ†è¡¨çš„è¿ç§»ã€‚ç”±äºåˆ†åº“åˆ†è¡¨åœ¨å„ä¸ªå…¬å¸ä¸­çš„åº”ç”¨å®åœ¨å¤ªè¿‡å¹¿æ³›ï¼Œæ‰€ä»¥åªæœ‰åœ¨æ”¯æŒåˆ†åº“åˆ†è¡¨è¿ç§»åï¼ŒDM æ‰æœ‰äº†å·¥ç¨‹å®è·µçš„æ„ä¹‰ï¼Œå¦åˆ™åªèƒ½ç®—ä½œä¸€ä¸ªç©å…·ã€‚è¿™å¯¹ DM æ¥è¯´æ„ä¹‰é‡å¤§ã€‚\n\nç”±äºæ‚²è§‚åè°ƒçš„å†…å®¹åºå¤§ï¼Œæœ¬èŠ‚åªè®²è¿°æ‚²è§‚åè°ƒçš„å‡†å¤‡è¿‡ç¨‹ï¼š\n\n- Master çš„å‡†å¤‡è¿‡ç¨‹\n- Worker çš„å‡†å¤‡è¿‡ç¨‹\n\nä»¥åŠåœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­è‡³å…³é‡è¦çš„ç»“æ„ä½“ï¼š\n\n- Lock\n- Info\n- Operation\n- ShardingMeta\n- ShardingGroup\n- ...\n\n> æ³¨ï¼šä¸ºäº†ä¸“æ³¨äºæˆ‘ä»¬çš„ç›®çš„ï¼ˆæ‚²è§‚åè°ƒï¼‰ï¼Œæœ¬æ–‡ä¸ä¼šå¯¹æ— å…³ä»£ç è¿›è¡Œè§£è¯»\n\n> è¿™ä¸€èŠ‚å¤–é“¾ä¸­çš„ä»£ç ï¼Œè¯»è€…å¯èƒ½ä¼šäº§ç”Ÿè¿™ä¸ªé€»è¾‘ä¸ºä»€ä¹ˆæ˜¯è¿™é‡Œçš„ç–‘é—®ã€‚è¿™æ˜¯å› ä¸ºæœ¬èŠ‚å¹¶æ²¡æœ‰å®Œå…¨æŒ‰ç…§é¡ºåºè¯»ä»£ç ã€‚æ‰€ä»¥è¯»è€…å¯ä»¥ä»…å¸¦ç€å­¦ä¹ çš„å¿ƒæ€é˜…è¯»æœ¬èŠ‚ï¼Œæš‚æ—¶ä¸éœ€è¦çŸ¥é“å®ƒä¸ºä»€ä¹ˆåœ¨ä»£ç çš„è¿™ä¸ªåœ°æ–¹ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ä¼šé¡ºåºé˜…è¯»ä»£ç \n\n> æœ¬èŠ‚åŸºäº [DM release-6.0.0](https://github.com/pingcap/tiflow/tree/release-6.0)\n\n# äºŒã€Master\n\n## 1ã€Pessimist å’Œ LockKeeper\n\n- [NewPessimist](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/server.go#L140)ï¼šPessimist æ˜¯ Master å¤„ç†æ‚²è§‚åè°ƒçš„ç»“æ„ä½“ï¼Œå…¶ä¸­æœ€é‡è¦çš„æˆå‘˜æ˜¯ `LockKeeper`ã€‚\n- `LockKeeper` çš„ä½œç”¨æ˜¯ç®¡ç†å„ç§å„æ ·çš„ lockã€‚\n\n```go\n// LockKeeper used to keep and handle DDL lock conveniently.\n\n// The lock information do not need to be persistent, and can be re-constructed from the shard DDL info.\n\ntype LockKeeper struct {\n\n    mu    sync.RWMutex\n\n    locks map[string]*Lock // lockID -> Lock\n\n}\n```\n\n- Lock å¯ä»¥çœ‹ä½œæ˜¯æ¯ä¸€ä¸ª ddl å½±å“çš„åº“è¡¨ï¼Œè¿™äº›åº“è¡¨åˆ†å¸ƒåœ¨ä¸åŒçš„ MySQL/source ä¸­ã€‚ç”±äºåœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­ï¼Œæ•°æ®æµï¼ˆbinlog æµï¼‰ä¸æ˜¯åœæ»çš„ï¼Œæ‰€ä»¥åœ¨æ•°æ®æµä¸­ï¼Œä¼šæºæºä¸æ–­åœ°å‡ºç°æ–° DDLï¼Œå³æ–° lockã€‚\n- æ•… `LockKeeper` å°±æ˜¯ç®¡ç†è¿™äº› lockã€‚\n\n```go\n// Lock represents the shard DDL lock in memory.\n\n// This information does not need to be persistent, and can be re-constructed from the shard DDL info.\n\ntype Lock struct {\n\n    mu sync.RWMutex\n\n\n\n    ID     string   // lock's ID\n\n    Task   string   // lock's corresponding task name\n\n    Owner  string   // Owner's source ID (not DM-worker's name)\n\n    DDLs   []string // DDL statements\n\n    remain int      // remain count of sources needed to receive DDL info\n\n\n\n    // whether the DDL info received from the source.\n\n    // if all of them have been ready, then we call the lock `synced`.\n\n    ready map[string]bool\n\n\n\n    // whether the operations have done (exec/skip the shard DDL).\n\n    // if all of them have done, then we call the lock `resolved`.\n\n    done map[string]bool\n\n}\n```\n\n## 2ã€Lock\n\n- ID è¡¨ç°å½¢å¼ä¸º [${task}-${schema}.${table}](https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/utils/common.go#L223)ï¼Œä» LockKeeper çš„ç»“æ„å¯ä»¥çœ‹åˆ°åŒä¸€ä»»åŠ¡åŒä¸€è¡¨ä¸‹åªèƒ½æœ‰ä¸€ä¸ª lockï¼Œå¦‚æœé‡åˆ°äº†ä¸åŒçš„ DDLï¼Œå½±å“çš„åˆæ˜¯åŒä»»åŠ¡åŒè¡¨ï¼Œåˆ™[æŠ¥é”™](https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/lock.go#L72-L74)ã€‚\n- DDLs ä¸ºä»€ä¹ˆæ˜¯ `[]string`ï¼Ÿå› ä¸ºè¿™é‡Œæ˜¯ç»è¿‡ `Split` çš„ DDLsï¼Œå•æ¡ DDL å¯èƒ½ä¼šè¢« Split æˆå¤šæ¡ DDLã€‚\n- Remain è¡¨ç¤ºå‰©ä½™çš„è¿˜æœªæ”¶åˆ° DDL çš„ source/workerï¼ˆä»¥ä¸‹ worker éƒ½è¡¨ç¤º source/worker å¯¹ï¼‰æ•°é‡ã€‚å³å¦‚æœ worker æŠŠè¿™ä¸ª Lock ç›¸å…³çš„ DDLsï¼ˆå®é™…ä¸Šæ˜¯ info çš„å½¢å¼ï¼‰å‘ç»™ masterï¼Œmaster åˆ™æŠŠ `remain --`ã€‚\n- Ready å’Œ remain è¡¨è¾¾ç›¸åŒçš„æ„æ€ï¼Œremain å³è¡¨ç¤º ready ä¸­ä¸º `true` çš„ä¸ªæ•°\n- Done è¡¨ç¤º operation ç»“æŸçš„ worker çš„çŠ¶æ€\n\n> æ³¨æ„ï¼šä¸‹é¢è¯´çš„æ‰€æœ‰ worker éƒ½ ready å³æ˜¯ **remain <= 0**ï¼Œä»£ç ä¸­å³æ˜¯ **synced** = trueã€‚è¿™é‡Œåˆ›é€ çš„æ¦‚å¿µè¿‡å¤šï¼Œåº”è¯¥æ”¶æŸä¸€ä¸‹ï¼Œå‡å°‘ä»£ç çš„ç†è§£éš¾åº¦ã€‚\n\n> TODOï¼šå¯ä»¥æŠŠä»£ç ä¸­çš„ remain æ”¹æˆ noReadiesï¼›synced æ”¹æˆ allReady\n\n## 3ã€Info\n\n```go\n// Info represents the shard DDL information.\n\n// This information should be persistent in etcd so can be retrieved after the DM-master leader restarted or changed.\n\n// NOTE: `Task` and `Source` are redundant in the etcd key path for convenient.\n\ntype Info struct {\n\n    Task   string   `json:\"task\"`   // data migration task name\n\n    Source string   `json:\"source\"` // upstream source ID\n\n    Schema string   `json:\"schema\"` // schema name of the DDL\n\n    Table  string   `json:\"table\"`  // table name of the DDL\n\n    DDLs   []string `json:\"ddls\"`   // DDL statements\n\n}\n```\n\nInfo å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹ï¼Œåªæ˜¯ç”¨ä½œ worker é€šçŸ¥ masterï¼ŒæŸ lock ready çš„æ¶ˆæ¯ã€‚\n\n## 4ã€Operation\n\n```go\n// Operation represents a shard DDL coordinate operation.\n\n// This information should be persistent in etcd so can be retrieved after the DM-master leader restarted or changed.\n\n// NOTE: `Task` and `Source` are redundant in the etcd key path for convenient.\n\ntype Operation struct {\n\n    ID     string   `json:\"id\"`     // the corresponding DDL lock ID\n\n    Task   string   `json:\"task\"`   // data migration task name\n\n    Source string   `json:\"source\"` // upstream source ID\n\n    DDLs   []string `json:\"ddls\"`   // DDL statements\n\n    Exec   bool     `json:\"exec\"`   // execute or skip the DDL statements\n\n    Done   bool     `json:\"done\"`   // whether the `Exec` operation has done\n\n\n\n    // only used to report to the caller of the watcher, do not marsh it.\n\n    // if it's true, it means the Operation has been deleted in etcd.\n\n    IsDeleted bool `json:\"-\"`\n\n}\n```\n\n- Execï¼šæ˜¯ master å‘ worker å‘é€æ¶ˆæ¯æ—¶æ‰€ç”¨åˆ°çš„å­—æ®µã€‚å®ƒå‘ŠçŸ¥è¯¥ worker æ˜¯å¦éœ€è¦æ‰§è¡Œ DDLï¼Œåªéœ€è¦ owner æ‰§è¡Œ DDL\n- Doneï¼šæ˜¯ worker å‘ master å‘é€æ¶ˆæ¯æ—¶æ‰€ç”¨åˆ°çš„å­—æ®µã€‚å®ƒå‘ŠçŸ¥ master è¯¥ worker done äº†ã€‚done å¹¶ä¸ä»£è¡¨è¯¥ worker æ‰§è¡Œäº† DDLï¼Œè€Œæ˜¯è¡¨ç¤ºä¸€ç§çŠ¶æ€ï¼Œå› ä¸ºåªæœ‰ owner å¯ä»¥æ‰§è¡Œ DDLï¼Œnon-owner done å¯ä»¥å½“ä½œ non-worker æ¥å—åˆ°äº† DDL å·²æ‰§è¡Œçš„ä¿¡æ¯çš„ç¡®è®¤ã€‚\n\n## 3ã€Start\n\n> ä»¥ä¸‹å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­æœç´¢å¯¹åº”çš„åå­—ï¼Œè¯·åŠ¡å¿…ä¸å¯¹åº”ä»£ç ä¸€èµ·é˜…è¯»ï¼\n\n- s.pessimist.Start\n\n- p.run\n\n  - watchInfoOperation\n\n    - pessimism.WatchInfoPutï¼šç­‰å¾… worker å‘é€ info\n\n    - p.handleInfoPutï¼š\n\n      - æ”¶åˆ° Worker å‘é€çš„ info ä¹‹åï¼Œæ„å‘³ç€è¯¥ worker [å·² ready](https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/lock.go#L87-L88)\n      - å¦‚æœè¿™ä¸ªæ—¶å€™æ‰€æœ‰çš„ source/worker éƒ½ [readyï¼ˆsyncedï¼‰](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L486) äº†ï¼Œåˆ™å¯ä»¥[å‘é€ä¸€ä¸ª exec operation ç»™è¯¥ lock çš„ owner](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L602-L611)ï¼ˆç¬¬ä¸€ä¸ª[åˆ›å»º lock](https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/keeper.go#L49) çš„ workerï¼‰\n\n    - pessimism.WatchOperationPutï¼š\n\n      - ç­‰å¾… worker å‘é€ operation doneã€‚\n      - è¿™é‡Œçš„ operation å’Œ ä¸Šé¢å‘é€çš„ operation å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œç›‘å¬çš„æ²¡æœ‰æŒ‡å®š [task å’Œ source](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L192)ï¼Œä¸Šé¢å‘é€çš„ operation æ˜¯[æŒ‡å®š task å’Œ source](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L604) çš„ã€‚æ‰€ä»¥ä¸Šé¢å‘é€çš„ operation è¿™é‡Œä¹Ÿä¼šç›‘å¬åˆ°ï¼Œ\n\n    - p.handleOperationPutï¼š\n\n      - æ”¶åˆ° [not done ](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L509-L512)operation è¿™é‡Œå¹¶ä¸è¿›è¡Œæ“ä½œã€‚å³ä¸Šé¢å‘é€ exec operation çš„æ—¶å€™æ²¡æœ‰ doneã€‚\n\n      - å½“æ”¶åˆ° operation is done æ—¶ï¼Œæ‰è¿›è¡Œä¸€ç³»åˆ—æ“ä½œã€‚å³ä» worker å‘é€è¿‡æ¥çš„ done operationã€‚\n\n        - é¦–å…ˆ markDone\n        - å¦‚æœæ˜¯ owner done äº†ï¼Œè¿˜ä¼šå¯¹ non-owner å‘é€ [exec operation](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L553)ï¼Œç£ä¿ƒ non-owner done\n        - å¦‚æœæ‰€æœ‰çš„ worker éƒ½ done äº†ï¼ˆå³ resolvedï¼‰ï¼Œåˆ™[æŠŠ lock é‡Šæ”¾](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L533)\n\n  - é”™è¯¯å¤„ç†\n\n# ä¸‰ã€Worker\n\n## 1ã€Pessimist\n\n```go\n// Pessimist used to coordinate the shard DDL migration in pessimism mode.\n\ntype Pessimist struct {\n\n    mu sync.RWMutex\n\n\n\n    logger log.Logger\n\n    cli    *clientv3.Client\n\n    task   string\n\n    source string\n\n\n\n    // the shard DDL info which is pending to handle.\n\n    pendingInfo *pessimism.Info\n\n    // the shard DDL lock operation which is pending to handle.\n\n    pendingOp *pessimism.Operation\n\n}\n```\n\n- [NewPessimist](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L252)ï¼šworker ä¸­çš„ pessimist ä¸åŒäº master ä¸­çš„ pessimistã€‚å®ƒåªä¿å­˜äº† `pendingInfo` å’Œ `pendingOp`ï¼Œç”¨äºä¿å­˜å½“å‰çš„ Info å’Œ Operation\n\n## 2ã€ShardingGroupKeeper\n\n- [NewShardingGroupKeeper](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L277)ï¼šå…¶ä¸­æœ€é‡è¦çš„ç»“æ„ä½“å°±æ˜¯ `shardingGroup`ã€‚`shardingGroup` å’Œ master ä¸­çš„ `Lock` ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨äºç®¡ç† DDL å½±å“åˆ°çš„ tableï¼ˆåœ¨ Lock ä¸­æ˜¯ source/workerï¼‰ã€‚\n\n```go\n// ShardingGroupKeeper used to keep ShardingGroup.\n\ntype ShardingGroupKeeper struct {\n\n    sync.RWMutex\n\n    groups map[string]*ShardingGroup // target table ID -> ShardingGroup\n\n    cfg    *config.SubTaskConfig\n\n\n\n    shardMetaSchema    string\n\n    shardMetaTable     string\n\n    shardMetaTableName string\n\n\n\n    db     *conn.BaseDB\n\n    dbConn *dbconn.DBConn\n\n\n\n    tctx *tcontext.Context\n\n}\n```\n\n## 3ã€ShardingGroup\n\n```go\n// ShardingGroup represents a sharding DDL sync group.\n\ntype ShardingGroup struct {\n\n    sync.RWMutex\n\n    // remain count waiting for syncing\n\n    // == len(sources):  DDL syncing not started or resolved\n\n    // == 0: all DDLs synced, will be reset to len(sources) after resolved combining with other dm-workers\n\n    // (0, len(sources)): waiting for syncing\n\n    // NOTE: we can make remain to be configurable if needed\n\n    remain       int\n\n    sources      map[string]bool // source table ID -> whether source table's DDL synced\n\n    IsSchemaOnly bool            // whether is a schema (database) only DDL TODO: zxc add schema-level syncing support later\n\n\n\n    sourceID string                  // associate dm-worker source ID\n\n    meta     *shardmeta.ShardingMeta // sharding sequence meta storage\n\n\n\n    firstLocation    *binlog.Location // first DDL's binlog pos and gtid, used to restrain the global checkpoint when un-resolved\n\n    firstEndLocation *binlog.Location // first DDL's binlog End_log_pos and gtid, used to re-direct binlog streamer after synced\n\n    ddls             []string         // DDL which current in syncing\n\n\n\n    flavor     string\n\n    enableGTID bool\n\n}\n```\n\n- Remain å’Œ Lock ä¸­çš„ remain æ„ä¹‰å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡ŒæŒ‡ table æ˜¯å¦ readyï¼ˆç°ä»£ç ä¸­ç”¨çš„ syncedï¼‰\n\n> whether source table's DDL synced\n\n> TODOï¼šåº”è¯¥ç»Ÿä¸€æ¦‚å¿µï¼Œè¿™é‡Œä¹Ÿç”¨ ready è¡¨ç¤º\n\n- sourcesï¼šå’Œ Lock ä¸­çš„ ready ç±»ä¼¼\n- firstLocation/firstEndLocation/ddlsï¼šè¿™ä¸‰ä¸ªå…¶å®åœ¨ meta ä¸­éƒ½æœ‰ä¿å­˜ï¼Œæ‰€ä»¥æ„Ÿè§‰å…¶å®æ²¡å•¥ç”¨\n- metaï¼šé‡Œé¢ä¿å­˜ç€æ‰€æœ‰çš„æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä¸‹é¢è¯¦ç»†è¯´\n\n## 4ã€ShardingMeta\n\nè¿™äº›ä¿¡æ¯ä¼šè¢«æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­\n\n```go\n// ShardingMeta stores sharding ddl sequence\n\n// including global sequence and each source's own sequence\n\n// NOTE: sharding meta is not thread safe, it must be used in thread safe context.\n\ntype ShardingMeta struct {\n\n    activeIdx int                          // the first unsynced DDL index\n\n    global    *ShardingSequence            // merged sharding sequence of all source tables\n\n    sources   map[string]*ShardingSequence // source table ID -> its sharding sequence\n\n    tableName string                       // table name (with schema) used in downstream meta db\n\n\n\n    enableGTID bool // whether enableGTID, used to compare location\n\n}\n```\n\n- activeIdxï¼šè¡¨ç¤ºå½“å‰æ´»è·ƒçš„ DDL ä¸‹æ ‡ï¼Œå³ç°åœ¨è¢«å“ªä¸ª DDL å¡ä½äº†\n- globalï¼šè¡¨ç¤ºå…¨å±€çš„ DDL åºåˆ—ï¼Œå³æ‰€æœ‰ table ä¸­æœ€é•¿çš„\n- sourcesï¼šè¡¨ç¤ºå„ä¸ª table çš„ DDL åºåˆ—\n\n## 5ã€ShardingSequence å’Œ DDLItem\n\n```go\n// ShardingSequence records a list of DDLItem.\n\ntype ShardingSequence struct {\n\n    Items []*DDLItem `json:\"items\"`\n\n}\n```\n\n```go\n// DDLItem records ddl information used in sharding sequence organization.\n\ntype DDLItem struct {\n\n    FirstLocation binlog.Location `json:\"-\"`      // first DDL's binlog Pos, not the End_log_pos of the event\n\n    DDLs          []string        `json:\"ddls\"`   // DDLs, these ddls are in the same QueryEvent\n\n    Source        string          `json:\"source\"` // source table ID\n\n\n\n    // just used for json's marshal and unmarshal, because gtid.Set in FirstLocation is interface,\n\n    // can't be marshal and unmarshal\n\n    FirstPosition mysql.Position `json:\"first-position\"`\n\n    FirstGTIDSet  string         `json:\"first-gtid-set\"`\n\n}\n```\n\nè¿™é‡Œçš„ DDLItem å’Œ Lock ä¸­çš„ \\[]DDL å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ª DDLItem ä¸­ä¹ŸåŒ…å«å¤šä¸ª DDLã€‚ä½†æ˜¯è¿™é‡Œçš„ DDLItem ä¸­å°è£…äº†æ›´å¤šçš„ä¿¡æ¯ï¼š\n\n> DDLs \\[]string \\`json:\"ddls\"\\` // DDLs, these ddls are in the same QueryEvent\n\n- FirstLocationï¼šDDL å¼€å§‹çš„ä½ç‚¹ï¼Œä¸»è¦ç”¨äºè¯†åˆ«è¯¥ DDL ä¹‹å‰æ˜¯å¦æ¥è¿‡äº†ã€‚\n\n## 6ã€Init\n\n- s.sgk.Init()ï¼šåœ¨ä¸‹æ¸¸åˆ›å»ºåº“è¡¨ `dm_meta.($task)_syncer_sharding_meta`\n- s.initShardingGroups\n\n> TODOï¼šå¯ç”¨ `utils.FetchTargetDoTables()` æ›¿æ¢ `fromDB.FetchAllDoTables`\n\n1. s.sgk.LoadShardMetaï¼šæŠŠæ•°æ®è¯»å‡ºæ¥ï¼Œå­˜åˆ°å†…å­˜é‡Œ\n2. s.sgk.AddGroupï¼šæŠŠ ShardingGroup æ¢å¤\n\n- Reset\n\n## 7ã€Start\n\n- å¯åŠ¨ syncDDL çº¿ç¨‹ï¼Œç­‰å¾… DDL job\n\n# å››ã€æ€»ç»“\n\næœ¬å°èŠ‚ä¸»è¦ä»‹ç»äº†åœ¨æ‚²è§‚åè°ƒä¸­ï¼š\n\n- ä¼šç”¨åˆ°çš„å„ç§æ•°æ®ç»“æ„\n- Master è¿è¡Œäº†å‡ ä¸ªçº¿ç¨‹ï¼Œç­‰å¾… worker ä¸­ä¿¡æ¯çš„æ¥ä¸´\n- Worker è¿è¡Œäº† syncDDL çº¿ç¨‹ï¼Œç­‰å¾…ç€ DDL åˆ°æ¥\n\nè¿™ä¸€èŠ‚ä¸­ï¼Œç½—åˆ—äº†ç‰¹åˆ«å¤šçš„æ¦‚å¿µï¼Œçœ‹ä¸æ‡‚æ˜¯æ­£å¸¸çš„ï¼åœ¨ä¸‹ä¸€èŠ‚ï¼Œå°†ä» worker æ¥å—åˆ°ä¸€æ¡ DDL å¼€å§‹ï¼Œç›´åˆ°è¿™æ¡ DDL çš„ lock è§£é™¤çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ è¿™äº›ç»“æ„ä½“åˆ°åº•æ˜¯æ€ä¹ˆç”¨çš„ã€‚\n\n> æŠ±æ­‰ç¬¬äºŒç« å°±æ˜¯æ‚²è§‚åè°ƒè¿™ä¸ªåŠŸèƒ½ğŸ˜‚ï¼Œæœ¬æ¥æƒ³è®©ç³»åˆ—æ–‡ç« çš„éš¾åº¦æ›´åŠ å¹³æ»‘ä¸€ç‚¹çš„ï¼Œä½†æ˜¯äººå¤ªæ‡’äº†ä¸€æ‹–å†æ‹–ğŸ˜‚ã€‚ä¸ºäº†é¿å…å†æ‹–ä¸‹å»ï¼Œå…ˆæŠŠå†™äº†çš„å­˜æ´»å‘å‡ºæ¥å§ï¼\n","source":"_posts/DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”01å‡†å¤‡è¿‡ç¨‹.md","raw":"---\ntitle: DM æ•°æ®æ—…ç¨‹ 02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”01å‡†å¤‡è¿‡ç¨‹\ndate: 2023-01-03 03:50:33\ntags:\n- DM\n- æºç é˜…è¯»\ncategories:\n- DM æ•°æ®æ—…ç¨‹\ncover: /img/category/dm_shard.png\n---\n\n# ä¸€ã€æ¦‚è¿°\n\nåˆ†åº“åˆ†è¡¨çš„æ‚²è§‚åè°ƒæ–¹æ³•æ˜¯ 2018 å¹´å¼€å‘çš„ç‰¹æ€§ï¼Œæ˜¯ DM é¦–æ¬¡æ”¯æŒ MySQL åˆ†åº“åˆ†è¡¨çš„è¿ç§»ã€‚ç”±äºåˆ†åº“åˆ†è¡¨åœ¨å„ä¸ªå…¬å¸ä¸­çš„åº”ç”¨å®åœ¨å¤ªè¿‡å¹¿æ³›ï¼Œæ‰€ä»¥åªæœ‰åœ¨æ”¯æŒåˆ†åº“åˆ†è¡¨è¿ç§»åï¼ŒDM æ‰æœ‰äº†å·¥ç¨‹å®è·µçš„æ„ä¹‰ï¼Œå¦åˆ™åªèƒ½ç®—ä½œä¸€ä¸ªç©å…·ã€‚è¿™å¯¹ DM æ¥è¯´æ„ä¹‰é‡å¤§ã€‚\n\nç”±äºæ‚²è§‚åè°ƒçš„å†…å®¹åºå¤§ï¼Œæœ¬èŠ‚åªè®²è¿°æ‚²è§‚åè°ƒçš„å‡†å¤‡è¿‡ç¨‹ï¼š\n\n- Master çš„å‡†å¤‡è¿‡ç¨‹\n- Worker çš„å‡†å¤‡è¿‡ç¨‹\n\nä»¥åŠåœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­è‡³å…³é‡è¦çš„ç»“æ„ä½“ï¼š\n\n- Lock\n- Info\n- Operation\n- ShardingMeta\n- ShardingGroup\n- ...\n\n> æ³¨ï¼šä¸ºäº†ä¸“æ³¨äºæˆ‘ä»¬çš„ç›®çš„ï¼ˆæ‚²è§‚åè°ƒï¼‰ï¼Œæœ¬æ–‡ä¸ä¼šå¯¹æ— å…³ä»£ç è¿›è¡Œè§£è¯»\n\n> è¿™ä¸€èŠ‚å¤–é“¾ä¸­çš„ä»£ç ï¼Œè¯»è€…å¯èƒ½ä¼šäº§ç”Ÿè¿™ä¸ªé€»è¾‘ä¸ºä»€ä¹ˆæ˜¯è¿™é‡Œçš„ç–‘é—®ã€‚è¿™æ˜¯å› ä¸ºæœ¬èŠ‚å¹¶æ²¡æœ‰å®Œå…¨æŒ‰ç…§é¡ºåºè¯»ä»£ç ã€‚æ‰€ä»¥è¯»è€…å¯ä»¥ä»…å¸¦ç€å­¦ä¹ çš„å¿ƒæ€é˜…è¯»æœ¬èŠ‚ï¼Œæš‚æ—¶ä¸éœ€è¦çŸ¥é“å®ƒä¸ºä»€ä¹ˆåœ¨ä»£ç çš„è¿™ä¸ªåœ°æ–¹ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ä¼šé¡ºåºé˜…è¯»ä»£ç \n\n> æœ¬èŠ‚åŸºäº [DM release-6.0.0](https://github.com/pingcap/tiflow/tree/release-6.0)\n\n# äºŒã€Master\n\n## 1ã€Pessimist å’Œ LockKeeper\n\n- [NewPessimist](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/server.go#L140)ï¼šPessimist æ˜¯ Master å¤„ç†æ‚²è§‚åè°ƒçš„ç»“æ„ä½“ï¼Œå…¶ä¸­æœ€é‡è¦çš„æˆå‘˜æ˜¯ `LockKeeper`ã€‚\n- `LockKeeper` çš„ä½œç”¨æ˜¯ç®¡ç†å„ç§å„æ ·çš„ lockã€‚\n\n```go\n// LockKeeper used to keep and handle DDL lock conveniently.\n\n// The lock information do not need to be persistent, and can be re-constructed from the shard DDL info.\n\ntype LockKeeper struct {\n\n    mu    sync.RWMutex\n\n    locks map[string]*Lock // lockID -> Lock\n\n}\n```\n\n- Lock å¯ä»¥çœ‹ä½œæ˜¯æ¯ä¸€ä¸ª ddl å½±å“çš„åº“è¡¨ï¼Œè¿™äº›åº“è¡¨åˆ†å¸ƒåœ¨ä¸åŒçš„ MySQL/source ä¸­ã€‚ç”±äºåœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­ï¼Œæ•°æ®æµï¼ˆbinlog æµï¼‰ä¸æ˜¯åœæ»çš„ï¼Œæ‰€ä»¥åœ¨æ•°æ®æµä¸­ï¼Œä¼šæºæºä¸æ–­åœ°å‡ºç°æ–° DDLï¼Œå³æ–° lockã€‚\n- æ•… `LockKeeper` å°±æ˜¯ç®¡ç†è¿™äº› lockã€‚\n\n```go\n// Lock represents the shard DDL lock in memory.\n\n// This information does not need to be persistent, and can be re-constructed from the shard DDL info.\n\ntype Lock struct {\n\n    mu sync.RWMutex\n\n\n\n    ID     string   // lock's ID\n\n    Task   string   // lock's corresponding task name\n\n    Owner  string   // Owner's source ID (not DM-worker's name)\n\n    DDLs   []string // DDL statements\n\n    remain int      // remain count of sources needed to receive DDL info\n\n\n\n    // whether the DDL info received from the source.\n\n    // if all of them have been ready, then we call the lock `synced`.\n\n    ready map[string]bool\n\n\n\n    // whether the operations have done (exec/skip the shard DDL).\n\n    // if all of them have done, then we call the lock `resolved`.\n\n    done map[string]bool\n\n}\n```\n\n## 2ã€Lock\n\n- ID è¡¨ç°å½¢å¼ä¸º [${task}-${schema}.${table}](https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/utils/common.go#L223)ï¼Œä» LockKeeper çš„ç»“æ„å¯ä»¥çœ‹åˆ°åŒä¸€ä»»åŠ¡åŒä¸€è¡¨ä¸‹åªèƒ½æœ‰ä¸€ä¸ª lockï¼Œå¦‚æœé‡åˆ°äº†ä¸åŒçš„ DDLï¼Œå½±å“çš„åˆæ˜¯åŒä»»åŠ¡åŒè¡¨ï¼Œåˆ™[æŠ¥é”™](https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/lock.go#L72-L74)ã€‚\n- DDLs ä¸ºä»€ä¹ˆæ˜¯ `[]string`ï¼Ÿå› ä¸ºè¿™é‡Œæ˜¯ç»è¿‡ `Split` çš„ DDLsï¼Œå•æ¡ DDL å¯èƒ½ä¼šè¢« Split æˆå¤šæ¡ DDLã€‚\n- Remain è¡¨ç¤ºå‰©ä½™çš„è¿˜æœªæ”¶åˆ° DDL çš„ source/workerï¼ˆä»¥ä¸‹ worker éƒ½è¡¨ç¤º source/worker å¯¹ï¼‰æ•°é‡ã€‚å³å¦‚æœ worker æŠŠè¿™ä¸ª Lock ç›¸å…³çš„ DDLsï¼ˆå®é™…ä¸Šæ˜¯ info çš„å½¢å¼ï¼‰å‘ç»™ masterï¼Œmaster åˆ™æŠŠ `remain --`ã€‚\n- Ready å’Œ remain è¡¨è¾¾ç›¸åŒçš„æ„æ€ï¼Œremain å³è¡¨ç¤º ready ä¸­ä¸º `true` çš„ä¸ªæ•°\n- Done è¡¨ç¤º operation ç»“æŸçš„ worker çš„çŠ¶æ€\n\n> æ³¨æ„ï¼šä¸‹é¢è¯´çš„æ‰€æœ‰ worker éƒ½ ready å³æ˜¯ **remain <= 0**ï¼Œä»£ç ä¸­å³æ˜¯ **synced** = trueã€‚è¿™é‡Œåˆ›é€ çš„æ¦‚å¿µè¿‡å¤šï¼Œåº”è¯¥æ”¶æŸä¸€ä¸‹ï¼Œå‡å°‘ä»£ç çš„ç†è§£éš¾åº¦ã€‚\n\n> TODOï¼šå¯ä»¥æŠŠä»£ç ä¸­çš„ remain æ”¹æˆ noReadiesï¼›synced æ”¹æˆ allReady\n\n## 3ã€Info\n\n```go\n// Info represents the shard DDL information.\n\n// This information should be persistent in etcd so can be retrieved after the DM-master leader restarted or changed.\n\n// NOTE: `Task` and `Source` are redundant in the etcd key path for convenient.\n\ntype Info struct {\n\n    Task   string   `json:\"task\"`   // data migration task name\n\n    Source string   `json:\"source\"` // upstream source ID\n\n    Schema string   `json:\"schema\"` // schema name of the DDL\n\n    Table  string   `json:\"table\"`  // table name of the DDL\n\n    DDLs   []string `json:\"ddls\"`   // DDL statements\n\n}\n```\n\nInfo å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹ï¼Œåªæ˜¯ç”¨ä½œ worker é€šçŸ¥ masterï¼ŒæŸ lock ready çš„æ¶ˆæ¯ã€‚\n\n## 4ã€Operation\n\n```go\n// Operation represents a shard DDL coordinate operation.\n\n// This information should be persistent in etcd so can be retrieved after the DM-master leader restarted or changed.\n\n// NOTE: `Task` and `Source` are redundant in the etcd key path for convenient.\n\ntype Operation struct {\n\n    ID     string   `json:\"id\"`     // the corresponding DDL lock ID\n\n    Task   string   `json:\"task\"`   // data migration task name\n\n    Source string   `json:\"source\"` // upstream source ID\n\n    DDLs   []string `json:\"ddls\"`   // DDL statements\n\n    Exec   bool     `json:\"exec\"`   // execute or skip the DDL statements\n\n    Done   bool     `json:\"done\"`   // whether the `Exec` operation has done\n\n\n\n    // only used to report to the caller of the watcher, do not marsh it.\n\n    // if it's true, it means the Operation has been deleted in etcd.\n\n    IsDeleted bool `json:\"-\"`\n\n}\n```\n\n- Execï¼šæ˜¯ master å‘ worker å‘é€æ¶ˆæ¯æ—¶æ‰€ç”¨åˆ°çš„å­—æ®µã€‚å®ƒå‘ŠçŸ¥è¯¥ worker æ˜¯å¦éœ€è¦æ‰§è¡Œ DDLï¼Œåªéœ€è¦ owner æ‰§è¡Œ DDL\n- Doneï¼šæ˜¯ worker å‘ master å‘é€æ¶ˆæ¯æ—¶æ‰€ç”¨åˆ°çš„å­—æ®µã€‚å®ƒå‘ŠçŸ¥ master è¯¥ worker done äº†ã€‚done å¹¶ä¸ä»£è¡¨è¯¥ worker æ‰§è¡Œäº† DDLï¼Œè€Œæ˜¯è¡¨ç¤ºä¸€ç§çŠ¶æ€ï¼Œå› ä¸ºåªæœ‰ owner å¯ä»¥æ‰§è¡Œ DDLï¼Œnon-owner done å¯ä»¥å½“ä½œ non-worker æ¥å—åˆ°äº† DDL å·²æ‰§è¡Œçš„ä¿¡æ¯çš„ç¡®è®¤ã€‚\n\n## 3ã€Start\n\n> ä»¥ä¸‹å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­æœç´¢å¯¹åº”çš„åå­—ï¼Œè¯·åŠ¡å¿…ä¸å¯¹åº”ä»£ç ä¸€èµ·é˜…è¯»ï¼\n\n- s.pessimist.Start\n\n- p.run\n\n  - watchInfoOperation\n\n    - pessimism.WatchInfoPutï¼šç­‰å¾… worker å‘é€ info\n\n    - p.handleInfoPutï¼š\n\n      - æ”¶åˆ° Worker å‘é€çš„ info ä¹‹åï¼Œæ„å‘³ç€è¯¥ worker [å·² ready](https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/lock.go#L87-L88)\n      - å¦‚æœè¿™ä¸ªæ—¶å€™æ‰€æœ‰çš„ source/worker éƒ½ [readyï¼ˆsyncedï¼‰](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L486) äº†ï¼Œåˆ™å¯ä»¥[å‘é€ä¸€ä¸ª exec operation ç»™è¯¥ lock çš„ owner](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L602-L611)ï¼ˆç¬¬ä¸€ä¸ª[åˆ›å»º lock](https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/keeper.go#L49) çš„ workerï¼‰\n\n    - pessimism.WatchOperationPutï¼š\n\n      - ç­‰å¾… worker å‘é€ operation doneã€‚\n      - è¿™é‡Œçš„ operation å’Œ ä¸Šé¢å‘é€çš„ operation å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œç›‘å¬çš„æ²¡æœ‰æŒ‡å®š [task å’Œ source](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L192)ï¼Œä¸Šé¢å‘é€çš„ operation æ˜¯[æŒ‡å®š task å’Œ source](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L604) çš„ã€‚æ‰€ä»¥ä¸Šé¢å‘é€çš„ operation è¿™é‡Œä¹Ÿä¼šç›‘å¬åˆ°ï¼Œ\n\n    - p.handleOperationPutï¼š\n\n      - æ”¶åˆ° [not done ](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L509-L512)operation è¿™é‡Œå¹¶ä¸è¿›è¡Œæ“ä½œã€‚å³ä¸Šé¢å‘é€ exec operation çš„æ—¶å€™æ²¡æœ‰ doneã€‚\n\n      - å½“æ”¶åˆ° operation is done æ—¶ï¼Œæ‰è¿›è¡Œä¸€ç³»åˆ—æ“ä½œã€‚å³ä» worker å‘é€è¿‡æ¥çš„ done operationã€‚\n\n        - é¦–å…ˆ markDone\n        - å¦‚æœæ˜¯ owner done äº†ï¼Œè¿˜ä¼šå¯¹ non-owner å‘é€ [exec operation](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L553)ï¼Œç£ä¿ƒ non-owner done\n        - å¦‚æœæ‰€æœ‰çš„ worker éƒ½ done äº†ï¼ˆå³ resolvedï¼‰ï¼Œåˆ™[æŠŠ lock é‡Šæ”¾](https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L533)\n\n  - é”™è¯¯å¤„ç†\n\n# ä¸‰ã€Worker\n\n## 1ã€Pessimist\n\n```go\n// Pessimist used to coordinate the shard DDL migration in pessimism mode.\n\ntype Pessimist struct {\n\n    mu sync.RWMutex\n\n\n\n    logger log.Logger\n\n    cli    *clientv3.Client\n\n    task   string\n\n    source string\n\n\n\n    // the shard DDL info which is pending to handle.\n\n    pendingInfo *pessimism.Info\n\n    // the shard DDL lock operation which is pending to handle.\n\n    pendingOp *pessimism.Operation\n\n}\n```\n\n- [NewPessimist](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L252)ï¼šworker ä¸­çš„ pessimist ä¸åŒäº master ä¸­çš„ pessimistã€‚å®ƒåªä¿å­˜äº† `pendingInfo` å’Œ `pendingOp`ï¼Œç”¨äºä¿å­˜å½“å‰çš„ Info å’Œ Operation\n\n## 2ã€ShardingGroupKeeper\n\n- [NewShardingGroupKeeper](https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L277)ï¼šå…¶ä¸­æœ€é‡è¦çš„ç»“æ„ä½“å°±æ˜¯ `shardingGroup`ã€‚`shardingGroup` å’Œ master ä¸­çš„ `Lock` ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨äºç®¡ç† DDL å½±å“åˆ°çš„ tableï¼ˆåœ¨ Lock ä¸­æ˜¯ source/workerï¼‰ã€‚\n\n```go\n// ShardingGroupKeeper used to keep ShardingGroup.\n\ntype ShardingGroupKeeper struct {\n\n    sync.RWMutex\n\n    groups map[string]*ShardingGroup // target table ID -> ShardingGroup\n\n    cfg    *config.SubTaskConfig\n\n\n\n    shardMetaSchema    string\n\n    shardMetaTable     string\n\n    shardMetaTableName string\n\n\n\n    db     *conn.BaseDB\n\n    dbConn *dbconn.DBConn\n\n\n\n    tctx *tcontext.Context\n\n}\n```\n\n## 3ã€ShardingGroup\n\n```go\n// ShardingGroup represents a sharding DDL sync group.\n\ntype ShardingGroup struct {\n\n    sync.RWMutex\n\n    // remain count waiting for syncing\n\n    // == len(sources):  DDL syncing not started or resolved\n\n    // == 0: all DDLs synced, will be reset to len(sources) after resolved combining with other dm-workers\n\n    // (0, len(sources)): waiting for syncing\n\n    // NOTE: we can make remain to be configurable if needed\n\n    remain       int\n\n    sources      map[string]bool // source table ID -> whether source table's DDL synced\n\n    IsSchemaOnly bool            // whether is a schema (database) only DDL TODO: zxc add schema-level syncing support later\n\n\n\n    sourceID string                  // associate dm-worker source ID\n\n    meta     *shardmeta.ShardingMeta // sharding sequence meta storage\n\n\n\n    firstLocation    *binlog.Location // first DDL's binlog pos and gtid, used to restrain the global checkpoint when un-resolved\n\n    firstEndLocation *binlog.Location // first DDL's binlog End_log_pos and gtid, used to re-direct binlog streamer after synced\n\n    ddls             []string         // DDL which current in syncing\n\n\n\n    flavor     string\n\n    enableGTID bool\n\n}\n```\n\n- Remain å’Œ Lock ä¸­çš„ remain æ„ä¹‰å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡ŒæŒ‡ table æ˜¯å¦ readyï¼ˆç°ä»£ç ä¸­ç”¨çš„ syncedï¼‰\n\n> whether source table's DDL synced\n\n> TODOï¼šåº”è¯¥ç»Ÿä¸€æ¦‚å¿µï¼Œè¿™é‡Œä¹Ÿç”¨ ready è¡¨ç¤º\n\n- sourcesï¼šå’Œ Lock ä¸­çš„ ready ç±»ä¼¼\n- firstLocation/firstEndLocation/ddlsï¼šè¿™ä¸‰ä¸ªå…¶å®åœ¨ meta ä¸­éƒ½æœ‰ä¿å­˜ï¼Œæ‰€ä»¥æ„Ÿè§‰å…¶å®æ²¡å•¥ç”¨\n- metaï¼šé‡Œé¢ä¿å­˜ç€æ‰€æœ‰çš„æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä¸‹é¢è¯¦ç»†è¯´\n\n## 4ã€ShardingMeta\n\nè¿™äº›ä¿¡æ¯ä¼šè¢«æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­\n\n```go\n// ShardingMeta stores sharding ddl sequence\n\n// including global sequence and each source's own sequence\n\n// NOTE: sharding meta is not thread safe, it must be used in thread safe context.\n\ntype ShardingMeta struct {\n\n    activeIdx int                          // the first unsynced DDL index\n\n    global    *ShardingSequence            // merged sharding sequence of all source tables\n\n    sources   map[string]*ShardingSequence // source table ID -> its sharding sequence\n\n    tableName string                       // table name (with schema) used in downstream meta db\n\n\n\n    enableGTID bool // whether enableGTID, used to compare location\n\n}\n```\n\n- activeIdxï¼šè¡¨ç¤ºå½“å‰æ´»è·ƒçš„ DDL ä¸‹æ ‡ï¼Œå³ç°åœ¨è¢«å“ªä¸ª DDL å¡ä½äº†\n- globalï¼šè¡¨ç¤ºå…¨å±€çš„ DDL åºåˆ—ï¼Œå³æ‰€æœ‰ table ä¸­æœ€é•¿çš„\n- sourcesï¼šè¡¨ç¤ºå„ä¸ª table çš„ DDL åºåˆ—\n\n## 5ã€ShardingSequence å’Œ DDLItem\n\n```go\n// ShardingSequence records a list of DDLItem.\n\ntype ShardingSequence struct {\n\n    Items []*DDLItem `json:\"items\"`\n\n}\n```\n\n```go\n// DDLItem records ddl information used in sharding sequence organization.\n\ntype DDLItem struct {\n\n    FirstLocation binlog.Location `json:\"-\"`      // first DDL's binlog Pos, not the End_log_pos of the event\n\n    DDLs          []string        `json:\"ddls\"`   // DDLs, these ddls are in the same QueryEvent\n\n    Source        string          `json:\"source\"` // source table ID\n\n\n\n    // just used for json's marshal and unmarshal, because gtid.Set in FirstLocation is interface,\n\n    // can't be marshal and unmarshal\n\n    FirstPosition mysql.Position `json:\"first-position\"`\n\n    FirstGTIDSet  string         `json:\"first-gtid-set\"`\n\n}\n```\n\nè¿™é‡Œçš„ DDLItem å’Œ Lock ä¸­çš„ \\[]DDL å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ª DDLItem ä¸­ä¹ŸåŒ…å«å¤šä¸ª DDLã€‚ä½†æ˜¯è¿™é‡Œçš„ DDLItem ä¸­å°è£…äº†æ›´å¤šçš„ä¿¡æ¯ï¼š\n\n> DDLs \\[]string \\`json:\"ddls\"\\` // DDLs, these ddls are in the same QueryEvent\n\n- FirstLocationï¼šDDL å¼€å§‹çš„ä½ç‚¹ï¼Œä¸»è¦ç”¨äºè¯†åˆ«è¯¥ DDL ä¹‹å‰æ˜¯å¦æ¥è¿‡äº†ã€‚\n\n## 6ã€Init\n\n- s.sgk.Init()ï¼šåœ¨ä¸‹æ¸¸åˆ›å»ºåº“è¡¨ `dm_meta.($task)_syncer_sharding_meta`\n- s.initShardingGroups\n\n> TODOï¼šå¯ç”¨ `utils.FetchTargetDoTables()` æ›¿æ¢ `fromDB.FetchAllDoTables`\n\n1. s.sgk.LoadShardMetaï¼šæŠŠæ•°æ®è¯»å‡ºæ¥ï¼Œå­˜åˆ°å†…å­˜é‡Œ\n2. s.sgk.AddGroupï¼šæŠŠ ShardingGroup æ¢å¤\n\n- Reset\n\n## 7ã€Start\n\n- å¯åŠ¨ syncDDL çº¿ç¨‹ï¼Œç­‰å¾… DDL job\n\n# å››ã€æ€»ç»“\n\næœ¬å°èŠ‚ä¸»è¦ä»‹ç»äº†åœ¨æ‚²è§‚åè°ƒä¸­ï¼š\n\n- ä¼šç”¨åˆ°çš„å„ç§æ•°æ®ç»“æ„\n- Master è¿è¡Œäº†å‡ ä¸ªçº¿ç¨‹ï¼Œç­‰å¾… worker ä¸­ä¿¡æ¯çš„æ¥ä¸´\n- Worker è¿è¡Œäº† syncDDL çº¿ç¨‹ï¼Œç­‰å¾…ç€ DDL åˆ°æ¥\n\nè¿™ä¸€èŠ‚ä¸­ï¼Œç½—åˆ—äº†ç‰¹åˆ«å¤šçš„æ¦‚å¿µï¼Œçœ‹ä¸æ‡‚æ˜¯æ­£å¸¸çš„ï¼åœ¨ä¸‹ä¸€èŠ‚ï¼Œå°†ä» worker æ¥å—åˆ°ä¸€æ¡ DDL å¼€å§‹ï¼Œç›´åˆ°è¿™æ¡ DDL çš„ lock è§£é™¤çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ è¿™äº›ç»“æ„ä½“åˆ°åº•æ˜¯æ€ä¹ˆç”¨çš„ã€‚\n\n> æŠ±æ­‰ç¬¬äºŒç« å°±æ˜¯æ‚²è§‚åè°ƒè¿™ä¸ªåŠŸèƒ½ğŸ˜‚ï¼Œæœ¬æ¥æƒ³è®©ç³»åˆ—æ–‡ç« çš„éš¾åº¦æ›´åŠ å¹³æ»‘ä¸€ç‚¹çš„ï¼Œä½†æ˜¯äººå¤ªæ‡’äº†ä¸€æ‹–å†æ‹–ğŸ˜‚ã€‚ä¸ºäº†é¿å…å†æ‹–ä¸‹å»ï¼Œå…ˆæŠŠå†™äº†çš„å­˜æ´»å‘å‡ºæ¥å§ï¼\n","slug":"DM-æ•°æ®æ—…ç¨‹-02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”01å‡†å¤‡è¿‡ç¨‹","published":1,"updated":"2024-06-16T07:10:04.519Z","_id":"clxh0zy370000hfdy585eg5ei","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"ä¸€ã€æ¦‚è¿°\"><a href=\"#ä¸€ã€æ¦‚è¿°\" class=\"headerlink\" title=\"ä¸€ã€æ¦‚è¿°\"></a>ä¸€ã€æ¦‚è¿°</h1><p>åˆ†åº“åˆ†è¡¨çš„æ‚²è§‚åè°ƒæ–¹æ³•æ˜¯ 2018 å¹´å¼€å‘çš„ç‰¹æ€§ï¼Œæ˜¯ DM é¦–æ¬¡æ”¯æŒ MySQL åˆ†åº“åˆ†è¡¨çš„è¿ç§»ã€‚ç”±äºåˆ†åº“åˆ†è¡¨åœ¨å„ä¸ªå…¬å¸ä¸­çš„åº”ç”¨å®åœ¨å¤ªè¿‡å¹¿æ³›ï¼Œæ‰€ä»¥åªæœ‰åœ¨æ”¯æŒåˆ†åº“åˆ†è¡¨è¿ç§»åï¼ŒDM æ‰æœ‰äº†å·¥ç¨‹å®è·µçš„æ„ä¹‰ï¼Œå¦åˆ™åªèƒ½ç®—ä½œä¸€ä¸ªç©å…·ã€‚è¿™å¯¹ DM æ¥è¯´æ„ä¹‰é‡å¤§ã€‚</p>\n<p>ç”±äºæ‚²è§‚åè°ƒçš„å†…å®¹åºå¤§ï¼Œæœ¬èŠ‚åªè®²è¿°æ‚²è§‚åè°ƒçš„å‡†å¤‡è¿‡ç¨‹ï¼š</p>\n<ul>\n<li>Master çš„å‡†å¤‡è¿‡ç¨‹</li>\n<li>Worker çš„å‡†å¤‡è¿‡ç¨‹</li>\n</ul>\n<p>ä»¥åŠåœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­è‡³å…³é‡è¦çš„ç»“æ„ä½“ï¼š</p>\n<ul>\n<li>Lock</li>\n<li>Info</li>\n<li>Operation</li>\n<li>ShardingMeta</li>\n<li>ShardingGroup</li>\n<li>â€¦</li>\n</ul>\n<blockquote>\n<p>æ³¨ï¼šä¸ºäº†ä¸“æ³¨äºæˆ‘ä»¬çš„ç›®çš„ï¼ˆæ‚²è§‚åè°ƒï¼‰ï¼Œæœ¬æ–‡ä¸ä¼šå¯¹æ— å…³ä»£ç è¿›è¡Œè§£è¯»</p>\n</blockquote>\n<blockquote>\n<p>è¿™ä¸€èŠ‚å¤–é“¾ä¸­çš„ä»£ç ï¼Œè¯»è€…å¯èƒ½ä¼šäº§ç”Ÿè¿™ä¸ªé€»è¾‘ä¸ºä»€ä¹ˆæ˜¯è¿™é‡Œçš„ç–‘é—®ã€‚è¿™æ˜¯å› ä¸ºæœ¬èŠ‚å¹¶æ²¡æœ‰å®Œå…¨æŒ‰ç…§é¡ºåºè¯»ä»£ç ã€‚æ‰€ä»¥è¯»è€…å¯ä»¥ä»…å¸¦ç€å­¦ä¹ çš„å¿ƒæ€é˜…è¯»æœ¬èŠ‚ï¼Œæš‚æ—¶ä¸éœ€è¦çŸ¥é“å®ƒä¸ºä»€ä¹ˆåœ¨ä»£ç çš„è¿™ä¸ªåœ°æ–¹ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ä¼šé¡ºåºé˜…è¯»ä»£ç </p>\n</blockquote>\n<blockquote>\n<p>æœ¬èŠ‚åŸºäº <a href=\"https://github.com/pingcap/tiflow/tree/release-6.0\">DM release-6.0.0</a></p>\n</blockquote>\n<h1 id=\"äºŒã€Master\"><a href=\"#äºŒã€Master\" class=\"headerlink\" title=\"äºŒã€Master\"></a>äºŒã€Master</h1><h2 id=\"1ã€Pessimist-å’Œ-LockKeeper\"><a href=\"#1ã€Pessimist-å’Œ-LockKeeper\" class=\"headerlink\" title=\"1ã€Pessimist å’Œ LockKeeper\"></a>1ã€Pessimist å’Œ LockKeeper</h2><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/server.go#L140\">NewPessimist</a>ï¼šPessimist æ˜¯ Master å¤„ç†æ‚²è§‚åè°ƒçš„ç»“æ„ä½“ï¼Œå…¶ä¸­æœ€é‡è¦çš„æˆå‘˜æ˜¯ <code>LockKeeper</code>ã€‚</li>\n<li><code>LockKeeper</code> çš„ä½œç”¨æ˜¯ç®¡ç†å„ç§å„æ ·çš„ lockã€‚</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// LockKeeper used to keep and handle DDL lock conveniently.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The lock information do not need to be persistent, and can be re-constructed from the shard DDL info.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> LockKeeper <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    mu    sync.RWMutex</span><br><span class=\"line\"></span><br><span class=\"line\">    locks <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]*Lock <span class=\"comment\">// lockID -&gt; Lock</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Lock å¯ä»¥çœ‹ä½œæ˜¯æ¯ä¸€ä¸ª ddl å½±å“çš„åº“è¡¨ï¼Œè¿™äº›åº“è¡¨åˆ†å¸ƒåœ¨ä¸åŒçš„ MySQL/source ä¸­ã€‚ç”±äºåœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­ï¼Œæ•°æ®æµï¼ˆbinlog æµï¼‰ä¸æ˜¯åœæ»çš„ï¼Œæ‰€ä»¥åœ¨æ•°æ®æµä¸­ï¼Œä¼šæºæºä¸æ–­åœ°å‡ºç°æ–° DDLï¼Œå³æ–° lockã€‚</li>\n<li>æ•… <code>LockKeeper</code> å°±æ˜¯ç®¡ç†è¿™äº› lockã€‚</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Lock represents the shard DDL lock in memory.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This information does not need to be persistent, and can be re-constructed from the shard DDL info.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Lock <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    mu sync.RWMutex</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    ID     <span class=\"type\">string</span>   <span class=\"comment\">// lock&#x27;s ID</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Task   <span class=\"type\">string</span>   <span class=\"comment\">// lock&#x27;s corresponding task name</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Owner  <span class=\"type\">string</span>   <span class=\"comment\">// Owner&#x27;s source ID (not DM-worker&#x27;s name)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    DDLs   []<span class=\"type\">string</span> <span class=\"comment\">// DDL statements</span></span><br><span class=\"line\"></span><br><span class=\"line\">    remain <span class=\"type\">int</span>      <span class=\"comment\">// remain count of sources needed to receive DDL info</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// whether the DDL info received from the source.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// if all of them have been ready, then we call the lock `synced`.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ready <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// whether the operations have done (exec/skip the shard DDL).</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// if all of them have done, then we call the lock `resolved`.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    done <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2ã€Lock\"><a href=\"#2ã€Lock\" class=\"headerlink\" title=\"2ã€Lock\"></a>2ã€Lock</h2><ul>\n<li>ID è¡¨ç°å½¢å¼ä¸º <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/utils/common.go#L223\">${task}-${schema}.${table}</a>ï¼Œä» LockKeeper çš„ç»“æ„å¯ä»¥çœ‹åˆ°åŒä¸€ä»»åŠ¡åŒä¸€è¡¨ä¸‹åªèƒ½æœ‰ä¸€ä¸ª lockï¼Œå¦‚æœé‡åˆ°äº†ä¸åŒçš„ DDLï¼Œå½±å“çš„åˆæ˜¯åŒä»»åŠ¡åŒè¡¨ï¼Œåˆ™<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/lock.go#L72-L74\">æŠ¥é”™</a>ã€‚</li>\n<li>DDLs ä¸ºä»€ä¹ˆæ˜¯ <code>[]string</code>ï¼Ÿå› ä¸ºè¿™é‡Œæ˜¯ç»è¿‡ <code>Split</code> çš„ DDLsï¼Œå•æ¡ DDL å¯èƒ½ä¼šè¢« Split æˆå¤šæ¡ DDLã€‚</li>\n<li>Remain è¡¨ç¤ºå‰©ä½™çš„è¿˜æœªæ”¶åˆ° DDL çš„ source/workerï¼ˆä»¥ä¸‹ worker éƒ½è¡¨ç¤º source/worker å¯¹ï¼‰æ•°é‡ã€‚å³å¦‚æœ worker æŠŠè¿™ä¸ª Lock ç›¸å…³çš„ DDLsï¼ˆå®é™…ä¸Šæ˜¯ info çš„å½¢å¼ï¼‰å‘ç»™ masterï¼Œmaster åˆ™æŠŠ <code>remain --</code>ã€‚</li>\n<li>Ready å’Œ remain è¡¨è¾¾ç›¸åŒçš„æ„æ€ï¼Œremain å³è¡¨ç¤º ready ä¸­ä¸º <code>true</code> çš„ä¸ªæ•°</li>\n<li>Done è¡¨ç¤º operation ç»“æŸçš„ worker çš„çŠ¶æ€</li>\n</ul>\n<blockquote>\n<p>æ³¨æ„ï¼šä¸‹é¢è¯´çš„æ‰€æœ‰ worker éƒ½ ready å³æ˜¯ <strong>remain &lt;= 0</strong>ï¼Œä»£ç ä¸­å³æ˜¯ <strong>synced</strong> = trueã€‚è¿™é‡Œåˆ›é€ çš„æ¦‚å¿µè¿‡å¤šï¼Œåº”è¯¥æ”¶æŸä¸€ä¸‹ï¼Œå‡å°‘ä»£ç çš„ç†è§£éš¾åº¦ã€‚</p>\n</blockquote>\n<blockquote>\n<p>TODOï¼šå¯ä»¥æŠŠä»£ç ä¸­çš„ remain æ”¹æˆ noReadiesï¼›synced æ”¹æˆ allReady</p>\n</blockquote>\n<h2 id=\"3ã€Info\"><a href=\"#3ã€Info\" class=\"headerlink\" title=\"3ã€Info\"></a>3ã€Info</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Info represents the shard DDL information.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This information should be persistent in etcd so can be retrieved after the DM-master leader restarted or changed.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// <span class=\"doctag\">NOTE:</span> `Task` and `Source` are redundant in the etcd key path for convenient.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Info <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    Task   <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;task&quot;`</span>   <span class=\"comment\">// data migration task name</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Source <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;source&quot;`</span> <span class=\"comment\">// upstream source ID</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Schema <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;schema&quot;`</span> <span class=\"comment\">// schema name of the DDL</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Table  <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;table&quot;`</span>  <span class=\"comment\">// table name of the DDL</span></span><br><span class=\"line\"></span><br><span class=\"line\">    DDLs   []<span class=\"type\">string</span> <span class=\"string\">`json:&quot;ddls&quot;`</span>   <span class=\"comment\">// DDL statements</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Info å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹ï¼Œåªæ˜¯ç”¨ä½œ worker é€šçŸ¥ masterï¼ŒæŸ lock ready çš„æ¶ˆæ¯ã€‚</p>\n<h2 id=\"4ã€Operation\"><a href=\"#4ã€Operation\" class=\"headerlink\" title=\"4ã€Operation\"></a>4ã€Operation</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Operation represents a shard DDL coordinate operation.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This information should be persistent in etcd so can be retrieved after the DM-master leader restarted or changed.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// <span class=\"doctag\">NOTE:</span> `Task` and `Source` are redundant in the etcd key path for convenient.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Operation <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    ID     <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;id&quot;`</span>     <span class=\"comment\">// the corresponding DDL lock ID</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Task   <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;task&quot;`</span>   <span class=\"comment\">// data migration task name</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Source <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;source&quot;`</span> <span class=\"comment\">// upstream source ID</span></span><br><span class=\"line\"></span><br><span class=\"line\">    DDLs   []<span class=\"type\">string</span> <span class=\"string\">`json:&quot;ddls&quot;`</span>   <span class=\"comment\">// DDL statements</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Exec   <span class=\"type\">bool</span>     <span class=\"string\">`json:&quot;exec&quot;`</span>   <span class=\"comment\">// execute or skip the DDL statements</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Done   <span class=\"type\">bool</span>     <span class=\"string\">`json:&quot;done&quot;`</span>   <span class=\"comment\">// whether the `Exec` operation has done</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// only used to report to the caller of the watcher, do not marsh it.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// if it&#x27;s true, it means the Operation has been deleted in etcd.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    IsDeleted <span class=\"type\">bool</span> <span class=\"string\">`json:&quot;-&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Execï¼šæ˜¯ master å‘ worker å‘é€æ¶ˆæ¯æ—¶æ‰€ç”¨åˆ°çš„å­—æ®µã€‚å®ƒå‘ŠçŸ¥è¯¥ worker æ˜¯å¦éœ€è¦æ‰§è¡Œ DDLï¼Œåªéœ€è¦ owner æ‰§è¡Œ DDL</li>\n<li>Doneï¼šæ˜¯ worker å‘ master å‘é€æ¶ˆæ¯æ—¶æ‰€ç”¨åˆ°çš„å­—æ®µã€‚å®ƒå‘ŠçŸ¥ master è¯¥ worker done äº†ã€‚done å¹¶ä¸ä»£è¡¨è¯¥ worker æ‰§è¡Œäº† DDLï¼Œè€Œæ˜¯è¡¨ç¤ºä¸€ç§çŠ¶æ€ï¼Œå› ä¸ºåªæœ‰ owner å¯ä»¥æ‰§è¡Œ DDLï¼Œnon-owner done å¯ä»¥å½“ä½œ non-worker æ¥å—åˆ°äº† DDL å·²æ‰§è¡Œçš„ä¿¡æ¯çš„ç¡®è®¤ã€‚</li>\n</ul>\n<h2 id=\"3ã€Start\"><a href=\"#3ã€Start\" class=\"headerlink\" title=\"3ã€Start\"></a>3ã€Start</h2><blockquote>\n<p>ä»¥ä¸‹å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­æœç´¢å¯¹åº”çš„åå­—ï¼Œè¯·åŠ¡å¿…ä¸å¯¹åº”ä»£ç ä¸€èµ·é˜…è¯»ï¼</p>\n</blockquote>\n<ul>\n<li><p>s.pessimist.Start</p>\n</li>\n<li><p>p.run</p>\n<ul>\n<li><p>watchInfoOperation</p>\n<ul>\n<li><p>pessimism.WatchInfoPutï¼šç­‰å¾… worker å‘é€ info</p>\n</li>\n<li><p>p.handleInfoPutï¼š</p>\n<ul>\n<li>æ”¶åˆ° Worker å‘é€çš„ info ä¹‹åï¼Œæ„å‘³ç€è¯¥ worker <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/lock.go#L87-L88\">å·² ready</a></li>\n<li>å¦‚æœè¿™ä¸ªæ—¶å€™æ‰€æœ‰çš„ source/worker éƒ½ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L486\">readyï¼ˆsyncedï¼‰</a> äº†ï¼Œåˆ™å¯ä»¥<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L602-L611\">å‘é€ä¸€ä¸ª exec operation ç»™è¯¥ lock çš„ owner</a>ï¼ˆç¬¬ä¸€ä¸ª<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/keeper.go#L49\">åˆ›å»º lock</a> çš„ workerï¼‰</li>\n</ul>\n</li>\n<li><p>pessimism.WatchOperationPutï¼š</p>\n<ul>\n<li>ç­‰å¾… worker å‘é€ operation doneã€‚</li>\n<li>è¿™é‡Œçš„ operation å’Œ ä¸Šé¢å‘é€çš„ operation å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œç›‘å¬çš„æ²¡æœ‰æŒ‡å®š <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L192\">task å’Œ source</a>ï¼Œä¸Šé¢å‘é€çš„ operation æ˜¯<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L604\">æŒ‡å®š task å’Œ source</a> çš„ã€‚æ‰€ä»¥ä¸Šé¢å‘é€çš„ operation è¿™é‡Œä¹Ÿä¼šç›‘å¬åˆ°ï¼Œ</li>\n</ul>\n</li>\n<li><p>p.handleOperationPutï¼š</p>\n<ul>\n<li><p>æ”¶åˆ° <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L509-L512\">not done </a>operation è¿™é‡Œå¹¶ä¸è¿›è¡Œæ“ä½œã€‚å³ä¸Šé¢å‘é€ exec operation çš„æ—¶å€™æ²¡æœ‰ doneã€‚</p>\n</li>\n<li><p>å½“æ”¶åˆ° operation is done æ—¶ï¼Œæ‰è¿›è¡Œä¸€ç³»åˆ—æ“ä½œã€‚å³ä» worker å‘é€è¿‡æ¥çš„ done operationã€‚</p>\n<ul>\n<li>é¦–å…ˆ markDone</li>\n<li>å¦‚æœæ˜¯ owner done äº†ï¼Œè¿˜ä¼šå¯¹ non-owner å‘é€ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L553\">exec operation</a>ï¼Œç£ä¿ƒ non-owner done</li>\n<li>å¦‚æœæ‰€æœ‰çš„ worker éƒ½ done äº†ï¼ˆå³ resolvedï¼‰ï¼Œåˆ™<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L533\">æŠŠ lock é‡Šæ”¾</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>é”™è¯¯å¤„ç†</p>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"ä¸‰ã€Worker\"><a href=\"#ä¸‰ã€Worker\" class=\"headerlink\" title=\"ä¸‰ã€Worker\"></a>ä¸‰ã€Worker</h1><h2 id=\"1ã€Pessimist\"><a href=\"#1ã€Pessimist\" class=\"headerlink\" title=\"1ã€Pessimist\"></a>1ã€Pessimist</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Pessimist used to coordinate the shard DDL migration in pessimism mode.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Pessimist <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    mu sync.RWMutex</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    logger log.Logger</span><br><span class=\"line\"></span><br><span class=\"line\">    cli    *clientv3.Client</span><br><span class=\"line\"></span><br><span class=\"line\">    task   <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\">    source <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// the shard DDL info which is pending to handle.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    pendingInfo *pessimism.Info</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// the shard DDL lock operation which is pending to handle.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    pendingOp *pessimism.Operation</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L252\">NewPessimist</a>ï¼šworker ä¸­çš„ pessimist ä¸åŒäº master ä¸­çš„ pessimistã€‚å®ƒåªä¿å­˜äº† <code>pendingInfo</code> å’Œ <code>pendingOp</code>ï¼Œç”¨äºä¿å­˜å½“å‰çš„ Info å’Œ Operation</li>\n</ul>\n<h2 id=\"2ã€ShardingGroupKeeper\"><a href=\"#2ã€ShardingGroupKeeper\" class=\"headerlink\" title=\"2ã€ShardingGroupKeeper\"></a>2ã€ShardingGroupKeeper</h2><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L277\">NewShardingGroupKeeper</a>ï¼šå…¶ä¸­æœ€é‡è¦çš„ç»“æ„ä½“å°±æ˜¯ <code>shardingGroup</code>ã€‚<code>shardingGroup</code> å’Œ master ä¸­çš„ <code>Lock</code> ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨äºç®¡ç† DDL å½±å“åˆ°çš„ tableï¼ˆåœ¨ Lock ä¸­æ˜¯ source/workerï¼‰ã€‚</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ShardingGroupKeeper used to keep ShardingGroup.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ShardingGroupKeeper <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    sync.RWMutex</span><br><span class=\"line\"></span><br><span class=\"line\">    groups <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]*ShardingGroup <span class=\"comment\">// target table ID -&gt; ShardingGroup</span></span><br><span class=\"line\"></span><br><span class=\"line\">    cfg    *config.SubTaskConfig</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    shardMetaSchema    <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\">    shardMetaTable     <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\">    shardMetaTableName <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    db     *conn.BaseDB</span><br><span class=\"line\"></span><br><span class=\"line\">    dbConn *dbconn.DBConn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    tctx *tcontext.Context</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3ã€ShardingGroup\"><a href=\"#3ã€ShardingGroup\" class=\"headerlink\" title=\"3ã€ShardingGroup\"></a>3ã€ShardingGroup</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ShardingGroup represents a sharding DDL sync group.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ShardingGroup <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    sync.RWMutex</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// remain count waiting for syncing</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// == len(sources):  DDL syncing not started or resolved</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// == 0: all DDLs synced, will be reset to len(sources) after resolved combining with other dm-workers</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// (0, len(sources)): waiting for syncing</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">NOTE:</span> we can make remain to be configurable if needed</span></span><br><span class=\"line\"></span><br><span class=\"line\">    remain       <span class=\"type\">int</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sources      <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">bool</span> <span class=\"comment\">// source table ID -&gt; whether source table&#x27;s DDL synced</span></span><br><span class=\"line\"></span><br><span class=\"line\">    IsSchemaOnly <span class=\"type\">bool</span>            <span class=\"comment\">// whether is a schema (database) only DDL <span class=\"doctag\">TODO:</span> zxc add schema-level syncing support later</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    sourceID <span class=\"type\">string</span>                  <span class=\"comment\">// associate dm-worker source ID</span></span><br><span class=\"line\"></span><br><span class=\"line\">    meta     *shardmeta.ShardingMeta <span class=\"comment\">// sharding sequence meta storage</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    firstLocation    *binlog.Location <span class=\"comment\">// first DDL&#x27;s binlog pos and gtid, used to restrain the global checkpoint when un-resolved</span></span><br><span class=\"line\"></span><br><span class=\"line\">    firstEndLocation *binlog.Location <span class=\"comment\">// first DDL&#x27;s binlog End_log_pos and gtid, used to re-direct binlog streamer after synced</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ddls             []<span class=\"type\">string</span>         <span class=\"comment\">// DDL which current in syncing</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    flavor     <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\">    enableGTID <span class=\"type\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Remain å’Œ Lock ä¸­çš„ remain æ„ä¹‰å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡ŒæŒ‡ table æ˜¯å¦ readyï¼ˆç°ä»£ç ä¸­ç”¨çš„ syncedï¼‰</li>\n</ul>\n<blockquote>\n<p>whether source tableâ€™s DDL synced</p>\n</blockquote>\n<blockquote>\n<p>TODOï¼šåº”è¯¥ç»Ÿä¸€æ¦‚å¿µï¼Œè¿™é‡Œä¹Ÿç”¨ ready è¡¨ç¤º</p>\n</blockquote>\n<ul>\n<li>sourcesï¼šå’Œ Lock ä¸­çš„ ready ç±»ä¼¼</li>\n<li>firstLocation/firstEndLocation/ddlsï¼šè¿™ä¸‰ä¸ªå…¶å®åœ¨ meta ä¸­éƒ½æœ‰ä¿å­˜ï¼Œæ‰€ä»¥æ„Ÿè§‰å…¶å®æ²¡å•¥ç”¨</li>\n<li>metaï¼šé‡Œé¢ä¿å­˜ç€æ‰€æœ‰çš„æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä¸‹é¢è¯¦ç»†è¯´</li>\n</ul>\n<h2 id=\"4ã€ShardingMeta\"><a href=\"#4ã€ShardingMeta\" class=\"headerlink\" title=\"4ã€ShardingMeta\"></a>4ã€ShardingMeta</h2><p>è¿™äº›ä¿¡æ¯ä¼šè¢«æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ShardingMeta stores sharding ddl sequence</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// including global sequence and each source&#x27;s own sequence</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// <span class=\"doctag\">NOTE:</span> sharding meta is not thread safe, it must be used in thread safe context.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ShardingMeta <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    activeIdx <span class=\"type\">int</span>                          <span class=\"comment\">// the first unsynced DDL index</span></span><br><span class=\"line\"></span><br><span class=\"line\">    global    *ShardingSequence            <span class=\"comment\">// merged sharding sequence of all source tables</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sources   <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]*ShardingSequence <span class=\"comment\">// source table ID -&gt; its sharding sequence</span></span><br><span class=\"line\"></span><br><span class=\"line\">    tableName <span class=\"type\">string</span>                       <span class=\"comment\">// table name (with schema) used in downstream meta db</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    enableGTID <span class=\"type\">bool</span> <span class=\"comment\">// whether enableGTID, used to compare location</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>activeIdxï¼šè¡¨ç¤ºå½“å‰æ´»è·ƒçš„ DDL ä¸‹æ ‡ï¼Œå³ç°åœ¨è¢«å“ªä¸ª DDL å¡ä½äº†</li>\n<li>globalï¼šè¡¨ç¤ºå…¨å±€çš„ DDL åºåˆ—ï¼Œå³æ‰€æœ‰ table ä¸­æœ€é•¿çš„</li>\n<li>sourcesï¼šè¡¨ç¤ºå„ä¸ª table çš„ DDL åºåˆ—</li>\n</ul>\n<h2 id=\"5ã€ShardingSequence-å’Œ-DDLItem\"><a href=\"#5ã€ShardingSequence-å’Œ-DDLItem\" class=\"headerlink\" title=\"5ã€ShardingSequence å’Œ DDLItem\"></a>5ã€ShardingSequence å’Œ DDLItem</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ShardingSequence records a list of DDLItem.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ShardingSequence <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    Items []*DDLItem <span class=\"string\">`json:&quot;items&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// DDLItem records ddl information used in sharding sequence organization.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> DDLItem <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    FirstLocation binlog.Location <span class=\"string\">`json:&quot;-&quot;`</span>      <span class=\"comment\">// first DDL&#x27;s binlog Pos, not the End_log_pos of the event</span></span><br><span class=\"line\"></span><br><span class=\"line\">    DDLs          []<span class=\"type\">string</span>        <span class=\"string\">`json:&quot;ddls&quot;`</span>   <span class=\"comment\">// DDLs, these ddls are in the same QueryEvent</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Source        <span class=\"type\">string</span>          <span class=\"string\">`json:&quot;source&quot;`</span> <span class=\"comment\">// source table ID</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// just used for json&#x27;s marshal and unmarshal, because gtid.Set in FirstLocation is interface,</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// can&#x27;t be marshal and unmarshal</span></span><br><span class=\"line\"></span><br><span class=\"line\">    FirstPosition mysql.Position <span class=\"string\">`json:&quot;first-position&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    FirstGTIDSet  <span class=\"type\">string</span>         <span class=\"string\">`json:&quot;first-gtid-set&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œçš„ DDLItem å’Œ Lock ä¸­çš„ []DDL å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ª DDLItem ä¸­ä¹ŸåŒ…å«å¤šä¸ª DDLã€‚ä½†æ˜¯è¿™é‡Œçš„ DDLItem ä¸­å°è£…äº†æ›´å¤šçš„ä¿¡æ¯ï¼š</p>\n<blockquote>\n<p>DDLs []string `json:â€ddlsâ€` // DDLs, these ddls are in the same QueryEvent</p>\n</blockquote>\n<ul>\n<li>FirstLocationï¼šDDL å¼€å§‹çš„ä½ç‚¹ï¼Œä¸»è¦ç”¨äºè¯†åˆ«è¯¥ DDL ä¹‹å‰æ˜¯å¦æ¥è¿‡äº†ã€‚</li>\n</ul>\n<h2 id=\"6ã€Init\"><a href=\"#6ã€Init\" class=\"headerlink\" title=\"6ã€Init\"></a>6ã€Init</h2><ul>\n<li>s.sgk.Init()ï¼šåœ¨ä¸‹æ¸¸åˆ›å»ºåº“è¡¨ <code>dm_meta.($task)_syncer_sharding_meta</code></li>\n<li>s.initShardingGroups</li>\n</ul>\n<blockquote>\n<p>TODOï¼šå¯ç”¨ <code>utils.FetchTargetDoTables()</code> æ›¿æ¢ <code>fromDB.FetchAllDoTables</code></p>\n</blockquote>\n<ol>\n<li>s.sgk.LoadShardMetaï¼šæŠŠæ•°æ®è¯»å‡ºæ¥ï¼Œå­˜åˆ°å†…å­˜é‡Œ</li>\n<li>s.sgk.AddGroupï¼šæŠŠ ShardingGroup æ¢å¤</li>\n</ol>\n<ul>\n<li>Reset</li>\n</ul>\n<h2 id=\"7ã€Start\"><a href=\"#7ã€Start\" class=\"headerlink\" title=\"7ã€Start\"></a>7ã€Start</h2><ul>\n<li>å¯åŠ¨ syncDDL çº¿ç¨‹ï¼Œç­‰å¾… DDL job</li>\n</ul>\n<h1 id=\"å››ã€æ€»ç»“\"><a href=\"#å››ã€æ€»ç»“\" class=\"headerlink\" title=\"å››ã€æ€»ç»“\"></a>å››ã€æ€»ç»“</h1><p>æœ¬å°èŠ‚ä¸»è¦ä»‹ç»äº†åœ¨æ‚²è§‚åè°ƒä¸­ï¼š</p>\n<ul>\n<li>ä¼šç”¨åˆ°çš„å„ç§æ•°æ®ç»“æ„</li>\n<li>Master è¿è¡Œäº†å‡ ä¸ªçº¿ç¨‹ï¼Œç­‰å¾… worker ä¸­ä¿¡æ¯çš„æ¥ä¸´</li>\n<li>Worker è¿è¡Œäº† syncDDL çº¿ç¨‹ï¼Œç­‰å¾…ç€ DDL åˆ°æ¥</li>\n</ul>\n<p>è¿™ä¸€èŠ‚ä¸­ï¼Œç½—åˆ—äº†ç‰¹åˆ«å¤šçš„æ¦‚å¿µï¼Œçœ‹ä¸æ‡‚æ˜¯æ­£å¸¸çš„ï¼åœ¨ä¸‹ä¸€èŠ‚ï¼Œå°†ä» worker æ¥å—åˆ°ä¸€æ¡ DDL å¼€å§‹ï¼Œç›´åˆ°è¿™æ¡ DDL çš„ lock è§£é™¤çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ è¿™äº›ç»“æ„ä½“åˆ°åº•æ˜¯æ€ä¹ˆç”¨çš„ã€‚</p>\n<blockquote>\n<p>æŠ±æ­‰ç¬¬äºŒç« å°±æ˜¯æ‚²è§‚åè°ƒè¿™ä¸ªåŠŸèƒ½ğŸ˜‚ï¼Œæœ¬æ¥æƒ³è®©ç³»åˆ—æ–‡ç« çš„éš¾åº¦æ›´åŠ å¹³æ»‘ä¸€ç‚¹çš„ï¼Œä½†æ˜¯äººå¤ªæ‡’äº†ä¸€æ‹–å†æ‹–ğŸ˜‚ã€‚ä¸ºäº†é¿å…å†æ‹–ä¸‹å»ï¼Œå…ˆæŠŠå†™äº†çš„å­˜æ´»å‘å‡ºæ¥å§ï¼</p>\n</blockquote>\n","site":{"data":{}},"cover_type":"img","length":8456,"excerpt":"","more":"<h1 id=\"ä¸€ã€æ¦‚è¿°\"><a href=\"#ä¸€ã€æ¦‚è¿°\" class=\"headerlink\" title=\"ä¸€ã€æ¦‚è¿°\"></a>ä¸€ã€æ¦‚è¿°</h1><p>åˆ†åº“åˆ†è¡¨çš„æ‚²è§‚åè°ƒæ–¹æ³•æ˜¯ 2018 å¹´å¼€å‘çš„ç‰¹æ€§ï¼Œæ˜¯ DM é¦–æ¬¡æ”¯æŒ MySQL åˆ†åº“åˆ†è¡¨çš„è¿ç§»ã€‚ç”±äºåˆ†åº“åˆ†è¡¨åœ¨å„ä¸ªå…¬å¸ä¸­çš„åº”ç”¨å®åœ¨å¤ªè¿‡å¹¿æ³›ï¼Œæ‰€ä»¥åªæœ‰åœ¨æ”¯æŒåˆ†åº“åˆ†è¡¨è¿ç§»åï¼ŒDM æ‰æœ‰äº†å·¥ç¨‹å®è·µçš„æ„ä¹‰ï¼Œå¦åˆ™åªèƒ½ç®—ä½œä¸€ä¸ªç©å…·ã€‚è¿™å¯¹ DM æ¥è¯´æ„ä¹‰é‡å¤§ã€‚</p>\n<p>ç”±äºæ‚²è§‚åè°ƒçš„å†…å®¹åºå¤§ï¼Œæœ¬èŠ‚åªè®²è¿°æ‚²è§‚åè°ƒçš„å‡†å¤‡è¿‡ç¨‹ï¼š</p>\n<ul>\n<li>Master çš„å‡†å¤‡è¿‡ç¨‹</li>\n<li>Worker çš„å‡†å¤‡è¿‡ç¨‹</li>\n</ul>\n<p>ä»¥åŠåœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­è‡³å…³é‡è¦çš„ç»“æ„ä½“ï¼š</p>\n<ul>\n<li>Lock</li>\n<li>Info</li>\n<li>Operation</li>\n<li>ShardingMeta</li>\n<li>ShardingGroup</li>\n<li>â€¦</li>\n</ul>\n<blockquote>\n<p>æ³¨ï¼šä¸ºäº†ä¸“æ³¨äºæˆ‘ä»¬çš„ç›®çš„ï¼ˆæ‚²è§‚åè°ƒï¼‰ï¼Œæœ¬æ–‡ä¸ä¼šå¯¹æ— å…³ä»£ç è¿›è¡Œè§£è¯»</p>\n</blockquote>\n<blockquote>\n<p>è¿™ä¸€èŠ‚å¤–é“¾ä¸­çš„ä»£ç ï¼Œè¯»è€…å¯èƒ½ä¼šäº§ç”Ÿè¿™ä¸ªé€»è¾‘ä¸ºä»€ä¹ˆæ˜¯è¿™é‡Œçš„ç–‘é—®ã€‚è¿™æ˜¯å› ä¸ºæœ¬èŠ‚å¹¶æ²¡æœ‰å®Œå…¨æŒ‰ç…§é¡ºåºè¯»ä»£ç ã€‚æ‰€ä»¥è¯»è€…å¯ä»¥ä»…å¸¦ç€å­¦ä¹ çš„å¿ƒæ€é˜…è¯»æœ¬èŠ‚ï¼Œæš‚æ—¶ä¸éœ€è¦çŸ¥é“å®ƒä¸ºä»€ä¹ˆåœ¨ä»£ç çš„è¿™ä¸ªåœ°æ–¹ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ä¼šé¡ºåºé˜…è¯»ä»£ç </p>\n</blockquote>\n<blockquote>\n<p>æœ¬èŠ‚åŸºäº <a href=\"https://github.com/pingcap/tiflow/tree/release-6.0\">DM release-6.0.0</a></p>\n</blockquote>\n<h1 id=\"äºŒã€Master\"><a href=\"#äºŒã€Master\" class=\"headerlink\" title=\"äºŒã€Master\"></a>äºŒã€Master</h1><h2 id=\"1ã€Pessimist-å’Œ-LockKeeper\"><a href=\"#1ã€Pessimist-å’Œ-LockKeeper\" class=\"headerlink\" title=\"1ã€Pessimist å’Œ LockKeeper\"></a>1ã€Pessimist å’Œ LockKeeper</h2><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/server.go#L140\">NewPessimist</a>ï¼šPessimist æ˜¯ Master å¤„ç†æ‚²è§‚åè°ƒçš„ç»“æ„ä½“ï¼Œå…¶ä¸­æœ€é‡è¦çš„æˆå‘˜æ˜¯ <code>LockKeeper</code>ã€‚</li>\n<li><code>LockKeeper</code> çš„ä½œç”¨æ˜¯ç®¡ç†å„ç§å„æ ·çš„ lockã€‚</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// LockKeeper used to keep and handle DDL lock conveniently.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The lock information do not need to be persistent, and can be re-constructed from the shard DDL info.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> LockKeeper <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    mu    sync.RWMutex</span><br><span class=\"line\"></span><br><span class=\"line\">    locks <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]*Lock <span class=\"comment\">// lockID -&gt; Lock</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Lock å¯ä»¥çœ‹ä½œæ˜¯æ¯ä¸€ä¸ª ddl å½±å“çš„åº“è¡¨ï¼Œè¿™äº›åº“è¡¨åˆ†å¸ƒåœ¨ä¸åŒçš„ MySQL/source ä¸­ã€‚ç”±äºåœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­ï¼Œæ•°æ®æµï¼ˆbinlog æµï¼‰ä¸æ˜¯åœæ»çš„ï¼Œæ‰€ä»¥åœ¨æ•°æ®æµä¸­ï¼Œä¼šæºæºä¸æ–­åœ°å‡ºç°æ–° DDLï¼Œå³æ–° lockã€‚</li>\n<li>æ•… <code>LockKeeper</code> å°±æ˜¯ç®¡ç†è¿™äº› lockã€‚</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Lock represents the shard DDL lock in memory.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This information does not need to be persistent, and can be re-constructed from the shard DDL info.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Lock <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    mu sync.RWMutex</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    ID     <span class=\"type\">string</span>   <span class=\"comment\">// lock&#x27;s ID</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Task   <span class=\"type\">string</span>   <span class=\"comment\">// lock&#x27;s corresponding task name</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Owner  <span class=\"type\">string</span>   <span class=\"comment\">// Owner&#x27;s source ID (not DM-worker&#x27;s name)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    DDLs   []<span class=\"type\">string</span> <span class=\"comment\">// DDL statements</span></span><br><span class=\"line\"></span><br><span class=\"line\">    remain <span class=\"type\">int</span>      <span class=\"comment\">// remain count of sources needed to receive DDL info</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// whether the DDL info received from the source.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// if all of them have been ready, then we call the lock `synced`.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ready <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// whether the operations have done (exec/skip the shard DDL).</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// if all of them have done, then we call the lock `resolved`.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    done <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2ã€Lock\"><a href=\"#2ã€Lock\" class=\"headerlink\" title=\"2ã€Lock\"></a>2ã€Lock</h2><ul>\n<li>ID è¡¨ç°å½¢å¼ä¸º <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/utils/common.go#L223\">${task}-${schema}.${table}</a>ï¼Œä» LockKeeper çš„ç»“æ„å¯ä»¥çœ‹åˆ°åŒä¸€ä»»åŠ¡åŒä¸€è¡¨ä¸‹åªèƒ½æœ‰ä¸€ä¸ª lockï¼Œå¦‚æœé‡åˆ°äº†ä¸åŒçš„ DDLï¼Œå½±å“çš„åˆæ˜¯åŒä»»åŠ¡åŒè¡¨ï¼Œåˆ™<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/lock.go#L72-L74\">æŠ¥é”™</a>ã€‚</li>\n<li>DDLs ä¸ºä»€ä¹ˆæ˜¯ <code>[]string</code>ï¼Ÿå› ä¸ºè¿™é‡Œæ˜¯ç»è¿‡ <code>Split</code> çš„ DDLsï¼Œå•æ¡ DDL å¯èƒ½ä¼šè¢« Split æˆå¤šæ¡ DDLã€‚</li>\n<li>Remain è¡¨ç¤ºå‰©ä½™çš„è¿˜æœªæ”¶åˆ° DDL çš„ source/workerï¼ˆä»¥ä¸‹ worker éƒ½è¡¨ç¤º source/worker å¯¹ï¼‰æ•°é‡ã€‚å³å¦‚æœ worker æŠŠè¿™ä¸ª Lock ç›¸å…³çš„ DDLsï¼ˆå®é™…ä¸Šæ˜¯ info çš„å½¢å¼ï¼‰å‘ç»™ masterï¼Œmaster åˆ™æŠŠ <code>remain --</code>ã€‚</li>\n<li>Ready å’Œ remain è¡¨è¾¾ç›¸åŒçš„æ„æ€ï¼Œremain å³è¡¨ç¤º ready ä¸­ä¸º <code>true</code> çš„ä¸ªæ•°</li>\n<li>Done è¡¨ç¤º operation ç»“æŸçš„ worker çš„çŠ¶æ€</li>\n</ul>\n<blockquote>\n<p>æ³¨æ„ï¼šä¸‹é¢è¯´çš„æ‰€æœ‰ worker éƒ½ ready å³æ˜¯ <strong>remain &lt;= 0</strong>ï¼Œä»£ç ä¸­å³æ˜¯ <strong>synced</strong> = trueã€‚è¿™é‡Œåˆ›é€ çš„æ¦‚å¿µè¿‡å¤šï¼Œåº”è¯¥æ”¶æŸä¸€ä¸‹ï¼Œå‡å°‘ä»£ç çš„ç†è§£éš¾åº¦ã€‚</p>\n</blockquote>\n<blockquote>\n<p>TODOï¼šå¯ä»¥æŠŠä»£ç ä¸­çš„ remain æ”¹æˆ noReadiesï¼›synced æ”¹æˆ allReady</p>\n</blockquote>\n<h2 id=\"3ã€Info\"><a href=\"#3ã€Info\" class=\"headerlink\" title=\"3ã€Info\"></a>3ã€Info</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Info represents the shard DDL information.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This information should be persistent in etcd so can be retrieved after the DM-master leader restarted or changed.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// <span class=\"doctag\">NOTE:</span> `Task` and `Source` are redundant in the etcd key path for convenient.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Info <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    Task   <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;task&quot;`</span>   <span class=\"comment\">// data migration task name</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Source <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;source&quot;`</span> <span class=\"comment\">// upstream source ID</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Schema <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;schema&quot;`</span> <span class=\"comment\">// schema name of the DDL</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Table  <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;table&quot;`</span>  <span class=\"comment\">// table name of the DDL</span></span><br><span class=\"line\"></span><br><span class=\"line\">    DDLs   []<span class=\"type\">string</span> <span class=\"string\">`json:&quot;ddls&quot;`</span>   <span class=\"comment\">// DDL statements</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Info å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹ï¼Œåªæ˜¯ç”¨ä½œ worker é€šçŸ¥ masterï¼ŒæŸ lock ready çš„æ¶ˆæ¯ã€‚</p>\n<h2 id=\"4ã€Operation\"><a href=\"#4ã€Operation\" class=\"headerlink\" title=\"4ã€Operation\"></a>4ã€Operation</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Operation represents a shard DDL coordinate operation.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This information should be persistent in etcd so can be retrieved after the DM-master leader restarted or changed.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// <span class=\"doctag\">NOTE:</span> `Task` and `Source` are redundant in the etcd key path for convenient.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Operation <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    ID     <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;id&quot;`</span>     <span class=\"comment\">// the corresponding DDL lock ID</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Task   <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;task&quot;`</span>   <span class=\"comment\">// data migration task name</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Source <span class=\"type\">string</span>   <span class=\"string\">`json:&quot;source&quot;`</span> <span class=\"comment\">// upstream source ID</span></span><br><span class=\"line\"></span><br><span class=\"line\">    DDLs   []<span class=\"type\">string</span> <span class=\"string\">`json:&quot;ddls&quot;`</span>   <span class=\"comment\">// DDL statements</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Exec   <span class=\"type\">bool</span>     <span class=\"string\">`json:&quot;exec&quot;`</span>   <span class=\"comment\">// execute or skip the DDL statements</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Done   <span class=\"type\">bool</span>     <span class=\"string\">`json:&quot;done&quot;`</span>   <span class=\"comment\">// whether the `Exec` operation has done</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// only used to report to the caller of the watcher, do not marsh it.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// if it&#x27;s true, it means the Operation has been deleted in etcd.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    IsDeleted <span class=\"type\">bool</span> <span class=\"string\">`json:&quot;-&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Execï¼šæ˜¯ master å‘ worker å‘é€æ¶ˆæ¯æ—¶æ‰€ç”¨åˆ°çš„å­—æ®µã€‚å®ƒå‘ŠçŸ¥è¯¥ worker æ˜¯å¦éœ€è¦æ‰§è¡Œ DDLï¼Œåªéœ€è¦ owner æ‰§è¡Œ DDL</li>\n<li>Doneï¼šæ˜¯ worker å‘ master å‘é€æ¶ˆæ¯æ—¶æ‰€ç”¨åˆ°çš„å­—æ®µã€‚å®ƒå‘ŠçŸ¥ master è¯¥ worker done äº†ã€‚done å¹¶ä¸ä»£è¡¨è¯¥ worker æ‰§è¡Œäº† DDLï¼Œè€Œæ˜¯è¡¨ç¤ºä¸€ç§çŠ¶æ€ï¼Œå› ä¸ºåªæœ‰ owner å¯ä»¥æ‰§è¡Œ DDLï¼Œnon-owner done å¯ä»¥å½“ä½œ non-worker æ¥å—åˆ°äº† DDL å·²æ‰§è¡Œçš„ä¿¡æ¯çš„ç¡®è®¤ã€‚</li>\n</ul>\n<h2 id=\"3ã€Start\"><a href=\"#3ã€Start\" class=\"headerlink\" title=\"3ã€Start\"></a>3ã€Start</h2><blockquote>\n<p>ä»¥ä¸‹å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­æœç´¢å¯¹åº”çš„åå­—ï¼Œè¯·åŠ¡å¿…ä¸å¯¹åº”ä»£ç ä¸€èµ·é˜…è¯»ï¼</p>\n</blockquote>\n<ul>\n<li><p>s.pessimist.Start</p>\n</li>\n<li><p>p.run</p>\n<ul>\n<li><p>watchInfoOperation</p>\n<ul>\n<li><p>pessimism.WatchInfoPutï¼šç­‰å¾… worker å‘é€ info</p>\n</li>\n<li><p>p.handleInfoPutï¼š</p>\n<ul>\n<li>æ”¶åˆ° Worker å‘é€çš„ info ä¹‹åï¼Œæ„å‘³ç€è¯¥ worker <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/lock.go#L87-L88\">å·² ready</a></li>\n<li>å¦‚æœè¿™ä¸ªæ—¶å€™æ‰€æœ‰çš„ source/worker éƒ½ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L486\">readyï¼ˆsyncedï¼‰</a> äº†ï¼Œåˆ™å¯ä»¥<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L602-L611\">å‘é€ä¸€ä¸ª exec operation ç»™è¯¥ lock çš„ owner</a>ï¼ˆç¬¬ä¸€ä¸ª<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/keeper.go#L49\">åˆ›å»º lock</a> çš„ workerï¼‰</li>\n</ul>\n</li>\n<li><p>pessimism.WatchOperationPutï¼š</p>\n<ul>\n<li>ç­‰å¾… worker å‘é€ operation doneã€‚</li>\n<li>è¿™é‡Œçš„ operation å’Œ ä¸Šé¢å‘é€çš„ operation å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œç›‘å¬çš„æ²¡æœ‰æŒ‡å®š <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L192\">task å’Œ source</a>ï¼Œä¸Šé¢å‘é€çš„ operation æ˜¯<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L604\">æŒ‡å®š task å’Œ source</a> çš„ã€‚æ‰€ä»¥ä¸Šé¢å‘é€çš„ operation è¿™é‡Œä¹Ÿä¼šç›‘å¬åˆ°ï¼Œ</li>\n</ul>\n</li>\n<li><p>p.handleOperationPutï¼š</p>\n<ul>\n<li><p>æ”¶åˆ° <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L509-L512\">not done </a>operation è¿™é‡Œå¹¶ä¸è¿›è¡Œæ“ä½œã€‚å³ä¸Šé¢å‘é€ exec operation çš„æ—¶å€™æ²¡æœ‰ doneã€‚</p>\n</li>\n<li><p>å½“æ”¶åˆ° operation is done æ—¶ï¼Œæ‰è¿›è¡Œä¸€ç³»åˆ—æ“ä½œã€‚å³ä» worker å‘é€è¿‡æ¥çš„ done operationã€‚</p>\n<ul>\n<li>é¦–å…ˆ markDone</li>\n<li>å¦‚æœæ˜¯ owner done äº†ï¼Œè¿˜ä¼šå¯¹ non-owner å‘é€ <a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L553\">exec operation</a>ï¼Œç£ä¿ƒ non-owner done</li>\n<li>å¦‚æœæ‰€æœ‰çš„ worker éƒ½ done äº†ï¼ˆå³ resolvedï¼‰ï¼Œåˆ™<a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L533\">æŠŠ lock é‡Šæ”¾</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>é”™è¯¯å¤„ç†</p>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"ä¸‰ã€Worker\"><a href=\"#ä¸‰ã€Worker\" class=\"headerlink\" title=\"ä¸‰ã€Worker\"></a>ä¸‰ã€Worker</h1><h2 id=\"1ã€Pessimist\"><a href=\"#1ã€Pessimist\" class=\"headerlink\" title=\"1ã€Pessimist\"></a>1ã€Pessimist</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Pessimist used to coordinate the shard DDL migration in pessimism mode.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Pessimist <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    mu sync.RWMutex</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    logger log.Logger</span><br><span class=\"line\"></span><br><span class=\"line\">    cli    *clientv3.Client</span><br><span class=\"line\"></span><br><span class=\"line\">    task   <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\">    source <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// the shard DDL info which is pending to handle.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    pendingInfo *pessimism.Info</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// the shard DDL lock operation which is pending to handle.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    pendingOp *pessimism.Operation</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L252\">NewPessimist</a>ï¼šworker ä¸­çš„ pessimist ä¸åŒäº master ä¸­çš„ pessimistã€‚å®ƒåªä¿å­˜äº† <code>pendingInfo</code> å’Œ <code>pendingOp</code>ï¼Œç”¨äºä¿å­˜å½“å‰çš„ Info å’Œ Operation</li>\n</ul>\n<h2 id=\"2ã€ShardingGroupKeeper\"><a href=\"#2ã€ShardingGroupKeeper\" class=\"headerlink\" title=\"2ã€ShardingGroupKeeper\"></a>2ã€ShardingGroupKeeper</h2><ul>\n<li><a href=\"https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L277\">NewShardingGroupKeeper</a>ï¼šå…¶ä¸­æœ€é‡è¦çš„ç»“æ„ä½“å°±æ˜¯ <code>shardingGroup</code>ã€‚<code>shardingGroup</code> å’Œ master ä¸­çš„ <code>Lock</code> ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨äºç®¡ç† DDL å½±å“åˆ°çš„ tableï¼ˆåœ¨ Lock ä¸­æ˜¯ source/workerï¼‰ã€‚</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ShardingGroupKeeper used to keep ShardingGroup.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ShardingGroupKeeper <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    sync.RWMutex</span><br><span class=\"line\"></span><br><span class=\"line\">    groups <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]*ShardingGroup <span class=\"comment\">// target table ID -&gt; ShardingGroup</span></span><br><span class=\"line\"></span><br><span class=\"line\">    cfg    *config.SubTaskConfig</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    shardMetaSchema    <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\">    shardMetaTable     <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\">    shardMetaTableName <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    db     *conn.BaseDB</span><br><span class=\"line\"></span><br><span class=\"line\">    dbConn *dbconn.DBConn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    tctx *tcontext.Context</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3ã€ShardingGroup\"><a href=\"#3ã€ShardingGroup\" class=\"headerlink\" title=\"3ã€ShardingGroup\"></a>3ã€ShardingGroup</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ShardingGroup represents a sharding DDL sync group.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ShardingGroup <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    sync.RWMutex</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// remain count waiting for syncing</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// == len(sources):  DDL syncing not started or resolved</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// == 0: all DDLs synced, will be reset to len(sources) after resolved combining with other dm-workers</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// (0, len(sources)): waiting for syncing</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">NOTE:</span> we can make remain to be configurable if needed</span></span><br><span class=\"line\"></span><br><span class=\"line\">    remain       <span class=\"type\">int</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sources      <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">bool</span> <span class=\"comment\">// source table ID -&gt; whether source table&#x27;s DDL synced</span></span><br><span class=\"line\"></span><br><span class=\"line\">    IsSchemaOnly <span class=\"type\">bool</span>            <span class=\"comment\">// whether is a schema (database) only DDL <span class=\"doctag\">TODO:</span> zxc add schema-level syncing support later</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    sourceID <span class=\"type\">string</span>                  <span class=\"comment\">// associate dm-worker source ID</span></span><br><span class=\"line\"></span><br><span class=\"line\">    meta     *shardmeta.ShardingMeta <span class=\"comment\">// sharding sequence meta storage</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    firstLocation    *binlog.Location <span class=\"comment\">// first DDL&#x27;s binlog pos and gtid, used to restrain the global checkpoint when un-resolved</span></span><br><span class=\"line\"></span><br><span class=\"line\">    firstEndLocation *binlog.Location <span class=\"comment\">// first DDL&#x27;s binlog End_log_pos and gtid, used to re-direct binlog streamer after synced</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ddls             []<span class=\"type\">string</span>         <span class=\"comment\">// DDL which current in syncing</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    flavor     <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\">    enableGTID <span class=\"type\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Remain å’Œ Lock ä¸­çš„ remain æ„ä¹‰å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡ŒæŒ‡ table æ˜¯å¦ readyï¼ˆç°ä»£ç ä¸­ç”¨çš„ syncedï¼‰</li>\n</ul>\n<blockquote>\n<p>whether source tableâ€™s DDL synced</p>\n</blockquote>\n<blockquote>\n<p>TODOï¼šåº”è¯¥ç»Ÿä¸€æ¦‚å¿µï¼Œè¿™é‡Œä¹Ÿç”¨ ready è¡¨ç¤º</p>\n</blockquote>\n<ul>\n<li>sourcesï¼šå’Œ Lock ä¸­çš„ ready ç±»ä¼¼</li>\n<li>firstLocation/firstEndLocation/ddlsï¼šè¿™ä¸‰ä¸ªå…¶å®åœ¨ meta ä¸­éƒ½æœ‰ä¿å­˜ï¼Œæ‰€ä»¥æ„Ÿè§‰å…¶å®æ²¡å•¥ç”¨</li>\n<li>metaï¼šé‡Œé¢ä¿å­˜ç€æ‰€æœ‰çš„æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä¸‹é¢è¯¦ç»†è¯´</li>\n</ul>\n<h2 id=\"4ã€ShardingMeta\"><a href=\"#4ã€ShardingMeta\" class=\"headerlink\" title=\"4ã€ShardingMeta\"></a>4ã€ShardingMeta</h2><p>è¿™äº›ä¿¡æ¯ä¼šè¢«æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ShardingMeta stores sharding ddl sequence</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// including global sequence and each source&#x27;s own sequence</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// <span class=\"doctag\">NOTE:</span> sharding meta is not thread safe, it must be used in thread safe context.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ShardingMeta <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    activeIdx <span class=\"type\">int</span>                          <span class=\"comment\">// the first unsynced DDL index</span></span><br><span class=\"line\"></span><br><span class=\"line\">    global    *ShardingSequence            <span class=\"comment\">// merged sharding sequence of all source tables</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sources   <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]*ShardingSequence <span class=\"comment\">// source table ID -&gt; its sharding sequence</span></span><br><span class=\"line\"></span><br><span class=\"line\">    tableName <span class=\"type\">string</span>                       <span class=\"comment\">// table name (with schema) used in downstream meta db</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    enableGTID <span class=\"type\">bool</span> <span class=\"comment\">// whether enableGTID, used to compare location</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>activeIdxï¼šè¡¨ç¤ºå½“å‰æ´»è·ƒçš„ DDL ä¸‹æ ‡ï¼Œå³ç°åœ¨è¢«å“ªä¸ª DDL å¡ä½äº†</li>\n<li>globalï¼šè¡¨ç¤ºå…¨å±€çš„ DDL åºåˆ—ï¼Œå³æ‰€æœ‰ table ä¸­æœ€é•¿çš„</li>\n<li>sourcesï¼šè¡¨ç¤ºå„ä¸ª table çš„ DDL åºåˆ—</li>\n</ul>\n<h2 id=\"5ã€ShardingSequence-å’Œ-DDLItem\"><a href=\"#5ã€ShardingSequence-å’Œ-DDLItem\" class=\"headerlink\" title=\"5ã€ShardingSequence å’Œ DDLItem\"></a>5ã€ShardingSequence å’Œ DDLItem</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ShardingSequence records a list of DDLItem.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ShardingSequence <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    Items []*DDLItem <span class=\"string\">`json:&quot;items&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// DDLItem records ddl information used in sharding sequence organization.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> DDLItem <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    FirstLocation binlog.Location <span class=\"string\">`json:&quot;-&quot;`</span>      <span class=\"comment\">// first DDL&#x27;s binlog Pos, not the End_log_pos of the event</span></span><br><span class=\"line\"></span><br><span class=\"line\">    DDLs          []<span class=\"type\">string</span>        <span class=\"string\">`json:&quot;ddls&quot;`</span>   <span class=\"comment\">// DDLs, these ddls are in the same QueryEvent</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Source        <span class=\"type\">string</span>          <span class=\"string\">`json:&quot;source&quot;`</span> <span class=\"comment\">// source table ID</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// just used for json&#x27;s marshal and unmarshal, because gtid.Set in FirstLocation is interface,</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// can&#x27;t be marshal and unmarshal</span></span><br><span class=\"line\"></span><br><span class=\"line\">    FirstPosition mysql.Position <span class=\"string\">`json:&quot;first-position&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    FirstGTIDSet  <span class=\"type\">string</span>         <span class=\"string\">`json:&quot;first-gtid-set&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œçš„ DDLItem å’Œ Lock ä¸­çš„ []DDL å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ª DDLItem ä¸­ä¹ŸåŒ…å«å¤šä¸ª DDLã€‚ä½†æ˜¯è¿™é‡Œçš„ DDLItem ä¸­å°è£…äº†æ›´å¤šçš„ä¿¡æ¯ï¼š</p>\n<blockquote>\n<p>DDLs []string `json:â€ddlsâ€` // DDLs, these ddls are in the same QueryEvent</p>\n</blockquote>\n<ul>\n<li>FirstLocationï¼šDDL å¼€å§‹çš„ä½ç‚¹ï¼Œä¸»è¦ç”¨äºè¯†åˆ«è¯¥ DDL ä¹‹å‰æ˜¯å¦æ¥è¿‡äº†ã€‚</li>\n</ul>\n<h2 id=\"6ã€Init\"><a href=\"#6ã€Init\" class=\"headerlink\" title=\"6ã€Init\"></a>6ã€Init</h2><ul>\n<li>s.sgk.Init()ï¼šåœ¨ä¸‹æ¸¸åˆ›å»ºåº“è¡¨ <code>dm_meta.($task)_syncer_sharding_meta</code></li>\n<li>s.initShardingGroups</li>\n</ul>\n<blockquote>\n<p>TODOï¼šå¯ç”¨ <code>utils.FetchTargetDoTables()</code> æ›¿æ¢ <code>fromDB.FetchAllDoTables</code></p>\n</blockquote>\n<ol>\n<li>s.sgk.LoadShardMetaï¼šæŠŠæ•°æ®è¯»å‡ºæ¥ï¼Œå­˜åˆ°å†…å­˜é‡Œ</li>\n<li>s.sgk.AddGroupï¼šæŠŠ ShardingGroup æ¢å¤</li>\n</ol>\n<ul>\n<li>Reset</li>\n</ul>\n<h2 id=\"7ã€Start\"><a href=\"#7ã€Start\" class=\"headerlink\" title=\"7ã€Start\"></a>7ã€Start</h2><ul>\n<li>å¯åŠ¨ syncDDL çº¿ç¨‹ï¼Œç­‰å¾… DDL job</li>\n</ul>\n<h1 id=\"å››ã€æ€»ç»“\"><a href=\"#å››ã€æ€»ç»“\" class=\"headerlink\" title=\"å››ã€æ€»ç»“\"></a>å››ã€æ€»ç»“</h1><p>æœ¬å°èŠ‚ä¸»è¦ä»‹ç»äº†åœ¨æ‚²è§‚åè°ƒä¸­ï¼š</p>\n<ul>\n<li>ä¼šç”¨åˆ°çš„å„ç§æ•°æ®ç»“æ„</li>\n<li>Master è¿è¡Œäº†å‡ ä¸ªçº¿ç¨‹ï¼Œç­‰å¾… worker ä¸­ä¿¡æ¯çš„æ¥ä¸´</li>\n<li>Worker è¿è¡Œäº† syncDDL çº¿ç¨‹ï¼Œç­‰å¾…ç€ DDL åˆ°æ¥</li>\n</ul>\n<p>è¿™ä¸€èŠ‚ä¸­ï¼Œç½—åˆ—äº†ç‰¹åˆ«å¤šçš„æ¦‚å¿µï¼Œçœ‹ä¸æ‡‚æ˜¯æ­£å¸¸çš„ï¼åœ¨ä¸‹ä¸€èŠ‚ï¼Œå°†ä» worker æ¥å—åˆ°ä¸€æ¡ DDL å¼€å§‹ï¼Œç›´åˆ°è¿™æ¡ DDL çš„ lock è§£é™¤çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ è¿™äº›ç»“æ„ä½“åˆ°åº•æ˜¯æ€ä¹ˆç”¨çš„ã€‚</p>\n<blockquote>\n<p>æŠ±æ­‰ç¬¬äºŒç« å°±æ˜¯æ‚²è§‚åè°ƒè¿™ä¸ªåŠŸèƒ½ğŸ˜‚ï¼Œæœ¬æ¥æƒ³è®©ç³»åˆ—æ–‡ç« çš„éš¾åº¦æ›´åŠ å¹³æ»‘ä¸€ç‚¹çš„ï¼Œä½†æ˜¯äººå¤ªæ‡’äº†ä¸€æ‹–å†æ‹–ğŸ˜‚ã€‚ä¸ºäº†é¿å…å†æ‹–ä¸‹å»ï¼Œå…ˆæŠŠå†™äº†çš„å­˜æ´»å‘å‡ºæ¥å§ï¼</p>\n</blockquote>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"clxgdbzoh0001xbdygyu7c36p","category_id":"clxgdbzom0003xbdyhftahxry","_id":"clxgdbzop0007xbdyf7yqdkr6"},{"post_id":"clxgfc6d300007odyg8gg1y4w","category_id":"clxgfdvel0004fhdyg0rb7wuq","_id":"clxgfdvem0005fhdyhyobb52i"},{"post_id":"clxh0ivhl0000rvdyen14f5dy","category_id":"clxgfdvel0004fhdyg0rb7wuq","_id":"clxh0ivhs0003rvdyd98kdl7m"},{"post_id":"clxh0mtjx0000avdy7tdtf3iz","category_id":"clxgfdvel0004fhdyg0rb7wuq","_id":"clxh0mtk30003avdyf5s92d7p"},{"post_id":"clxh0oeka0000kbdy6mt69rq6","category_id":"clxgfdvel0004fhdyg0rb7wuq","_id":"clxh0pgxf0002m3dyaq5f17qw"},{"post_id":"clxh0zy370000hfdy585eg5ei","category_id":"clxgfdvel0004fhdyg0rb7wuq","_id":"clxh0zy3c0003hfdy9ugh1n33"}],"PostTag":[{"post_id":"clxgdbzoh0001xbdygyu7c36p","tag_id":"clxgdbzon0004xbdy9jlx483v","_id":"clxgdbzop0008xbdy5dgvgrxz"},{"post_id":"clxgdbzoh0001xbdygyu7c36p","tag_id":"clxgdbzoo0006xbdy6c4m53ue","_id":"clxgdbzoq0009xbdy4kytajym"},{"post_id":"clxgfc6d300007odyg8gg1y4w","tag_id":"clxgfdcs90000fhdy0ht83py9","_id":"clxgfdcsb0002fhdy9p6p0b0u"},{"post_id":"clxgfc6d300007odyg8gg1y4w","tag_id":"clxgfdcsa0001fhdy0f8j8s40","_id":"clxgfdcsb0003fhdy5x1u8pf3"},{"post_id":"clxh0ivhl0000rvdyen14f5dy","tag_id":"clxgfdcs90000fhdy0ht83py9","_id":"clxh0ivhr0001rvdybk4u1mnh"},{"post_id":"clxh0ivhl0000rvdyen14f5dy","tag_id":"clxgfdcsa0001fhdy0f8j8s40","_id":"clxh0ivhs0002rvdyby8665aw"},{"post_id":"clxh0mtjx0000avdy7tdtf3iz","tag_id":"clxgfdcs90000fhdy0ht83py9","_id":"clxh0mtk20001avdye9hj8gk5"},{"post_id":"clxh0mtjx0000avdy7tdtf3iz","tag_id":"clxgfdcsa0001fhdy0f8j8s40","_id":"clxh0mtk30002avdygayi74rl"},{"post_id":"clxh0oeka0000kbdy6mt69rq6","tag_id":"clxgfdcs90000fhdy0ht83py9","_id":"clxh0pgxe0000m3dycs4obulf"},{"post_id":"clxh0oeka0000kbdy6mt69rq6","tag_id":"clxgfdcsa0001fhdy0f8j8s40","_id":"clxh0pgxf0001m3dyeolf9bw4"},{"post_id":"clxh0zy370000hfdy585eg5ei","tag_id":"clxgfdcs90000fhdy0ht83py9","_id":"clxh0zy3c0001hfdy956y21be"},{"post_id":"clxh0zy370000hfdy585eg5ei","tag_id":"clxgfdcsa0001fhdy0f8j8s40","_id":"clxh0zy3c0002hfdy8tc2gbku"}],"Tag":[{"name":"ç”Ÿæ´»","_id":"clxgdbzon0004xbdy9jlx483v"},{"name":"å·¥ä½œ","_id":"clxgdbzoo0006xbdy6c4m53ue"},{"name":"DM, æºç é˜…è¯»","_id":"clxgfc6d800017ody912ifvxa"},{"name":"DM","_id":"clxgfdcs90000fhdy0ht83py9"},{"name":"æºç é˜…è¯»","_id":"clxgfdcsa0001fhdy0f8j8s40"}]}}