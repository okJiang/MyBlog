<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>okJiang</title>
  
  <subtitle>è‡ªå¨±è‡ªä¹</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2024-06-16T07:00:14.111Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>okJiang</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>DM æ•°æ®æ—…ç¨‹ 02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”03reSync</title>
    <link href="http://example.com/2023/01/03/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B-02%EF%BC%9A%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E6%82%B2%E8%A7%82%E5%8D%8F%E8%B0%83%E2%80%94%E2%80%9403reSync/"/>
    <id>http://example.com/2023/01/03/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B-02%EF%BC%9A%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E6%82%B2%E8%A7%82%E5%8D%8F%E8%B0%83%E2%80%94%E2%80%9403reSync/</id>
    <published>2023-01-02T20:58:33.000Z</published>
    <updated>2024-06-16T07:00:14.111Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h1><p>åœ¨åˆ†åº“åˆ†è¡¨åŒæ­¥çš„è¿‡ç¨‹ä¸­ï¼Œä¸åŒçš„ DDL ä¹‹é—´ï¼Œè¿˜ä¼šç©¿æ’ç€å„ç§å„æ ·çš„ DML è¯­å¥ï¼Œè¿™äº› DML è¯­å¥è¦å¦‚ä½•å¤„ç†å‘¢ï¼Ÿä»Šå¤©å°±æ¥çœ‹çœ‹å®ƒä»¬çš„å¤„ç†è¿‡ç¨‹â€”â€”reSyncã€‚</p><p>æœ¬èŠ‚å…ˆä»‹ç» reSync çš„æ€»æµç¨‹ï¼Œç„¶ååˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ä»‹ç» reSyncï¼š</p><ul><li>ä¸€é˜¶æ®µï¼šreSync ä¹‹å‰</li><li>å¼€å¯ reSync</li><li>äºŒé˜¶æ®µï¼šreSync ä¹‹å</li><li>å…³é—­ reSync</li></ul><blockquote><p>æœ¬èŠ‚å†…å®¹çš†å‚è€ƒ <a href="https://github.com/pingcap/tiflow/tree/release-6.0">DM v6.0</a>ï¼Œå¯¹ç°åœ¨è€Œè¨€ï¼Œæœ‰å¯èƒ½å·²è¿‡æ—¶ï¼Œæ¬¢è¿å¤§å®¶æå‡ºæ„è§ï½</p></blockquote><h1 id="äºŒã€Overview"><a href="#äºŒã€Overview" class="headerlink" title="äºŒã€Overview"></a>äºŒã€Overview</h1><ol><li>è¿›å…¥ lock é˜¶æ®µåï¼Œåœ¨ç¬¬ä¸€æ¬¡ sync çš„æ—¶å€™ï¼Œä¼šè·³è¿‡è¢« active å½±å“åˆ°çš„ targetTable å¯¹åº”çš„ DML</li><li>åœ¨ Lock resolved ä¹‹åï¼Œä¼šå›åˆ°ç¬¬ä¸€æ¬¡è¿›å…¥ lock çš„ binlog Location ç‚¹ï¼Œè¿›è¡Œ reSyncï¼ŒæŠŠä¹‹å‰ skip çš„ DML é‡æ–° syncï¼Œè¿™ä¸ªé˜¶æ®µä¼šè·³è¿‡ä¸Šæ¬¡æ‰§è¡Œè¿‡çš„ DMLã€‚</li></ol><p><img src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404522042.png"></p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ä¸¤ç§ DML äº’ç›¸éš”ç¦»ï¼Œä¸ä¼šäº’ç›¸å½±å“ã€‚</p><h1 id="ä¸‰ã€è¿‡ç¨‹"><a href="#ä¸‰ã€è¿‡ç¨‹" class="headerlink" title="ä¸‰ã€è¿‡ç¨‹"></a>ä¸‰ã€è¿‡ç¨‹</h1><h2 id="1ã€ä¸€é˜¶æ®µ"><a href="#1ã€ä¸€é˜¶æ®µ" class="headerlink" title="1ã€ä¸€é˜¶æ®µ"></a>1ã€ä¸€é˜¶æ®µ</h2><h3 id="Skip"><a href="#Skip" class="headerlink" title="Skip"></a>Skip</h3><p>åœ¨ handleRowsEvent çš„æ—¶å€™ï¼Œ<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2368">åˆ¤æ–­è¯¥ event æ˜¯å¦éœ€è¦ skip</a>ï¼š</p><ol><li><p>é€šè¿‡ targetTable å¾—åˆ°å¯¹åº”çš„ group</p></li><li><p>é€šè¿‡ sourceTable å¾—åˆ°å¯¹åº”çš„ activeDDLItemï¼Œ</p><ol><li><p>ä¸‹å›¾ä¸­ ID3 å³ä¸éœ€è¦ skip</p></li><li><p>å¦‚æœå·²ç»æ”¶åˆ° activeDDLItem</p><ol><li>å¦‚æœè¯¥ DML åœ¨ active å‰é¢ï¼Œä¸éœ€è¦ skip</li><li>å¦‚æœè¯¥ DML åœ¨ active åé¢ï¼Œåˆ™ skip</li></ol></li></ol></li></ol><p><img src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672404521513.png"></p><h2 id="2ã€å¼€å§‹-reSync"><a href="#2ã€å¼€å§‹-reSync" class="headerlink" title="2ã€å¼€å§‹ reSync"></a>2ã€å¼€å§‹ reSync</h2><p><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2970-L2975">reSync ä¿¡å·</a>ï¼šæŠŠ targetTable å’Œ binlog location ä¿¡æ¯ä¼ é€’ç»™ä¸»é€»è¾‘ä¸­ï¼Œ<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1843-L1864">é‡å®šå‘ streamer</a>ã€‚</p><h3 id="ShardingReSync"><a href="#ShardingReSync" class="headerlink" title="ShardingReSync"></a>ShardingReSync</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ShardingReSync represents re-sync info for a sharding DDL group.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ShardingReSync <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">    currLocation   binlog.Location <span class="comment">// current DDL&#x27;s binlog location, initialize to first DDL&#x27;s location</span></span><br><span class="line"></span><br><span class="line">    latestLocation binlog.Location <span class="comment">// latest DDL&#x27;s binlog location</span></span><br><span class="line"></span><br><span class="line">    targetTable    *filter.Table</span><br><span class="line"></span><br><span class="line">    allResolved    <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨åˆ°çš„ <code>ShardingReSync</code> ç»“æ„ä½“ï¼š</p><ul><li>currLocationï¼šç”¨äºé‡å®šå‘</li><li>latestLocationï¼šç”¨äºåˆ¤æ–­ reSync æ˜¯å¦ç»“æŸ</li><li>targetTableï¼šç”¨äºåˆ¤æ–­è¯¥ DML æ˜¯å¦éœ€è¦ reSync</li><li>allResolvedï¼šä¸å…³é—­ reSync æœ‰å…³</li></ul><h2 id="3ã€äºŒé˜¶æ®µ"><a href="#3ã€äºŒé˜¶æ®µ" class="headerlink" title="3ã€äºŒé˜¶æ®µ"></a>3ã€äºŒé˜¶æ®µ</h2><ol><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2333-L2337">åˆ¤æ–­æ˜¯å¦ skip</a></li><li>æ›´æ–° <code>shardingReSync.currLocation</code> å¹¶åˆ¤æ–­æ˜¯å¦è¦ç»“æŸ reSync</li></ol><ul><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2125-L2143">XIDEvent</a></li><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2285-L2300">RotateEvent</a></li><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2328-L2332">RowsEvent</a></li><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2629-L2645">QueryEvent</a></li></ul><h2 id="4ã€å…³é—­-reSync"><a href="#4ã€å…³é—­-reSync" class="headerlink" title="4ã€å…³é—­ reSync"></a>4ã€å…³é—­ reSync</h2><p>å¦‚æœå½“å‰ binlog location å·²ç»è¶Šè¿‡äº† shardingReSync.lastestLocationï¼Œåˆ™é‡å®šå‘å›å»ã€‚æ ¹æ®æ˜¯å¦ allResolved æœ‰ä¸¤ç§é‡å®šå‘æ–¹å¼ï¼Œä½†è²Œä¼¼æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><h1 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h1><p>ç»è¿‡ reSync ä¹‹åï¼Œæ‚²è§‚åè°ƒå°±ç»“æŸäº†ã€‚reSync çš„è¿‡ç¨‹ä¸æ˜¯å¾ˆå¤æ‚ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ç§æ“ä½œï¼š</p><ul><li>é‡å®šå‘</li><li>Skip</li></ul><p>æ¥ä¸‹æ¥å°†ä¼šå¼€å§‹ä¹è§‚åè°ƒçš„å­¦ä¹ ï¼ˆå¸Œæœ›ğŸ˜­</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;ä¸€ã€æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;åœ¨åˆ†åº“åˆ†è¡¨åŒæ­¥çš„è¿‡ç¨‹ä¸­ï¼Œä¸åŒçš„ DDL ä¹‹é—´ï¼Œè¿˜ä¼šç©¿æ’ç€å„ç§å„æ ·çš„ DML è¯­å¥ï¼Œè¿™äº› DML è¯­å¥è¦å¦‚ä½•å¤„ç†å‘¢ï¼Ÿä»Šå¤©å°±æ¥çœ‹</summary>
      
    
    
    
    <category term="DM æ•°æ®æ—…ç¨‹" scheme="http://example.com/categories/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B/"/>
    
    
    <category term="DM" scheme="http://example.com/tags/DM/"/>
    
    <category term="æºç é˜…è¯»" scheme="http://example.com/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    
  </entry>
  
  <entry>
    <title>DM æ•°æ®æ—…ç¨‹ 02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”02Lock -&gt; Resolve Lock</title>
    <link href="http://example.com/2023/01/03/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B-02%EF%BC%9A%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E6%82%B2%E8%A7%82%E5%8D%8F%E8%B0%83%E2%80%94%E2%80%9402Lock-Resolve-Lock/"/>
    <id>http://example.com/2023/01/03/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B-02%EF%BC%9A%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E6%82%B2%E8%A7%82%E5%8D%8F%E8%B0%83%E2%80%94%E2%80%9402Lock-Resolve-Lock/</id>
    <published>2023-01-02T19:58:33.000Z</published>
    <updated>2024-06-16T06:59:24.542Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h1><p>ä»‹ç»äº†ä¸æ‚²è§‚åè°ƒæœ‰å…³çš„å„ä¸ªæ•°æ®ç»“æ„ä¹‹åï¼Œæ¥ä¸‹æ¥å°†ä»‹ç»ä¸€ä¸ª DM ç³»ç»Ÿä»æ¥å—åˆ°ç¬¬ä¸€æ¡åˆ†è¡¨ DDL å¼€å§‹ï¼Œåˆ°æ‰€æœ‰è¯¥ DDL å¯¹åº”çš„ Lock resolved çš„å…¨è¿‡ç¨‹ã€‚</p><blockquote><p>æœ¬èŠ‚å†…å®¹çš†å‚è€ƒ <a href="https://github.com/pingcap/tiflow/tree/release-6.0">DM v6.0</a>ï¼Œå¯¹ç°åœ¨è€Œè¨€ï¼Œæœ‰å¯èƒ½å·²è¿‡æ—¶ï¼Œæ¬¢è¿å¤§å®¶æå‡ºæ„è§ï½</p></blockquote><h1 id="äºŒã€Overview"><a href="#äºŒã€Overview" class="headerlink" title="äºŒã€Overview"></a>äºŒã€Overview</h1><p>å‡è®¾ç°åœ¨èµ·äº† master å’Œä¸¤ä¸ª Workerï¼Œä¸¤ä¸ª Worker åˆ†åˆ«ç»‘å®šä¸¤ä¸ª Sourceï¼ˆs1ï¼Œs2ï¼‰ï¼Œæ¯ä¸ª Source æœ‰ä¸¤ä¸ªåˆ†è¡¨ï¼ˆt1ï¼Œt2ï¼‰ï¼Œè¿™å››ä¸ªè¡¨ä¼š route åˆ°ä¸€ä¸ª target tableï¼ˆtarTblï¼‰ä¸­ã€‚åœ¨ DDL åˆ°æ¥ä¹‹å‰ï¼Œä¸¤ä¸ª worker ä¼šåˆ›å»ºå¥½ ShardingGroupKeeperï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ª target tableï¼Œä¸¤ä¸ª source tableã€‚</p><p><img src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283187.png"></p><p>ä¸¤ä¸ª Worker å…ˆåæ”¶åˆ°ä¸¤ä¸ª Source å››ä¸ªåˆ†è¡¨çš„åŒä¸€æ¡ DDLï¼Œè¡¨ç¤ºä¸ºï¼š</p><ul><li>DDL1ï¼šè¡¨ç¤ºå¯¹ s1.t1 çš„ DDLã€‚</li><li>DDL2ï¼šè¡¨ç¤ºå¯¹ s2.t1 çš„ DDLã€‚</li><li>DDL3ï¼šè¡¨ç¤ºå¯¹ s1.t2 çš„ DDLã€‚</li><li>DDL4ï¼šè¡¨ç¤ºå¯¹ s2.t2 çš„ DDLã€‚</li></ul><p><img src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283666.png"></p><h1 id="ä¸‰ã€å…·ä½“è¿‡ç¨‹"><a href="#ä¸‰ã€å…·ä½“è¿‡ç¨‹" class="headerlink" title="ä¸‰ã€å…·ä½“è¿‡ç¨‹"></a>ä¸‰ã€å…·ä½“è¿‡ç¨‹</h1><blockquote><p>æœ¬å°èŠ‚ worker å¯¹ DDL çš„å¤„ç†ä» <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2853">handleQueryEventPessimistic</a> å¼€å§‹ï¼Œå¦‚æœä¸çŸ¥é“åœ¨æ­¤ä¹‹å‰çš„ DDL åšè¿‡å“ªäº›å¤„ç†ï¼Œè¯·æœŸå¾…åç»­æ–‡ç« ğŸ˜</p></blockquote><p>æ¥ä¸‹æ¥å°†å¯¹ä¸Šå›¾ä¸­çš„æ­¥éª¤ä¸€ä¸€ä»‹ç»</p><h2 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h2><ol><li>worker1 æ”¶åˆ°æ¥è‡ª source1 çš„ DDL1ï¼Œä¼šç›´æ¥ <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883">TrySync</a>ï¼Œè¿™é‡Œè¿”å›äº†ä¸€å¤§å †çš„å‚æ•°ï¼Œå…¶å®æœ‰ç”¨çš„å°±åªæ˜¯ <code>synced</code>ï¼Œç®€å•æ¥è¯´ï¼Œé‡Œé¢åªåšäº†ä¸€ä»¶äº‹ï¼š<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding_group.go#L215">AddItem</a>ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹ TrySync</li></ol><blockquote><p>æœ¬èŠ‚ï¼Œå‡è®¾è¯¥ DDL ä¸æ˜¯ CreateTableStmtï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæ¯æ¬¡éƒ½æ˜¯ remain &lt;=0ï¼Œsynced = trueï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€æ¬¡å‘é€è¯¥ create table çš„ worker ä¼š syncDDLã€‚</p></blockquote><h3 id="TrySync"><a href="#TrySync" class="headerlink" title="TrySync"></a>TrySync</h3><p>æƒ³è¦çŸ¥é“ worker åœ¨æ‚²è§‚åè°ƒçš„æ—¶å€™åšäº†ä»€ä¹ˆï¼Œå¿…é¡»è¦ææ‡‚ TrySync æ˜¯æ€ä¹ˆè¿ä½œçš„ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥é‡æ–°ç†è§£ä¸€ä¸‹ ShardingGroupKeeperï¼š</p><p><img src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283187.png"></p><p>å•ç‹¬æ‹¿å‡ºä¸€ä¸ª ShardingGroup ä¸¾ä¾‹ï¼ˆé¢œè‰²ä»£è¡¨ DDL çš„ç§ç±»ï¼‰ï¼š</p><h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><p>worker æ”¶åˆ°äº†ä»¥ä¸‹ DDL</p><ul><li>ä¾æ¬¡æ”¶åˆ°äº† table1 æ©™è‰²ã€é»„è‰²ã€ç»¿è‰²ä¸‰æ¡ DDL</li><li>æ”¶åˆ°äº† table2 æ©™è‰²</li><li>è¿™ä¸ªæ—¶å€™ <code>activeIdx = 0</code>ï¼Œ<code>remain = 1</code>ï¼Œå› ä¸ºåªæœ‰ table3 æ²¡æœ‰æ”¶åˆ° active DDL äº†</li></ul><p><img src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283679.png"></p><ul><li>å¦‚æœåœ¨è¿™ä¸ªæ—¶å€™æ”¶åˆ°äº† table3 æ©™è‰² DDLï¼Œ<code>remain = 0</code>ï¼Œå¤„ç†äº†è¿™æ¡ DDL ä¹‹åï¼Œ<code>active ++</code></li></ul><p><img src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/image-1672713793518.png" alt="image.png"></p><ul><li>å¦‚æœè¿™ä¸ªæ—¶å€™æ”¶åˆ° table2 ç»¿è‰² DDLï¼Œåˆ™ä¼š<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L197-L199">æŠ¥é”™</a>ï¼Œæ‚²è§‚åè°ƒè¦æ±‚åŒä¸€ä¸ª source table ä¸­ DDL å¿…é¡»æœ‰åº</li></ul><p><img src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283186.png"></p><ul><li>å¦‚æœ group ä¸­æ‰€æœ‰çš„ DDL éƒ½ resolved äº†ã€‚åˆ™ä¼š<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L243-L246">é‡ç½®</a>ä¸€ä¸‹ meta</li></ul><p><img src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/unnamed-1672403283692.png"></p><p>æ€»ç»“ï¼š<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding_group.go#L215">AddItem</a> å°±æ˜¯ä¸Šé¢å›¾ä¸­æŠŠ DDLItem æ”¾è¿› ShardingSequence çš„è¿‡ç¨‹</p><h2 id="Step-2-ä¸-Step-1-ç›¸åŒ"><a href="#Step-2-ä¸-Step-1-ç›¸åŒ" class="headerlink" title="Step 2 ä¸ Step 1 ç›¸åŒ"></a>Step 2 ä¸ Step 1 ç›¸åŒ</h2><h2 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h2><p>ç”±äº tarTbl åªæœ‰ä¸¤ä¸ª source tableï¼šs1.t1 å’Œ s1.t2ï¼Œè¿™æ—¶ <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883">TrySync</a> åï¼Œ<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2948">synced = true</a>ï¼Œè¯´æ˜è¯¥ worker ready</p><h2 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4"></a>Step 4</h2><h3 id="worker1"><a href="#worker1" class="headerlink" title="worker1"></a>worker1</h3><ul><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2985">PutInfo</a>ï¼šå‘é€ ready info ç»™ masterï¼ˆåé¢ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸ªå‡½æ•°ï¼‰</li><li>ä¹‹åä¼šè¢«é˜»å¡ï¼Œ<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2992">ç­‰å¾… master å‘é€ operation</a>ã€‚</li></ul><h3 id="Master"><a href="#Master" class="headerlink" title="Master"></a>Master</h3><ul><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L177">watchInfoPut</a>ï¼šæˆåŠŸç›‘å¬åˆ°äº†</li><li>handleInfoPutï¼šmaster ä¹Ÿå¼€å§‹ <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L474">TrySync</a>ï¼Œmaster çš„ TrySync ç›¸æ¯” worker ä¸­çš„è¦ç®€å•å¾ˆå¤šï¼Œæ¯ä¸€ä¸ª Info ç›´æ¥ç›¸å½“äºè¯¥ source/worker å·² readyï¼Œæ‰€ä»¥ç›´æ¥ç»Ÿè®¡æ˜¯å¦æ‰€æœ‰ ready å³å¯</li><li>ç”±äºè¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ª worker å‘ info ç»™ masterï¼Œæ‰€ä»¥éœ€è¦<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/keeper.go#L49">æ–°å»º Lock</a>ï¼Œæ–°å»º Lock è¿‡ç¨‹ä¸­ä¼šè·å–è¯¥ task æ‰€æœ‰çš„ sourceï¼Œå¹¶å­˜åˆ° lock ä¸­ï¼Œè¿™æ ·å°±çŸ¥é“è¿˜æœ‰å¤šå°‘ source æ²¡ readyã€‚æ˜¾ç„¶è¿˜æœ‰ source2 æ²¡ readyã€‚</li><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L481-L485">ç»§ç»­ç­‰å¾…</a></li></ul><h2 id="Step-5-ä¸-Step-3-ç›¸åŒ"><a href="#Step-5-ä¸-Step-3-ç›¸åŒ" class="headerlink" title="Step 5 ä¸ Step 3 ç›¸åŒ"></a>Step 5 ä¸ Step 3 ç›¸åŒ</h2><h2 id="Step-6"><a href="#Step-6" class="headerlink" title="Step 6"></a>Step 6</h2><ul><li>å‰é¢ä¸ Step 4 ç›¸åŒï¼Œä½†æ˜¯è¿™æ—¶æ‰€æœ‰ source éƒ½ ready äº†ï¼Œ<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L486">synced = true</a></li></ul><h2 id="Step-7"><a href="#Step-7" class="headerlink" title="Step 7"></a>Step 7</h2><h3 id="master"><a href="#master" class="headerlink" title="master"></a>master</h3><ul><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L599">putOpForOwner</a>ï¼šå‘é€ <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L604">exec</a> operation to owner(worker1)</li></ul><h3 id="Worker1"><a href="#Worker1" class="headerlink" title="Worker1"></a>Worker1</h3><ul><li><p><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/shardddl/pessimist.go#L120-L124">å¾—åˆ° master çš„ exec operation</a></p></li><li><p><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L3042-L3043">NewDDLJob</a> å¹¶ handle</p></li><li><p><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1057">addJob</a>ï¼šå‘é€ job ç»™ DDLJobCh</p></li><li><p>syncDDLï¼šä¹‹å‰ worker èµ·çš„åç¨‹æ¥å—åˆ°è¯¥ job</p><ul><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1324">æ‹¿åˆ°åˆšåˆšå¾—åˆ°çš„ operation</a>ï¼Œå¹¶ä¸”ä¸ä¼šè¢«è·³è¿‡ï¼Œå› ä¸º ignore = false</li></ul></li></ul><h2 id="Step-8"><a href="#Step-8" class="headerlink" title="Step 8"></a>Step 8</h2><ul><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1344">åŒæ­¥åˆ°ä¸‹æ¸¸</a></li></ul><h2 id="Step-9"><a href="#Step-9" class="headerlink" title="Step 9"></a>Step 9</h2><h3 id="Worker1-1"><a href="#Worker1-1" class="headerlink" title="Worker1"></a>Worker1</h3><ul><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1384">DoneOperationDeleteInfo</a>ï¼šå‘é€ done operation ç»™ master å¹¶åˆ é™¤ info</li></ul><h2 id="Step-10"><a href="#Step-10" class="headerlink" title="Step 10"></a>Step 10</h2><h3 id="Master-1"><a href="#Master-1" class="headerlink" title="Master"></a>Master</h3><ul><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L509">æ¥å— done operation</a></li><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L529">markDone</a></li><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L553">putOpsForNonOwner</a>ï¼šç»™å…¶ä»–æ‰€æœ‰ non-owner å‘é€ skip infoï¼ˆskip done æ˜¯ä¸ºäº†é˜²æ­¢æŠŠ done è¦†ç›–æ‰ï¼‰</li></ul><h3 id="Worker2"><a href="#Worker2" class="headerlink" title="Worker2"></a>Worker2</h3><ul><li>æ¥å—åˆ°äº† no exec(skip) çš„ operationï¼Œå’Œ Step 7 ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨ syncDDL çš„æ—¶å€™ä¼š<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L1325-L1328">è¢« skip</a></li></ul><h2 id="Step-11-å’Œ-Step-9-ç›¸åŒ"><a href="#Step-11-å’Œ-Step-9-ç›¸åŒ" class="headerlink" title="Step 11 å’Œ Step 9 ç›¸åŒ"></a>Step 11 å’Œ Step 9 ç›¸åŒ</h2><h1 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h1><p>æœ¬èŠ‚ä»‹ç»äº†åœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ç¬¬ä¸€æ¡ DDL è¯­å¥ï¼Œç”Ÿæˆ Lockï¼Œåˆ°æ”¶åˆ°æ‰€æœ‰ DDL è¯­å¥ï¼ŒLock è§£é™¤çš„è¿‡ç¨‹ã€‚</p><p>ç»è¿‡æœ¬èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»å®Œå…¨å­¦ä¼šäº† DM æ‚²è§‚åè°ƒçš„è¿‡ç¨‹ã€‚æ˜¯ä¸æ˜¯ä¹Ÿæ²¡é‚£ä¹ˆå¤æ‚ğŸ˜ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªçŸ¥é“ DDL çš„å¤„ç†æ–¹å¼ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­çš„ DML ä¼šæ€ä¹ˆåŠå‘¢ï¼Ÿä¸‹ä¸€ç« æ­æ™“ã€‚</p><h1 id="äº”ã€ç–‘ä¼¼-bug"><a href="#äº”ã€ç–‘ä¼¼-bug" class="headerlink" title="äº”ã€ç–‘ä¼¼ bug"></a>äº”ã€ç–‘ä¼¼ bug</h1><ol><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L552-L559">initShardingGroups</a> ä¸­å¯¹ ShardingGroup.sources è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œè¿™é‡ŒåŒ…å«äº†è¯¥ targetTable å¯¹åº”çš„æ‰€æœ‰ sourceTables</li><li>åœ¨ <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2883">TrySync</a> çš„æ—¶å€™ï¼Œå´ä½¿ç”¨ç¬¬ä¸€ä¸ª <code>sourceTable[0]</code>ï¼Œæ¥æ ‡è®°æ‰€æœ‰çš„ <code>DDL[]</code>ï¼Œå¦‚æœ <code>len(DDL[]) != 1</code>ï¼Œåˆ™ remain æ°¸è¿œä¸å¯èƒ½ä¸º 0ã€‚å› ä¸º sourceTables æ¥æºäº ddlInfoã€‚è€Œ DDLInfo åªå­˜äº†<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2738-L2743">ç¬¬ä¸€æ¡ ddl çš„ ddlInfo</a>ï¼Œå®é™…ä¸Šå¯¹äºæ¯ä¸€ä¸ª Split ä¹‹åçš„ DDLï¼Œéƒ½ä¼š <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2694">genDDLInfo</a>ã€‚</li><li>ä½†æ˜¯å¥‡æ€ªçš„æ˜¯ï¼Œä»£ç ä¸­æ ‡æ³¨äº†<a href="http://errsyncerunitddlonmultipletable/">ä¸æ”¯æŒ multi-table DDL</a>ï¼Œè¿™ä¸ª error åœ¨ pessimist/optimist mode ä¸­éƒ½ç”¨åˆ°äº†ã€‚ä½†æ˜¯åœ¨ç°åœ¨çœ‹ pessimist ä»£ç ä¸­ï¼Œåˆçœ‹åˆ°å…¶ä¸º multi-table DDL å®ç°äº†éƒ¨åˆ†ç›¸å…³é€»è¾‘ã€‚ã€‚ã€‚<strong>æœ‰æ¯’</strong></li><li>æ¯”å¦‚ï¼š</li></ol><ul><li>https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L2957-L2960</li><li>https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/sharding-meta/shardmeta.go#L35</li><li>ã€‚ã€‚ã€‚</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;ä¸€ã€æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;ä»‹ç»äº†ä¸æ‚²è§‚åè°ƒæœ‰å…³çš„å„ä¸ªæ•°æ®ç»“æ„ä¹‹åï¼Œæ¥ä¸‹æ¥å°†ä»‹ç»ä¸€ä¸ª DM ç³»ç»Ÿä»æ¥å—åˆ°ç¬¬ä¸€æ¡åˆ†è¡¨ DDL å¼€å§‹ï¼Œåˆ°æ‰€æœ‰è¯¥ DDL å¯¹åº”</summary>
      
    
    
    
    <category term="DM æ•°æ®æ—…ç¨‹" scheme="http://example.com/categories/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B/"/>
    
    
    <category term="DM" scheme="http://example.com/tags/DM/"/>
    
    <category term="æºç é˜…è¯»" scheme="http://example.com/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    
  </entry>
  
  <entry>
    <title>DM æ•°æ®æ—…ç¨‹ 02ï¼šåˆ†åº“åˆ†è¡¨æ‚²è§‚åè°ƒâ€”â€”01å‡†å¤‡è¿‡ç¨‹</title>
    <link href="http://example.com/2023/01/03/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B-02%EF%BC%9A%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E6%82%B2%E8%A7%82%E5%8D%8F%E8%B0%83%E2%80%94%E2%80%9401%E5%87%86%E5%A4%87%E8%BF%87%E7%A8%8B/"/>
    <id>http://example.com/2023/01/03/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B-02%EF%BC%9A%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E6%82%B2%E8%A7%82%E5%8D%8F%E8%B0%83%E2%80%94%E2%80%9401%E5%87%86%E5%A4%87%E8%BF%87%E7%A8%8B/</id>
    <published>2023-01-02T19:50:33.000Z</published>
    <updated>2024-06-16T07:10:04.519Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h1><p>åˆ†åº“åˆ†è¡¨çš„æ‚²è§‚åè°ƒæ–¹æ³•æ˜¯ 2018 å¹´å¼€å‘çš„ç‰¹æ€§ï¼Œæ˜¯ DM é¦–æ¬¡æ”¯æŒ MySQL åˆ†åº“åˆ†è¡¨çš„è¿ç§»ã€‚ç”±äºåˆ†åº“åˆ†è¡¨åœ¨å„ä¸ªå…¬å¸ä¸­çš„åº”ç”¨å®åœ¨å¤ªè¿‡å¹¿æ³›ï¼Œæ‰€ä»¥åªæœ‰åœ¨æ”¯æŒåˆ†åº“åˆ†è¡¨è¿ç§»åï¼ŒDM æ‰æœ‰äº†å·¥ç¨‹å®è·µçš„æ„ä¹‰ï¼Œå¦åˆ™åªèƒ½ç®—ä½œä¸€ä¸ªç©å…·ã€‚è¿™å¯¹ DM æ¥è¯´æ„ä¹‰é‡å¤§ã€‚</p><p>ç”±äºæ‚²è§‚åè°ƒçš„å†…å®¹åºå¤§ï¼Œæœ¬èŠ‚åªè®²è¿°æ‚²è§‚åè°ƒçš„å‡†å¤‡è¿‡ç¨‹ï¼š</p><ul><li>Master çš„å‡†å¤‡è¿‡ç¨‹</li><li>Worker çš„å‡†å¤‡è¿‡ç¨‹</li></ul><p>ä»¥åŠåœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­è‡³å…³é‡è¦çš„ç»“æ„ä½“ï¼š</p><ul><li>Lock</li><li>Info</li><li>Operation</li><li>ShardingMeta</li><li>ShardingGroup</li><li>â€¦</li></ul><blockquote><p>æ³¨ï¼šä¸ºäº†ä¸“æ³¨äºæˆ‘ä»¬çš„ç›®çš„ï¼ˆæ‚²è§‚åè°ƒï¼‰ï¼Œæœ¬æ–‡ä¸ä¼šå¯¹æ— å…³ä»£ç è¿›è¡Œè§£è¯»</p></blockquote><blockquote><p>è¿™ä¸€èŠ‚å¤–é“¾ä¸­çš„ä»£ç ï¼Œè¯»è€…å¯èƒ½ä¼šäº§ç”Ÿè¿™ä¸ªé€»è¾‘ä¸ºä»€ä¹ˆæ˜¯è¿™é‡Œçš„ç–‘é—®ã€‚è¿™æ˜¯å› ä¸ºæœ¬èŠ‚å¹¶æ²¡æœ‰å®Œå…¨æŒ‰ç…§é¡ºåºè¯»ä»£ç ã€‚æ‰€ä»¥è¯»è€…å¯ä»¥ä»…å¸¦ç€å­¦ä¹ çš„å¿ƒæ€é˜…è¯»æœ¬èŠ‚ï¼Œæš‚æ—¶ä¸éœ€è¦çŸ¥é“å®ƒä¸ºä»€ä¹ˆåœ¨ä»£ç çš„è¿™ä¸ªåœ°æ–¹ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ä¼šé¡ºåºé˜…è¯»ä»£ç </p></blockquote><blockquote><p>æœ¬èŠ‚åŸºäº <a href="https://github.com/pingcap/tiflow/tree/release-6.0">DM release-6.0.0</a></p></blockquote><h1 id="äºŒã€Master"><a href="#äºŒã€Master" class="headerlink" title="äºŒã€Master"></a>äºŒã€Master</h1><h2 id="1ã€Pessimist-å’Œ-LockKeeper"><a href="#1ã€Pessimist-å’Œ-LockKeeper" class="headerlink" title="1ã€Pessimist å’Œ LockKeeper"></a>1ã€Pessimist å’Œ LockKeeper</h2><ul><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/server.go#L140">NewPessimist</a>ï¼šPessimist æ˜¯ Master å¤„ç†æ‚²è§‚åè°ƒçš„ç»“æ„ä½“ï¼Œå…¶ä¸­æœ€é‡è¦çš„æˆå‘˜æ˜¯ <code>LockKeeper</code>ã€‚</li><li><code>LockKeeper</code> çš„ä½œç”¨æ˜¯ç®¡ç†å„ç§å„æ ·çš„ lockã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LockKeeper used to keep and handle DDL lock conveniently.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The lock information do not need to be persistent, and can be re-constructed from the shard DDL info.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> LockKeeper <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">    mu    sync.RWMutex</span><br><span class="line"></span><br><span class="line">    locks <span class="keyword">map</span>[<span class="type">string</span>]*Lock <span class="comment">// lockID -&gt; Lock</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Lock å¯ä»¥çœ‹ä½œæ˜¯æ¯ä¸€ä¸ª ddl å½±å“çš„åº“è¡¨ï¼Œè¿™äº›åº“è¡¨åˆ†å¸ƒåœ¨ä¸åŒçš„ MySQL/source ä¸­ã€‚ç”±äºåœ¨æ‚²è§‚åè°ƒè¿‡ç¨‹ä¸­ï¼Œæ•°æ®æµï¼ˆbinlog æµï¼‰ä¸æ˜¯åœæ»çš„ï¼Œæ‰€ä»¥åœ¨æ•°æ®æµä¸­ï¼Œä¼šæºæºä¸æ–­åœ°å‡ºç°æ–° DDLï¼Œå³æ–° lockã€‚</li><li>æ•… <code>LockKeeper</code> å°±æ˜¯ç®¡ç†è¿™äº› lockã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lock represents the shard DDL lock in memory.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// This information does not need to be persistent, and can be re-constructed from the shard DDL info.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Lock <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">    mu sync.RWMutex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ID     <span class="type">string</span>   <span class="comment">// lock&#x27;s ID</span></span><br><span class="line"></span><br><span class="line">    Task   <span class="type">string</span>   <span class="comment">// lock&#x27;s corresponding task name</span></span><br><span class="line"></span><br><span class="line">    Owner  <span class="type">string</span>   <span class="comment">// Owner&#x27;s source ID (not DM-worker&#x27;s name)</span></span><br><span class="line"></span><br><span class="line">    DDLs   []<span class="type">string</span> <span class="comment">// DDL statements</span></span><br><span class="line"></span><br><span class="line">    remain <span class="type">int</span>      <span class="comment">// remain count of sources needed to receive DDL info</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// whether the DDL info received from the source.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// if all of them have been ready, then we call the lock `synced`.</span></span><br><span class="line"></span><br><span class="line">    ready <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">bool</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// whether the operations have done (exec/skip the shard DDL).</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// if all of them have done, then we call the lock `resolved`.</span></span><br><span class="line"></span><br><span class="line">    done <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">bool</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2ã€Lock"><a href="#2ã€Lock" class="headerlink" title="2ã€Lock"></a>2ã€Lock</h2><ul><li>ID è¡¨ç°å½¢å¼ä¸º <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/utils/common.go#L223">${task}-${schema}.${table}</a>ï¼Œä» LockKeeper çš„ç»“æ„å¯ä»¥çœ‹åˆ°åŒä¸€ä»»åŠ¡åŒä¸€è¡¨ä¸‹åªèƒ½æœ‰ä¸€ä¸ª lockï¼Œå¦‚æœé‡åˆ°äº†ä¸åŒçš„ DDLï¼Œå½±å“çš„åˆæ˜¯åŒä»»åŠ¡åŒè¡¨ï¼Œåˆ™<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/lock.go#L72-L74">æŠ¥é”™</a>ã€‚</li><li>DDLs ä¸ºä»€ä¹ˆæ˜¯ <code>[]string</code>ï¼Ÿå› ä¸ºè¿™é‡Œæ˜¯ç»è¿‡ <code>Split</code> çš„ DDLsï¼Œå•æ¡ DDL å¯èƒ½ä¼šè¢« Split æˆå¤šæ¡ DDLã€‚</li><li>Remain è¡¨ç¤ºå‰©ä½™çš„è¿˜æœªæ”¶åˆ° DDL çš„ source/workerï¼ˆä»¥ä¸‹ worker éƒ½è¡¨ç¤º source/worker å¯¹ï¼‰æ•°é‡ã€‚å³å¦‚æœ worker æŠŠè¿™ä¸ª Lock ç›¸å…³çš„ DDLsï¼ˆå®é™…ä¸Šæ˜¯ info çš„å½¢å¼ï¼‰å‘ç»™ masterï¼Œmaster åˆ™æŠŠ <code>remain --</code>ã€‚</li><li>Ready å’Œ remain è¡¨è¾¾ç›¸åŒçš„æ„æ€ï¼Œremain å³è¡¨ç¤º ready ä¸­ä¸º <code>true</code> çš„ä¸ªæ•°</li><li>Done è¡¨ç¤º operation ç»“æŸçš„ worker çš„çŠ¶æ€</li></ul><blockquote><p>æ³¨æ„ï¼šä¸‹é¢è¯´çš„æ‰€æœ‰ worker éƒ½ ready å³æ˜¯ <strong>remain &lt;= 0</strong>ï¼Œä»£ç ä¸­å³æ˜¯ <strong>synced</strong> = trueã€‚è¿™é‡Œåˆ›é€ çš„æ¦‚å¿µè¿‡å¤šï¼Œåº”è¯¥æ”¶æŸä¸€ä¸‹ï¼Œå‡å°‘ä»£ç çš„ç†è§£éš¾åº¦ã€‚</p></blockquote><blockquote><p>TODOï¼šå¯ä»¥æŠŠä»£ç ä¸­çš„ remain æ”¹æˆ noReadiesï¼›synced æ”¹æˆ allReady</p></blockquote><h2 id="3ã€Info"><a href="#3ã€Info" class="headerlink" title="3ã€Info"></a>3ã€Info</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Info represents the shard DDL information.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// This information should be persistent in etcd so can be retrieved after the DM-master leader restarted or changed.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> `Task` and `Source` are redundant in the etcd key path for convenient.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Info <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">    Task   <span class="type">string</span>   <span class="string">`json:&quot;task&quot;`</span>   <span class="comment">// data migration task name</span></span><br><span class="line"></span><br><span class="line">    Source <span class="type">string</span>   <span class="string">`json:&quot;source&quot;`</span> <span class="comment">// upstream source ID</span></span><br><span class="line"></span><br><span class="line">    Schema <span class="type">string</span>   <span class="string">`json:&quot;schema&quot;`</span> <span class="comment">// schema name of the DDL</span></span><br><span class="line"></span><br><span class="line">    Table  <span class="type">string</span>   <span class="string">`json:&quot;table&quot;`</span>  <span class="comment">// table name of the DDL</span></span><br><span class="line"></span><br><span class="line">    DDLs   []<span class="type">string</span> <span class="string">`json:&quot;ddls&quot;`</span>   <span class="comment">// DDL statements</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Info å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹ï¼Œåªæ˜¯ç”¨ä½œ worker é€šçŸ¥ masterï¼ŒæŸ lock ready çš„æ¶ˆæ¯ã€‚</p><h2 id="4ã€Operation"><a href="#4ã€Operation" class="headerlink" title="4ã€Operation"></a>4ã€Operation</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Operation represents a shard DDL coordinate operation.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// This information should be persistent in etcd so can be retrieved after the DM-master leader restarted or changed.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> `Task` and `Source` are redundant in the etcd key path for convenient.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Operation <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">    ID     <span class="type">string</span>   <span class="string">`json:&quot;id&quot;`</span>     <span class="comment">// the corresponding DDL lock ID</span></span><br><span class="line"></span><br><span class="line">    Task   <span class="type">string</span>   <span class="string">`json:&quot;task&quot;`</span>   <span class="comment">// data migration task name</span></span><br><span class="line"></span><br><span class="line">    Source <span class="type">string</span>   <span class="string">`json:&quot;source&quot;`</span> <span class="comment">// upstream source ID</span></span><br><span class="line"></span><br><span class="line">    DDLs   []<span class="type">string</span> <span class="string">`json:&quot;ddls&quot;`</span>   <span class="comment">// DDL statements</span></span><br><span class="line"></span><br><span class="line">    Exec   <span class="type">bool</span>     <span class="string">`json:&quot;exec&quot;`</span>   <span class="comment">// execute or skip the DDL statements</span></span><br><span class="line"></span><br><span class="line">    Done   <span class="type">bool</span>     <span class="string">`json:&quot;done&quot;`</span>   <span class="comment">// whether the `Exec` operation has done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// only used to report to the caller of the watcher, do not marsh it.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// if it&#x27;s true, it means the Operation has been deleted in etcd.</span></span><br><span class="line"></span><br><span class="line">    IsDeleted <span class="type">bool</span> <span class="string">`json:&quot;-&quot;`</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Execï¼šæ˜¯ master å‘ worker å‘é€æ¶ˆæ¯æ—¶æ‰€ç”¨åˆ°çš„å­—æ®µã€‚å®ƒå‘ŠçŸ¥è¯¥ worker æ˜¯å¦éœ€è¦æ‰§è¡Œ DDLï¼Œåªéœ€è¦ owner æ‰§è¡Œ DDL</li><li>Doneï¼šæ˜¯ worker å‘ master å‘é€æ¶ˆæ¯æ—¶æ‰€ç”¨åˆ°çš„å­—æ®µã€‚å®ƒå‘ŠçŸ¥ master è¯¥ worker done äº†ã€‚done å¹¶ä¸ä»£è¡¨è¯¥ worker æ‰§è¡Œäº† DDLï¼Œè€Œæ˜¯è¡¨ç¤ºä¸€ç§çŠ¶æ€ï¼Œå› ä¸ºåªæœ‰ owner å¯ä»¥æ‰§è¡Œ DDLï¼Œnon-owner done å¯ä»¥å½“ä½œ non-worker æ¥å—åˆ°äº† DDL å·²æ‰§è¡Œçš„ä¿¡æ¯çš„ç¡®è®¤ã€‚</li></ul><h2 id="3ã€Start"><a href="#3ã€Start" class="headerlink" title="3ã€Start"></a>3ã€Start</h2><blockquote><p>ä»¥ä¸‹å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­æœç´¢å¯¹åº”çš„åå­—ï¼Œè¯·åŠ¡å¿…ä¸å¯¹åº”ä»£ç ä¸€èµ·é˜…è¯»ï¼</p></blockquote><ul><li><p>s.pessimist.Start</p></li><li><p>p.run</p><ul><li><p>watchInfoOperation</p><ul><li><p>pessimism.WatchInfoPutï¼šç­‰å¾… worker å‘é€ info</p></li><li><p>p.handleInfoPutï¼š</p><ul><li>æ”¶åˆ° Worker å‘é€çš„ info ä¹‹åï¼Œæ„å‘³ç€è¯¥ worker <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/lock.go#L87-L88">å·² ready</a></li><li>å¦‚æœè¿™ä¸ªæ—¶å€™æ‰€æœ‰çš„ source/worker éƒ½ <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L486">readyï¼ˆsyncedï¼‰</a> äº†ï¼Œåˆ™å¯ä»¥<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L602-L611">å‘é€ä¸€ä¸ª exec operation ç»™è¯¥ lock çš„ owner</a>ï¼ˆç¬¬ä¸€ä¸ª<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/pkg/shardddl/pessimism/keeper.go#L49">åˆ›å»º lock</a> çš„ workerï¼‰</li></ul></li><li><p>pessimism.WatchOperationPutï¼š</p><ul><li>ç­‰å¾… worker å‘é€ operation doneã€‚</li><li>è¿™é‡Œçš„ operation å’Œ ä¸Šé¢å‘é€çš„ operation å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œç›‘å¬çš„æ²¡æœ‰æŒ‡å®š <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L192">task å’Œ source</a>ï¼Œä¸Šé¢å‘é€çš„ operation æ˜¯<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L604">æŒ‡å®š task å’Œ source</a> çš„ã€‚æ‰€ä»¥ä¸Šé¢å‘é€çš„ operation è¿™é‡Œä¹Ÿä¼šç›‘å¬åˆ°ï¼Œ</li></ul></li><li><p>p.handleOperationPutï¼š</p><ul><li><p>æ”¶åˆ° <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L509-L512">not done </a>operation è¿™é‡Œå¹¶ä¸è¿›è¡Œæ“ä½œã€‚å³ä¸Šé¢å‘é€ exec operation çš„æ—¶å€™æ²¡æœ‰ doneã€‚</p></li><li><p>å½“æ”¶åˆ° operation is done æ—¶ï¼Œæ‰è¿›è¡Œä¸€ç³»åˆ—æ“ä½œã€‚å³ä» worker å‘é€è¿‡æ¥çš„ done operationã€‚</p><ul><li>é¦–å…ˆ markDone</li><li>å¦‚æœæ˜¯ owner done äº†ï¼Œè¿˜ä¼šå¯¹ non-owner å‘é€ <a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L553">exec operation</a>ï¼Œç£ä¿ƒ non-owner done</li><li>å¦‚æœæ‰€æœ‰çš„ worker éƒ½ done äº†ï¼ˆå³ resolvedï¼‰ï¼Œåˆ™<a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/dm/master/shardddl/pessimist.go#L533">æŠŠ lock é‡Šæ”¾</a></li></ul></li></ul></li></ul></li><li><p>é”™è¯¯å¤„ç†</p></li></ul></li></ul><h1 id="ä¸‰ã€Worker"><a href="#ä¸‰ã€Worker" class="headerlink" title="ä¸‰ã€Worker"></a>ä¸‰ã€Worker</h1><h2 id="1ã€Pessimist"><a href="#1ã€Pessimist" class="headerlink" title="1ã€Pessimist"></a>1ã€Pessimist</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pessimist used to coordinate the shard DDL migration in pessimism mode.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Pessimist <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">    mu sync.RWMutex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    logger log.Logger</span><br><span class="line"></span><br><span class="line">    cli    *clientv3.Client</span><br><span class="line"></span><br><span class="line">    task   <span class="type">string</span></span><br><span class="line"></span><br><span class="line">    source <span class="type">string</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// the shard DDL info which is pending to handle.</span></span><br><span class="line"></span><br><span class="line">    pendingInfo *pessimism.Info</span><br><span class="line"></span><br><span class="line">    <span class="comment">// the shard DDL lock operation which is pending to handle.</span></span><br><span class="line"></span><br><span class="line">    pendingOp *pessimism.Operation</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L252">NewPessimist</a>ï¼šworker ä¸­çš„ pessimist ä¸åŒäº master ä¸­çš„ pessimistã€‚å®ƒåªä¿å­˜äº† <code>pendingInfo</code> å’Œ <code>pendingOp</code>ï¼Œç”¨äºä¿å­˜å½“å‰çš„ Info å’Œ Operation</li></ul><h2 id="2ã€ShardingGroupKeeper"><a href="#2ã€ShardingGroupKeeper" class="headerlink" title="2ã€ShardingGroupKeeper"></a>2ã€ShardingGroupKeeper</h2><ul><li><a href="https://github.com/pingcap/tiflow/blob/release-6.0/dm/syncer/syncer.go#L277">NewShardingGroupKeeper</a>ï¼šå…¶ä¸­æœ€é‡è¦çš„ç»“æ„ä½“å°±æ˜¯ <code>shardingGroup</code>ã€‚<code>shardingGroup</code> å’Œ master ä¸­çš„ <code>Lock</code> ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨äºç®¡ç† DDL å½±å“åˆ°çš„ tableï¼ˆåœ¨ Lock ä¸­æ˜¯ source/workerï¼‰ã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ShardingGroupKeeper used to keep ShardingGroup.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ShardingGroupKeeper <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">    sync.RWMutex</span><br><span class="line"></span><br><span class="line">    groups <span class="keyword">map</span>[<span class="type">string</span>]*ShardingGroup <span class="comment">// target table ID -&gt; ShardingGroup</span></span><br><span class="line"></span><br><span class="line">    cfg    *config.SubTaskConfig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    shardMetaSchema    <span class="type">string</span></span><br><span class="line"></span><br><span class="line">    shardMetaTable     <span class="type">string</span></span><br><span class="line"></span><br><span class="line">    shardMetaTableName <span class="type">string</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    db     *conn.BaseDB</span><br><span class="line"></span><br><span class="line">    dbConn *dbconn.DBConn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    tctx *tcontext.Context</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3ã€ShardingGroup"><a href="#3ã€ShardingGroup" class="headerlink" title="3ã€ShardingGroup"></a>3ã€ShardingGroup</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ShardingGroup represents a sharding DDL sync group.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ShardingGroup <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">    sync.RWMutex</span><br><span class="line"></span><br><span class="line">    <span class="comment">// remain count waiting for syncing</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// == len(sources):  DDL syncing not started or resolved</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// == 0: all DDLs synced, will be reset to len(sources) after resolved combining with other dm-workers</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// (0, len(sources)): waiting for syncing</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> we can make remain to be configurable if needed</span></span><br><span class="line"></span><br><span class="line">    remain       <span class="type">int</span></span><br><span class="line"></span><br><span class="line">    sources      <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">bool</span> <span class="comment">// source table ID -&gt; whether source table&#x27;s DDL synced</span></span><br><span class="line"></span><br><span class="line">    IsSchemaOnly <span class="type">bool</span>            <span class="comment">// whether is a schema (database) only DDL <span class="doctag">TODO:</span> zxc add schema-level syncing support later</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    sourceID <span class="type">string</span>                  <span class="comment">// associate dm-worker source ID</span></span><br><span class="line"></span><br><span class="line">    meta     *shardmeta.ShardingMeta <span class="comment">// sharding sequence meta storage</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    firstLocation    *binlog.Location <span class="comment">// first DDL&#x27;s binlog pos and gtid, used to restrain the global checkpoint when un-resolved</span></span><br><span class="line"></span><br><span class="line">    firstEndLocation *binlog.Location <span class="comment">// first DDL&#x27;s binlog End_log_pos and gtid, used to re-direct binlog streamer after synced</span></span><br><span class="line"></span><br><span class="line">    ddls             []<span class="type">string</span>         <span class="comment">// DDL which current in syncing</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    flavor     <span class="type">string</span></span><br><span class="line"></span><br><span class="line">    enableGTID <span class="type">bool</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Remain å’Œ Lock ä¸­çš„ remain æ„ä¹‰å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡ŒæŒ‡ table æ˜¯å¦ readyï¼ˆç°ä»£ç ä¸­ç”¨çš„ syncedï¼‰</li></ul><blockquote><p>whether source tableâ€™s DDL synced</p></blockquote><blockquote><p>TODOï¼šåº”è¯¥ç»Ÿä¸€æ¦‚å¿µï¼Œè¿™é‡Œä¹Ÿç”¨ ready è¡¨ç¤º</p></blockquote><ul><li>sourcesï¼šå’Œ Lock ä¸­çš„ ready ç±»ä¼¼</li><li>firstLocation/firstEndLocation/ddlsï¼šè¿™ä¸‰ä¸ªå…¶å®åœ¨ meta ä¸­éƒ½æœ‰ä¿å­˜ï¼Œæ‰€ä»¥æ„Ÿè§‰å…¶å®æ²¡å•¥ç”¨</li><li>metaï¼šé‡Œé¢ä¿å­˜ç€æ‰€æœ‰çš„æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä¸‹é¢è¯¦ç»†è¯´</li></ul><h2 id="4ã€ShardingMeta"><a href="#4ã€ShardingMeta" class="headerlink" title="4ã€ShardingMeta"></a>4ã€ShardingMeta</h2><p>è¿™äº›ä¿¡æ¯ä¼šè¢«æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ShardingMeta stores sharding ddl sequence</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// including global sequence and each source&#x27;s own sequence</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> sharding meta is not thread safe, it must be used in thread safe context.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ShardingMeta <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">    activeIdx <span class="type">int</span>                          <span class="comment">// the first unsynced DDL index</span></span><br><span class="line"></span><br><span class="line">    global    *ShardingSequence            <span class="comment">// merged sharding sequence of all source tables</span></span><br><span class="line"></span><br><span class="line">    sources   <span class="keyword">map</span>[<span class="type">string</span>]*ShardingSequence <span class="comment">// source table ID -&gt; its sharding sequence</span></span><br><span class="line"></span><br><span class="line">    tableName <span class="type">string</span>                       <span class="comment">// table name (with schema) used in downstream meta db</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    enableGTID <span class="type">bool</span> <span class="comment">// whether enableGTID, used to compare location</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>activeIdxï¼šè¡¨ç¤ºå½“å‰æ´»è·ƒçš„ DDL ä¸‹æ ‡ï¼Œå³ç°åœ¨è¢«å“ªä¸ª DDL å¡ä½äº†</li><li>globalï¼šè¡¨ç¤ºå…¨å±€çš„ DDL åºåˆ—ï¼Œå³æ‰€æœ‰ table ä¸­æœ€é•¿çš„</li><li>sourcesï¼šè¡¨ç¤ºå„ä¸ª table çš„ DDL åºåˆ—</li></ul><h2 id="5ã€ShardingSequence-å’Œ-DDLItem"><a href="#5ã€ShardingSequence-å’Œ-DDLItem" class="headerlink" title="5ã€ShardingSequence å’Œ DDLItem"></a>5ã€ShardingSequence å’Œ DDLItem</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ShardingSequence records a list of DDLItem.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ShardingSequence <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">    Items []*DDLItem <span class="string">`json:&quot;items&quot;`</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DDLItem records ddl information used in sharding sequence organization.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> DDLItem <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">    FirstLocation binlog.Location <span class="string">`json:&quot;-&quot;`</span>      <span class="comment">// first DDL&#x27;s binlog Pos, not the End_log_pos of the event</span></span><br><span class="line"></span><br><span class="line">    DDLs          []<span class="type">string</span>        <span class="string">`json:&quot;ddls&quot;`</span>   <span class="comment">// DDLs, these ddls are in the same QueryEvent</span></span><br><span class="line"></span><br><span class="line">    Source        <span class="type">string</span>          <span class="string">`json:&quot;source&quot;`</span> <span class="comment">// source table ID</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// just used for json&#x27;s marshal and unmarshal, because gtid.Set in FirstLocation is interface,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// can&#x27;t be marshal and unmarshal</span></span><br><span class="line"></span><br><span class="line">    FirstPosition mysql.Position <span class="string">`json:&quot;first-position&quot;`</span></span><br><span class="line"></span><br><span class="line">    FirstGTIDSet  <span class="type">string</span>         <span class="string">`json:&quot;first-gtid-set&quot;`</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ DDLItem å’Œ Lock ä¸­çš„ []DDL å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ª DDLItem ä¸­ä¹ŸåŒ…å«å¤šä¸ª DDLã€‚ä½†æ˜¯è¿™é‡Œçš„ DDLItem ä¸­å°è£…äº†æ›´å¤šçš„ä¿¡æ¯ï¼š</p><blockquote><p>DDLs []string `json:â€ddlsâ€` // DDLs, these ddls are in the same QueryEvent</p></blockquote><ul><li>FirstLocationï¼šDDL å¼€å§‹çš„ä½ç‚¹ï¼Œä¸»è¦ç”¨äºè¯†åˆ«è¯¥ DDL ä¹‹å‰æ˜¯å¦æ¥è¿‡äº†ã€‚</li></ul><h2 id="6ã€Init"><a href="#6ã€Init" class="headerlink" title="6ã€Init"></a>6ã€Init</h2><ul><li>s.sgk.Init()ï¼šåœ¨ä¸‹æ¸¸åˆ›å»ºåº“è¡¨ <code>dm_meta.($task)_syncer_sharding_meta</code></li><li>s.initShardingGroups</li></ul><blockquote><p>TODOï¼šå¯ç”¨ <code>utils.FetchTargetDoTables()</code> æ›¿æ¢ <code>fromDB.FetchAllDoTables</code></p></blockquote><ol><li>s.sgk.LoadShardMetaï¼šæŠŠæ•°æ®è¯»å‡ºæ¥ï¼Œå­˜åˆ°å†…å­˜é‡Œ</li><li>s.sgk.AddGroupï¼šæŠŠ ShardingGroup æ¢å¤</li></ol><ul><li>Reset</li></ul><h2 id="7ã€Start"><a href="#7ã€Start" class="headerlink" title="7ã€Start"></a>7ã€Start</h2><ul><li>å¯åŠ¨ syncDDL çº¿ç¨‹ï¼Œç­‰å¾… DDL job</li></ul><h1 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h1><p>æœ¬å°èŠ‚ä¸»è¦ä»‹ç»äº†åœ¨æ‚²è§‚åè°ƒä¸­ï¼š</p><ul><li>ä¼šç”¨åˆ°çš„å„ç§æ•°æ®ç»“æ„</li><li>Master è¿è¡Œäº†å‡ ä¸ªçº¿ç¨‹ï¼Œç­‰å¾… worker ä¸­ä¿¡æ¯çš„æ¥ä¸´</li><li>Worker è¿è¡Œäº† syncDDL çº¿ç¨‹ï¼Œç­‰å¾…ç€ DDL åˆ°æ¥</li></ul><p>è¿™ä¸€èŠ‚ä¸­ï¼Œç½—åˆ—äº†ç‰¹åˆ«å¤šçš„æ¦‚å¿µï¼Œçœ‹ä¸æ‡‚æ˜¯æ­£å¸¸çš„ï¼åœ¨ä¸‹ä¸€èŠ‚ï¼Œå°†ä» worker æ¥å—åˆ°ä¸€æ¡ DDL å¼€å§‹ï¼Œç›´åˆ°è¿™æ¡ DDL çš„ lock è§£é™¤çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ è¿™äº›ç»“æ„ä½“åˆ°åº•æ˜¯æ€ä¹ˆç”¨çš„ã€‚</p><blockquote><p>æŠ±æ­‰ç¬¬äºŒç« å°±æ˜¯æ‚²è§‚åè°ƒè¿™ä¸ªåŠŸèƒ½ğŸ˜‚ï¼Œæœ¬æ¥æƒ³è®©ç³»åˆ—æ–‡ç« çš„éš¾åº¦æ›´åŠ å¹³æ»‘ä¸€ç‚¹çš„ï¼Œä½†æ˜¯äººå¤ªæ‡’äº†ä¸€æ‹–å†æ‹–ğŸ˜‚ã€‚ä¸ºäº†é¿å…å†æ‹–ä¸‹å»ï¼Œå…ˆæŠŠå†™äº†çš„å­˜æ´»å‘å‡ºæ¥å§ï¼</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;ä¸€ã€æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;åˆ†åº“åˆ†è¡¨çš„æ‚²è§‚åè°ƒæ–¹æ³•æ˜¯ 2018 å¹´å¼€å‘çš„ç‰¹æ€§ï¼Œæ˜¯ DM é¦–æ¬¡æ”¯æŒ MySQL åˆ†åº“åˆ†è¡¨çš„è¿ç§»ã€‚ç”±äºåˆ†åº“åˆ†è¡¨åœ¨å„ä¸ªå…¬å¸ä¸­çš„</summary>
      
    
    
    
    <category term="DM æ•°æ®æ—…ç¨‹" scheme="http://example.com/categories/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B/"/>
    
    
    <category term="DM" scheme="http://example.com/tags/DM/"/>
    
    <category term="æºç é˜…è¯»" scheme="http://example.com/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    
  </entry>
  
  <entry>
    <title>DM æ•°æ®æ—…ç¨‹ 01ï¼šç¬¬ä¸€æ¬¡ start task</title>
    <link href="http://example.com/2023/01/03/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B-01%EF%BC%9A%E7%AC%AC%E4%B8%80%E6%AC%A1-start-task/"/>
    <id>http://example.com/2023/01/03/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B-01%EF%BC%9A%E7%AC%AC%E4%B8%80%E6%AC%A1-start-task/</id>
    <published>2023-01-02T18:58:33.000Z</published>
    <updated>2024-06-16T07:12:29.395Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h1><p>æœ¬æ–‡ä»¥ start task ä¸ºç›®çš„ï¼Œå¸¦ç€è¯»è€…ä» 0 åˆ° 1 å¯åŠ¨ä¸€ä¸ªæ•°æ®è¿ç§»ä»»åŠ¡ï¼Œæ—¨åœ¨è®©è¯»è€…äº†è§£åˆ°æœ€åŸºç¡€çš„ DM é€»è¾‘ã€‚æœ¬æ–‡å°†ç›´æ¥å‚ç…§é›†æˆæµ‹è¯• <a href="https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L27-L36">start_task</a> çš„è¿‡ç¨‹ï¼Œä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å±•å¼€ï¼š</p><ol><li>Start dm-master</li><li>Start dm-worker</li><li>ç»‘å®š source å’Œ dm-worker</li><li>Start task</li></ol><blockquote><p>æ³¨ï¼šä¸ºäº†ä¸“æ³¨äºæˆ‘ä»¬çš„ç›®çš„ï¼ˆstart taskï¼‰ï¼Œæœ¬æ–‡ä¸ä¼šå¯¹æ— å…³ä»£ç è¿›è¡Œè§£è¯»</p></blockquote><blockquote><p>å¤§å®¶å¯ä½¿ç”¨ <a href="https://pingcap.feishu.cn/mindnotes/bmncnqlO5BCrkgxFqabTLaz6EQh#mindmap">start/stop æµç¨‹</a> è¾…åŠ©é˜…è¯»</p><p>ç”±äºå†™è¿™ç¯‡çš„æ–‡ç« çš„æ—¶é—´æ˜¯ 2021 å¹´ 12 æœˆä»½ï¼Œæ‰€ä»¥æ‰€æœ‰çš„é“¾æ¥éƒ½æ˜¯åŸ DM repo çš„ğŸ˜‚</p></blockquote><h1 id="äºŒã€start-dm-master"><a href="#äºŒã€start-dm-master" class="headerlink" title="äºŒã€start dm-master"></a>äºŒã€start dm-master</h1><ol><li><a href="https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L27">./dm-master</a>ï¼ˆin <a href="https://github.com/pingcap/dm/blob/master/tests/_utils/run_dm_master">run_dm_master</a>ï¼‰ å¯åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå³è°ƒç”¨ <a href="https://github.com/pingcap/dm/blob/master/cmd/dm-master/main.go#L35">main å‡½æ•°</a>ï¼Œå…¶ä¸­ <a href="https://github.com/pingcap/dm/blob/master/cmd/dm-master/main.go#L69">master-server start</a></li><li><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L232">go electionNotify</a>ï¼šè¿™ä¸ªæ˜¯ä¸ºäº†<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L55">ç­‰å¾… </a><code>etcd election</code><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L55"> æˆåŠŸ</a>ï¼Œå¹¶åœ¨å…¶æˆåŠŸååšâ¬‡ï¸</li></ol><blockquote><p>DM master ä¸­å†…åµŒäº†ä¸€ä¸ª <a href="https://etcd.io/">etcd</a>ï¼Œç”¨äºå­˜å‚¨å„ç§å…ƒæ•°æ®ï¼Œå¹¶ä¸”å€Ÿæ­¤ä¿è¯ DM master çš„é«˜å¯ç”¨ã€‚åé¢éå¸¸å¤šçš„æ•°æ®å­˜å‚¨éƒ½ä¼šç”¨åˆ° etcdã€‚</p></blockquote><ol start="3"><li><p><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L71">startLeaderComponent</a>ï¼Œå…¶ä¸­æˆ‘ä»¬è¿™æ¬¡åªéœ€è¦å…³æ³¨ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/election.go#L173">s.scheduler.Start</a> ä¸­çš„<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L243">go observeWorkerEvent</a>ï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†</p><ol><li><p><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1617">go WatchWorkerEvent</a>ï¼šè¯¥å‡½æ•°é€šè¿‡ etcd client ç›‘å¬<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L198">æ˜¯å¦æœ‰ workerEvent å‡ºç°</a></p></li><li><p><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1619">handleWorkerEv</a>ï¼šæœ‰ workerEvent å‡ºç°æ—¶ï¼Œhandle it</p><ol><li><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1580">handleWorkerOffline</a></li><li><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1582">handleWorkerOnline</a></li></ol></li></ol></li><li><p>è¿™ä¸ªæ—¶å€™ï¼Œdm-master ç­‰å¾… workerEvent åˆ°æ¥</p></li></ol><h1 id="ä¸‰ã€start-dm-worker"><a href="#ä¸‰ã€start-dm-worker" class="headerlink" title="ä¸‰ã€start dm-worker"></a>ä¸‰ã€start dm-worker</h1><ol><li><p><a href="https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L29">./dm-worker</a>ï¼ˆin <a href="https://github.com/pingcap/dm/blob/master/tests/_utils/run_dm_worker">run_dm_worker</a>ï¼‰å¯åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå³è°ƒç”¨ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go">main å‡½æ•°</a>ï¼Œå…¶ä¸­<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go#L89"> worker-server start</a></p></li><li><p><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/cmd/dm-worker/main.go#L78">JoinMaster</a>ï¼šå…ˆå‘Šè¯‰ masterï¼Œæˆ‘æ¥äº†ï¼</p><ol><li>worker å…ˆåœ¨è¿™ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/join.go#L72">RegisterWorker</a>ï¼Œç„¶åä¼šè§¦å‘ master è°ƒç”¨ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L298">RegisterWorker</a></li><li>Master ä¼šè°ƒç”¨ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L308">AddWorker</a>ï¼Œç„¶å <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L907">PutWorkerInfo</a>ï¼ŒæŠŠç›¸åº”çš„ key-value <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/worker.go#L69">å†™åˆ° etcd</a> ä¸­</li><li>å¯ä»¥çœ‹åˆ°å†™åˆ° etcd ç”¨çš„æ˜¯ <code>clientv3.OpPut(key, value)</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ kv è¦æ‰§è¡Œ put æ“ä½œ</li><li>ä¹‹å‰çš„ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1617">go WatchWorkerEvent</a> ä¸­å°±ç›‘å¬åˆ°æœ‰äº‹ä»¶æ¥äº†ï¼Œå¹¶ä¸”åˆ¤æ–­å…¶ä¸º <code>mvccpb.PUT</code><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L224"> ç±»å‹</a>ï¼Œevent å¤„ç†ä¹‹åä¼šé€šè¿‡ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/keepalive.go#L242">outCh</a> ä¼ åˆ° handleWorkerEv ä¸­è¿›è¡Œå…·ä½“çš„<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1582">ä¸Šçº¿å¤„ç†</a></li><li>åˆšä¸Šçº¿çš„æ—¶å€™ï¼Œå°±ä¼šå»å„ç§æ‰¾ source å» boundï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¿˜æ²¡æœ‰ create sourceï¼Œæ‰€ä»¥ä¹Ÿæ‰¾ä¸åˆ° sourceï¼Œæš‚æ—¶å¯ä»¥ä¸å…³æ³¨è¿™é‡Œ</li></ol></li><li><p>Start task è¿˜éœ€è¦ bound sourceï¼Œé‚£ worker é¦–å…ˆè¦åšçš„å°±æ˜¯ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L169">observeSourceBound</a>ï¼Œè¿™é‡ŒåŒ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L243">observeWorkerEvent</a> æ˜¯ç±»ä¼¼çš„ï¼š</p><ol><li><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L404">go WatchSourceBound</a>ï¼šé€šè¿‡ etcd client ç›‘å¬<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/bound.go#L265">æ˜¯å¦æœ‰ sourceBound å‡ºç°</a></li><li><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L406">handleSourceBound</a>ï¼šä¸Šé¢ç›‘å¬åˆ°äº†ä¹‹åï¼Œåˆ™ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L582">operateSourceBound</a></li></ol></li><li><p>æ¥ä¸‹æ¥ï¼Œdm-worker ç­‰å¾… source bound</p></li></ol><h1 id="å››ã€operate-source-create"><a href="#å››ã€operate-source-create" class="headerlink" title="å››ã€operate-source create"></a>å››ã€operate-source create</h1><blockquote><p>DM ç”¨çš„å‘½ä»¤è¡Œå·¥å…·æ˜¯ <a href="https://github.com/spf13/cobra">cobra</a>ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯æ·±å…¥äº†è§£ä¸€ä¸‹</p></blockquote><ol><li><p>å‘½ä»¤è¡Œæ‰§è¡Œ <a href="https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L34">operate-source create</a>ï¼ˆin <a href="https://github.com/pingcap/dm/blob/master/tests/_utils/test_prepare#L128-L136">test_prepare</a>ï¼‰ï¼Œ<code>operate-source</code> è¿™ä¸ªå‘½ä»¤åœ¨ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/ctl.go#L68">NewOperateSourceCmd</a> æ³¨å†Œï¼Œå…·ä½“å®ç°åœ¨ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L39">operateSourceFunc</a></p></li><li><p>è¯»å–åˆ°è¯¥å‘½ä»¤åï¼Œå¼€å§‹<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L89">è§£æ</a>ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå³ <code>create</code>ï¼‰å¹¶<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L47-L48">è½¬æ¢</a>ï¼Œæœ€åè¢«<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/ctl/master/operate_source.go#L143-L152">æ‰“åŒ…é€</a>åˆ° masterï¼Œå¼€å§‹æ‰§è¡Œ master çš„ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1186">OperateSource</a> å‡½æ•°</p></li><li><p>è¯¥å‡½æ•°ä¸­ï¼Œmaster ä¼šä»å‘½ä»¤è¡Œä¸­ç»™å‡ºçš„é…ç½®æ–‡ä»¶è·¯å¾„</p><ol><li><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1205">è§£æå¹¶è°ƒæ•´</a> source config</li><li><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L1227">æŠŠ source cfg ä¹Ÿå­˜åˆ° etcd é‡Œ</a>ï¼Œå› ä¸º worker å¾…ä¼šè¦ç”¨</li><li><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L318-L319">Try to bound it to a free worker</a>ï¼šå› ä¸ºæˆ‘ä»¬æ˜¯ç¬¬ä¸€æ¬¡ start taskï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å¼€å¯ relay åŠŸèƒ½ï¼ˆ<a href="https://github.com/pingcap/dm/blob/master/tests/start_task/conf/source1.yaml#L4">test</a> ä¸­æ˜¯å¼€å¯äº†ï¼Œä½†æœ¬ç¯‡æ–‡ç« å‡è®¾ä¸å¼€å¯ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åªèƒ½ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1904-L1915">bound a free worker</a> äº†ã€‚</li><li>æœ€ç»ˆï¼Œé€šè¿‡ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L1936">PutSourceBound</a>ï¼ŒæŠŠ SourceBound <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/bound.go#L100">é€šè¿‡ etcd client å‘é€</a></li></ol></li><li><p>å‘é€ä¹‹åï¼Œworker å°±é€šè¿‡ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L404">go WatchSourceBound</a> ç›‘å¬åˆ°æœ‰ SourceBound å‡ºç°ï¼Œç„¶åè¿›è¡Œ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L582">operateSourceBound</a></p><ol><li>é¦–å…ˆéœ€è¦<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L649">æ‹¿åˆ° source cfg</a>ï¼Œå› ä¸ºä¸Šé¢çš„æ“ä½œéƒ½æ˜¯åœ¨ master æ‰§è¡Œçš„ï¼Œworker è¿™é‡Œå¹¶æ²¡æœ‰ source cfg</li><li>Source cfg ä¹Ÿæ˜¯é€šè¿‡ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/source.go#L83">etcd</a> æ‹¿åˆ°çš„ï¼Œæ­£å¥½ä¸Šé¢å­˜äº†</li></ol></li><li><p>ä¹‹åå°±å¯ä»¥<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/server.go#L658">å¼€å§‹ subtask äº†å§</a>ï¼</p><ol><li>ä½†æ˜¯å¹¶æ²¡æœ‰ã€‚ã€‚ã€‚æˆ‘ä»¬è¿˜æ²¡å¼€å§‹ start task å‘¢ï¼</li><li>æ‰€ä»¥ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L396">fetchSubTasksAndAdjust</a> å¹¶ä¸èƒ½æ‹¿åˆ° subtaskã€‚æ‹¿åˆ°æ˜¯ç©ºçš„</li></ol></li><li><p>é‚£æ²¡åŠæ³•äº†ï¼Œç»§ç»­<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L422">ç­‰</a>å‘—ï¼ˆåˆæ˜¯åŒæ ·çš„ watch/handle æœºåˆ¶ï¼‰</p><ol><li><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L638">go WatchSubTaskStage</a></li><li><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L640">handleSubTaskStage</a></li></ol></li></ol><h1 id="äº”ã€start-task"><a href="#äº”ã€start-task" class="headerlink" title="äº”ã€start-task"></a>äº”ã€start-task</h1><ol><li><p>å‘½ä»¤è¡Œæ‰§è¡Œ <a href="https://github.com/pingcap/dm/blob/master/tests/start_task/run.sh#L36">start-task</a>ï¼ˆin <a href="https://github.com/pingcap/dm/blob/master/tests/_utils/test_prepare#L53-L64">test_prepare</a>ï¼‰ï¼Œ<code>start-task</code> å‘½ä»¤çš„æ³¨å†Œå’Œå®ç°å‚è€ƒ <code>operate-source</code>ï¼Œæœ€åæ‰§è¡Œ master çš„ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L404">StartTask</a> å‡½æ•°</p></li><li><p>ç›´æ¥å¼€å§‹å°± <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L426">generateSubTask</a>ï¼ˆ<code>req.Task</code> ç›´æ¥ä¼ é€’çš„å°±æ˜¯è§£æå¥½çš„ <code>task.yaml</code> å­—ç¬¦ä¸²ï¼ŒåŸæ¥åœ¨å‘½ä»¤çš„å®ç°ä¸­å°±å¸®æˆ‘ä»¬è§£æå¥½å•¦ï¼‰ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯ç»è¿‡ä¸€äº› adjust å’Œ checkï¼Œ å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆäº† <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/config/subtask.go#L184">SubTask</a> struct</p></li><li><p>é‡ç‚¹æ¥äº†ï¼Œ<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/server.go#L489">AddSubTasks</a> -&gt; <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L727">NewSubTaskStage</a>ï¼ŒsubTask ç»ˆäºåˆ›å»ºå¥½äº†ï¼Œstage=runningï¼›å† <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/master/scheduler/scheduler.go#L739">put</a> è¿› etcdï¼Œå®Œç¾ã€‚å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆ†åˆ«æŠŠ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/ops.go#L91">SubTaskCfg</a> å’Œ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/pkg/ha/ops.go#L95">SubTaskStage</a> éƒ½ put è¿› etcd äº†ã€‚</p></li><li><p>é‚£ä¸Šé¢å°± watch åˆ° stage æ¥äº†ï¼Œå¯¹ SubTaskCfg è¿›è¡Œ<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L682">å¤„ç†</a>ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯è¦è¿›è¡Œ run çš„æ“ä½œï¼Œæˆ‘ä»¬è¿˜å¾—<a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L735-L743">å…ˆæŠŠ cfg æ‹¿å‡ºæ¥</a>ï¼Œæœ€å <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L716">startSubTask</a></p></li><li><p>startSubTask ä¸­ï¼Œä¼š <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L481">NewSubTask</a>ï¼Œå† <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/source_worker.go#L504">runSubTask</a>ã€‚subTask å†…éƒ¨å…·ä½“çš„æ‰§è¡Œç»„å»ºæ˜¯ç”± <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/unit/unit.go#L32-L67">unit</a> è´Ÿè´£çš„ï¼Œæ‰€ä»¥å®ƒä¼š</p><ol><li><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L200">initUnits</a></li><li><a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L207">st.run</a> å…¶å®ä¹Ÿæ˜¯ç”± <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L228">currentUnit</a> æ¥ <a href="https://github.com/pingcap/dm/blob/39b5e2098f21260c14373a23069f7e38395d8d7f/dm/worker/subtask.go#L233">Process</a></li></ol></li></ol><h1 id="å…­ã€ç»“è¯­"><a href="#å…­ã€ç»“è¯­" class="headerlink" title="å…­ã€ç»“è¯­"></a>å…­ã€ç»“è¯­</h1><p>åœ¨ unit Process åï¼Œstart-task å°±ç»“æŸå•¦ï¼æ˜¯ä¸æ˜¯è¿˜æ„çŠ¹æœªå°½å‘¢ï¼Ÿåˆ°åº•æœ‰å“ªäº› unit å‘¢ï¼Ÿè¿™äº› unit å†…éƒ¨åˆ°åº•æ˜¯æ€ä¹ˆ Process çš„å‘¢ï¼Ÿåœ¨åç»­çš„æ–‡ç« ä¸­ä¼šé™†ç»­å’Œå¤§å®¶è§é¢å“¦ã€‚</p><p>å…¶å®å†å¤è¯»ä¸€ä¸‹å…¨æ–‡ï¼Œæˆ‘ä»¬å‘ç°æœ¬ç¯‡æ–‡ç« å¹¶æ²¡æœ‰å¤ªå¤šå¾ˆéš¾çš„ä¸œè¥¿ï¼Œå¤§éƒ¨åˆ†ç¯‡å¹…éƒ½åœ¨æè¿°ä¸€äº›ã€Œå‡†å¤‡æ´»åŠ¨ã€ï¼Œå…¨ç¨‹ç”¨ etcd watchâ€”â€”master ç­‰å¾… worker åˆ°æ¥ã€worker ç­‰å¾… source åˆ°æ¥ã€source-worker ç­‰å¾… subtask åˆ°æ¥ã€‚ç­‰å°±å®Œäº‹äº†ã€‚</p><p>ä»»ä½•å»ºè®®å’Œåé¦ˆéƒ½æ¬¢è¿å‘Šè¯‰æˆ‘ã€‚ä¸‹æœŸå†è§ï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æ¦‚è¿°&quot;&gt;&lt;/a&gt;ä¸€ã€æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;æœ¬æ–‡ä»¥ start task ä¸ºç›®çš„ï¼Œå¸¦ç€è¯»è€…ä» 0 åˆ° 1 å¯åŠ¨ä¸€ä¸ªæ•°æ®è¿ç§»ä»»åŠ¡ï¼Œæ—¨åœ¨è®©è¯»è€…äº†è§£åˆ°æœ€åŸºç¡€çš„ DM é€»è¾‘ã€‚æœ¬</summary>
      
    
    
    
    <category term="DM æ•°æ®æ—…ç¨‹" scheme="http://example.com/categories/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B/"/>
    
    
    <category term="DM" scheme="http://example.com/tags/DM/"/>
    
    <category term="æºç é˜…è¯»" scheme="http://example.com/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    
  </entry>
  
  <entry>
    <title>DM æ•°æ®æ—…ç¨‹ 00ï¼šåºè¨€</title>
    <link href="http://example.com/2023/01/03/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B-00%EF%BC%9A%E5%BA%8F%E8%A8%80/"/>
    <id>http://example.com/2023/01/03/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B-00%EF%BC%9A%E5%BA%8F%E8%A8%80/</id>
    <published>2023-01-02T17:58:33.000Z</published>
    <updated>2024-06-16T07:03:47.893Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨æ­¤ä¹‹å‰å·²ç»æœ‰å®˜æ–¹å¾ˆå¤šå…³äº DM çš„ä¼˜ç§€æ–‡ç« äº†ï¼Œæ¯”å¦‚</p><ul><li><a href="https://pingcap.com/zh/blog/tidb-ecosystem-tools-3">TiDB Ecosystem Tools åŸç†è§£è¯»ç³»åˆ—ï¼ˆä¸‰ï¼‰TiDB Data Migration æ¶æ„è®¾è®¡ä¸å®ç°åŸç†</a></li><li><a href="https://pingcap.com/zh/blog?tag=DM%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB">DM æºç è§£è¯»</a></li></ul><p>è¿™äº›æ–‡ç« ä»åŸç†æ–¹é¢éå¸¸è¯¦å°½åœ°ä»‹ç»äº† DM çš„ç›¸å…³åŠŸèƒ½ï¼Œæ˜¯éå¸¸å¥½çš„å­¦ä¹ èµ„æ–™ã€‚ä½†æ˜¯</p><ul><li>å®ƒè®²è¿°çš„å†…å®¹è·¨åº¦è¾ƒå¤§ï¼Œå¯¹è¯»è€…æœ‰ä¸€å®šçš„é—¨æ§›ï¼Œ<a href="https://pingcap.com/zh/blog/dm-source-code-reading-1#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86">DM æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰åºï¼šèƒŒæ™¯çŸ¥è¯†</a></li><li>ç¼–è¾‘æ—¶é—´å¤ªè¿‡ä¹…è¿œï¼Œå·²ç»è¿‡å»ä¸¤å¹´å¤šäº†ã€‚DM æ–°å¢äº†ä¸€äº›æ–°ç‰¹æ€§ï¼Œå¯¹å¾ˆå¤šæ—§åŠŸèƒ½ä¹Ÿè¿›è¡Œäº†æ›´æ–°ä¼˜åŒ–ã€‚æ‰€ä»¥åŸæ–‡ä¸­æœ‰å¾ˆå¤šå†…å®¹å·²ç»è¿‡æ—¶ï¼ˆä½†å¤§éƒ¨åˆ†ä»æœ‰å‚è€ƒä»·å€¼ï¼‰ã€‚ä¾‹å¦‚ï¼š<a href="https://github.com/pingcap/dm/pull/540">DM ä½¿ç”¨ Dumpling æ›¿æ¢äº† MyDumper</a>ï¼Œ<a href="https://github.com/pingcap/dm/pull/568">æ–°å¢ä¹è§‚æ¨¡å¼</a>ç­‰ç­‰ã€‚</li></ul><p>è€Œå¤–éƒ¨çš„æ–‡ç« åˆ™å¤§éƒ¨åˆ†é›†ä¸­åœ¨ DM çš„ä½¿ç”¨ä¸Šè€Œä¸æ˜¯å®ç°ä¸Šã€‚</p><p>åŸºäºæ­¤ï¼Œæˆ‘æƒ³å¼€ä¸€ä¸ªå‘ã€ŠDM æ•°æ®æ—…ç¨‹ç³»åˆ—ã€‹ï¼Œæ¯ä¸€ç¯‡æ–‡ç« å°†ä»¥ä¸€ä¸ªä¸ªå°åŠŸèƒ½ä¸ºçº¿ç´¢ï¼Œå¸¦å¤§å®¶ç†è§£ DM ä¸­çš„å„ç§å®ç°ã€‚å¦‚æœè¦è®²çš„åŠŸèƒ½å¤ªå¤§ï¼Œä¹Ÿä¼šæ‹†åˆ†æˆå°æ¨¡å—æ”¾å‡ºã€‚æ¯ä¸€æ­¥éƒ½ä¼šå°½é‡æ”¾å‡º GitHub åœ°å€ï¼Œæ–¹ä¾¿å¤§å®¶è·Ÿè¸ªå­¦ä¹ ï½</p><blockquote><p>æ•°æ®æ—…ç¨‹å‡ºè‡ªäºé¾™å°‘ PPT ä¸­æåˆ°çš„ç”¨æˆ·æ—…ç¨‹å’Œæ•°æ®æ—…ç¨‹ï¼ŒæŒ‡æˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®ï¼ˆå­—èŠ‚ï¼‰ä¼ è¾“çš„é€”å¾„ã€‚åœ¨çœ‹ä¸€æ®µä»£ç æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒè¿™ä¸ªå­—èŠ‚æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œåˆ°å“ªé‡Œå»ï¼Œä½œç”¨æ˜¯ä»€ä¹ˆï¼Œé€šè¿‡ç†è§£æ•°æ®æ—…ç¨‹æ¥ç†è§£æ•´ä¸ªäº§å“å®ƒçš„æ·±å±‚åŸç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æ”¹å˜æ•°æ®è§„æ¨¡ï¼ˆæå‡/é™ä½æ•°æ®æ•°é‡çº§ï¼‰å’Œåœºæ™¯ï¼ˆä¸åŒçš„æ—¶é—´ä¸åŒçš„ä½ç½®ï¼‰æ¥ç†è§£äº§å“çš„ç¼ºç‚¹ï¼ˆbugï¼‰ã€‚</p></blockquote><blockquote><p>ä»¥ä¸Šéƒ½æ˜¯ä¸ªäººæ‹™è§ï¼ˆåºŸè¯ï¼‰ï¼Œæ¬¢è¿ææ„è§ï½</p></blockquote><p>å½“ç„¶ï¼Œç°åœ¨çš„ DM æ­£åœ¨é£é€Ÿçš„å‘å±•è¿­ä»£ä¸­ï¼Œæœ¬ç³»åˆ—çš„å†…å®¹ä¹Ÿå¯èƒ½é©¬ä¸Šå°±ä¼šè¿‡æ—¶ï¼Œç°åœ¨æ˜¯ 2021 å¹´ 10 æœˆ 31 æ—¥ï¼Œæœ¬ç³»åˆ—æ–‡ç« é¢„è®¡å°†ä¼šè¦†ç›– DM v5.3.0-vx.x.x çš„ä»£ç é€»è¾‘ã€‚</p><p>å¦‚æœè®¤ä¸ºæ–‡ç« ä¸­æœ‰ä»»ä½•å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Œ æ¬¢è¿å¤§å®¶æå‡ºè‡ªå·±çš„æƒ³æ³•ã€‚åŒæ ·åœ°ï¼Œå› ä¸º DM è¿˜åœ¨å¿«é€Ÿè¿­ä»£ï¼Œè¿˜æœ‰å¾ˆå¤šåœ°æ–¹éƒ½æœ‰æ”¹è¿›çš„åœ°æ–¹ï¼Œå¦‚æœå¤§å®¶å¯¹ä»£ç å®ç°æœ‰ä»»ä½•ç–‘é—®ï¼Œä¹Ÿéƒ½å¯ä»¥å» repo ä¸­ç›´æ¥æ issueã€‚</p><h1 id="è¯»è€…è¦æ±‚"><a href="#è¯»è€…è¦æ±‚" class="headerlink" title="è¯»è€…è¦æ±‚"></a>è¯»è€…è¦æ±‚</h1><ul><li>èƒ½çœ‹æ‡‚ Golang è¯­æ³•</li><li>äº†è§£ grpcã€etcd</li><li>è®¡åˆ’ç« èŠ‚</li><li>Start task</li><li>Stop task</li><li>Pause task</li><li>Resume task</li><li>Full modeï¼ˆdumplingï¼‰</li><li>Incremental modeï¼ˆsyncerï¼‰</li><li>Block-allow list</li><li>Binlog-filter</li><li>Enable relay log</li><li>Permistic sharding ddl</li><li>Optimistic sharding ddl</li><li>ã€‚ã€‚ã€‚</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;åœ¨æ­¤ä¹‹å‰å·²ç»æœ‰å®˜æ–¹å¾ˆå¤šå…³äº DM çš„ä¼˜ç§€æ–‡ç« äº†ï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://pingcap.com/z</summary>
      
    
    
    
    <category term="DM æ•°æ®æ—…ç¨‹" scheme="http://example.com/categories/DM-%E6%95%B0%E6%8D%AE%E6%97%85%E7%A8%8B/"/>
    
    
    <category term="DM" scheme="http://example.com/tags/DM/"/>
    
    <category term="æºç é˜…è¯»" scheme="http://example.com/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    
  </entry>
  
  <entry>
    <title>2022å¹´ç»ˆæ€»ç»“â€”â€”å¹¸è¿å¼€å¿ƒçš„ä¸€å¹´</title>
    <link href="http://example.com/2023/01/01/2022%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>http://example.com/2023/01/01/2022%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</id>
    <published>2023-01-01T12:00:52.000Z</published>
    <updated>2024-06-16T08:39:15.976Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬¬ä¸€æ¬¡å†™å¹´ç»ˆæ€»ç»“å‘€ï¼Œå°è¯•è®°å½•ä¸€ä¸‹ã€‚ä¸€å¹´ä¸‹æ¥è¿˜çœŸå‘ç”Ÿäº†ä¸å°‘äº‹ã€‚çœ‹çœ‹è‡ªå·±æœ‰å•¥æ”¶è·æœ‰å•¥æˆé•¿ã€‚</p><h2 id="å·¥ä½œ"><a href="#å·¥ä½œ" class="headerlink" title="å·¥ä½œ"></a>å·¥ä½œ</h2><p>å…ˆè¯´è¯´å·¥ä½œå§ã€‚ä»å—å¤§æ¯•ä¸šåï¼Œæˆ‘å»äº† PingCAPï¼ˆè´µå¸ï¼‰å·¥ä½œï¼Œç°åœ¨åœ¨è´µå¸çš„ DMï¼ˆData Migrationï¼‰å›¢é˜Ÿå·¥ä½œï¼Œå·®ä¸å¤šå°±åœ¨æ•°æ®å¯¼å…¥ã€æ•°æ®è¿ç§»ä»¥åŠå…¶å¯¹åº”çš„äº‘ä¸Šç‰ˆæœ¬è¿™äº›åœ°æ–¹æ¬ç –ã€‚å»å¹´å°±æœ‰åœ¨è´µå¸å®ä¹ ï¼Œä¸»è¦åœ¨ç»´æŠ¤ DMï¼Œä¹Ÿå°±æ˜¯æ€ä¹ˆæŠŠä¸€æ¡ binlog å†™åˆ°ä¸‹æ¸¸ TiDB é‡Œé¢ï¼Œå’Œ MySQL binlog æ‰“äº¤é“æ¯”è¾ƒå¤šã€‚ä»Šå¹´å…¥èŒåï¼Œé¡ºåº”å…¬å¸çš„æˆ˜ç•¥ï¼Œä¸»è¦åœ¨ tidbcloud.com ä¸Š CRUDï¼Œå¸®åŠ©ç”¨æˆ·åœ¨ cloud ä¸Šå¯¼å…¥æˆ–è¿ç§»æ•°æ®ï¼Œå’Œ k8sã€CRUD ä»¥åŠç”¨æˆ·ä½“éªŒæ‰“äº¤é“æ¯”è¾ƒå¤šã€‚</p><p>ç®€å•æ€»ç»“ä¸€ä¸‹å­¦åˆ°çš„ä¸œè¥¿å§ï¼Œä»å®ä¹ åˆ°ç°åœ¨ï¼š</p><ol><li>å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•</li><li>å¤šçº¿ç¨‹ä»£ç </li><li>review ä»£ç </li><li>å†™è®¾è®¡æ–‡æ¡£</li><li>ç†è§£ä¸€ä¸ªéœ€æ±‚æ˜¯ä»»ä½•å·¥ä½œçš„ç¬¬ä¸€æ­¥</li><li>å¯¹ä¸€ä¸ªéœ€æ±‚è¿›è¡Œé¡¹ç›®ç®¡ç†ï¼Œä»¥å°½å¯èƒ½åœ°æŒ‰æ—¶äº¤ä»˜ï¼ˆå½“ç„¶ç°åœ¨è¿˜åšçš„ä¸å¤Ÿå¥½ã€‚ã€‚ã€‚ï¼‰</li><li>å­¦ä¹ äº† K8s/CRD/Operator/AWS/Pulumi ç›¸å…³çš„çŸ¥è¯†ï¼Œèƒ½çœ‹æ‡‚ä»£ç ï¼Œå¹¶ç¼–å†™ç®€å•çš„ä»£ç </li><li>æ›´å¤šåœ°è€ƒè™‘ç”¨æˆ·ä½“éªŒ</li><li>ã€‚ã€‚</li></ol><p>å†è°ˆè°ˆå·¥ä½œçš„æ„Ÿå—ã€‚å¯¹äºæˆ‘è¿™ç¬¬ä¸€ä»½æ­£å¼çš„å·¥ä½œï¼Œæˆ‘æ˜¯éå¸¸æ»¡æ„æˆ‘å½“å‰çš„å›¢é˜Ÿå’Œå…¬å¸çš„ã€‚ä¸è®ºæ˜¯å…¬å¸è¿˜æ˜¯å›¢é˜Ÿå†…ï¼Œå¤§ä½¬éå¸¸å¤šï¼Œå¯ä»¥åœ¨ä»–ä»¬èº«ä¸Šå­¦åˆ°å¾ˆå¤šä¸œè¥¿ã€‚å›¢é˜Ÿå†…çš„äººå¤§å®¶å®äº‹æ±‚æ˜¯ã€äº’ç›¸å¸®åŠ©ï¼Œæˆ‘æ˜¯æ²¡æœ‰é‡åˆ°ä»€ä¹ˆå°”è™æˆ‘è¯ˆï¼Œä¸ºäº†åˆ©ç›Šèµ·å†²çªçš„æƒ…å†µï¼Œå¾ˆ niceï¼è™½ç„¶å¾ˆå¤šäººè¯Ÿç—…è´µå¸å·²ç»ä¸æ˜¯ä»¥å‰çš„è´µå¸äº†ï¼Œä¹‹å‰çš„å·¥ç¨‹å¸ˆæ–‡åŒ–æ²¡æœ‰é‚£ä¹ˆçº¯ç²¹äº†ï¼Œä½†æˆ‘è¿˜æ˜¯å¸®å…¬å¸è¯´å¥è¯ã€‚ä»Šå¹´ 2022 å¹´çš„ç¯å¢ƒå¤§å®¶è¿˜æ˜¯å¯ä»¥çœ‹å¾—åˆ°çš„ï¼ŒåŒæ ·ä»¥å·¥ç¨‹å¸ˆæ–‡åŒ–è‘—ç§°çš„å°é©¬ï¼Œå·²ç»æŠŠ 22 å±Šå¤§éƒ¨åˆ†çš„åº”å±Šç”Ÿè£æ‰äº†ï¼Œæˆ‘æœ‰åŒå­¦å°±åœ¨è¢«è£åå•é‡Œã€‚æ‰€ä»¥å¯¹äºä¸€ä¸ªåŒæ ·æ˜¯åº”å±Šç”Ÿçš„æˆ‘ï¼Œæˆ‘è¿˜æ˜¯å¾ˆä½©æœå…¬å¸çš„æˆ˜ç•¥å’Œå®šåŠ›ï¼Œä»¥å¸®åŠ©å…¬å¸ç»§ç»­ç”Ÿå­˜ä¸‹å»ï¼Œæ¯•ç«Ÿæ´»ä¸‹å»æ‰æœ‰æœªæ¥ã€‚æˆ‘çŸ¥é“è¿™ä¸¤è€…ä¹Ÿå¹¶ä¸æ˜¯å†²çªçš„ï¼Œä½†æˆ‘è¿˜æ˜¯åº†å¹¸å…¬å¸èƒ½è®©æˆ‘æœ‰ä¸€ä¸ªåœ°æ–¹å­¦ä¹ å’Œæˆé•¿ã€‚å½“ç„¶ï¼Œå¤§å®¶ä¹Ÿéƒ½ä¼šå¸Œæœ›è‡ªå·±çš„å…¬å¸èƒ½è¶Šæ¥è¶Šå¥½ï¼</p><p>è®°å½•ä¸€ä¸‹ï¼šä»Šå¹´ 1 æœˆä»½å…¨ç»„äººå‘˜é½èšåŒ—äº¬å›¢ï¼ˆmianï¼‰å»ºï¼ˆjiï¼‰ï¼Œç¬¬ä¸€æ¬¡æ­£å¼è§åˆ°äº†æ¥è‡ªæˆéƒ½ã€åŒ—äº¬ã€æ­å·ã€ä¸Šæµ·çš„å„ä½å¤§ä½¬ï¼Œä¹Ÿè·Ÿç€ mentor æ²¡ç¾æ²¡è‡Šåœ°è¹­åƒè¹­å–ç©äº†ä¸¤å¤©å“ˆå“ˆã€‚ä¸å¾—ä¸è¯´ï¼Œå¤ªçˆ½äº†å“ˆå“ˆå“ˆğŸ¶ã€‚</p><h2 id="å­¦ç”Ÿç”Ÿæ¶¯"><a href="#å­¦ç”Ÿç”Ÿæ¶¯" class="headerlink" title="å­¦ç”Ÿç”Ÿæ¶¯"></a>å­¦ç”Ÿç”Ÿæ¶¯</h2><p>ä»Šå¹´ç»ˆäºä»ç¡•å£«æ¯•ä¸šäº†ã€‚å¦è¯šåœ°å¯¹ç¡•å£«è¿™ä¸‰å¹´åšä¸ªç®€çŸ­çš„æ€»ç»“å§ã€‚è‡ªå·±åœ¨ä¸‰å¹´ä¸­å‡ ä¹æ²¡æœ‰ä»»ä½•çš„æˆæœï¼Œè¿ä¸€ç¯‡è®ºæ–‡éƒ½æ²¡å‘è¿‡ï¼Œåœ¨ç§‘ç ”è¿™æ¡è·¯ä¸Šï¼Œæˆ‘ä¹Ÿç®—çš„ä¸Šæ˜¯å½»åº•å¤±è´¥äº†ã€‚ä¸è¿‡è¿™ä¸‰å¹´æ¯”è¾ƒå¹¸è¿çš„æ˜¯ï¼Œæˆ‘åœ¨ç ”ä¸€ä¸‹å°±æ„è¯†åˆ°äº†è‡ªå·±ä¸é€‚åˆèµ°ç§‘ç ”è¿™æ¡è·¯ï¼Œæ‰€ä»¥èŠ±äº†å¾ˆå¤šæ—¶é—´åœ¨æ€è€ƒå’Œå®è·µè‡ªå·±ä»¥åè¦åšä»€ä¹ˆè¿™ä¸ªé—®é¢˜ä¸Šã€‚ä¹Ÿæ‰¾åˆ°äº†è‡ªè®¤ä¸ºçŸ­ä¸­æœŸå†…å‘å±•è¿˜ä¸é”™çš„æ•°æ®åº“è¿™æ¡é“è·¯ã€‚</p><blockquote><p>åœ¨è¯»ä¹¦æœŸé—´ï¼Œç»å¸¸å’ŒåŒå­¦è°ƒä¾ƒï¼Œè¯»ç ”æœ€å¤§çš„ä½œç”¨ï¼Œå°±æ˜¯å‘ç°äº†è¯»ç ”æ²¡ç”¨ã€‚å“ˆå“ˆå“ˆï¼Œè¿™å¥è¯å¯èƒ½æœ‰ç‚¹è¿‡ï¼Œä½†ä¹Ÿæ˜¯åªæœ‰è¯»ç ”åï¼Œæ‰èƒ½ç†è§£å¾ˆå¤šå¤§ä½¬è¯´çš„ï¼Œã€Œå›½å†…çš„ç ”ç©¶æœ‰äº›æµ®èºã€ä¸­<strong>æµ®èº</strong>çš„å«ä¹‰å§ï¼ˆå¹æ¯ï¼‰</p></blockquote><h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><p>åœ¨æ¯•ä¸šåï¼Œæ­£å¼å¼€å¯äº†æˆ‘è‡ªå·±çš„ç”Ÿæ´»ã€‚è¿™ä¸€æ¬¡å’Œæˆ‘ä¹‹å‰çš„å®ä¹ éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ‹’ç»äº†åˆç§Ÿï¼Œé€‰æ‹©äº†ä¸€ä¸ªäººæ•´ç§Ÿä¸€ä¸ªå°åŒºé‡Œçš„ä¸€å®¤ä¸€å…ã€‚åœ¨çœé’±å’Œç”Ÿæ´»è´¨é‡ä¸­é€‰æ‹©äº†åè€…ã€‚å½“æ—¶åœ¨æ¥å¹¿å·ä¹‹å‰å°±ç–¯ç‹‚åœ°çœ‹æˆ¿ï¼Œå¹»æƒ³ç€è‡ªå·±ä¸€ä¸ªäººè‡ªç”±çš„ç”Ÿæ´»å“ˆå“ˆå“ˆã€‚æ¥äº†å¹¿å·ä¹‹åå°±ç–¯ç‹‚åœ°æ‰¾æˆ¿å­ï¼Œä¸€å®¤ä¸€å…çš„å°åŒºæˆ¿å®åœ¨æ˜¯å¤ªå°‘äº†ğŸ¤®ã€‚æˆ‘é‡åˆ°ä¸€ä¸ª 2500/æœˆ 60 å¹³çš„æˆ¿å­ï¼Œä¸‹åˆ 2 ç‚¹çœ‹å®Œé¥­ï¼Œä¸‹åˆ 4 ç‚¹å°±è¢«ç§Ÿå‡ºå»äº†ï¼å°±æ˜¯è¢«æˆ‘åé¢ä¸€ä¸ªçœ‹æˆ¿çš„äººç§Ÿèµ°äº†ã€‚ã€‚ã€‚è¿™æ•ˆç‡ç®€ç›´äº†ã€‚æœ€åç§Ÿåˆ°äº†ä¸€é—´ 3000 å‡ºå¤´çš„ä¸€å®¤ä¸€å…ï¼Œæˆ¿ä¸œéå¸¸ niceï¼Œç»™é…äº†æ–°çš„é©¬æ¡¶ã€ç”µçƒ­æ°´å™¨ã€ç©ºè°ƒã€æŠ½æ²¹çƒŸæœºå’Œç¶å°ï¼Œç”šè‡³è¿˜é‡æ–°è£…ä¿®äº†å¨æˆ¿ï¼è™½ç„¶è¿˜æœ‰ä¸è¶³çš„åœ°æ–¹ï¼Œä½†æˆ‘å·²ç»éå¸¸æ»¡è¶³äº†ï¼</p><h3 id="æ·»ç½®æ–°ç‰©ä»¶"><a href="#æ·»ç½®æ–°ç‰©ä»¶" class="headerlink" title="æ·»ç½®æ–°ç‰©ä»¶"></a>æ·»ç½®æ–°ç‰©ä»¶</h3><h4 id="å¤§æ¡Œå­âœ…"><a href="#å¤§æ¡Œå­âœ…" class="headerlink" title="å¤§æ¡Œå­âœ…"></a>å¤§æ¡Œå­âœ…</h4><p>åœ¨è‡ªå·±ç§Ÿäº†æˆ¿å­ä¹‹åï¼Œå¿…ç„¶ä¹Ÿæ˜¯è¦æ•´ä¸€ä¸ªæ­£ç»çš„å°ä¹¦æ¡Œçš„å•¦ã€‚åœ¨é—²é±¼ä¸Šè¹²äº†å¥½å‡ å¤©ï¼Œä¸­é—´è¿˜å»æ—è¾¹çš„äºŒæ‰‹å¸‚åœºçœ‹äº†ï¼Œæœ€åèŠ± 220 è¹²åˆ°äº†è¿™å¼  160âœ–ï¸70 çš„æ¡Œå­ï¼ˆè´§æ‹‰æ‹‰éƒ½èŠ±äº† 100+ ğŸ˜‚ï¼‰</p><p><a href="https://sm.ms/image/jHu2RD9PSVkeXoW" target="_blank"><img src="https://s2.loli.net/2024/06/16/jHu2RD9PSVkeXoW.jpg" ></a></p><h4 id="æ´æ´æ¿âœ…"><a href="#æ´æ´æ¿âœ…" class="headerlink" title="æ´æ´æ¿âœ…"></a>æ´æ´æ¿âœ…</h4><p>çœ‹ B ç«™è§†é¢‘è¿˜çœ‹åˆ°äº†è¿™ç§ç«‹å¼çš„æ´æ´æ¿ï¼Œæƒ³åˆ°å‡ºç§Ÿå±‹é‡Œä¹Ÿå®Œå…¨æ²¡æœ‰ä¹¦æ¶ã€å°ç‰©ä»¶çš„æ”¶çº³ä»€ä¹ˆçš„ï¼Œå°±æ•´äº†ä¸€ä¸ªã€‚è¿˜è¡Œå“ˆï¼Œæ¯”å…‰ç§ƒç§ƒçš„å¥½å¤šäº†ã€‚</p><p><a href="https://sm.ms/image/gs7OwZPaprB3JxI" target="_blank"><img src="https://s2.loli.net/2024/06/16/gs7OwZPaprB3JxI.jpg" ></a></p><h4 id="äººä½“å·¥å­¦æ¤…âœ…"><a href="#äººä½“å·¥å­¦æ¤…âœ…" class="headerlink" title="äººä½“å·¥å­¦æ¤…âœ…"></a>äººä½“å·¥å­¦æ¤…âœ…</h4><p>æ¯•ç«Ÿå·¥ä½œéœ€è¦ï¼Œç«‹é©¬ä¹Ÿæ•´äº†ä¸ªå¥½æ¤…å­ï¼Œå¯ä»¥ç”¨å¾ˆä¹…äº†</p><p><a href="https://sm.ms/image/KnuqMXJTmroE5NV" target="_blank"><img src="https://s2.loli.net/2024/06/16/KnuqMXJTmroE5NV.jpg" ></a></p><h4 id="ç‰™å¥—âœ…"><a href="#ç‰™å¥—âœ…" class="headerlink" title="ç‰™å¥—âœ…"></a>ç‰™å¥—âœ…</h4><p>ä»å¾ˆå¤šå¹´å‰è‡ªå·±å°±è§‰å¾—è‡ªå·±çš„ç‰™é½¿ä¸é½ï¼Œæƒ³è¦åšç‰™é½¿çŸ«æ­£ï¼Œä½†æ— å¥ˆå› ä¸ºé’±æˆ–è€…é•¿ä½åœ°ä¸ç¨³å®šç­‰åŸå› ï¼Œä¸€ç›´æ²¡å¼€å§‹ã€‚æ‰€ä»¥åœ¨å¹¿å·å®‰é¡¿ä¸‹æ¥ä¹‹åï¼Œç«‹é©¬å¼€å§‹äº†ç‰™é½¿çŸ«æ­£çš„è¿›ç¨‹ã€‚ä¸Šä¸‹å·¦å³æ‹”äº† 4 é¢—ç‰™ï¼å¦ˆè€¶ï¼Œç–¼æ­»æˆ‘äº†ã€‚</p><h4 id="æ‰“å‡»å«âœ…"><a href="#æ‰“å‡»å«âœ…" class="headerlink" title="æ‰“å‡»å«âœ…"></a>æ‰“å‡»å«âœ…</h4><p>æˆ‘è‡ªå·±å¯¹éŸ³ä¹ä¹Ÿä¸€ç›´æŒºæ„Ÿå…´è¶£çš„ï¼Œå“ˆå“ˆå°±æƒ³åšç‚¹éŸ³ä¹ç›¸å…³çš„çˆ±å¥½ã€‚ä¹‹å‰æœ‰å…³æ³¨ä¸€ä¸ªç»åœ°çš„ä¸»æ’­ï¼Œä»–ç©çš„æ‰“å‡»å«è¶…é…·ï¼ç°åœ¨æœ‰è‡ªå·±çš„ç©ºé—´å’Œç”Ÿæ´»äº†ï¼Œå°±æ•´äº†ä¸€ä¸ªäºŒæ‰‹çš„å…¥é—¨æ¬¾ã€‚</p><p><a href="https://sm.ms/image/K5g4Ip78FGziUON" target="_blank"><img src="https://s2.loli.net/2024/06/16/K5g4Ip78FGziUON.jpg" ></a></p><p>ä½†æ˜¯éå¸¸å¯æƒœï¼Œåœ¨ç»ƒå®Œå…¥é—¨æ›² <a href="https://www.bilibili.com/video/BV1bv4y1B7RL/?spm_id_from=333.999.0.0&vd_source=1d41e3899bfb8af8d65144aad99bbde1">Luz letter</a> åï¼Œåœ¨å¦å¤–æŒ‘äº†ä¸€é¦–<a href="https://www.bilibili.com/video/BV1q8411E7ts/?spm_id_from=333.999.0.0&vd_source=1d41e3899bfb8af8d65144aad99bbde1">è¿›é˜¶çš„æ›²å­</a>ç»ƒä¹ è¿‡ç¨‹ä¸­å°±å‘ç°äº†é—®é¢˜â€”â€”ç¯å…‰è·Ÿä¸ä¸ŠèŠ‚å¥ã€‚ã€‚ã€‚è¿™ä¸ªå…¥é—¨æ¬¾çš„ç¯å…‰é¢‘ç‡å¤ªä½äº†ï¼Œå°è¯•äº†å¾ˆå¤šæ¬¡ä¹‹åè¿˜æ˜¯æ”¾å¼ƒäº†ç»§ç»­åœ¨è¿™æ¬¾ä¸Šé¢ç»§ç»­ç»ƒï¼Œç„¶åè’åºŸåˆ°ç°åœ¨ï¼ˆå“ï¼Œå¯æƒœã€‚</p><h4 id="PS5-å¤§ç”µè§†âœ…"><a href="#PS5-å¤§ç”µè§†âœ…" class="headerlink" title="PS5/å¤§ç”µè§†âœ…"></a>PS5/å¤§ç”µè§†âœ…</h4><p>åœ¨åŒåä¸€çš„æ—¶å€™ï¼Œæ”¶äº†ä¸€ä¸ªäºŒæ‰‹çš„ PS5ï¼Œè¿˜é…äº†ä¸€ä¸ªå¤§ç”µè§†ï¼è¿™ä¸ªå°å‡ºç§Ÿå±‹ä¹Ÿç»ˆäºå¯ä»¥çœ‹ç”µè§†äº†ã€‚</p><p><a href="https://sm.ms/image/EeSkDPKI1gFwsin" target="_blank"><img src="https://s2.loli.net/2024/06/16/EeSkDPKI1gFwsin.jpg" ></a></p><p>é¡ºå¸¦è¯„ä»·ä¸€ä¸‹è€å¤´ç¯å§ï¼Œåœ¨ PS5 ä¸Šç©çš„ç¬¬ä¸€ä¸ªæ¸¸æˆã€‚ä¹‹å‰ä¹Ÿæœ‰ç©è¿‡é»‘é­‚ 3ï¼Œ1ï¼‰æ‰€ä»¥å¹¶æ²¡æœ‰ç¬¬ä¸€æ¬¡ç©é­‚ç±»æ¸¸æˆé‚£ç§å†²å‡»äº†ï¼Œè€Œä¸”è€å¤´ç¯çš„éš¾åº¦ç³»æ•°ç›¸æ¯”é»‘é­‚ç¡®å®ä½äº†ä¸å°‘ï¼Œè½¬è§’æ€å°‘äº†ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥è€ç©å®¶åœ¨è½¬è§’å¤„å›å¤´çš„æ—¶å€™ç»å¸¸â€œå¤±æœ›â€å“ˆå“ˆå“ˆã€‚2ï¼‰è¿˜æœ‰ä¸€ä¸ªç‚¹æ˜¯å †æ–™å¤ªä¸¥é‡äº†å­ï¼Œé‡å¤çš„é—è¿¹ï¼Œé‡å¤çš„ bossï¼Œé‡å¤çš„å¢“åœ°ï¼Œå•ä¸€çš„å°æ€ªï¼Œæ•£è½åœ¨äº¤ç•Œåœ°çš„å„å¤„ï¼Œå®Œå…¨æ²¡æœ‰ä»€ä¹ˆåŠ¨åŠ›å»ä¸€ä¸€æ‰«å›¾ã€‚ã€‚ã€‚3ï¼‰å¯¹äºå‰§æƒ…ï¼Œæˆ‘è¿˜æ˜¯çŸ¥é“é­‚ç±»æ¸¸æˆçš„å¥—è·¯çš„â€”â€”å‰§æƒ…éƒ½æ•£è½åœ¨å„ä¸ªé“å…·ä¸Šï¼Œä½†æˆ‘çœŸçš„åšä¸åˆ°å…¨æœé›†å‘€ï¼ğŸ˜­ï¼Œè€Œä¸”ç”±äºåœ°å›¾å¤ªå¤§ï¼Œå‰§æƒ…å¤ªæ•£ï¼Œæˆ‘çœŸçš„è®°ä¸ä½å„ä¸ªæ”¯çº¿å‘€ï¼4ï¼‰å¯¹äºå¼€æ”¾ä¸–ç•Œï¼Œç”±äºä¹Ÿç©è¿‡å¡å°”è¾¾è¿™ç§ç¥ä½œï¼Œåªèƒ½è¯´å®«å´è‹±é«˜æŠŠé­‚å…ƒç´ å¡åˆ°äº†ä¸€ä¸ªå¼€æ”¾ä¸–ç•Œä¸­ï¼Œè‡³äºè¿™ä¸ªå¼€æ”¾ä¸–ç•Œå®ƒâ€œå¼€æ”¾â€å—ï¼Ÿè¿™ç®¡æˆ‘å•¥äº‹ã€‚</p><p>å“ˆå“ˆå“ˆï¼Œåæ§½å®Œäº†ï¼Œä½†è¿˜æ˜¯è¦è¯´æˆ‘ç©äº†å‡ åä¸ªå°æ—¶ï¼Œæ¯æ¬¡ä¸€ç©å°±æ˜¯äº”å…­ä¸ªå°æ—¶èµ·æ­¥ï¼Œè¿˜æ˜¯å¾ˆä¸é”™çš„æ¸¸æˆçš„ï¼Œåªä¸è¿‡åœ¨åæœŸæ„Ÿå—åˆ°äº†ä¹å‘³ï¼Œæ²¡èƒ½æˆä¸ºè‰¾å°”ç™»ä¹‹ç‹ã€‚</p><h3 id="åšé¥­"><a href="#åšé¥­" class="headerlink" title="åšé¥­"></a>åšé¥­</h3><p>è¦æœ‰ç”Ÿæ´»æ°”æ¯ï¼Œä¸€å®šç¦»ä¸å¼€è‡ªå·±åšé¥­ï¼ä»Šå¹´è‡ªå·±å’Œå¥³æœ‹å‹ä¸€èµ·åšäº†å¥½å¤šå¥½å¤šçš„èœï¼è€Œä¸”å°‘æœ‰å¤±è´¥ï¼Œå“ˆå“ˆå“ˆå¥³ç¥¨ç›´ç§°æˆ‘ä¸ºå¨æˆ¿å°å¤©æ‰å“ˆå“ˆï¼ˆä¹Ÿä¸æ’é™¤å¥¹æ˜¯ä¸ºäº†è®©æˆ‘å¤šåšé¥­ğŸ¶ï¼‰ã€‚è‡ªå·±åšé¥­çœŸçš„æ²¡é‚£ä¹ˆéš¾ï¼Œè€Œä¸”å‘³é“ä¹Ÿæ¯”å¤§éƒ¨åˆ†åŸä¸­æ‘çš„å¤–å–å¥½åƒï¼Œå°±æ˜¯æ”¶æ‹¾å¨æˆ¿ã€æ´—ç¢—ä»€ä¹ˆçš„å¤ªéº»çƒ¦äº†ï¼Œåšå®Œé¥­åƒå®Œé¥­æ”¶æ‹¾å®ŒåŸºæœ¬æ™šä¸Šå°±å•¥éƒ½ä¸æƒ³å¹²äº†åªæƒ³ç˜«ç€ã€‚ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™èƒ½ä¹°ä¸ªæ´—ç¢—æœºå‘€ã€‚</p><img src=https://cdn-us.imgs.moe/2023/01/02/63b2c89a14f9a.jpg width=30% /><h3 id="çœ‹ä¹¦"><a href="#çœ‹ä¹¦" class="headerlink" title="çœ‹ä¹¦"></a>çœ‹ä¹¦</h3><p>ä»Šå¹´çœ‹ä¹¦çš„ç›®æ ‡ç®—æ˜¯è¾¾åˆ°äº†ï¼Œä¸€å…±çœ‹å®Œäº† 13 æœ¬ä¹¦ã€‚æ„Ÿè§‰è‡ªå·±çœ‹ä¹¦çš„è¾“å…¥æ•ˆç‡è¿˜ä¸å¤Ÿã€‚ã€‚ã€‚è¿˜éœ€è¦ç»§ç»­å­¦ä¹ ğŸ˜‚</p><ul><li>æµªæ½®ä¹‹å·…</li><li>ç¨‹åºå‘˜çš„ä¿®ç‚¼ä¹‹é“</li><li>å°ç‹å­çš„é¢†æ‚Ÿ</li><li>MySQL æ˜¯æ€ä¹ˆè¿è¡Œçš„</li><li>é»‘å®¢ä¸ç”»å®¶</li><li>æ‚‰è¾¾å¤š</li><li>kubernetes in action</li><li>å¼‚ä¹¡äºº</li><li>æ²™å‘ä¸Šçš„å¿ƒç†å­¦</li><li>æ•°æ®ç”Ÿæ€ï¼šMySQL å¤åˆ¶æŠ€æœ¯ä¸ç”Ÿäº§å®è·µ</li><li>å®‡å®™çš„æœ€åä¸‰åˆ†é’Ÿ</li><li>shell è„šæœ¬åŸºç¡€æ•™ç¨‹</li><li>æªç‚®ã€ç—…èŒä¸é’¢é“</li></ul><h3 id="çˆ±æƒ…"><a href="#çˆ±æƒ…" class="headerlink" title="çˆ±æƒ…"></a>çˆ±æƒ…</h3><p>ä»Šå¹´æ˜¯å’Œæˆ‘å¥³æœ‹å‹ï¼ˆä»¥åå°±å«å¥¹å°æ‡’è™«å§ï¼ï¼‰åœ¨ä¸€èµ·çš„ç¬¬ä¸€å¹´ï½ç®—æ˜¯æ”¶è·äº†æ¢¦æƒ³ä¸­ç”œèœœçš„çˆ±æƒ…äº†ï¼ˆç—´æ±‰ç¬‘ğŸ˜Šï¼‰ã€‚è¿™ä¸€å¹´æˆ‘ä»¬å…ˆæ˜¯åº¦è¿‡äº†æ‹çˆ±ä¸­æœ€éš¾ç†¬çš„å¼‚åœ°æ‹ï¼æœ€é•¿æœ‰ä¸‰ä¸ªæœˆçš„æ—¶é—´æ²¡æœ‰è§é¢ï¼Œå¯èƒ½ä»¥åéƒ½ä¸ä¼šå†æœ‰è¿™ä¹ˆé•¿æ—¶é—´ä¸è§é¢çš„æœºä¼šäº†å§ã€‚</p><p>ä»Šå¹´å’Œå°æ‡’è™«åº¦è¿‡äº†è¶…çº§å¤šçš„ç¬¬ä¸€æ¬¡ã€‚</p><ul><li>ç¬¬ä¸€æ¬¡æ”¶åˆ°æ–°å¹´ç¤¼ç‰©</li></ul><p><a href="https://sm.ms/image/7vwNYZQUSeMxodC" target="_blank"><img src="https://s2.loli.net/2024/06/16/7vwNYZQUSeMxodC.jpg" ></a></p><ul><li><p>ç¬¬ä¸€æ¬¡ä¸€èµ·å¼¹é’¢ç´</p></li><li><p>ç¬¬ä¸€æ¬¡ä¸€èµ·æ—…æ¸¸ã€çœ‹æµ·ã€å¸†èˆ¹ã€æ¡¨æ¿ã€æµ·è¾¹éœ²è¥ã€æ—¥å‡º</p></li><li><p>ç¬¬ä¸€æ¬¡ææ€–å¯†å®¤</p></li><li><p>ç¬¬ä¸€æ¬¡é€šå…³æ¸¸æˆ</p></li></ul><p><a href="https://sm.ms/image/fORLaluNng48Fyc" target="_blank"><img src="https://s2.loli.net/2024/06/16/fORLaluNng48Fyc.jpg" ></a></p><ul><li>ç¬¬ä¸€æ¬¡è„±å£ç§€</li></ul><p><a href="https://sm.ms/image/RyXg19LSFOuNoqA" target="_blank"><img src="https://s2.loli.net/2024/06/16/RyXg19LSFOuNoqA.jpg" ></a></p><h3 id="ç–«æƒ…"><a href="#ç–«æƒ…" class="headerlink" title="ç–«æƒ…"></a>ç–«æƒ…</h3><p>åœ¨ 2022 å¹´çš„å¹´æœ«ï¼Œç–«æƒ…ç»ˆäºç®—æ˜¯â€œç»“æŸâ€äº†ã€‚ã€‚ã€‚åœ¨æ¯•ä¸šå‰ç”±äºæ±Ÿè‹æ•™è‚²å±€çš„æ”¿ç­–ã€Œä¸Šæµ·ä¸€å¤©ä¸è§£å°ï¼Œå—äº¬é«˜æ ¡ä¹Ÿä¸è§£å°ã€ï¼Œç»“æœå¯¼è‡´æˆ‘ä»¬åœ¨å—å¤§è¢«å°äº†ä¸¤ä¸ªæœˆï¼è¿™è®©æˆ‘ä»¬è®ºæ–‡å†™å®Œäº†ï¼Œç­”è¾©å®Œäº†ä¹Ÿæ²¡æœ‰æœºä¼šå‡ºæ ¡ã€‚è¿™ç›´æ¥å¯¼è‡´æˆ‘åœ¨èƒ½æ¯•ä¸šç¦»æ ¡çš„ç¬¬ä¸€æ—¶é—´ç¦»å¼€äº†å­¦æ ¡ï¼Œå¹¶ä¸å¸¦ä¸€ç‚¹ç•™æ‹ã€‚æœ¬æ¥æ‰“ç®—åœ¨å—äº¬å¥½å¥½ç©ä¸€ä¸‹çš„ä¹Ÿæ²¡æœ‰æ—¶é—´äº†ã€‚å¼‚åœ°æ‹çš„å½±å“ä¹Ÿåœ¨è¿™ä¸¤ä¸ªæœˆé‡Œè¾¾åˆ°äº†é¡¶å³°ã€‚ã€‚ã€‚çœŸæ˜¯å¤ªç…ç†¬äº†ã€‚</p><p>å¦å¤–ï¼Œä»ä»Šå¹´å¹´åº•å¹¿å·ç–«æƒ…å¼€å§‹ï¼Œè‡ªå·±å‡ ä¹å°±ä¸€ç›´ remote åˆ°äº†ç°åœ¨ï¼Œå®Œå…¨æ”¹å˜äº†å·¥ä½œä¹ æƒ¯ã€‚ã€‚ã€‚æ”¾å¼€åä¹Ÿé˜³äº†ä¸€æ¬¡ï¼Œä½†è¿˜ä¸ç®—ä¸¥é‡ï¼Œä¹Ÿå°±çƒ§äº†ä¸€å¤©å¤šï¼Œå‘çƒ§çš„æ—¶å€™åŸºæœ¬åœ¨ç¡è§‰ï¼Œé€€çƒ§ååŸºæœ¬å°±æ²¡ä»€ä¹ˆäº‹äº†ã€‚</p><p>æˆ‘è®¤ä¸ºåªè¦ä¸å†æä»€ä¹ˆç±»ä¼¼å°åŸçš„äº‹æƒ…ï¼Œç–«æƒ…å°±ç®—æ˜¯è¿‡å»äº†ã€‚å› ä¸ºè¿™æ˜¯ä¸å¯é¿å…çš„äº‹æƒ…å‘€ï¼Œåœ¨è¯»å®Œã€Šæªç‚®ã€ç—…èŒä¸é’¢é“ã€‹åçŸ¥é“ï¼Œäººç±»<strong>ä»æ¥</strong>æ²¡æœ‰æˆ˜èƒœè¿‡ç—…æ¯’ã€‚è¿™æ˜¯å®¢è§‚äº‹å®ã€‚ä¸€æ—¦æ”¾å¼€åï¼Œæˆ‘ä»¬å°±å†ä¹Ÿå›ä¸å»äº†ï¼Œäº¦æˆ–è€…è¯´æˆ‘ä»¬ç¬é—´å°±å›åˆ°äº†è¿‡å»ã€‚æœ‰ç—…æ²»ç—…ï¼ŒæŒºå¥½çš„ã€‚</p><h2 id="2023"><a href="#2023" class="headerlink" title="2023"></a>2023</h2><p>2023 å¹´è¦åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>å·¥ä½œä¸Šï¼Œthink more and do more</li><li>è¯»ä¹¦å’Œåšé¥­çš„ä¹ æƒ¯èƒ½ç»§ç»­ä¿æŒ</li><li>è®¡åˆ’ä¸­çš„é”»ç‚¼åˆ«æ‹‰ä¸‹äº†ï¼Œå¤šè·‘æ­¥ï¼Œå‚åŠ ä¸€åœºåŠé©¬</li><li>æ¥¼ä¸‹å°±æœ‰ç½‘çƒåœºï¼Œå¤§å­¦å­¦çš„ç½‘çƒä¸€å®šè¦æ¡èµ·æ¥ç©ç©</li><li>å»æ›´å¤šåœ°æ–¹æ—…è¡Œï¼ˆå“ˆå°”æ»¨ã€æ½®æ±•</li><li>æ¢ä¸ªå¥½ç‚¹çš„ launchpad ç»§ç»­ç©ç©</li></ul><p>æ€»ä¹‹ï¼Œ2022 è¿˜è¡Œï¼Œ2023 ç»§ç»­åŠ æ²¹ğŸ’ª</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ç¬¬ä¸€æ¬¡å†™å¹´ç»ˆæ€»ç»“å‘€ï¼Œå°è¯•è®°å½•ä¸€ä¸‹ã€‚ä¸€å¹´ä¸‹æ¥è¿˜çœŸå‘ç”Ÿäº†ä¸å°‘äº‹ã€‚çœ‹çœ‹è‡ªå·±æœ‰å•¥æ”¶è·æœ‰å•¥æˆé•¿ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å·¥ä½œ&quot;&gt;&lt;a href=&quot;#å·¥ä½œ&quot; class=&quot;headerlink&quot; title=&quot;å·¥ä½œ&quot;&gt;&lt;/a&gt;å·¥ä½œ&lt;/h2&gt;&lt;p&gt;å…ˆè¯´è¯´å·¥ä½œå§ã€‚ä»å—å¤§æ¯•ä¸šåï¼Œæˆ‘å»äº† P</summary>
      
    
    
    
    <category term="å¹´ç»ˆæ€»ç»“" scheme="http://example.com/categories/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="ç”Ÿæ´»" scheme="http://example.com/tags/%E7%94%9F%E6%B4%BB/"/>
    
    <category term="å·¥ä½œ" scheme="http://example.com/tags/%E5%B7%A5%E4%BD%9C/"/>
    
  </entry>
  
</feed>
